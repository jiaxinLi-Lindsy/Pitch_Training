<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotChatHistory">
    <option name="conversations">
      <list>
        <Conversation>
          <option name="createTime" value="1762667412018" />
          <option name="id" value="019a672a3a327cbb89ed4d8625aa320a" />
          <option name="title" value="实验结果邮件方案与封装" />
          <option name="turns">
            <list>
              <Turn>
                <option name="agent" value="" />
                <option name="aguiRpcList">
                  <list>
                    <option value="{&quot;type&quot;:&quot;RUN_STARTED&quot;,&quot;timestamp&quot;:1762667601,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a672d1c1a7fdfb87b56e0d5fdd88d&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;threadId&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;runId&quot;:&quot;019a672d1c1a7fdfb87b56e0d5fdd88d&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762667604,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a672d1c1a7fdfb87b56e0d5fdd88d&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762667611,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a672d1c1a7fdfb87b56e0d5fdd88d&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a672d1c1a7fdfb87b56e0d5fdd88d&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a672d1c1a7fdfb87b56e0d5fdd88d&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a672d1c1a7fdfb87b56e0d5fdd88d&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;我仔细阅读了您的实验代码，这是一个动态音高辨别实验（ABX范式）。现在我为您提供几个在实验完成后发送结果到邮箱的方案：\n\n## 方案对比\n\n### 方案1：使用后端服务（推荐）⭐⭐⭐⭐⭐\n**实现方式：**\n- 创建一个简单的后端API（Node.js/Python/PHP等）\n- 前端通过AJAX将实验数据发送到后端\n- 后端使用邮件服务（如Nodemailer、SMTP等）发送邮件\n\n**优点：**\n- ✅ 安全性高，邮箱凭证不暴露在前端\n- ✅ 可靠性强，可以处理发送失败重试\n- ✅ 可以记录日志、数据库存储\n- ✅ 支持附件（CSV文件）\n\n**缺点：**\n- ❌ 需要部署后端服务器\n- ❌ 开发成本相对较高\n\n---\n\n### 方案2：使用第三方邮件API服务 ⭐⭐⭐⭐\n**实现方式：**\n- 使用EmailJS、SendGrid、Mailgun等第三方服务\n- 前端直接调用API发送邮件\n- 通过API Key进行认证\n\n**优点：**\n- ✅ 无需自建后端\n- ✅ 实现简单快速\n- ✅ 服务稳定可靠\n- ✅ 有免费额度\n\n**缺点：**\n- ❌ API Key暴露在前端（可通过域名限制缓解）\n- ❌ 依赖第三方服务\n- ❌ 可能有发送限制\n\n---\n\n### 方案3：使用mailto协议 ⭐⭐\n**实现方式：**\n- 使用`mailto:`链接打开用户默认邮件客户端\n- 预填充收件人、主题和部分内容\n\n**优点：**\n- ✅ 实现极其简单\n- ✅ 无需后端或第三方服务\n- ✅ 完全客户端操作\n\n**缺点：**\n- ❌ 需要用户手动发送\n- ❌ 无法自动发送\n- ❌ 内容长度受限\n- ❌ 用户体验较差\n\n---\n\n### 方案4：使用Google Apps Script ⭐⭐⭐⭐\n**实现方式：**\n- 创建Google Apps Script作为Web App\n- 前端POST数据到Script\n- Script使用Gmail API发送邮件\n\n**优点：**\n- ✅ 免费且稳定\n- ✅ 与Google账户集成\n- ✅ 支持附件\n- ✅ 无需自建服务器\n\n**缺点：**\n- ❌ 需要Google账户\n- ❌ 有每日配额限制\n- ❌ 配置稍复杂\n\n---\n\n## 我的推荐\n\n根据您的需求，我推荐以下组合方案：\n\n###  **首选：方案2（EmailJS）+ 方案1备选**\n- **短期快速实现**：使用EmailJS，5分钟即可集成\n- **长期规划**：如果实验规模扩大，迁移到自建后端\n\n###  **封装结构**\n```\nE:/Projects/Pitch_Training/\n├── js/\n│   └── emailService.js          # 邮件服务封装\n├── config/\n│   └── emailConfig.js           # 邮件配置（可选）\n├── ABX_falling_low.html\n├── ABX_rising_low.html\n└── ... (其他实验文件)\n```\n\n---\n\n## 具体实现建议\n\n### 使用EmailJS的实现步骤：\n\n1. **注册EmailJS账户**（免费200封/月）\n2. **创建邮件模板**\n3. **集成到您的代码**\n\n我可以为您创建：\n- `js/emailService.js` - 封装的邮件发送模块\n- 修改各个实验HTML文件，在实验完成后调用邮件发送功能\n\n---\n\n## 您希望我如何继续？\n\n请告诉我：\n1. **您倾向于哪个方案？**（如果不确定，我推荐方案2-EmailJS）\n2. **是否需要发送CSV附件？**（还是只发送结果摘要）\n3. **收件人邮箱是固定的还是可配置的？**\n4. **是否需要用户确认后再发送？**（还是自动发送）\n\n确认后，我将立即为您创建封装好的邮件服务模块！&quot;},&quot;timestamp&quot;:1762667611,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762667628,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a672d1c1a7fdfb87b56e0d5fdd88d&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a672d1c1a7fdfb87b56e0d5fdd88d&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762667628,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a672d1c1a7fdfb87b56e0d5fdd88d&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:1376,&quot;prompt_tokens&quot;:33869,&quot;total_tokens&quot;:35245,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:null,&quot;cache_write_tokens&quot;:33865},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;RUN_FINISHED&quot;,&quot;timestamp&quot;:1762667628,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a672d1c1a7fdfb87b56e0d5fdd88d&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;threadId&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;runId&quot;:&quot;019a672d1c1a7fdfb87b56e0d5fdd88d&quot;}" />
                  </list>
                </option>
                <option name="answer" value="" />
                <option name="chatMode" value="AGENT" />
                <option name="chatResource" value="user" />
                <option name="codeReferences">
                  <list>
                    <CodeReferencesBean>
                      <option name="content" value="" />
                      <option name="filename" value="ABX_falling_high.html" />
                      <option name="language" value="HTML" />
                      <option name="range">
                        <CommitRange>
                          <option name="dontDisplayRange" value="true" />
                          <option name="dontSelectByRange" value="true" />
                          <option name="end">
                            <Position />
                          </option>
                          <option name="start">
                            <Position />
                          </option>
                        </CommitRange>
                      </option>
                      <option name="type" value="full_file" />
                      <option name="url" value="file:///E:/Projects/Pitch_Training/ABX_falling_high.html" />
                    </CodeReferencesBean>
                    <CodeReferencesBean>
                      <option name="content" value="" />
                      <option name="filename" value="ABX_rising_low.html" />
                      <option name="language" value="HTML" />
                      <option name="range">
                        <CommitRange>
                          <option name="dontDisplayRange" value="true" />
                          <option name="dontSelectByRange" value="true" />
                          <option name="end">
                            <Position />
                          </option>
                          <option name="start">
                            <Position />
                          </option>
                        </CommitRange>
                      </option>
                      <option name="type" value="full_file" />
                      <option name="url" value="file:///E:/Projects/Pitch_Training/ABX_rising_low.html" />
                    </CodeReferencesBean>
                    <CodeReferencesBean>
                      <option name="content" value="" />
                      <option name="filename" value="ABX_level_high.html" />
                      <option name="language" value="HTML" />
                      <option name="range">
                        <CommitRange>
                          <option name="dontDisplayRange" value="true" />
                          <option name="dontSelectByRange" value="true" />
                          <option name="end">
                            <Position />
                          </option>
                          <option name="start">
                            <Position />
                          </option>
                        </CommitRange>
                      </option>
                      <option name="type" value="full_file" />
                      <option name="url" value="file:///E:/Projects/Pitch_Training/ABX_level_high.html" />
                    </CodeReferencesBean>
                    <CodeReferencesBean>
                      <option name="content" value="" />
                      <option name="filename" value="ABX_falling_low.html" />
                      <option name="language" value="HTML" />
                      <option name="range">
                        <CommitRange>
                          <option name="dontDisplayRange" value="true" />
                          <option name="dontSelectByRange" value="true" />
                          <option name="end">
                            <Position />
                          </option>
                          <option name="start">
                            <Position />
                          </option>
                        </CommitRange>
                      </option>
                      <option name="type" value="full_file" />
                      <option name="url" value="file:///E:/Projects/Pitch_Training/ABX_falling_low.html" />
                    </CodeReferencesBean>
                    <CodeReferencesBean>
                      <option name="content" value="" />
                      <option name="filename" value="ABX_level_low.html" />
                      <option name="language" value="HTML" />
                      <option name="range">
                        <CommitRange>
                          <option name="dontDisplayRange" value="true" />
                          <option name="dontSelectByRange" value="true" />
                          <option name="end">
                            <Position />
                          </option>
                          <option name="start">
                            <Position />
                          </option>
                        </CommitRange>
                      </option>
                      <option name="type" value="full_file" />
                      <option name="url" value="file:///E:/Projects/Pitch_Training/ABX_level_low.html" />
                    </CodeReferencesBean>
                    <CodeReferencesBean>
                      <option name="content" value="" />
                      <option name="filename" value="ABX_rising_high.html" />
                      <option name="language" value="HTML" />
                      <option name="range">
                        <CommitRange>
                          <option name="dontDisplayRange" value="true" />
                          <option name="dontSelectByRange" value="true" />
                          <option name="end">
                            <Position />
                          </option>
                          <option name="start">
                            <Position />
                          </option>
                        </CommitRange>
                      </option>
                      <option name="type" value="full_file" />
                      <option name="url" value="file:///E:/Projects/Pitch_Training/ABX_rising_high.html" />
                    </CodeReferencesBean>
                  </list>
                </option>
                <option name="command" value="normal" />
                <option name="conversationId" value="019a672a3a327cbb89ed4d8625aa320a" />
                <option name="historyDocumentMap">
                  <map>
                    <entry key="file:///E:/Projects/Pitch_Training/ABX_falling_high.html" value="&lt;!DOCTYPE html&gt;&#10;&lt;html&gt;&#10;&lt;head&gt;&#10;    &lt;title&gt;PLOYU-Peng's Lab: Pitch Sensitivity Training&lt;/title&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;style&gt;&#10;        body {&#10;            font-family: Arial, sans-serif;&#10;            margin: 20px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .container {&#10;            max-width: 800px;&#10;            margin: 0 auto;&#10;            padding: 20px;&#10;            background-color: white;&#10;            border-radius: 10px;&#10;            box-shadow: 0 0 10px rgba(0,0,0,0.1);&#10;            display: flex;&#10;            flex-direction: column;&#10;            align-items: center;&#10;        }&#10;        .header {&#10;            text-align: center;&#10;            margin-bottom: 40px;&#10;            width: 100%;&#10;        }&#10;        .training-info {&#10;            font-size: 16px;&#10;            color: #555;&#10;            margin-top: 10px;&#10;            margin-bottom: 5px;&#10;            text-align: center;&#10;        }&#10;        .instruction-text {&#10;            font-size: 14px;&#10;            color: #777;&#10;            margin-bottom: 15px;&#10;            text-align: center;&#10;            font-style: italic;&#10;        }&#10;        .button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .prompt-text {&#10;            text-align: center;&#10;            font-size: 20px;&#10;            margin-bottom: 25px;&#10;            margin-top: 30px;&#10;            font-weight: bold;&#10;        }&#10;        .response-button {&#10;            width: 160px;&#10;            height: 160px;&#10;            font-size: 26px;&#10;            margin: 0 40px;&#10;            border-radius: 15px;&#10;            border: none;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.1);&#10;            transition: all 0.3s ease;&#10;        }&#10;        .response-button:hover:enabled {&#10;            transform: translateY(-3px);&#10;            box-shadow: 0 6px 12px rgba(0,0,0,0.15);&#10;        }&#10;        .response-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .button-playing {&#10;            animation: pulse 1s ease-in-out infinite;&#10;            box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            transform: scale(1.05);&#10;        }&#10;        @keyframes pulse {&#10;            0%, 100% {&#10;                box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            }&#10;            50% {&#10;                box-shadow: 0 0 30px rgba(102, 204, 255, 1);&#10;            }&#10;        }&#10;        .control-button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            gap: 30px;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .control-button {&#10;            padding: 14px 28px;&#10;            font-size: 18px;&#10;            border-radius: 8px;&#10;            border: none;&#10;            background-color: #4CAF50;&#10;            color: white;&#10;            cursor: pointer;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .control-button:hover:enabled {&#10;            background-color: #3e8e41;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .control-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .control-button:disabled {&#10;            background-color: #cccccc;&#10;            cursor: not-allowed;&#10;            box-shadow: none;&#10;        }&#10;        .feedback {&#10;            text-align: center;&#10;            height: 100px;&#10;            margin: 30px 0;&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;        }&#10;        .status {&#10;            width: 350px;&#10;            height: 68px;&#10;            text-align: center;&#10;            font-size: 18px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            margin: 0 auto;&#10;            padding: 10px;&#10;            background-color: #f9f9f9;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.05);&#10;        }&#10;        .debug-info {&#10;            font-size: 12px;&#10;            color: #777;&#10;            margin-top: 30px;&#10;            text-align: left;&#10;            display: none;&#10;            max-height: 300px;&#10;            overflow-y: auto;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            padding: 15px;&#10;            width: 100%;&#10;        }&#10;        .results-container {&#10;            display: none;&#10;            margin-top: 30px;&#10;            padding: 20px;&#10;            background-color: #f0f8ff;&#10;            border-radius: 8px;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.1);&#10;            width: 100%;&#10;        }&#10;        .result-heading {&#10;            text-align: center;&#10;            margin-bottom: 20px;&#10;            color: #2c3e50;&#10;        }&#10;        .result-table {&#10;            width: 100%;&#10;            border-collapse: collapse;&#10;            margin-bottom: 20px;&#10;        }&#10;        .result-table th, .result-table td {&#10;            padding: 12px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .result-table th {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .result-table tr:nth-child(even) {&#10;            background-color: #f2f2f2;&#10;        }&#10;        .result-interpretation {&#10;            background-color: #e8f4f8;&#10;            padding: 15px;&#10;            border-radius: 5px;&#10;            margin-bottom: 20px;&#10;        }&#10;        .back-button {&#10;            display: block;&#10;            margin: 0 auto;&#10;            padding: 14px 28px;&#10;            background-color: #3498db;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .back-button:hover {&#10;            background-color: #2980b9;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .back-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        .chart-container {&#10;            height: 300px;&#10;            margin: 20px 0;&#10;            background-color: white;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;            padding: 10px;&#10;        }&#10;        .auxiliary-buttons {&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            margin-top: 30px;&#10;            gap: 20px;&#10;            flex-wrap: wrap;&#10;        }&#10;        .auxiliary-buttons button {&#10;            padding: 10px 15px;&#10;            border-radius: 5px;&#10;            border: 1px solid #ddd;&#10;            background-color: #f0f0f0;&#10;            cursor: pointer;&#10;            transition: all 0.2s ease;&#10;        }&#10;        .auxiliary-buttons button:hover {&#10;            background-color: #e0e0e0;&#10;        }&#10;        .diagnostic-overlay {&#10;            position: fixed;&#10;            top: 0;&#10;            left: 0;&#10;            width: 100%;&#10;            height: 100%;&#10;            background-color: rgba(0, 0, 0, 0.8);&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            z-index: 1000;&#10;            display: none;&#10;        }&#10;        .diagnostic-content {&#10;            width: 80%;&#10;            max-width: 700px;&#10;            max-height: 80%;&#10;            overflow-y: auto;&#10;            background-color: white;&#10;            padding: 20px;&#10;            border-radius: 8px;&#10;            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);&#10;        }&#10;        .diagnostic-heading {&#10;            text-align: center;&#10;            color: #e74c3c;&#10;            margin-bottom: 20px;&#10;            font-size: 24px;&#10;        }&#10;        .diagnostic-close {&#10;            float: right;&#10;            font-size: 20px;&#10;            cursor: pointer;&#10;            color: #777;&#10;        }&#10;        .diagnostic-close:hover {&#10;            color: #333;&#10;        }&#10;        .diagnostic-section {&#10;            margin-bottom: 15px;&#10;            padding: 10px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;        }&#10;        .diagnostic-actions {&#10;            text-align: center;&#10;            margin-top: 20px;&#10;        }&#10;        .diagnostic-action-button {&#10;            padding: 10px 20px;&#10;            margin: 0 10px;&#10;            border: none;&#10;            border-radius: 5px;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;        }&#10;        .retry-button {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .retry-button:hover {&#10;            background-color: #2980b9;&#10;        }&#10;        .continue-button {&#10;            background-color: #2ecc71;&#10;            color: white;&#10;        }&#10;        .continue-button:hover {&#10;            background-color: #27ae60;&#10;        }&#10;        .diagnostic-file-status {&#10;            display: flex;&#10;            flex-wrap: wrap;&#10;            gap: 10px;&#10;        }&#10;        .file-status-item {&#10;            font-size: 12px;&#10;            padding: 5px 10px;&#10;            border-radius: 3px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .file-found {&#10;            color: #27ae60;&#10;            border-left: 3px solid #27ae60;&#10;        }&#10;        .file-missing {&#10;            color: #e74c3c;&#10;            border-left: 3px solid #e74c3c;&#10;        }&#10;        .statistics-table {&#10;            width: 100%;&#10;            margin: 10px 0;&#10;            border-collapse: collapse;&#10;        }&#10;        .statistics-table th, .statistics-table td {&#10;            padding: 8px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .statistics-table th {&#10;            background-color: #f0f0f0;&#10;        }&#10;        .direction-stats-good {&#10;            color: #27ae60;&#10;        }&#10;        .direction-stats-warning {&#10;            color: #f39c12;&#10;        }&#10;        .direction-stats-bad {&#10;            color: #e74c3c;&#10;        }&#10;        @media (max-width: 600px) {&#10;            .response-button {&#10;                width: 130px;&#10;                height: 130px;&#10;                font-size: 22px;&#10;                margin: 0 20px;&#10;            }&#10;            .control-button {&#10;                padding: 12px 20px;&#10;            }&#10;        }&#10;        .print-button {&#10;            padding: 14px 28px;&#10;            margin: 20px auto;&#10;            background-color: #9b59b6;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;            display: block;&#10;        }&#10;        .print-button:hover {&#10;            background-color: #8e44ad;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .print-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        @media print {&#10;            body {&#10;                background-color: white;&#10;                margin: 0;&#10;                padding: 0;&#10;            }&#10;            .container {&#10;                max-width: 100%;&#10;                box-shadow: none;&#10;                padding: 10px;&#10;            }&#10;            .back-button, .print-button, .auxiliary-buttons {&#10;                display: none;&#10;            }&#10;            .results-container {&#10;                display: block !important;&#10;                box-shadow: none;&#10;                background-color: white;&#10;                padding: 0;&#10;            }&#10;            .chart-container {&#10;                border: 1px solid #ddd;&#10;                background-color: white;&#10;            }&#10;            .result-table th {&#10;                background-color: #f0f0f0 !important;&#10;                color: black !important;&#10;            }&#10;            .result-interpretation {&#10;                background-color: white;&#10;                border: 1px solid #ddd;&#10;            }&#10;            * {&#10;                -webkit-print-color-adjust: exact !important;&#10;                print-color-adjust: exact !important;&#10;            }&#10;        }&#10;        .progress-bar-container {&#10;            width: 100%;&#10;            height: 20px;&#10;            background-color: #e0e0e0;&#10;            border-radius: 10px;&#10;            margin: 10px 0;&#10;            overflow: hidden;&#10;        }&#10;        .progress-bar {&#10;            height: 100%;&#10;            background-color: #4CAF50;&#10;            border-radius: 10px;&#10;            transition: width 0.3s ease;&#10;        }&#10;        .progress-label {&#10;            text-align: center;&#10;            font-size: 14px;&#10;            color: #555;&#10;            margin-top: 5px;&#10;        }&#10;        .highlight-box {&#10;            background-color: #fffacd;&#10;            border: 2px solid #ffd700;&#10;            padding: 15px;&#10;            border-radius: 8px;&#10;            margin: 20px 0;&#10;            text-align: center;&#10;        }&#10;        .highlight-value {&#10;            font-size: 28px;&#10;            font-weight: bold;&#10;            color: #e74c3c;&#10;            margin: 10px 0;&#10;        }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;div class=&quot;container&quot;&gt;&#10;        &lt;div class=&quot;header&quot;&gt;&#10;            &lt;img src=&quot;Media/animation.gif&quot; alt=&quot;Experiment animation&quot;&gt;&#10;            &lt;div class=&quot;training-info&quot;&gt;High Falling Tone Discrimination (ABX)&lt;/div&gt;&#10;            &lt;div class=&quot;instruction-text&quot;&gt;請判斷第三個音聽起來更像第一個還是第二個音&lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div id=&quot;experimentContainer&quot;&gt;&#10;            &lt;div class=&quot;control-button-container&quot;&gt;&#10;                &lt;input id=&quot;start&quot; type=&quot;button&quot; value=&quot;開始實驗&quot; onclick=&quot;start_onclick()&quot; class=&quot;control-button&quot;&gt;&#10;                &lt;input id=&quot;viewResult&quot; type=&quot;button&quot; value=&quot;查看結果&quot; onclick=&quot;view_onclick()&quot; class=&quot;control-button&quot; disabled&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;prompt-text&quot; id=&quot;promptText&quot;&gt;&#10;                第三個音更像...&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;firstBtn&quot; type=&quot;button&quot; value=&quot;第一個音&quot; onclick=&quot;processAnswer(1)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;                &lt;input id=&quot;secondBtn&quot; type=&quot;button&quot; value=&quot;第二個音&quot; onclick=&quot;processAnswer(2)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;feedback&quot;&gt;&#10;                &lt;img id=&quot;smile&quot; src=&quot;Media/null.gif&quot; width=&quot;100&quot; height=&quot;84&quot; alt=&quot;Feedback&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;text1&quot; class=&quot;status&quot; readonly&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;progress-bar-container&quot;&gt;&#10;                &lt;div class=&quot;progress-bar&quot; id=&quot;progressBar&quot; style=&quot;width: 0%&quot;&gt;&lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;progress-label&quot; id=&quot;progressLabel&quot;&gt;Progress: 0%&lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;debug-info&quot; id=&quot;debugInfo&quot;&gt;&#10;                Debug information will be displayed here&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot;&gt;&#10;                &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;showDebug&quot; onclick=&quot;toggleDebug()&quot;&gt; Show Debug Info&lt;/label&gt;&#10;                &lt;button onclick=&quot;testAudio()&quot;&gt;Test All Audio&lt;/button&gt;&#10;                &lt;button onclick=&quot;showDiagnostics()&quot;&gt;Diagnostics&lt;/button&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot; id=&quot;exportBtn&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div id=&quot;resultsContainer&quot; class=&quot;results-container&quot;&gt;&#10;            &lt;h2 class=&quot;result-heading&quot;&gt;Dynamic Pitch Discrimination Test Results (ABX)&lt;/h2&gt;&#10;            &#10;            &lt;div class=&quot;highlight-box&quot;&gt;&#10;                &lt;h3 style=&quot;margin-top: 0;&quot;&gt;Just Noticeable Difference (JND)&lt;/h3&gt;&#10;                &lt;div class=&quot;highlight-value&quot; id=&quot;jndValue&quot;&gt;--&lt;/div&gt;&#10;                &lt;p style=&quot;margin-bottom: 0; font-size: 14px; color: #666;&quot;&gt;&#10;                    This represents the minimum detectable difference in modulation window duration&lt;br&gt;&#10;                    &lt;strong&gt;Smaller JND = Better discrimination ability&lt;/strong&gt;&#10;                &lt;/p&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Perceptual Discrimination Thresholds&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Parameter&lt;/th&gt;&#10;                        &lt;th&gt;Standard (Reference)&lt;/th&gt;&#10;                        &lt;th&gt;Threshold (Your JND)&lt;/th&gt;&#10;                        &lt;th&gt;Difference Ratio&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;resultTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;div class=&quot;result-interpretation&quot; id=&quot;resultInterpretation&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Detailed Threshold Metrics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Metric&lt;/th&gt;&#10;                        &lt;th&gt;Value&lt;/th&gt;&#10;                        &lt;th&gt;Interpretation&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;detailedMetricsBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;h3&gt;Performance Statistics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Metric&lt;/th&gt;&#10;                        &lt;th&gt;Value&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;performanceStatsBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;button class=&quot;print-button&quot; onclick=&quot;printResults()&quot;&gt;Print Results&lt;/button&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot; style=&quot;margin-top: 20px;&quot;&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;button class=&quot;back-button&quot; onclick=&quot;backToExperiment()&quot;&gt;Back to Experiment&lt;/button&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div class=&quot;diagnostic-overlay&quot; id=&quot;diagnosticOverlay&quot;&gt;&#10;            &lt;div class=&quot;diagnostic-content&quot;&gt;&#10;                &lt;span class=&quot;diagnostic-close&quot; onclick=&quot;closeDiagnostics()&quot;&gt;&amp;times;&lt;/span&gt;&#10;                &lt;h2 class=&quot;diagnostic-heading&quot;&gt;Experiment Diagnostics&lt;/h2&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Test Status&lt;/h3&gt;&#10;                    &lt;table class=&quot;statistics-table&quot;&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;th&gt;Trials&lt;/th&gt;&#10;                            &lt;th&gt;Reversals&lt;/th&gt;&#10;                            &lt;th&gt;Status&lt;/th&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td id=&quot;totalTrials&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;totalReversals&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;testStatus&quot;&gt;Not started&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                    &lt;/table&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Audio Files Check&lt;/h3&gt;&#10;                    &lt;p&gt;Verifying necessary audio files:&lt;/p&gt;&#10;                    &lt;div id=&quot;audioFileStatus&quot; class=&quot;diagnostic-file-status&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Reversal History&lt;/h3&gt;&#10;                    &lt;div id=&quot;reversalHistory&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Recommendations&lt;/h3&gt;&#10;                    &lt;div id=&quot;diagnosticRecommendations&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-actions&quot;&gt;&#10;                    &lt;button class=&quot;diagnostic-action-button continue-button&quot; onclick=&quot;closeDiagnostics()&quot;&gt;Close&lt;/button&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;audio id=&quot;high_falling_standard&quot; src=&quot;Media/high_falling_standard.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;    &lt;audio id=&quot;high_falling_1&quot; src=&quot;Media/high_falling_1.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_falling_2&quot; src=&quot;Media/high_falling_2.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_falling_3&quot; src=&quot;Media/high_falling_3.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_falling_4&quot; src=&quot;Media/high_falling_4.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_falling_5&quot; src=&quot;Media/high_falling_5.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_falling_6&quot; src=&quot;Media/high_falling_6.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_falling_7&quot; src=&quot;Media/high_falling_7.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_falling_8&quot; src=&quot;Media/high_falling_8.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_falling_9&quot; src=&quot;Media/high_falling_9.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;&lt;script&gt;&#10;function getLocalTimestamp() {&#10;    const now = new Date();&#10;    const year = now.getFullYear();&#10;    const month = String(now.getMonth() + 1).padStart(2, '0');&#10;    const day = String(now.getDate()).padStart(2, '0');&#10;    const hours = String(now.getHours()).padStart(2, '0');&#10;    const minutes = String(now.getMinutes()).padStart(2, '0');&#10;    const seconds = String(now.getSeconds()).padStart(2, '0');&#10;    const milliseconds = String(now.getMilliseconds()).padStart(3, '0');&#10;    &#10;    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;&#10;}&#10;&#10;// Stimulus parameters for dynamic pitch modulation&#10;const STIMULUS_DURATION = 450; // ms, total duration&#10;const STANDARD_WINDOW = 400; // ms, modulation window for standard (100%)&#10;const STANDARD_WINDOW_PERCENT = 100; // percentage&#10;&#10;// Modulation window percentages for each difficulty level&#10;const MODULATION_WINDOWS = {&#10;    1: 20,   // easiest - 20% of standard window (80 ms)&#10;    2: 40,   // 160 ms&#10;    3: 50,   // 200 ms&#10;    4: 60,   // 240 ms&#10;    5: 70,   // 280 ms&#10;    6: 80,   // 320 ms&#10;    7: 90,   // 360 ms&#10;    8: 95,   // 380 ms&#10;    9: 98    // hardest - 98% of standard window (392 ms)&#10;};&#10;&#10;function getModulationWindowDuration(level) {&#10;    return (MODULATION_WINDOWS[level] / 100) * STANDARD_WINDOW;&#10;}&#10;&#10;const PITCH_FALL_SEMITONES = 1.0;&#10;&#10;function getModulationRate(level) {&#10;    const windowDuration = getModulationWindowDuration(level);&#10;    const windowDurationSec = windowDuration / 1000;&#10;    return PITCH_FALL_SEMITONES / windowDurationSec;&#10;}&#10;&#10;function getModulationSlope(level) {&#10;    const windowDuration = getModulationWindowDuration(level);&#10;    return PITCH_FALL_SEMITONES / windowDuration;&#10;}&#10;&#10;// Adaptive threshold experiment constants&#10;const MAXREVERSALS = 10;&#10;const MAXITERATIONS = 50;&#10;const LOWERLIMIT = 1;&#10;const DECREASING = -1;&#10;const INCREASING = 1;&#10;const MINIMUMREVERSALS = 6;&#10;const THRESHOLD_REVERSAL_COUNT = 6;&#10;&#10;// Experiment state variables&#10;var CorrectAnswer;&#10;var CorrectResponses = 0;&#10;var Direction = DECREASING;&#10;var Reversals = [];&#10;var NumberOfReversals = 0;&#10;var currentLevel = 5;&#10;var numberOfIterations = 0;&#10;var sentAverage = 0.0;&#10;var sentStdev = 0.0;&#10;var isTestComplete = false;&#10;var audioUnlocked = false;&#10;var allFilesPresent = true;&#10;var trialRecords = [];&#10;var stimulusEndTime = 0;&#10;&#10;// ABX variables&#10;var standardIsFirst;&#10;var comparisonSound;&#10;var standardSound;&#10;var xSound;&#10;&#10;var isReplayTrial = false;&#10;&#10;// Results variables - JND-based&#10;var jndAbsoluteDifference = 0;&#10;var jndRatio = 0;&#10;var jndPercentDifference = 0;&#10;var thresholdWindowDuration = 0;&#10;var thresholdWindowPercent = 0;&#10;var thresholdModulationRate = 0;&#10;var thresholdSlope = 0;&#10;var webersRatio = 0;&#10;&#10;function printResults() {&#10;    window.print();&#10;}&#10;&#10;function logDebug(message) {&#10;    console.log(message);&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var now = new Date();&#10;    var timeStr = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + '.' + now.getMilliseconds();&#10;    debugArea.innerHTML += '&lt;p&gt;[' + timeStr + '] ' + message + '&lt;/p&gt;';&#10;    debugArea.scrollTop = debugArea.scrollHeight;&#10;}&#10;&#10;function toggleDebug() {&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var checkbox = document.getElementById('showDebug');&#10;    debugArea.style.display = checkbox.checked ? 'block' : 'none';&#10;}&#10;&#10;function showDiagnostics() {&#10;    updateDiagnostics();&#10;    document.getElementById('diagnosticOverlay').style.display = 'flex';&#10;}&#10;&#10;function closeDiagnostics() {&#10;    document.getElementById('diagnosticOverlay').style.display = 'none';&#10;}&#10;&#10;function updateDiagnostics() {&#10;    document.getElementById('totalTrials').innerText = numberOfIterations;&#10;    document.getElementById('totalReversals').innerText = NumberOfReversals;&#10;    &#10;    let testStatus = getTestStatus();&#10;    document.getElementById('testStatus').innerText = testStatus.text;&#10;    document.getElementById('testStatus').className = `direction-stats-${testStatus.class}`;&#10;    &#10;    checkAudioFiles();&#10;    &#10;    let reversalHistoryHtml = '';&#10;    if (Reversals.length === 0) {&#10;        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';&#10;    } else {&#10;        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals.join(', ') + '&lt;/p&gt;';&#10;        reversalHistoryHtml += '&lt;p&gt;Corresponding modulation windows: ';&#10;        reversalHistoryHtml += Reversals.map(level =&gt; MODULATION_WINDOWS[level] + '% (' + getModulationWindowDuration(level) + ' ms)').join(', ') + '&lt;/p&gt;';&#10;    }&#10;    &#10;    document.getElementById('reversalHistory').innerHTML = reversalHistoryHtml;&#10;    &#10;    generateDiagnosticRecommendations();&#10;}&#10;&#10;function getTestStatus() {&#10;    if (isTestComplete) {&#10;        return { text: &quot;Complete&quot;, class: &quot;good&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals &lt; 1) {&#10;        return { text: &quot;Not enough data&quot;, class: &quot;bad&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals &lt; MINIMUMREVERSALS) {&#10;        return { text: &quot;Incomplete (&quot; + NumberOfReversals + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals)&quot;, class: &quot;warning&quot; };&#10;    }&#10;    &#10;    return { text: &quot;In progress&quot;, class: &quot;good&quot; };&#10;}&#10;&#10;function checkAudioFiles() {&#10;    const requiredFiles = [&#10;        &quot;high_falling_standard&quot;,&#10;        &quot;high_falling_1&quot;, &quot;high_falling_2&quot;, &quot;high_falling_3&quot;, &quot;high_falling_4&quot;, &quot;high_falling_5&quot;, &#10;        &quot;high_falling_6&quot;, &quot;high_falling_7&quot;, &quot;high_falling_8&quot;, &quot;high_falling_9&quot;&#10;    ];&#10;    &#10;    let statusHtml = '';&#10;    allFilesPresent = true;&#10;    &#10;    requiredFiles.forEach(function(fileId) {&#10;        const audioElement = document.getElementById(fileId);&#10;        const fileFound = audioElement !== null;&#10;        &#10;        if (!fileFound) {&#10;            allFilesPresent = false;&#10;        }&#10;        &#10;        statusHtml += `&lt;div class=&quot;file-status-item ${fileFound ? 'file-found' : 'file-missing'}&quot;&gt;${fileId}: ${fileFound ? 'Found' : 'Missing'}&lt;/div&gt;`;&#10;    });&#10;    &#10;    document.getElementById('audioFileStatus').innerHTML = statusHtml;&#10;}&#10;&#10;function generateDiagnosticRecommendations() {&#10;    let recommendations = '';&#10;    let hasIssues = false;&#10;    &#10;    if (!allFilesPresent) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Critical Issue:&lt;/strong&gt; Some required audio files are missing. Please ensure all files are properly loaded.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (numberOfIterations &gt;= MAXITERATIONS &amp;&amp; NumberOfReversals &lt; MINIMUMREVERSALS) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Issue:&lt;/strong&gt; Reached maximum trials but has insufficient reversals. This might indicate audio file issues or participant response patterns.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (!hasIssues) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Good:&lt;/strong&gt; No major issues detected with the experiment setup.&lt;/p&gt;';&#10;        &#10;        if (isTestComplete) {&#10;            recommendations += '&lt;p&gt;Test is complete.&lt;/p&gt;';&#10;        } else {&#10;            recommendations += '&lt;p&gt;Test is still in progress.&lt;/p&gt;';&#10;        }&#10;    }&#10;    &#10;    document.getElementById('diagnosticRecommendations').innerHTML = recommendations;&#10;}&#10;&#10;function testAudio() {&#10;    logDebug(&quot;Starting to test all audio files...&quot;);&#10;    var audios = document.querySelectorAll('audio');&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    var index = 0;&#10;    function playNext() {&#10;        if (index &gt;= audios.length) {&#10;            logDebug(&quot;All audio testing complete!&quot;);&#10;            return;&#10;        }&#10;        &#10;        var audio = audios[index];&#10;        logDebug(&quot;Testing audio #&quot; + (index + 1) + &quot;: &quot; + audio.id);&#10;        &#10;        audio.currentTime = 0;&#10;        &#10;        var playPromise = audio.play();&#10;        if (playPromise !== undefined) {&#10;            playPromise.then(function() {&#10;                logDebug(audio.id + &quot; played successfully&quot;);&#10;                &#10;                audio.onended = function() {&#10;                    logDebug(audio.id + &quot; playback ended&quot;);&#10;                    index++;&#10;                    setTimeout(playNext, 500);&#10;                };&#10;            }).catch(function(error) {&#10;                logDebug(&quot;Failed to play &quot; + audio.id + &quot;: &quot; + error);&#10;                index++;&#10;                setTimeout(playNext, 500);&#10;            });&#10;        }&#10;    }&#10;    &#10;    playNext();&#10;}&#10;&#10;function unlockAudioContext() {&#10;    logDebug(&quot;Attempting to unlock audio context...&quot;);&#10;    &#10;    var silentAudio = new Audio();&#10;    silentAudio.src = &quot;data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA&quot;;&#10;    &#10;    var promise = silentAudio.play();&#10;    if (promise !== undefined) {&#10;        promise.then(function() {&#10;            logDebug(&quot;Audio context unlocked successfully&quot;);&#10;            silentAudio.remove();&#10;            audioUnlocked = true;&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to unlock audio context: &quot; + error);&#10;        });&#10;    }&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    for (var i = 0; i &lt; allAudios.length; i++) {&#10;        var audio = allAudios[i];&#10;        audio.load();&#10;    }&#10;    &#10;    logDebug(&quot;Preloaded &quot; + allAudios.length + &quot; audio files&quot;);&#10;}&#10;&#10;function resetPage() {&#10;    numberOfIterations++;&#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('firstBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('secondBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    if (isTestComplete) {&#10;        document.getElementById('start').disabled = false;&#10;        document.getElementById('viewResult').disabled = false;&#10;        document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;        updateProgressBar(100);&#10;        return;&#10;    }&#10;    &#10;    if ((numberOfIterations &gt;= MAXITERATIONS) || (NumberOfReversals &gt;= MAXREVERSALS)) {&#10;        if (NumberOfReversals &gt;= MINIMUMREVERSALS) {&#10;            calculateResults();&#10;            isTestComplete = true;&#10;            document.getElementById('start').disabled = false;&#10;            document.getElementById('viewResult').disabled = false;&#10;            document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;            updateProgressBar(100);&#10;        } else {&#10;            logDebug(&quot;Reached max iterations but has only &quot; + NumberOfReversals + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals. Showing diagnostics.&quot;);&#10;            document.getElementById('text1').value = &quot;Insufficient data. Check diagnostics.&quot;;&#10;            setTimeout(function() {&#10;                showDiagnostics();&#10;            }, 500);&#10;            return;&#10;        }&#10;    } else {&#10;        updateProgressBar();&#10;        beginIteration();&#10;    }&#10;}&#10;&#10;function updateProgressBar(forcePercent) {&#10;    if (typeof forcePercent === 'number') {&#10;        document.getElementById('progressBar').style.width = forcePercent + '%';&#10;        document.getElementById('progressLabel').textContent = 'Progress: ' + forcePercent + '%';&#10;        return;&#10;    }&#10;    &#10;    const maxValue = Math.max(MAXREVERSALS, MAXITERATIONS);&#10;    const currentValue = isTestComplete ? maxValue : Math.max(NumberOfReversals, numberOfIterations);&#10;    const totalPercent = Math.min(100 * (currentValue / maxValue), 100);&#10;    &#10;    document.getElementById('progressBar').style.width = totalPercent + '%';&#10;    document.getElementById('progressLabel').textContent = 'Progress: ' + Math.round(totalPercent) + '%';&#10;}&#10;&#10;function calculateResults() {&#10;    let sum = 0.0, stddevsum = 0.0, average = 0.0, stdev = 0.0, counter = 0;&#10;    &#10;    for (let i = 0; i &lt; Reversals.length; i++) {&#10;        if (Reversals[i] &gt; 0) counter++;&#10;    }&#10;    &#10;    if (counter &lt; MINIMUMREVERSALS) {&#10;        logDebug(&quot;Test has insufficient data&quot;);&#10;        alert(&quot;Test has insufficient data. Please complete the test again.&quot;);&#10;        return;&#10;    }&#10;    &#10;    const startIndex = Math.max(0, NumberOfReversals - THRESHOLD_REVERSAL_COUNT);&#10;    counter = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0) {&#10;            sum += level;&#10;            counter++;&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 0) {&#10;        average = sum / counter;&#10;        average = parseFloat(average.toFixed(2));&#10;    }&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0) {&#10;            stddevsum += Math.pow(level - average, 2);&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 1) {&#10;        stdev = Math.sqrt(stddevsum / (counter - 1));&#10;        stdev = parseFloat(stdev.toFixed(2));&#10;    }&#10;    &#10;    sentAverage = average;&#10;    sentStdev = stdev;&#10;    &#10;    thresholdWindowPercent = calculateAverageWindowPercent(startIndex);&#10;    thresholdWindowDuration = (thresholdWindowPercent / 100) * STANDARD_WINDOW;&#10;    thresholdModulationRate = PITCH_FALL_SEMITONES / (thresholdWindowDuration / 1000);&#10;    thresholdSlope = PITCH_FALL_SEMITONES / thresholdWindowDuration;&#10;&#10;    jndAbsoluteDifference = STANDARD_WINDOW - thresholdWindowDuration;&#10;    jndRatio = thresholdWindowDuration / STANDARD_WINDOW;&#10;    jndPercentDifference = 100 - thresholdWindowPercent;&#10;    webersRatio = jndAbsoluteDifference / STANDARD_WINDOW;&#10;    &#10;    logDebug(&quot;Test complete! Average difficulty level: &quot; + average.toFixed(2));&#10;    logDebug(&quot;Threshold window: &quot; + thresholdWindowPercent.toFixed(2) + &quot;% (&quot; + thresholdWindowDuration.toFixed(2) + &quot; ms)&quot;);&#10;    logDebug(&quot;JND Absolute Difference: &quot; + jndAbsoluteDifference.toFixed(2) + &quot; ms&quot;);&#10;    logDebug(&quot;JND Ratio: &quot; + jndRatio.toFixed(4));&#10;    logDebug(&quot;JND Percent Difference: &quot; + jndPercentDifference.toFixed(2) + &quot;%&quot;);&#10;    logDebug(&quot;Weber's Ratio: &quot; + webersRatio.toFixed(4));&#10;    &#10;    document.getElementById('text1').value = &quot;Test complete! JND: &quot; + jndAbsoluteDifference.toFixed(1) + &quot; ms&quot;;&#10;}&#10;&#10;function calculateAverageWindowPercent(startIndex) {&#10;    let sum = 0;&#10;    let count = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0 &amp;&amp; MODULATION_WINDOWS[level] !== undefined) {&#10;            sum += MODULATION_WINDOWS[level];&#10;            count++;&#10;        }&#10;    }&#10;    &#10;    return count &gt; 0 ? sum / count : 0;&#10;}&#10;&#10;function calculateReactionTimeStats() {&#10;    let allRTs = trialRecords.map(t =&gt; parseFloat(t.reactionTime));&#10;    &#10;    return {&#10;        mean: allRTs.length ? (allRTs.reduce((a, b) =&gt; a + b, 0) / allRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;        median: allRTs.length ? calculateMedian(allRTs).toFixed(0) : &quot;N/A&quot;,&#10;        sd: allRTs.length &gt; 1 ? calculateSD(allRTs).toFixed(0) : &quot;N/A&quot;&#10;    };&#10;}&#10;&#10;function calculateAccuracyStats() {&#10;    let allTrials = trialRecords;&#10;    &#10;    return {&#10;        correct: allTrials.filter(t =&gt; t.isCorrect).length,&#10;        total: allTrials.length,&#10;        percentage: allTrials.length ? &#10;            (allTrials.filter(t =&gt; t.isCorrect).length / allTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;    };&#10;}&#10;&#10;function calculateMedian(values) {&#10;    if (!values.length) return 0;&#10;    &#10;    const sortedValues = values.slice().sort((a, b) =&gt; a - b);&#10;    const mid = Math.floor(sortedValues.length / 2);&#10;    &#10;    return sortedValues.length % 2 === 0 ? &#10;        (sortedValues[mid - 1] + sortedValues[mid]) / 2 : &#10;        sortedValues[mid];&#10;}&#10;&#10;function calculateSD(values) {&#10;    if (values.length &lt;= 1) return 0;&#10;    &#10;    const mean = values.reduce((a, b) =&gt; a + b, 0) / values.length;&#10;    const variance = values.map(x =&gt; Math.pow(x - mean, 2)).reduce((a, b) =&gt; a + b, 0) / (values.length - 1);&#10;    &#10;    return Math.sqrt(variance);&#10;}&#10;&#10;function displayResults() {&#10;    logDebug(&quot;Displaying results&quot;);&#10;    &#10;    let hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;&#10;    &#10;    if (!hasData) {&#10;        let message = &quot;Warning: Insufficient data. Results may not be reliable.&quot;;&#10;        &#10;        if (confirm(message + &quot;\n\nWould you like to retry the experiment?&quot;)) {&#10;            window_onload();&#10;            return;&#10;        }&#10;    }&#10;    &#10;    document.getElementById('experimentContainer').style.display = 'none';&#10;    document.getElementById('resultsContainer').style.display = 'block';&#10;    &#10;    if (hasData) {&#10;        document.getElementById('jndValue').innerHTML = &#10;            jndAbsoluteDifference.toFixed(2) + ' ms&lt;br&gt;' +&#10;            '&lt;span style=&quot;font-size: 18px;&quot;&gt;(' + jndPercentDifference.toFixed(2) + '% difference from standard)&lt;/span&gt;';&#10;    } else {&#10;        document.getElementById('jndValue').textContent = 'Insufficient Data';&#10;    }&#10;    &#10;    var tableBody = document.getElementById('resultTableBody');&#10;    tableBody.innerHTML = '';&#10;    &#10;    var windowRow = document.createElement('tr');&#10;    windowRow.innerHTML = &#10;        '&lt;td&gt;Modulation Window Duration&lt;/td&gt;' +&#10;        '&lt;td&gt;' + STANDARD_WINDOW + ' ms (100%)&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? thresholdWindowDuration.toFixed(2) + ' ms (' + thresholdWindowPercent.toFixed(2) + '%)' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? jndRatio.toFixed(4) + ' : 1&lt;br&gt;(Threshold/Standard)' : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(windowRow);&#10;    &#10;    var diffRow = document.createElement('tr');&#10;    diffRow.innerHTML = &#10;        '&lt;td&gt;Absolute Difference (JND)&lt;/td&gt;' +&#10;        '&lt;td&gt;0 ms (reference)&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? jndAbsoluteDifference.toFixed(2) + ' ms' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? 'Weber Ratio: ' + webersRatio.toFixed(4) : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(diffRow);&#10;    &#10;    var rateStandard = PITCH_FALL_SEMITONES / (STANDARD_WINDOW / 1000);&#10;    var rateRow = document.createElement('tr');&#10;    rateRow.innerHTML = &#10;        '&lt;td&gt;Modulation Rate&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rateStandard.toFixed(4) + ' semitones/s&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? thresholdModulationRate.toFixed(4) + ' semitones/s' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? (thresholdModulationRate / rateStandard).toFixed(4) + ' : 1' : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(rateRow);&#10;    &#10;    var interpretation = document.getElementById('resultInterpretation');&#10;    let interpretationHtml = '&lt;h3 style=&quot;margin-top: 0;&quot;&gt;Performance Interpretation&lt;/h3&gt;';&#10;    &#10;    if (hasData) {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Your Just Noticeable Difference (JND):&lt;/strong&gt;&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;You can reliably detect a difference when the modulation window changes by &lt;strong&gt;' + &#10;            jndAbsoluteDifference.toFixed(2) + ' ms&lt;/strong&gt; (or &lt;strong&gt;' + jndPercentDifference.toFixed(2) + &#10;            '%&lt;/strong&gt; of the standard 400 ms window).&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;In other words, you can discriminate between:&lt;/p&gt;';&#10;        interpretationHtml += '&lt;ul&gt;';&#10;        interpretationHtml += '&lt;li&gt;Standard stimulus: 400 ms modulation window&lt;/li&gt;';&#10;        interpretationHtml += '&lt;li&gt;Your threshold: ' + thresholdWindowDuration.toFixed(2) + ' ms modulation window&lt;/li&gt;';&#10;        interpretationHtml += '&lt;li&gt;Difference: ' + jndAbsoluteDifference.toFixed(2) + ' ms&lt;/li&gt;';&#10;        interpretationHtml += '&lt;/ul&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Weber\'s Ratio:&lt;/strong&gt; ' + webersRatio.toFixed(4) + &#10;            ' (smaller Weber\'s ratio = better discrimination sensitivity)&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;&lt;em&gt;Note: A &lt;strong&gt;smaller JND&lt;/strong&gt; indicates &lt;strong&gt;better sensitivity&lt;/strong&gt; to dynamic pitch changes, ' +&#10;            'as it means you can detect smaller differences between stimuli.&lt;/em&gt;&lt;/p&gt;';&#10;    } else {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Complete results not available due to insufficient data.&lt;/p&gt;';&#10;    }&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    const accuracyStats = calculateAccuracyStats();&#10;    &#10;    interpretationHtml += '&lt;p&gt;&lt;strong&gt;Overall Performance:&lt;/strong&gt; ' + accuracyStats.percentage + &#10;        '% accuracy with average reaction time of ' + rtStats.mean + ' ms across ' + &#10;        accuracyStats.total + ' trials.&lt;/p&gt;';&#10;    &#10;    interpretation.innerHTML = interpretationHtml;&#10;    &#10;    var detailedBody = document.getElementById('detailedMetricsBody');&#10;    detailedBody.innerHTML = '';&#10;    &#10;    var metrics = [&#10;        { name: 'Average Difficulty Level', value: hasData ? sentAverage.toFixed(2) : 'N/A', interp: hasData ? 'SD: ' + sentStdev.toFixed(2) : 'N/A' },&#10;        { name: 'Threshold Slope', value: hasData ? thresholdSlope.toFixed(6) + ' semitones/ms' : 'N/A', interp: hasData ? 'Rate of pitch change' : 'N/A' },&#10;        { name: 'Number of Reversals', value: NumberOfReversals, interp: 'Minimum required: ' + MINIMUMREVERSALS },&#10;        { name: 'Total Trials', value: numberOfIterations, interp: 'Maximum allowed: ' + MAXITERATIONS }&#10;    ];&#10;    &#10;    metrics.forEach(function(metric) {&#10;        var row = document.createElement('tr');&#10;        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;&lt;td&gt;' + metric.interp + '&lt;/td&gt;';&#10;        detailedBody.appendChild(row);&#10;    });&#10;    &#10;    var perfBody = document.getElementById('performanceStatsBody');&#10;    perfBody.innerHTML = '';&#10;    &#10;    var perfMetrics = [&#10;        { name: 'Total Trials', value: accuracyStats.total },&#10;        { name: 'Correct Responses', value: accuracyStats.correct },&#10;        { name: 'Overall Accuracy', value: accuracyStats.percentage + '%' },&#10;        { name: 'Mean Reaction Time', value: rtStats.mean + ' ms' },&#10;        { name: 'Median Reaction Time', value: rtStats.median + ' ms' },&#10;        { name: 'RT Standard Deviation', value: rtStats.sd + ' ms' }&#10;    ];&#10;    &#10;    perfMetrics.forEach(function(metric) {&#10;        var row = document.createElement('tr');&#10;        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;';&#10;        perfBody.appendChild(row);&#10;    });&#10;}&#10;&#10;function backToExperiment() {&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;}&#10;&#10;function view_onclick() {&#10;    logDebug(&quot;View results button clicked&quot;);&#10;    &#10;    if (!isTestComplete &amp;&amp; NumberOfReversals &gt;= MINIMUMREVERSALS) {&#10;        calculateResults();&#10;        isTestComplete = true;&#10;    }&#10;    &#10;    displayResults();&#10;}&#10;&#10;function beginIteration() {&#10;    isReplayTrial = false;&#10;    &#10;    standardIsFirst = Math.random() &lt; 0.5;&#10;    var xIsStandard = Math.random() &lt; 0.5;&#10;    &#10;    if (xIsStandard) {&#10;        CorrectAnswer = standardIsFirst ? 1 : 2;&#10;    } else {&#10;        CorrectAnswer = standardIsFirst ? 2 : 1;&#10;    }&#10;    &#10;    logDebug(&quot;Starting new iteration #&quot; + numberOfIterations + &#10;             &quot;, Standard is &quot; + (standardIsFirst ? &quot;first&quot; : &quot;second&quot;) +&#10;             &quot;, X is &quot; + (xIsStandard ? &quot;standard&quot; : &quot;comparison&quot;) +&#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Difficulty level: &quot; + currentLevel +&#10;             &quot;, Modulation window: &quot; + MODULATION_WINDOWS[currentLevel] + &quot;% (&quot; + &#10;             getModulationWindowDuration(currentLevel) + &quot; ms)&quot;);&#10;    &#10;    setTimeout(function() {&#10;        playABXSequence(xIsStandard);&#10;    }, 1000);&#10;}&#10;&#10;function clearButtonAnimations() {&#10;    document.getElementById('firstBtn').classList.remove('button-playing');&#10;    document.getElementById('secondBtn').classList.remove('button-playing');&#10;}&#10;&#10;function playABXSequence(xIsStandard) {&#10;    logDebug(&quot;Playing ABX sequence&quot;);&#10;    &#10;    clearButtonAnimations();&#10;&#10;    standardSound = document.getElementById('high_falling_standard');&#10;    comparisonSound = document.getElementById(&quot;high_falling_&quot; + currentLevel);&#10;&#10;    xSound = xIsStandard ? standardSound : comparisonSound;&#10;    &#10;    if (!standardSound || !comparisonSound) {&#10;        logDebug(&quot;Error: Cannot find audio elements!&quot;);&#10;        document.getElementById('text1').value = &quot;出錯：找不到音頻文件&quot;;&#10;        setTimeout(function() {&#10;            showDiagnostics();&#10;        }, 1000);&#10;        return;&#10;    }&#10;    &#10;    var firstSound = standardIsFirst ? standardSound : comparisonSound;&#10;    document.getElementById('text1').value = &quot;播放第一個音&quot;;&#10;    &#10;    document.getElementById('firstBtn').classList.add('button-playing');&#10;    &#10;    firstSound.currentTime = 0;&#10;    var playPromise1 = firstSound.play();&#10;    &#10;    if (playPromise1 !== undefined) {&#10;        playPromise1.then(function() {&#10;            logDebug(&quot;First sound (A) played successfully&quot;);&#10;            &#10;            firstSound.onended = function() {&#10;                logDebug(&quot;First sound ended&quot;);&#10;                &#10;                document.getElementById('firstBtn').classList.remove('button-playing');&#10;                &#10;                setTimeout(function() {&#10;                    var secondSound = standardIsFirst ? comparisonSound : standardSound;&#10;                    document.getElementById('text1').value = &quot;播放第二個音&quot;;&#10;                    &#10;                    document.getElementById('secondBtn').classList.add('button-playing');&#10;                    &#10;                    secondSound.currentTime = 0;&#10;                    var playPromise2 = secondSound.play();&#10;                    &#10;                    if (playPromise2 !== undefined) {&#10;                        playPromise2.then(function() {&#10;                            logDebug(&quot;Second sound (B) played successfully&quot;);&#10;                            &#10;                            secondSound.onended = function() {&#10;                                logDebug(&quot;Second sound ended&quot;);&#10;                                &#10;                                document.getElementById('secondBtn').classList.remove('button-playing');&#10;                                &#10;                                setTimeout(function() {&#10;                                    document.getElementById('text1').value = &quot;播放第三個音&quot;;&#10;                                    &#10;                                    xSound.currentTime = 0;&#10;                                    var playPromise3 = xSound.play();&#10;                                    &#10;                                    if (playPromise3 !== undefined) {&#10;                                        playPromise3.then(function() {&#10;                                            logDebug(&quot;Third sound (X) played successfully&quot;);&#10;                                            &#10;                                            xSound.onended = function() {&#10;                                                logDebug(&quot;Third sound ended, enabling response buttons&quot;);&#10;                                                &#10;                                                stimulusEndTime = performance.now();&#10;                                                &#10;                                                document.getElementById('text1').value = &quot;請作出選擇&quot;;&#10;                                                document.getElementById('promptText').style.visibility = 'visible';&#10;                                                &#10;                                                document.getElementById('firstBtn').disabled = false;&#10;                                                document.getElementById('secondBtn').disabled = false;&#10;                                                document.getElementById('firstBtn').style.background = &quot;#66CCFF&quot;;&#10;                                                document.getElementById('secondBtn').style.background = &quot;#66CCFF&quot;;&#10;                                            };&#10;                                        }).catch(function(error) {&#10;                                            logDebug(&quot;Failed to play third sound: &quot; + error);&#10;                                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                                            clearButtonAnimations();&#10;                                            setTimeout(showDiagnostics, 1000);&#10;                                        });&#10;                                    }&#10;                                }, 1000);&#10;                            };&#10;                        }).catch(function(error) {&#10;                            logDebug(&quot;Failed to play second sound: &quot; + error);&#10;                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                            clearButtonAnimations();&#10;                            setTimeout(showDiagnostics, 1000);&#10;                        });&#10;                    }&#10;                }, 1000);&#10;            };&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to play first sound: &quot; + error);&#10;            document.getElementById('text1').value = &quot;音頻播放錯誤，請刷新頁面&quot;;&#10;            clearButtonAnimations();&#10;            setTimeout(showDiagnostics, 1000);&#10;        });&#10;    }&#10;}&#10;&#10;function start_onclick() {&#10;    logDebug(&quot;Starting experiment&quot;);&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    checkAudioFiles();&#10;    if (!allFilesPresent) {&#10;        logDebug(&quot;Cannot start experiment: Some audio files are missing&quot;);&#10;        document.getElementById('text1').value = &quot;音頻缺失&quot;;&#10;        showDiagnostics();&#10;        return;&#10;    }&#10;    &#10;    window_onload();&#10;    document.getElementById('text1').value = &quot;開始實驗...&quot;;&#10;    updateProgressBar(0);&#10;    &#10;    setTimeout(function() {&#10;        beginIteration();&#10;        document.getElementById('start').disabled = true;&#10;        document.getElementById('viewResult').disabled = true;&#10;        document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;        document.getElementById('promptText').style.visibility = 'hidden';&#10;    }, 1000);&#10;}&#10;&#10;function gotReversal() {&#10;    NumberOfReversals++;&#10;    Reversals[NumberOfReversals - 1] = currentLevel;&#10;    Direction = -Direction;&#10;    logDebug(&quot;Recorded reversal #&quot; + NumberOfReversals + &quot; at difficulty &quot; + currentLevel + &#10;             &quot; (window: &quot; + MODULATION_WINDOWS[currentLevel] + &quot;%, &quot; + &#10;             getModulationWindowDuration(currentLevel) + &quot; ms)&quot;);&#10;}&#10;&#10;function processAnswer(Response) {&#10;    const reactionEndTime = performance.now();&#10;    const reactionTime = reactionEndTime - stimulusEndTime;&#10;    &#10;    logDebug(&quot;User answered: &quot; + (Response === 1 ? &quot;First&quot; : &quot;Second&quot;) + &#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Is replay: &quot; + isReplayTrial);&#10;    &#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    const isCorrect = (Response === CorrectAnswer);&#10;    &#10;    if (!isReplayTrial) {&#10;        const windowPercent = MODULATION_WINDOWS[currentLevel];&#10;        const windowDuration = getModulationWindowDuration(currentLevel);&#10;        const modulationRate = getModulationRate(currentLevel);&#10;        const slope = getModulationSlope(currentLevel);&#10;        &#10;        const trialInfo = {&#10;            trialNumber: numberOfIterations,&#10;            timestamp: getLocalTimestamp(),&#10;            difficultyLevel: currentLevel,&#10;            modulationWindowPercent: windowPercent,&#10;            modulationWindowDuration: windowDuration.toFixed(2),&#10;            modulationRate: modulationRate.toFixed(4),&#10;            slope: slope.toFixed(6),&#10;            userResponse: Response === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            correctResponse: CorrectAnswer === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            isCorrect: isCorrect,&#10;            reactionTime: reactionTime.toFixed(0),&#10;            isReversal: false,&#10;            stepDirection: Direction === DECREASING ? &quot;Increasing Difficulty&quot; : &quot;Decreasing Difficulty&quot;,&#10;            standardPosition: standardIsFirst ? &quot;First&quot; : &quot;Second&quot;&#10;        };&#10;        &#10;        trialRecords.push(trialInfo);&#10;    }&#10;    &#10;    if (isCorrect) {&#10;        logDebug(&quot;Correct answer&quot;);&#10;        document.getElementById('smile').src = &quot;Media/smiley.png&quot;;&#10;        document.getElementById('text1').value = &quot;正確！&quot;;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses++;&#10;            &#10;            if (CorrectResponses == 2) {&#10;                logDebug(&quot;Two correct answers in a row&quot;);&#10;                CorrectResponses = 0;&#10;                &#10;                if (Direction == INCREASING) {&#10;                    gotReversal();&#10;                    if (trialRecords.length &gt; 0) {&#10;                        trialRecords[trialRecords.length-1].isReversal = true;&#10;                    }&#10;                }&#10;                &#10;                changeLevel(DECREASING);&#10;            }&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            resetPage();&#10;        }, 1500);&#10;    } else {&#10;        logDebug(&quot;Incorrect answer - will replay stimulus&quot;);&#10;        document.getElementById('smile').src = &quot;Media/nosmiley.png&quot;;&#10;        &#10;        var correctAnswerText = CorrectAnswer === 1 ? &quot;第一個音&quot; : &quot;第二個音&quot;;&#10;        document.getElementById('text1').value = &quot;錯誤！正確答案是：&quot; + correctAnswerText;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses = 0;&#10;            &#10;            if (Direction == DECREASING) {&#10;                gotReversal();&#10;                if (trialRecords.length &gt; 0) {&#10;                    trialRecords[trialRecords.length-1].isReversal = true;&#10;                }&#10;            }&#10;            &#10;            changeLevel(INCREASING);&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            document.getElementById('text1').value = &quot;重播刺激音...&quot;;&#10;            &#10;            setTimeout(function() {&#10;                isReplayTrial = true;&#10;                &#10;                var xIsStandard = (standardIsFirst &amp;&amp; CorrectAnswer === 1) || &#10;                                  (!standardIsFirst &amp;&amp; CorrectAnswer === 2);&#10;                playABXSequence(xIsStandard);&#10;            }, 1000);&#10;        }, 2000);&#10;    }&#10;}&#10;&#10;function changeLevel(whichWay) {&#10;    var oldLevel = currentLevel;&#10;    var stepSize = NumberOfReversals &lt; 4 ? 2 : 1;&#10;    &#10;    if (whichWay == DECREASING) {&#10;        currentLevel = Math.min(9, currentLevel + stepSize);&#10;    } else {&#10;        currentLevel = Math.max(LOWERLIMIT, currentLevel - stepSize);&#10;    }&#10;    &#10;    logDebug(&quot;Difficulty changed from level &quot; + oldLevel + &quot; (&quot; + MODULATION_WINDOWS[oldLevel] + &quot;%, &quot; +&#10;             getModulationWindowDuration(oldLevel) + &quot; ms) to level &quot; + &#10;             currentLevel + &quot; (&quot; + MODULATION_WINDOWS[currentLevel] + &quot;%, &quot; +&#10;             getModulationWindowDuration(currentLevel) + &quot; ms) &quot; +&#10;             (whichWay == DECREASING ? &quot;(increasing difficulty)&quot; : &quot;(decreasing difficulty)&quot;));&#10;}&#10;&#10;function exportToCSV() {&#10;    const headers = [&#10;        &quot;Trial Number&quot;, &#10;        &quot;Timestamp&quot;, &#10;        &quot;Difficulty Level&quot;, &#10;        &quot;Modulation Window (%)&quot;,&#10;        &quot;Modulation Window (ms)&quot;,&#10;        &quot;Modulation Rate (semitones/s)&quot;,&#10;        &quot;Slope (semitones/ms)&quot;,&#10;        &quot;Standard Position&quot;,&#10;        &quot;User Response&quot;, &#10;        &quot;Correct Response&quot;, &#10;        &quot;Is Correct&quot;, &#10;        &quot;Reaction Time (ms)&quot;, &#10;        &quot;Is Reversal&quot;,&#10;        &quot;Step Direction&quot;&#10;    ];&#10;    &#10;    const csvRows = [];&#10;    csvRows.push(headers.join(&quot;,&quot;));&#10;    &#10;    trialRecords.forEach(function(trial) {&#10;        const row = [&#10;            trial.trialNumber,&#10;            trial.timestamp,&#10;            trial.difficultyLevel,&#10;            trial.modulationWindowPercent,&#10;            trial.modulationWindowDuration,&#10;            trial.modulationRate,&#10;            trial.slope,&#10;            trial.standardPosition,&#10;            trial.userResponse,&#10;            trial.correctResponse,&#10;            trial.isCorrect ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.reactionTime,&#10;            trial.isReversal ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.stepDirection&#10;        ];&#10;        csvRows.push(row.join(&quot;,&quot;));&#10;    });&#10;    &#10;    csvRows.push(&quot;\nRESULTS SUMMARY - JUST NOTICEABLE DIFFERENCE (JND)&quot;);&#10;    csvRows.push(&quot;\nJND Metrics&quot;);&#10;    csvRows.push(&quot;Parameter,Value,Unit,Description&quot;);&#10;    &#10;    const hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;&#10;    &#10;    csvRows.push(&quot;JND Absolute Difference,&quot; + &#10;        (hasData ? jndAbsoluteDifference.toFixed(2) : &quot;N/A&quot;) + &quot;,ms,Detectable difference from standard (smaller = better)&quot;);&#10;    &#10;    csvRows.push(&quot;JND Percentage Difference,&quot; + &#10;        (hasData ? jndPercentDifference.toFixed(2) : &quot;N/A&quot;) + &quot;,%,Percentage difference from standard (smaller = better)&quot;);&#10;    &#10;    csvRows.push(&quot;JND Ratio (Threshold/Standard),&quot; + &#10;        (hasData ? jndRatio.toFixed(4) : &quot;N/A&quot;) + &quot;,ratio,Threshold modulation window / Standard window&quot;);&#10;    &#10;    csvRows.push(&quot;Weber's Ratio,&quot; + &#10;        (hasData ? webersRatio.toFixed(4) : &quot;N/A&quot;) + &quot;,ratio,ΔI / I (smaller = better sensitivity)&quot;);&#10;    &#10;    csvRows.push(&quot;\nThreshold Parameters&quot;);&#10;    csvRows.push(&quot;Parameter,Value,Unit&quot;);&#10;    &#10;    csvRows.push(&quot;Standard Modulation Window,&quot; + STANDARD_WINDOW + &quot;,ms&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Modulation Window,&quot; + &#10;        (hasData ? thresholdWindowDuration.toFixed(2) : &quot;N/A&quot;) + &quot;,ms&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Window Percentage,&quot; + &#10;        (hasData ? thresholdWindowPercent.toFixed(2) : &quot;N/A&quot;) + &quot;,%&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Modulation Rate,&quot; + &#10;        (hasData ? thresholdModulationRate.toFixed(4) : &quot;N/A&quot;) + &quot;,semitones/s&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Slope,&quot; + &#10;        (hasData ? thresholdSlope.toFixed(6) : &quot;N/A&quot;) + &quot;,semitones/ms&quot;);&#10;    &#10;    csvRows.push(&quot;Average Difficulty Level,&quot; + &#10;        (hasData ? sentAverage.toFixed(2) : &quot;N/A&quot;) + &quot;,level (1-9)&quot;);&#10;    &#10;    csvRows.push(&quot;Difficulty Level SD,&quot; + &#10;        (hasData ? sentStdev.toFixed(2) : &quot;N/A&quot;) + &quot;,level&quot;);&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    csvRows.push(&quot;\nReaction Time Statistics&quot;);&#10;    csvRows.push(&quot;Mean,Median,Standard Deviation&quot;);&#10;    csvRows.push(rtStats.mean + &quot;,&quot; + rtStats.median + &quot;,&quot; + rtStats.sd);&#10;    &#10;    const accuracyStats = calculateAccuracyStats();&#10;    csvRows.push(&quot;\nAccuracy Statistics&quot;);&#10;    csvRows.push(&quot;Correct Responses,Total Responses,Percentage&quot;);&#10;    csvRows.push(accuracyStats.correct + &quot;,&quot; + accuracyStats.total + &quot;,&quot; + accuracyStats.percentage + &quot;%&quot;);&#10;    &#10;    csvRows.push(&quot;\nExperiment Parameters&quot;);&#10;    csvRows.push(&quot;Parameter,Value&quot;);&#10;    csvRows.push(&quot;Paradigm,ABX&quot;);&#10;    csvRows.push(&quot;Stimulus Type,Dynamic Pitch (Falling Tone)&quot;);&#10;    csvRows.push(&quot;Total Stimulus Duration,&quot; + STIMULUS_DURATION + &quot; ms&quot;);&#10;    csvRows.push(&quot;Standard Modulation Window,&quot; + STANDARD_WINDOW + &quot; ms&quot;);&#10;    csvRows.push(&quot;Pitch Fall Amount,&quot; + PITCH_FALL_SEMITONES + &quot; semitone(s)&quot;);&#10;    csvRows.push(&quot;Max Reversals,&quot; + MAXREVERSALS);&#10;    csvRows.push(&quot;Min Reversals for Calculation,&quot; + MINIMUMREVERSALS);&#10;    csvRows.push(&quot;Max Iterations,&quot; + MAXITERATIONS);&#10;    &#10;    csvRows.push(&quot;\nDifficulty Level Mapping&quot;);&#10;    csvRows.push(&quot;Level,Modulation Window (%),Modulation Window (ms),Difference from Standard (ms),Modulation Rate (semitones/s),Slope (semitones/ms)&quot;);&#10;    for (let level = 1; level &lt;= 9; level++) {&#10;        const windowPercent = MODULATION_WINDOWS[level];&#10;        const windowDuration = getModulationWindowDuration(level);&#10;        const diffFromStandard = STANDARD_WINDOW - windowDuration;&#10;        const rate = getModulationRate(level);&#10;        const slope = getModulationSlope(level);&#10;        csvRows.push(level + &quot;,&quot; + windowPercent + &quot;,&quot; + windowDuration.toFixed(2) + &quot;,&quot; + &#10;                     diffFromStandard.toFixed(2) + &quot;,&quot; + rate.toFixed(4) + &quot;,&quot; + slope.toFixed(6));&#10;    }&#10;    &#10;    const csvContent = &quot;data:text/csv;charset=utf-8,&quot; + csvRows.join(&quot;\n&quot;);&#10;    const encodedUri = encodeURI(csvContent);&#10;    const link = document.createElement(&quot;a&quot;);&#10;    const timestamp = new Date().toISOString().replace(/[:.]/g, &quot;-&quot;);&#10;    link.setAttribute(&quot;href&quot;, encodedUri);&#10;    link.setAttribute(&quot;download&quot;, &quot;dynamic_pitch_JND_ABX_data_&quot; + timestamp + &quot;.csv&quot;);&#10;    document.body.appendChild(link);&#10;    link.click();&#10;    document.body.removeChild(link);&#10;}&#10;&#10;function window_onload() {&#10;    window.name = &quot;EXP&quot;;&#10;    NumberOfReversals = 0;&#10;    numberOfIterations = 0;&#10;    CorrectResponses = 0;&#10;    Direction = DECREASING;&#10;    currentLevel = 5;&#10;    isTestComplete = false;&#10;    Reversals = [];&#10;    trialRecords = [];&#10;    isReplayTrial = false;&#10;    &#10;    jndAbsoluteDifference = 0;&#10;    jndRatio = 0;&#10;    jndPercentDifference = 0;&#10;    thresholdWindowDuration = 0;&#10;    thresholdWindowPercent = 0;&#10;    thresholdModulationRate = 0;&#10;    thresholdSlope = 0;&#10;    webersRatio = 0;&#10;&#10;    document.getElementById('text1').value = &quot;準備完畢後請點擊\&quot;開始實驗\&quot;&quot;;&#10;    document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;    document.getElementById('start').disabled = false;&#10;    document.getElementById('viewResult').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;    &#10;    updateProgressBar(0);&#10;    &#10;    logDebug(&quot;Page reset complete&quot;);&#10;}&#10;&#10;window.onload = function() {&#10;    window_onload();&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    logDebug(&quot;Preloading &quot; + allAudios.length + &quot; audio files&quot;);&#10;    &#10;    allAudios.forEach(function(audio) {&#10;        audio.load();&#10;    });&#10;    &#10;    document.getElementById('text1').value = &quot;請點擊\&quot;開始實驗\&quot;&quot;;&#10;    &#10;    window.onerror = function(message, source, lineno, colno, error) {&#10;        logDebug(&quot;Global error: &quot; + message + &quot; at &quot; + source + &quot;:&quot; + lineno);&#10;        return false;&#10;    };&#10;    &#10;    document.getElementById('showDebug').checked = true;&#10;    toggleDebug();&#10;};&#10;&lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
                    <entry key="file:///E:/Projects/Pitch_Training/ABX_falling_low.html" value="&lt;!DOCTYPE html&gt;&#10;&lt;html&gt;&#10;&lt;head&gt;&#10;    &lt;title&gt;PLOYU-Peng's Lab: Pitch Sensitivity Training&lt;/title&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;style&gt;&#10;        body {&#10;            font-family: Arial, sans-serif;&#10;            margin: 20px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .container {&#10;            max-width: 800px;&#10;            margin: 0 auto;&#10;            padding: 20px;&#10;            background-color: white;&#10;            border-radius: 10px;&#10;            box-shadow: 0 0 10px rgba(0,0,0,0.1);&#10;            display: flex;&#10;            flex-direction: column;&#10;            align-items: center;&#10;        }&#10;        .header {&#10;            text-align: center;&#10;            margin-bottom: 40px;&#10;            width: 100%;&#10;        }&#10;        .training-info {&#10;            font-size: 16px;&#10;            color: #555;&#10;            margin-top: 10px;&#10;            margin-bottom: 5px;&#10;            text-align: center;&#10;        }&#10;        .instruction-text {&#10;            font-size: 14px;&#10;            color: #777;&#10;            margin-bottom: 15px;&#10;            text-align: center;&#10;            font-style: italic;&#10;        }&#10;        .button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .prompt-text {&#10;            text-align: center;&#10;            font-size: 20px;&#10;            margin-bottom: 25px;&#10;            margin-top: 30px;&#10;            font-weight: bold;&#10;        }&#10;        .response-button {&#10;            width: 160px;&#10;            height: 160px;&#10;            font-size: 26px;&#10;            margin: 0 40px;&#10;            border-radius: 15px;&#10;            border: none;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.1);&#10;            transition: all 0.3s ease;&#10;        }&#10;        .response-button:hover:enabled {&#10;            transform: translateY(-3px);&#10;            box-shadow: 0 6px 12px rgba(0,0,0,0.15);&#10;        }&#10;        .response-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .button-playing {&#10;            animation: pulse 1s ease-in-out infinite;&#10;            box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            transform: scale(1.05);&#10;        }&#10;        @keyframes pulse {&#10;            0%, 100% {&#10;                box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            }&#10;            50% {&#10;                box-shadow: 0 0 30px rgba(102, 204, 255, 1);&#10;            }&#10;        }&#10;        .control-button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            gap: 30px;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .control-button {&#10;            padding: 14px 28px;&#10;            font-size: 18px;&#10;            border-radius: 8px;&#10;            border: none;&#10;            background-color: #4CAF50;&#10;            color: white;&#10;            cursor: pointer;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .control-button:hover:enabled {&#10;            background-color: #3e8e41;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .control-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .control-button:disabled {&#10;            background-color: #cccccc;&#10;            cursor: not-allowed;&#10;            box-shadow: none;&#10;        }&#10;        .feedback {&#10;            text-align: center;&#10;            height: 100px;&#10;            margin: 30px 0;&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;        }&#10;        .status {&#10;            width: 350px;&#10;            height: 68px;&#10;            text-align: center;&#10;            font-size: 18px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            margin: 0 auto;&#10;            padding: 10px;&#10;            background-color: #f9f9f9;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.05);&#10;        }&#10;        .debug-info {&#10;            font-size: 12px;&#10;            color: #777;&#10;            margin-top: 30px;&#10;            text-align: left;&#10;            display: none;&#10;            max-height: 300px;&#10;            overflow-y: auto;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            padding: 15px;&#10;            width: 100%;&#10;        }&#10;        .results-container {&#10;            display: none;&#10;            margin-top: 30px;&#10;            padding: 20px;&#10;            background-color: #f0f8ff;&#10;            border-radius: 8px;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.1);&#10;            width: 100%;&#10;        }&#10;        .result-heading {&#10;            text-align: center;&#10;            margin-bottom: 20px;&#10;            color: #2c3e50;&#10;        }&#10;        .result-table {&#10;            width: 100%;&#10;            border-collapse: collapse;&#10;            margin-bottom: 20px;&#10;        }&#10;        .result-table th, .result-table td {&#10;            padding: 12px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .result-table th {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .result-table tr:nth-child(even) {&#10;            background-color: #f2f2f2;&#10;        }&#10;        .result-interpretation {&#10;            background-color: #e8f4f8;&#10;            padding: 15px;&#10;            border-radius: 5px;&#10;            margin-bottom: 20px;&#10;        }&#10;        .back-button {&#10;            display: block;&#10;            margin: 0 auto;&#10;            padding: 14px 28px;&#10;            background-color: #3498db;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .back-button:hover {&#10;            background-color: #2980b9;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .back-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        .chart-container {&#10;            height: 300px;&#10;            margin: 20px 0;&#10;            background-color: white;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;            padding: 10px;&#10;        }&#10;        .auxiliary-buttons {&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            margin-top: 30px;&#10;            gap: 20px;&#10;            flex-wrap: wrap;&#10;        }&#10;        .auxiliary-buttons button {&#10;            padding: 10px 15px;&#10;            border-radius: 5px;&#10;            border: 1px solid #ddd;&#10;            background-color: #f0f0f0;&#10;            cursor: pointer;&#10;            transition: all 0.2s ease;&#10;        }&#10;        .auxiliary-buttons button:hover {&#10;            background-color: #e0e0e0;&#10;        }&#10;        .diagnostic-overlay {&#10;            position: fixed;&#10;            top: 0;&#10;            left: 0;&#10;            width: 100%;&#10;            height: 100%;&#10;            background-color: rgba(0, 0, 0, 0.8);&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            z-index: 1000;&#10;            display: none;&#10;        }&#10;        .diagnostic-content {&#10;            width: 80%;&#10;            max-width: 700px;&#10;            max-height: 80%;&#10;            overflow-y: auto;&#10;            background-color: white;&#10;            padding: 20px;&#10;            border-radius: 8px;&#10;            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);&#10;        }&#10;        .diagnostic-heading {&#10;            text-align: center;&#10;            color: #e74c3c;&#10;            margin-bottom: 20px;&#10;            font-size: 24px;&#10;        }&#10;        .diagnostic-close {&#10;            float: right;&#10;            font-size: 20px;&#10;            cursor: pointer;&#10;            color: #777;&#10;        }&#10;        .diagnostic-close:hover {&#10;            color: #333;&#10;        }&#10;        .diagnostic-section {&#10;            margin-bottom: 15px;&#10;            padding: 10px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;        }&#10;        .diagnostic-actions {&#10;            text-align: center;&#10;            margin-top: 20px;&#10;        }&#10;        .diagnostic-action-button {&#10;            padding: 10px 20px;&#10;            margin: 0 10px;&#10;            border: none;&#10;            border-radius: 5px;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;        }&#10;        .retry-button {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .retry-button:hover {&#10;            background-color: #2980b9;&#10;        }&#10;        .continue-button {&#10;            background-color: #2ecc71;&#10;            color: white;&#10;        }&#10;        .continue-button:hover {&#10;            background-color: #27ae60;&#10;        }&#10;        .diagnostic-file-status {&#10;            display: flex;&#10;            flex-wrap: wrap;&#10;            gap: 10px;&#10;        }&#10;        .file-status-item {&#10;            font-size: 12px;&#10;            padding: 5px 10px;&#10;            border-radius: 3px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .file-found {&#10;            color: #27ae60;&#10;            border-left: 3px solid #27ae60;&#10;        }&#10;        .file-missing {&#10;            color: #e74c3c;&#10;            border-left: 3px solid #e74c3c;&#10;        }&#10;        .statistics-table {&#10;            width: 100%;&#10;            margin: 10px 0;&#10;            border-collapse: collapse;&#10;        }&#10;        .statistics-table th, .statistics-table td {&#10;            padding: 8px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .statistics-table th {&#10;            background-color: #f0f0f0;&#10;        }&#10;        .direction-stats-good {&#10;            color: #27ae60;&#10;        }&#10;        .direction-stats-warning {&#10;            color: #f39c12;&#10;        }&#10;        .direction-stats-bad {&#10;            color: #e74c3c;&#10;        }&#10;        @media (max-width: 600px) {&#10;            .response-button {&#10;                width: 130px;&#10;                height: 130px;&#10;                font-size: 22px;&#10;                margin: 0 20px;&#10;            }&#10;            .control-button {&#10;                padding: 12px 20px;&#10;            }&#10;        }&#10;        .print-button {&#10;            padding: 14px 28px;&#10;            margin: 20px auto;&#10;            background-color: #9b59b6;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;            display: block;&#10;        }&#10;        .print-button:hover {&#10;            background-color: #8e44ad;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .print-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        @media print {&#10;            body {&#10;                background-color: white;&#10;                margin: 0;&#10;                padding: 0;&#10;            }&#10;            .container {&#10;                max-width: 100%;&#10;                box-shadow: none;&#10;                padding: 10px;&#10;            }&#10;            .back-button, .print-button, .auxiliary-buttons {&#10;                display: none;&#10;            }&#10;            .results-container {&#10;                display: block !important;&#10;                box-shadow: none;&#10;                background-color: white;&#10;                padding: 0;&#10;            }&#10;            .chart-container {&#10;                border: 1px solid #ddd;&#10;                background-color: white;&#10;            }&#10;            .result-table th {&#10;                background-color: #f0f0f0 !important;&#10;                color: black !important;&#10;            }&#10;            .result-interpretation {&#10;                background-color: white;&#10;                border: 1px solid #ddd;&#10;            }&#10;            * {&#10;                -webkit-print-color-adjust: exact !important;&#10;                print-color-adjust: exact !important;&#10;            }&#10;        }&#10;        .progress-bar-container {&#10;            width: 100%;&#10;            height: 20px;&#10;            background-color: #e0e0e0;&#10;            border-radius: 10px;&#10;            margin: 10px 0;&#10;            overflow: hidden;&#10;        }&#10;        .progress-bar {&#10;            height: 100%;&#10;            background-color: #4CAF50;&#10;            border-radius: 10px;&#10;            transition: width 0.3s ease;&#10;        }&#10;        .progress-label {&#10;            text-align: center;&#10;            font-size: 14px;&#10;            color: #555;&#10;            margin-top: 5px;&#10;        }&#10;        .highlight-box {&#10;            background-color: #fffacd;&#10;            border: 2px solid #ffd700;&#10;            padding: 15px;&#10;            border-radius: 8px;&#10;            margin: 20px 0;&#10;            text-align: center;&#10;        }&#10;        .highlight-value {&#10;            font-size: 28px;&#10;            font-weight: bold;&#10;            color: #e74c3c;&#10;            margin: 10px 0;&#10;        }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;div class=&quot;container&quot;&gt;&#10;        &lt;div class=&quot;header&quot;&gt;&#10;            &lt;img src=&quot;Media/animation.gif&quot; alt=&quot;Experiment animation&quot;&gt;&#10;            &lt;div class=&quot;training-info&quot;&gt;Low Falling Tone Discrimination (ABX)&lt;/div&gt;&#10;            &lt;div class=&quot;instruction-text&quot;&gt;請判斷第三個音聽起來更像第一個還是第二個音&lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div id=&quot;experimentContainer&quot;&gt;&#10;            &lt;div class=&quot;control-button-container&quot;&gt;&#10;                &lt;input id=&quot;start&quot; type=&quot;button&quot; value=&quot;開始實驗&quot; onclick=&quot;start_onclick()&quot; class=&quot;control-button&quot;&gt;&#10;                &lt;input id=&quot;viewResult&quot; type=&quot;button&quot; value=&quot;查看結果&quot; onclick=&quot;view_onclick()&quot; class=&quot;control-button&quot; disabled&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;prompt-text&quot; id=&quot;promptText&quot;&gt;&#10;                第三個音更像...&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;firstBtn&quot; type=&quot;button&quot; value=&quot;第一個音&quot; onclick=&quot;processAnswer(1)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;                &lt;input id=&quot;secondBtn&quot; type=&quot;button&quot; value=&quot;第二個音&quot; onclick=&quot;processAnswer(2)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;feedback&quot;&gt;&#10;                &lt;img id=&quot;smile&quot; src=&quot;Media/null.gif&quot; width=&quot;100&quot; height=&quot;84&quot; alt=&quot;Feedback&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;text1&quot; class=&quot;status&quot; readonly&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;progress-bar-container&quot;&gt;&#10;                &lt;div class=&quot;progress-bar&quot; id=&quot;progressBar&quot; style=&quot;width: 0%&quot;&gt;&lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;progress-label&quot; id=&quot;progressLabel&quot;&gt;Progress: 0%&lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;debug-info&quot; id=&quot;debugInfo&quot;&gt;&#10;                Debug information will be displayed here&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot;&gt;&#10;                &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;showDebug&quot; onclick=&quot;toggleDebug()&quot;&gt; Show Debug Info&lt;/label&gt;&#10;                &lt;button onclick=&quot;testAudio()&quot;&gt;Test All Audio&lt;/button&gt;&#10;                &lt;button onclick=&quot;showDiagnostics()&quot;&gt;Diagnostics&lt;/button&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot; id=&quot;exportBtn&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div id=&quot;resultsContainer&quot; class=&quot;results-container&quot;&gt;&#10;            &lt;h2 class=&quot;result-heading&quot;&gt;Dynamic Pitch Discrimination Test Results (ABX)&lt;/h2&gt;&#10;            &#10;            &lt;div class=&quot;highlight-box&quot;&gt;&#10;                &lt;h3 style=&quot;margin-top: 0;&quot;&gt;Just Noticeable Difference (JND)&lt;/h3&gt;&#10;                &lt;div class=&quot;highlight-value&quot; id=&quot;jndValue&quot;&gt;--&lt;/div&gt;&#10;                &lt;p style=&quot;margin-bottom: 0; font-size: 14px; color: #666;&quot;&gt;&#10;                    This represents the minimum detectable difference in modulation window duration&lt;br&gt;&#10;                    &lt;strong&gt;Smaller JND = Better discrimination ability&lt;/strong&gt;&#10;                &lt;/p&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Perceptual Discrimination Thresholds&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Parameter&lt;/th&gt;&#10;                        &lt;th&gt;Standard (Reference)&lt;/th&gt;&#10;                        &lt;th&gt;Threshold (Your JND)&lt;/th&gt;&#10;                        &lt;th&gt;Difference Ratio&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;resultTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;div class=&quot;result-interpretation&quot; id=&quot;resultInterpretation&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Detailed Threshold Metrics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Metric&lt;/th&gt;&#10;                        &lt;th&gt;Value&lt;/th&gt;&#10;                        &lt;th&gt;Interpretation&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;detailedMetricsBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;h3&gt;Performance Statistics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Metric&lt;/th&gt;&#10;                        &lt;th&gt;Value&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;performanceStatsBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;button class=&quot;print-button&quot; onclick=&quot;printResults()&quot;&gt;Print Results&lt;/button&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot; style=&quot;margin-top: 20px;&quot;&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;button class=&quot;back-button&quot; onclick=&quot;backToExperiment()&quot;&gt;Back to Experiment&lt;/button&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div class=&quot;diagnostic-overlay&quot; id=&quot;diagnosticOverlay&quot;&gt;&#10;            &lt;div class=&quot;diagnostic-content&quot;&gt;&#10;                &lt;span class=&quot;diagnostic-close&quot; onclick=&quot;closeDiagnostics()&quot;&gt;&amp;times;&lt;/span&gt;&#10;                &lt;h2 class=&quot;diagnostic-heading&quot;&gt;Experiment Diagnostics&lt;/h2&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Test Status&lt;/h3&gt;&#10;                    &lt;table class=&quot;statistics-table&quot;&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;th&gt;Trials&lt;/th&gt;&#10;                            &lt;th&gt;Reversals&lt;/th&gt;&#10;                            &lt;th&gt;Status&lt;/th&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td id=&quot;totalTrials&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;totalReversals&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;testStatus&quot;&gt;Not started&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                    &lt;/table&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Audio Files Check&lt;/h3&gt;&#10;                    &lt;p&gt;Verifying necessary audio files:&lt;/p&gt;&#10;                    &lt;div id=&quot;audioFileStatus&quot; class=&quot;diagnostic-file-status&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Reversal History&lt;/h3&gt;&#10;                    &lt;div id=&quot;reversalHistory&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Recommendations&lt;/h3&gt;&#10;                    &lt;div id=&quot;diagnosticRecommendations&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-actions&quot;&gt;&#10;                    &lt;button class=&quot;diagnostic-action-button continue-button&quot; onclick=&quot;closeDiagnostics()&quot;&gt;Close&lt;/button&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;audio id=&quot;low_falling_standard&quot; src=&quot;Media/low_falling_standard.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;    &lt;audio id=&quot;low_falling_1&quot; src=&quot;Media/low_falling_1.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_falling_2&quot; src=&quot;Media/low_falling_2.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_falling_3&quot; src=&quot;Media/low_falling_3.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_falling_4&quot; src=&quot;Media/low_falling_4.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_falling_5&quot; src=&quot;Media/low_falling_5.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_falling_6&quot; src=&quot;Media/low_falling_6.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_falling_7&quot; src=&quot;Media/low_falling_7.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_falling_8&quot; src=&quot;Media/low_falling_8.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_falling_9&quot; src=&quot;Media/low_falling_9.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;&lt;script&gt;&#10;function getLocalTimestamp() {&#10;    const now = new Date();&#10;    const year = now.getFullYear();&#10;    const month = String(now.getMonth() + 1).padStart(2, '0');&#10;    const day = String(now.getDate()).padStart(2, '0');&#10;    const hours = String(now.getHours()).padStart(2, '0');&#10;    const minutes = String(now.getMinutes()).padStart(2, '0');&#10;    const seconds = String(now.getSeconds()).padStart(2, '0');&#10;    const milliseconds = String(now.getMilliseconds()).padStart(3, '0');&#10;    &#10;    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;&#10;}&#10;&#10;// Stimulus parameters for dynamic pitch modulation&#10;const STIMULUS_DURATION = 450; // ms, total duration&#10;const STANDARD_WINDOW = 400; // ms, modulation window for standard (100%)&#10;const STANDARD_WINDOW_PERCENT = 100; // percentage&#10;&#10;// Modulation window percentages for each difficulty level&#10;const MODULATION_WINDOWS = {&#10;    1: 20,   // easiest - 20% of standard window (80 ms)&#10;    2: 40,   // 160 ms&#10;    3: 50,   // 200 ms&#10;    4: 60,   // 240 ms&#10;    5: 70,   // 280 ms&#10;    6: 80,   // 320 ms&#10;    7: 90,   // 360 ms&#10;    8: 95,   // 380 ms&#10;    9: 98    // hardest - 98% of standard window (392 ms)&#10;};&#10;&#10;function getModulationWindowDuration(level) {&#10;    return (MODULATION_WINDOWS[level] / 100) * STANDARD_WINDOW;&#10;}&#10;&#10;const PITCH_FALL_SEMITONES = 1.0;&#10;&#10;function getModulationRate(level) {&#10;    const windowDuration = getModulationWindowDuration(level);&#10;    const windowDurationSec = windowDuration / 1000;&#10;    return PITCH_FALL_SEMITONES / windowDurationSec;&#10;}&#10;&#10;function getModulationSlope(level) {&#10;    const windowDuration = getModulationWindowDuration(level);&#10;    return PITCH_FALL_SEMITONES / windowDuration;&#10;}&#10;&#10;// Adaptive threshold experiment constants&#10;const MAXREVERSALS = 10;&#10;const MAXITERATIONS = 50;&#10;const LOWERLIMIT = 1;&#10;const DECREASING = -1;&#10;const INCREASING = 1;&#10;const MINIMUMREVERSALS = 6;&#10;const THRESHOLD_REVERSAL_COUNT = 6;&#10;&#10;// Experiment state variables&#10;var CorrectAnswer;&#10;var CorrectResponses = 0;&#10;var Direction = DECREASING;&#10;var Reversals = [];&#10;var NumberOfReversals = 0;&#10;var currentLevel = 5;&#10;var numberOfIterations = 0;&#10;var sentAverage = 0.0;&#10;var sentStdev = 0.0;&#10;var isTestComplete = false;&#10;var audioUnlocked = false;&#10;var allFilesPresent = true;&#10;var trialRecords = [];&#10;var stimulusEndTime = 0;&#10;&#10;// ABX variables&#10;var standardIsFirst;&#10;var comparisonSound;&#10;var standardSound;&#10;var xSound;&#10;&#10;var isReplayTrial = false;&#10;&#10;// Results variables - JND-based&#10;var jndAbsoluteDifference = 0;&#10;var jndRatio = 0;&#10;var jndPercentDifference = 0;&#10;var thresholdWindowDuration = 0;&#10;var thresholdWindowPercent = 0;&#10;var thresholdModulationRate = 0;&#10;var thresholdSlope = 0;&#10;var webersRatio = 0;&#10;&#10;function printResults() {&#10;    window.print();&#10;}&#10;&#10;function logDebug(message) {&#10;    console.log(message);&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var now = new Date();&#10;    var timeStr = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + '.' + now.getMilliseconds();&#10;    debugArea.innerHTML += '&lt;p&gt;[' + timeStr + '] ' + message + '&lt;/p&gt;';&#10;    debugArea.scrollTop = debugArea.scrollHeight;&#10;}&#10;&#10;function toggleDebug() {&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var checkbox = document.getElementById('showDebug');&#10;    debugArea.style.display = checkbox.checked ? 'block' : 'none';&#10;}&#10;&#10;function showDiagnostics() {&#10;    updateDiagnostics();&#10;    document.getElementById('diagnosticOverlay').style.display = 'flex';&#10;}&#10;&#10;function closeDiagnostics() {&#10;    document.getElementById('diagnosticOverlay').style.display = 'none';&#10;}&#10;&#10;function updateDiagnostics() {&#10;    document.getElementById('totalTrials').innerText = numberOfIterations;&#10;    document.getElementById('totalReversals').innerText = NumberOfReversals;&#10;    &#10;    let testStatus = getTestStatus();&#10;    document.getElementById('testStatus').innerText = testStatus.text;&#10;    document.getElementById('testStatus').className = `direction-stats-${testStatus.class}`;&#10;    &#10;    checkAudioFiles();&#10;    &#10;    let reversalHistoryHtml = '';&#10;    if (Reversals.length === 0) {&#10;        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';&#10;    } else {&#10;        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals.join(', ') + '&lt;/p&gt;';&#10;        reversalHistoryHtml += '&lt;p&gt;Corresponding modulation windows: ';&#10;        reversalHistoryHtml += Reversals.map(level =&gt; MODULATION_WINDOWS[level] + '% (' + getModulationWindowDuration(level) + ' ms)').join(', ') + '&lt;/p&gt;';&#10;    }&#10;    &#10;    document.getElementById('reversalHistory').innerHTML = reversalHistoryHtml;&#10;    &#10;    generateDiagnosticRecommendations();&#10;}&#10;&#10;function getTestStatus() {&#10;    if (isTestComplete) {&#10;        return { text: &quot;Complete&quot;, class: &quot;good&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals &lt; 1) {&#10;        return { text: &quot;Not enough data&quot;, class: &quot;bad&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals &lt; MINIMUMREVERSALS) {&#10;        return { text: &quot;Incomplete (&quot; + NumberOfReversals + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals)&quot;, class: &quot;warning&quot; };&#10;    }&#10;    &#10;    return { text: &quot;In progress&quot;, class: &quot;good&quot; };&#10;}&#10;&#10;function checkAudioFiles() {&#10;    const requiredFiles = [&#10;        &quot;low_falling_standard&quot;,&#10;        &quot;low_falling_1&quot;, &quot;low_falling_2&quot;, &quot;low_falling_3&quot;, &quot;low_falling_4&quot;, &quot;low_falling_5&quot;, &#10;        &quot;low_falling_6&quot;, &quot;low_falling_7&quot;, &quot;low_falling_8&quot;, &quot;low_falling_9&quot;&#10;    ];&#10;    &#10;    let statusHtml = '';&#10;    allFilesPresent = true;&#10;    &#10;    requiredFiles.forEach(function(fileId) {&#10;        const audioElement = document.getElementById(fileId);&#10;        const fileFound = audioElement !== null;&#10;        &#10;        if (!fileFound) {&#10;            allFilesPresent = false;&#10;        }&#10;        &#10;        statusHtml += `&lt;div class=&quot;file-status-item ${fileFound ? 'file-found' : 'file-missing'}&quot;&gt;${fileId}: ${fileFound ? 'Found' : 'Missing'}&lt;/div&gt;`;&#10;    });&#10;    &#10;    document.getElementById('audioFileStatus').innerHTML = statusHtml;&#10;}&#10;&#10;function generateDiagnosticRecommendations() {&#10;    let recommendations = '';&#10;    let hasIssues = false;&#10;    &#10;    if (!allFilesPresent) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Critical Issue:&lt;/strong&gt; Some required audio files are missing. Please ensure all files are properly loaded.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (numberOfIterations &gt;= MAXITERATIONS &amp;&amp; NumberOfReversals &lt; MINIMUMREVERSALS) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Issue:&lt;/strong&gt; Reached maximum trials but has insufficient reversals. This might indicate audio file issues or participant response patterns.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (!hasIssues) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Good:&lt;/strong&gt; No major issues detected with the experiment setup.&lt;/p&gt;';&#10;        &#10;        if (isTestComplete) {&#10;            recommendations += '&lt;p&gt;Test is complete.&lt;/p&gt;';&#10;        } else {&#10;            recommendations += '&lt;p&gt;Test is still in progress.&lt;/p&gt;';&#10;        }&#10;    }&#10;    &#10;    document.getElementById('diagnosticRecommendations').innerHTML = recommendations;&#10;}&#10;&#10;function testAudio() {&#10;    logDebug(&quot;Starting to test all audio files...&quot;);&#10;    var audios = document.querySelectorAll('audio');&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    var index = 0;&#10;    function playNext() {&#10;        if (index &gt;= audios.length) {&#10;            logDebug(&quot;All audio testing complete!&quot;);&#10;            return;&#10;        }&#10;        &#10;        var audio = audios[index];&#10;        logDebug(&quot;Testing audio #&quot; + (index + 1) + &quot;: &quot; + audio.id);&#10;        &#10;        audio.currentTime = 0;&#10;        &#10;        var playPromise = audio.play();&#10;        if (playPromise !== undefined) {&#10;            playPromise.then(function() {&#10;                logDebug(audio.id + &quot; played successfully&quot;);&#10;                &#10;                audio.onended = function() {&#10;                    logDebug(audio.id + &quot; playback ended&quot;);&#10;                    index++;&#10;                    setTimeout(playNext, 500);&#10;                };&#10;            }).catch(function(error) {&#10;                logDebug(&quot;Failed to play &quot; + audio.id + &quot;: &quot; + error);&#10;                index++;&#10;                setTimeout(playNext, 500);&#10;            });&#10;        }&#10;    }&#10;    &#10;    playNext();&#10;}&#10;&#10;function unlockAudioContext() {&#10;    logDebug(&quot;Attempting to unlock audio context...&quot;);&#10;    &#10;    var silentAudio = new Audio();&#10;    silentAudio.src = &quot;data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA&quot;;&#10;    &#10;    var promise = silentAudio.play();&#10;    if (promise !== undefined) {&#10;        promise.then(function() {&#10;            logDebug(&quot;Audio context unlocked successfully&quot;);&#10;            silentAudio.remove();&#10;            audioUnlocked = true;&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to unlock audio context: &quot; + error);&#10;        });&#10;    }&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    for (var i = 0; i &lt; allAudios.length; i++) {&#10;        var audio = allAudios[i];&#10;        audio.load();&#10;    }&#10;    &#10;    logDebug(&quot;Preloaded &quot; + allAudios.length + &quot; audio files&quot;);&#10;}&#10;&#10;function resetPage() {&#10;    numberOfIterations++;&#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('firstBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('secondBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    if (isTestComplete) {&#10;        document.getElementById('start').disabled = false;&#10;        document.getElementById('viewResult').disabled = false;&#10;        document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;        updateProgressBar(100);&#10;        return;&#10;    }&#10;    &#10;    if ((numberOfIterations &gt;= MAXITERATIONS) || (NumberOfReversals &gt;= MAXREVERSALS)) {&#10;        if (NumberOfReversals &gt;= MINIMUMREVERSALS) {&#10;            calculateResults();&#10;            isTestComplete = true;&#10;            document.getElementById('start').disabled = false;&#10;            document.getElementById('viewResult').disabled = false;&#10;            document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;            updateProgressBar(100);&#10;        } else {&#10;            logDebug(&quot;Reached max iterations but has only &quot; + NumberOfReversals + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals. Showing diagnostics.&quot;);&#10;            document.getElementById('text1').value = &quot;Insufficient data. Check diagnostics.&quot;;&#10;            setTimeout(function() {&#10;                showDiagnostics();&#10;            }, 500);&#10;            return;&#10;        }&#10;    } else {&#10;        updateProgressBar();&#10;        beginIteration();&#10;    }&#10;}&#10;&#10;function updateProgressBar(forcePercent) {&#10;    if (typeof forcePercent === 'number') {&#10;        document.getElementById('progressBar').style.width = forcePercent + '%';&#10;        document.getElementById('progressLabel').textContent = 'Progress: ' + forcePercent + '%';&#10;        return;&#10;    }&#10;    &#10;    const maxValue = Math.max(MAXREVERSALS, MAXITERATIONS);&#10;    const currentValue = isTestComplete ? maxValue : Math.max(NumberOfReversals, numberOfIterations);&#10;    const totalPercent = Math.min(100 * (currentValue / maxValue), 100);&#10;    &#10;    document.getElementById('progressBar').style.width = totalPercent + '%';&#10;    document.getElementById('progressLabel').textContent = 'Progress: ' + Math.round(totalPercent) + '%';&#10;}&#10;&#10;function calculateResults() {&#10;    let sum = 0.0, stddevsum = 0.0, average = 0.0, stdev = 0.0, counter = 0;&#10;    &#10;    for (let i = 0; i &lt; Reversals.length; i++) {&#10;        if (Reversals[i] &gt; 0) counter++;&#10;    }&#10;    &#10;    if (counter &lt; MINIMUMREVERSALS) {&#10;        logDebug(&quot;Test has insufficient data&quot;);&#10;        alert(&quot;Test has insufficient data. Please complete the test again.&quot;);&#10;        return;&#10;    }&#10;    &#10;    const startIndex = Math.max(0, NumberOfReversals - THRESHOLD_REVERSAL_COUNT);&#10;    counter = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0) {&#10;            sum += level;&#10;            counter++;&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 0) {&#10;        average = sum / counter;&#10;        average = parseFloat(average.toFixed(2));&#10;    }&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0) {&#10;            stddevsum += Math.pow(level - average, 2);&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 1) {&#10;        stdev = Math.sqrt(stddevsum / (counter - 1));&#10;        stdev = parseFloat(stdev.toFixed(2));&#10;    }&#10;    &#10;    sentAverage = average;&#10;    sentStdev = stdev;&#10;    &#10;    thresholdWindowPercent = calculateAverageWindowPercent(startIndex);&#10;    thresholdWindowDuration = (thresholdWindowPercent / 100) * STANDARD_WINDOW;&#10;    thresholdModulationRate = PITCH_FALL_SEMITONES / (thresholdWindowDuration / 1000);&#10;    thresholdSlope = PITCH_FALL_SEMITONES / thresholdWindowDuration;&#10;&#10;    jndAbsoluteDifference = STANDARD_WINDOW - thresholdWindowDuration;&#10;    jndRatio = thresholdWindowDuration / STANDARD_WINDOW;&#10;    jndPercentDifference = 100 - thresholdWindowPercent;&#10;    webersRatio = jndAbsoluteDifference / STANDARD_WINDOW;&#10;    &#10;    logDebug(&quot;Test complete! Average difficulty level: &quot; + average.toFixed(2));&#10;    logDebug(&quot;Threshold window: &quot; + thresholdWindowPercent.toFixed(2) + &quot;% (&quot; + thresholdWindowDuration.toFixed(2) + &quot; ms)&quot;);&#10;    logDebug(&quot;JND Absolute Difference: &quot; + jndAbsoluteDifference.toFixed(2) + &quot; ms&quot;);&#10;    logDebug(&quot;JND Ratio: &quot; + jndRatio.toFixed(4));&#10;    logDebug(&quot;JND Percent Difference: &quot; + jndPercentDifference.toFixed(2) + &quot;%&quot;);&#10;    logDebug(&quot;Weber's Ratio: &quot; + webersRatio.toFixed(4));&#10;    &#10;    document.getElementById('text1').value = &quot;Test complete! JND: &quot; + jndAbsoluteDifference.toFixed(1) + &quot; ms&quot;;&#10;}&#10;&#10;function calculateAverageWindowPercent(startIndex) {&#10;    let sum = 0;&#10;    let count = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0 &amp;&amp; MODULATION_WINDOWS[level] !== undefined) {&#10;            sum += MODULATION_WINDOWS[level];&#10;            count++;&#10;        }&#10;    }&#10;    &#10;    return count &gt; 0 ? sum / count : 0;&#10;}&#10;&#10;function calculateReactionTimeStats() {&#10;    let allRTs = trialRecords.map(t =&gt; parseFloat(t.reactionTime));&#10;    &#10;    return {&#10;        mean: allRTs.length ? (allRTs.reduce((a, b) =&gt; a + b, 0) / allRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;        median: allRTs.length ? calculateMedian(allRTs).toFixed(0) : &quot;N/A&quot;,&#10;        sd: allRTs.length &gt; 1 ? calculateSD(allRTs).toFixed(0) : &quot;N/A&quot;&#10;    };&#10;}&#10;&#10;function calculateAccuracyStats() {&#10;    let allTrials = trialRecords;&#10;    &#10;    return {&#10;        correct: allTrials.filter(t =&gt; t.isCorrect).length,&#10;        total: allTrials.length,&#10;        percentage: allTrials.length ? &#10;            (allTrials.filter(t =&gt; t.isCorrect).length / allTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;    };&#10;}&#10;&#10;function calculateMedian(values) {&#10;    if (!values.length) return 0;&#10;    &#10;    const sortedValues = values.slice().sort((a, b) =&gt; a - b);&#10;    const mid = Math.floor(sortedValues.length / 2);&#10;    &#10;    return sortedValues.length % 2 === 0 ? &#10;        (sortedValues[mid - 1] + sortedValues[mid]) / 2 : &#10;        sortedValues[mid];&#10;}&#10;&#10;function calculateSD(values) {&#10;    if (values.length &lt;= 1) return 0;&#10;    &#10;    const mean = values.reduce((a, b) =&gt; a + b, 0) / values.length;&#10;    const variance = values.map(x =&gt; Math.pow(x - mean, 2)).reduce((a, b) =&gt; a + b, 0) / (values.length - 1);&#10;    &#10;    return Math.sqrt(variance);&#10;}&#10;&#10;function displayResults() {&#10;    logDebug(&quot;Displaying results&quot;);&#10;    &#10;    let hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;&#10;    &#10;    if (!hasData) {&#10;        let message = &quot;Warning: Insufficient data. Results may not be reliable.&quot;;&#10;        &#10;        if (confirm(message + &quot;\n\nWould you like to retry the experiment?&quot;)) {&#10;            window_onload();&#10;            return;&#10;        }&#10;    }&#10;    &#10;    document.getElementById('experimentContainer').style.display = 'none';&#10;    document.getElementById('resultsContainer').style.display = 'block';&#10;    &#10;    if (hasData) {&#10;        document.getElementById('jndValue').innerHTML = &#10;            jndAbsoluteDifference.toFixed(2) + ' ms&lt;br&gt;' +&#10;            '&lt;span style=&quot;font-size: 18px;&quot;&gt;(' + jndPercentDifference.toFixed(2) + '% difference from standard)&lt;/span&gt;';&#10;    } else {&#10;        document.getElementById('jndValue').textContent = 'Insufficient Data';&#10;    }&#10;    &#10;    var tableBody = document.getElementById('resultTableBody');&#10;    tableBody.innerHTML = '';&#10;    &#10;    var windowRow = document.createElement('tr');&#10;    windowRow.innerHTML = &#10;        '&lt;td&gt;Modulation Window Duration&lt;/td&gt;' +&#10;        '&lt;td&gt;' + STANDARD_WINDOW + ' ms (100%)&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? thresholdWindowDuration.toFixed(2) + ' ms (' + thresholdWindowPercent.toFixed(2) + '%)' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? jndRatio.toFixed(4) + ' : 1&lt;br&gt;(Threshold/Standard)' : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(windowRow);&#10;    &#10;    var diffRow = document.createElement('tr');&#10;    diffRow.innerHTML = &#10;        '&lt;td&gt;Absolute Difference (JND)&lt;/td&gt;' +&#10;        '&lt;td&gt;0 ms (reference)&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? jndAbsoluteDifference.toFixed(2) + ' ms' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? 'Weber Ratio: ' + webersRatio.toFixed(4) : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(diffRow);&#10;    &#10;    var rateStandard = PITCH_FALL_SEMITONES / (STANDARD_WINDOW / 1000);&#10;    var rateRow = document.createElement('tr');&#10;    rateRow.innerHTML = &#10;        '&lt;td&gt;Modulation Rate&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rateStandard.toFixed(4) + ' semitones/s&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? thresholdModulationRate.toFixed(4) + ' semitones/s' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? (thresholdModulationRate / rateStandard).toFixed(4) + ' : 1' : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(rateRow);&#10;    &#10;    var interpretation = document.getElementById('resultInterpretation');&#10;    let interpretationHtml = '&lt;h3 style=&quot;margin-top: 0;&quot;&gt;Performance Interpretation&lt;/h3&gt;';&#10;    &#10;    if (hasData) {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Your Just Noticeable Difference (JND):&lt;/strong&gt;&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;You can reliably detect a difference when the modulation window changes by &lt;strong&gt;' + &#10;            jndAbsoluteDifference.toFixed(2) + ' ms&lt;/strong&gt; (or &lt;strong&gt;' + jndPercentDifference.toFixed(2) + &#10;            '%&lt;/strong&gt; of the standard 400 ms window).&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;In other words, you can discriminate between:&lt;/p&gt;';&#10;        interpretationHtml += '&lt;ul&gt;';&#10;        interpretationHtml += '&lt;li&gt;Standard stimulus: 400 ms modulation window&lt;/li&gt;';&#10;        interpretationHtml += '&lt;li&gt;Your threshold: ' + thresholdWindowDuration.toFixed(2) + ' ms modulation window&lt;/li&gt;';&#10;        interpretationHtml += '&lt;li&gt;Difference: ' + jndAbsoluteDifference.toFixed(2) + ' ms&lt;/li&gt;';&#10;        interpretationHtml += '&lt;/ul&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Weber\'s Ratio:&lt;/strong&gt; ' + webersRatio.toFixed(4) + &#10;            ' (smaller Weber\'s ratio = better discrimination sensitivity)&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;&lt;em&gt;Note: A &lt;strong&gt;smaller JND&lt;/strong&gt; indicates &lt;strong&gt;better sensitivity&lt;/strong&gt; to dynamic pitch changes, ' +&#10;            'as it means you can detect smaller differences between stimuli.&lt;/em&gt;&lt;/p&gt;';&#10;    } else {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Complete results not available due to insufficient data.&lt;/p&gt;';&#10;    }&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    const accuracyStats = calculateAccuracyStats();&#10;    &#10;    interpretationHtml += '&lt;p&gt;&lt;strong&gt;Overall Performance:&lt;/strong&gt; ' + accuracyStats.percentage + &#10;        '% accuracy with average reaction time of ' + rtStats.mean + ' ms across ' + &#10;        accuracyStats.total + ' trials.&lt;/p&gt;';&#10;    &#10;    interpretation.innerHTML = interpretationHtml;&#10;    &#10;    var detailedBody = document.getElementById('detailedMetricsBody');&#10;    detailedBody.innerHTML = '';&#10;    &#10;    var metrics = [&#10;        { name: 'Average Difficulty Level', value: hasData ? sentAverage.toFixed(2) : 'N/A', interp: hasData ? 'SD: ' + sentStdev.toFixed(2) : 'N/A' },&#10;        { name: 'Threshold Slope', value: hasData ? thresholdSlope.toFixed(6) + ' semitones/ms' : 'N/A', interp: hasData ? 'Rate of pitch change' : 'N/A' },&#10;        { name: 'Number of Reversals', value: NumberOfReversals, interp: 'Minimum required: ' + MINIMUMREVERSALS },&#10;        { name: 'Total Trials', value: numberOfIterations, interp: 'Maximum allowed: ' + MAXITERATIONS }&#10;    ];&#10;    &#10;    metrics.forEach(function(metric) {&#10;        var row = document.createElement('tr');&#10;        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;&lt;td&gt;' + metric.interp + '&lt;/td&gt;';&#10;        detailedBody.appendChild(row);&#10;    });&#10;    &#10;    var perfBody = document.getElementById('performanceStatsBody');&#10;    perfBody.innerHTML = '';&#10;    &#10;    var perfMetrics = [&#10;        { name: 'Total Trials', value: accuracyStats.total },&#10;        { name: 'Correct Responses', value: accuracyStats.correct },&#10;        { name: 'Overall Accuracy', value: accuracyStats.percentage + '%' },&#10;        { name: 'Mean Reaction Time', value: rtStats.mean + ' ms' },&#10;        { name: 'Median Reaction Time', value: rtStats.median + ' ms' },&#10;        { name: 'RT Standard Deviation', value: rtStats.sd + ' ms' }&#10;    ];&#10;    &#10;    perfMetrics.forEach(function(metric) {&#10;        var row = document.createElement('tr');&#10;        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;';&#10;        perfBody.appendChild(row);&#10;    });&#10;}&#10;&#10;function backToExperiment() {&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;}&#10;&#10;function view_onclick() {&#10;    logDebug(&quot;View results button clicked&quot;);&#10;    &#10;    if (!isTestComplete &amp;&amp; NumberOfReversals &gt;= MINIMUMREVERSALS) {&#10;        calculateResults();&#10;        isTestComplete = true;&#10;    }&#10;    &#10;    displayResults();&#10;}&#10;&#10;function beginIteration() {&#10;    isReplayTrial = false;&#10;    &#10;    standardIsFirst = Math.random() &lt; 0.5;&#10;    var xIsStandard = Math.random() &lt; 0.5;&#10;    &#10;    if (xIsStandard) {&#10;        CorrectAnswer = standardIsFirst ? 1 : 2;&#10;    } else {&#10;        CorrectAnswer = standardIsFirst ? 2 : 1;&#10;    }&#10;    &#10;    logDebug(&quot;Starting new iteration #&quot; + numberOfIterations + &#10;             &quot;, Standard is &quot; + (standardIsFirst ? &quot;first&quot; : &quot;second&quot;) +&#10;             &quot;, X is &quot; + (xIsStandard ? &quot;standard&quot; : &quot;comparison&quot;) +&#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Difficulty level: &quot; + currentLevel +&#10;             &quot;, Modulation window: &quot; + MODULATION_WINDOWS[currentLevel] + &quot;% (&quot; + &#10;             getModulationWindowDuration(currentLevel) + &quot; ms)&quot;);&#10;    &#10;    setTimeout(function() {&#10;        playABXSequence(xIsStandard);&#10;    }, 1000);&#10;}&#10;&#10;function clearButtonAnimations() {&#10;    document.getElementById('firstBtn').classList.remove('button-playing');&#10;    document.getElementById('secondBtn').classList.remove('button-playing');&#10;}&#10;&#10;function playABXSequence(xIsStandard) {&#10;    logDebug(&quot;Playing ABX sequence&quot;);&#10;    &#10;    clearButtonAnimations();&#10;&#10;    standardSound = document.getElementById('low_falling_standard');&#10;    comparisonSound = document.getElementById(&quot;low_falling_&quot; + currentLevel);&#10;&#10;    xSound = xIsStandard ? standardSound : comparisonSound;&#10;    &#10;    if (!standardSound || !comparisonSound) {&#10;        logDebug(&quot;Error: Cannot find audio elements!&quot;);&#10;        document.getElementById('text1').value = &quot;出錯：找不到音頻文件&quot;;&#10;        setTimeout(function() {&#10;            showDiagnostics();&#10;        }, 1000);&#10;        return;&#10;    }&#10;    &#10;    var firstSound = standardIsFirst ? standardSound : comparisonSound;&#10;    document.getElementById('text1').value = &quot;播放第一個音&quot;;&#10;    &#10;    document.getElementById('firstBtn').classList.add('button-playing');&#10;    &#10;    firstSound.currentTime = 0;&#10;    var playPromise1 = firstSound.play();&#10;    &#10;    if (playPromise1 !== undefined) {&#10;        playPromise1.then(function() {&#10;            logDebug(&quot;First sound (A) played successfully&quot;);&#10;            &#10;            firstSound.onended = function() {&#10;                logDebug(&quot;First sound ended&quot;);&#10;                &#10;                document.getElementById('firstBtn').classList.remove('button-playing');&#10;                &#10;                setTimeout(function() {&#10;                    var secondSound = standardIsFirst ? comparisonSound : standardSound;&#10;                    document.getElementById('text1').value = &quot;播放第二個音&quot;;&#10;                    &#10;                    document.getElementById('secondBtn').classList.add('button-playing');&#10;                    &#10;                    secondSound.currentTime = 0;&#10;                    var playPromise2 = secondSound.play();&#10;                    &#10;                    if (playPromise2 !== undefined) {&#10;                        playPromise2.then(function() {&#10;                            logDebug(&quot;Second sound (B) played successfully&quot;);&#10;                            &#10;                            secondSound.onended = function() {&#10;                                logDebug(&quot;Second sound ended&quot;);&#10;                                &#10;                                document.getElementById('secondBtn').classList.remove('button-playing');&#10;                                &#10;                                setTimeout(function() {&#10;                                    document.getElementById('text1').value = &quot;播放第三個音&quot;;&#10;                                    &#10;                                    xSound.currentTime = 0;&#10;                                    var playPromise3 = xSound.play();&#10;                                    &#10;                                    if (playPromise3 !== undefined) {&#10;                                        playPromise3.then(function() {&#10;                                            logDebug(&quot;Third sound (X) played successfully&quot;);&#10;                                            &#10;                                            xSound.onended = function() {&#10;                                                logDebug(&quot;Third sound ended, enabling response buttons&quot;);&#10;                                                &#10;                                                stimulusEndTime = performance.now();&#10;                                                &#10;                                                document.getElementById('text1').value = &quot;請作出選擇&quot;;&#10;                                                document.getElementById('promptText').style.visibility = 'visible';&#10;                                                &#10;                                                document.getElementById('firstBtn').disabled = false;&#10;                                                document.getElementById('secondBtn').disabled = false;&#10;                                                document.getElementById('firstBtn').style.background = &quot;#66CCFF&quot;;&#10;                                                document.getElementById('secondBtn').style.background = &quot;#66CCFF&quot;;&#10;                                            };&#10;                                        }).catch(function(error) {&#10;                                            logDebug(&quot;Failed to play third sound: &quot; + error);&#10;                                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                                            clearButtonAnimations();&#10;                                            setTimeout(showDiagnostics, 1000);&#10;                                        });&#10;                                    }&#10;                                }, 1000);&#10;                            };&#10;                        }).catch(function(error) {&#10;                            logDebug(&quot;Failed to play second sound: &quot; + error);&#10;                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                            clearButtonAnimations();&#10;                            setTimeout(showDiagnostics, 1000);&#10;                        });&#10;                    }&#10;                }, 1000);&#10;            };&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to play first sound: &quot; + error);&#10;            document.getElementById('text1').value = &quot;音頻播放錯誤，請刷新頁面&quot;;&#10;            clearButtonAnimations();&#10;            setTimeout(showDiagnostics, 1000);&#10;        });&#10;    }&#10;}&#10;&#10;function start_onclick() {&#10;    logDebug(&quot;Starting experiment&quot;);&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    checkAudioFiles();&#10;    if (!allFilesPresent) {&#10;        logDebug(&quot;Cannot start experiment: Some audio files are missing&quot;);&#10;        document.getElementById('text1').value = &quot;音頻缺失&quot;;&#10;        showDiagnostics();&#10;        return;&#10;    }&#10;    &#10;    window_onload();&#10;    document.getElementById('text1').value = &quot;開始實驗...&quot;;&#10;    updateProgressBar(0);&#10;    &#10;    setTimeout(function() {&#10;        beginIteration();&#10;        document.getElementById('start').disabled = true;&#10;        document.getElementById('viewResult').disabled = true;&#10;        document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;        document.getElementById('promptText').style.visibility = 'hidden';&#10;    }, 1000);&#10;}&#10;&#10;function gotReversal() {&#10;    NumberOfReversals++;&#10;    Reversals[NumberOfReversals - 1] = currentLevel;&#10;    Direction = -Direction;&#10;    logDebug(&quot;Recorded reversal #&quot; + NumberOfReversals + &quot; at difficulty &quot; + currentLevel + &#10;             &quot; (window: &quot; + MODULATION_WINDOWS[currentLevel] + &quot;%, &quot; + &#10;             getModulationWindowDuration(currentLevel) + &quot; ms)&quot;);&#10;}&#10;&#10;function processAnswer(Response) {&#10;    const reactionEndTime = performance.now();&#10;    const reactionTime = reactionEndTime - stimulusEndTime;&#10;    &#10;    logDebug(&quot;User answered: &quot; + (Response === 1 ? &quot;First&quot; : &quot;Second&quot;) + &#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Is replay: &quot; + isReplayTrial);&#10;    &#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    const isCorrect = (Response === CorrectAnswer);&#10;    &#10;    if (!isReplayTrial) {&#10;        const windowPercent = MODULATION_WINDOWS[currentLevel];&#10;        const windowDuration = getModulationWindowDuration(currentLevel);&#10;        const modulationRate = getModulationRate(currentLevel);&#10;        const slope = getModulationSlope(currentLevel);&#10;        &#10;        const trialInfo = {&#10;            trialNumber: numberOfIterations,&#10;            timestamp: getLocalTimestamp(),&#10;            difficultyLevel: currentLevel,&#10;            modulationWindowPercent: windowPercent,&#10;            modulationWindowDuration: windowDuration.toFixed(2),&#10;            modulationRate: modulationRate.toFixed(4),&#10;            slope: slope.toFixed(6),&#10;            userResponse: Response === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            correctResponse: CorrectAnswer === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            isCorrect: isCorrect,&#10;            reactionTime: reactionTime.toFixed(0),&#10;            isReversal: false,&#10;            stepDirection: Direction === DECREASING ? &quot;Increasing Difficulty&quot; : &quot;Decreasing Difficulty&quot;,&#10;            standardPosition: standardIsFirst ? &quot;First&quot; : &quot;Second&quot;&#10;        };&#10;        &#10;        trialRecords.push(trialInfo);&#10;    }&#10;    &#10;    if (isCorrect) {&#10;        logDebug(&quot;Correct answer&quot;);&#10;        document.getElementById('smile').src = &quot;Media/smiley.png&quot;;&#10;        document.getElementById('text1').value = &quot;正確！&quot;;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses++;&#10;            &#10;            if (CorrectResponses == 2) {&#10;                logDebug(&quot;Two correct answers in a row&quot;);&#10;                CorrectResponses = 0;&#10;                &#10;                if (Direction == INCREASING) {&#10;                    gotReversal();&#10;                    if (trialRecords.length &gt; 0) {&#10;                        trialRecords[trialRecords.length-1].isReversal = true;&#10;                    }&#10;                }&#10;                &#10;                changeLevel(DECREASING);&#10;            }&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            resetPage();&#10;        }, 1500);&#10;    } else {&#10;        logDebug(&quot;Incorrect answer - will replay stimulus&quot;);&#10;        document.getElementById('smile').src = &quot;Media/nosmiley.png&quot;;&#10;        &#10;        var correctAnswerText = CorrectAnswer === 1 ? &quot;第一個音&quot; : &quot;第二個音&quot;;&#10;        document.getElementById('text1').value = &quot;錯誤！正確答案是：&quot; + correctAnswerText;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses = 0;&#10;            &#10;            if (Direction == DECREASING) {&#10;                gotReversal();&#10;                if (trialRecords.length &gt; 0) {&#10;                    trialRecords[trialRecords.length-1].isReversal = true;&#10;                }&#10;            }&#10;            &#10;            changeLevel(INCREASING);&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            document.getElementById('text1').value = &quot;重播刺激音...&quot;;&#10;            &#10;            setTimeout(function() {&#10;                isReplayTrial = true;&#10;                &#10;                var xIsStandard = (standardIsFirst &amp;&amp; CorrectAnswer === 1) || &#10;                                  (!standardIsFirst &amp;&amp; CorrectAnswer === 2);&#10;                playABXSequence(xIsStandard);&#10;            }, 1000);&#10;        }, 2000);&#10;    }&#10;}&#10;&#10;function changeLevel(whichWay) {&#10;    var oldLevel = currentLevel;&#10;    var stepSize = NumberOfReversals &lt; 4 ? 2 : 1;&#10;    &#10;    if (whichWay == DECREASING) {&#10;        currentLevel = Math.min(9, currentLevel + stepSize);&#10;    } else {&#10;        currentLevel = Math.max(LOWERLIMIT, currentLevel - stepSize);&#10;    }&#10;    &#10;    logDebug(&quot;Difficulty changed from level &quot; + oldLevel + &quot; (&quot; + MODULATION_WINDOWS[oldLevel] + &quot;%, &quot; +&#10;             getModulationWindowDuration(oldLevel) + &quot; ms) to level &quot; + &#10;             currentLevel + &quot; (&quot; + MODULATION_WINDOWS[currentLevel] + &quot;%, &quot; +&#10;             getModulationWindowDuration(currentLevel) + &quot; ms) &quot; +&#10;             (whichWay == DECREASING ? &quot;(increasing difficulty)&quot; : &quot;(decreasing difficulty)&quot;));&#10;}&#10;&#10;function exportToCSV() {&#10;    const headers = [&#10;        &quot;Trial Number&quot;, &#10;        &quot;Timestamp&quot;, &#10;        &quot;Difficulty Level&quot;, &#10;        &quot;Modulation Window (%)&quot;,&#10;        &quot;Modulation Window (ms)&quot;,&#10;        &quot;Modulation Rate (semitones/s)&quot;,&#10;        &quot;Slope (semitones/ms)&quot;,&#10;        &quot;Standard Position&quot;,&#10;        &quot;User Response&quot;, &#10;        &quot;Correct Response&quot;, &#10;        &quot;Is Correct&quot;, &#10;        &quot;Reaction Time (ms)&quot;, &#10;        &quot;Is Reversal&quot;,&#10;        &quot;Step Direction&quot;&#10;    ];&#10;    &#10;    const csvRows = [];&#10;    csvRows.push(headers.join(&quot;,&quot;));&#10;    &#10;    trialRecords.forEach(function(trial) {&#10;        const row = [&#10;            trial.trialNumber,&#10;            trial.timestamp,&#10;            trial.difficultyLevel,&#10;            trial.modulationWindowPercent,&#10;            trial.modulationWindowDuration,&#10;            trial.modulationRate,&#10;            trial.slope,&#10;            trial.standardPosition,&#10;            trial.userResponse,&#10;            trial.correctResponse,&#10;            trial.isCorrect ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.reactionTime,&#10;            trial.isReversal ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.stepDirection&#10;        ];&#10;        csvRows.push(row.join(&quot;,&quot;));&#10;    });&#10;    &#10;    csvRows.push(&quot;\nRESULTS SUMMARY - JUST NOTICEABLE DIFFERENCE (JND)&quot;);&#10;    csvRows.push(&quot;\nJND Metrics&quot;);&#10;    csvRows.push(&quot;Parameter,Value,Unit,Description&quot;);&#10;    &#10;    const hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;&#10;    &#10;    csvRows.push(&quot;JND Absolute Difference,&quot; + &#10;        (hasData ? jndAbsoluteDifference.toFixed(2) : &quot;N/A&quot;) + &quot;,ms,Detectable difference from standard (smaller = better)&quot;);&#10;    &#10;    csvRows.push(&quot;JND Percentage Difference,&quot; + &#10;        (hasData ? jndPercentDifference.toFixed(2) : &quot;N/A&quot;) + &quot;,%,Percentage difference from standard (smaller = better)&quot;);&#10;    &#10;    csvRows.push(&quot;JND Ratio (Threshold/Standard),&quot; + &#10;        (hasData ? jndRatio.toFixed(4) : &quot;N/A&quot;) + &quot;,ratio,Threshold modulation window / Standard window&quot;);&#10;    &#10;    csvRows.push(&quot;Weber's Ratio,&quot; + &#10;        (hasData ? webersRatio.toFixed(4) : &quot;N/A&quot;) + &quot;,ratio,ΔI / I (smaller = better sensitivity)&quot;);&#10;    &#10;    csvRows.push(&quot;\nThreshold Parameters&quot;);&#10;    csvRows.push(&quot;Parameter,Value,Unit&quot;);&#10;    &#10;    csvRows.push(&quot;Standard Modulation Window,&quot; + STANDARD_WINDOW + &quot;,ms&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Modulation Window,&quot; + &#10;        (hasData ? thresholdWindowDuration.toFixed(2) : &quot;N/A&quot;) + &quot;,ms&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Window Percentage,&quot; + &#10;        (hasData ? thresholdWindowPercent.toFixed(2) : &quot;N/A&quot;) + &quot;,%&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Modulation Rate,&quot; + &#10;        (hasData ? thresholdModulationRate.toFixed(4) : &quot;N/A&quot;) + &quot;,semitones/s&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Slope,&quot; + &#10;        (hasData ? thresholdSlope.toFixed(6) : &quot;N/A&quot;) + &quot;,semitones/ms&quot;);&#10;    &#10;    csvRows.push(&quot;Average Difficulty Level,&quot; + &#10;        (hasData ? sentAverage.toFixed(2) : &quot;N/A&quot;) + &quot;,level (1-9)&quot;);&#10;    &#10;    csvRows.push(&quot;Difficulty Level SD,&quot; + &#10;        (hasData ? sentStdev.toFixed(2) : &quot;N/A&quot;) + &quot;,level&quot;);&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    csvRows.push(&quot;\nReaction Time Statistics&quot;);&#10;    csvRows.push(&quot;Mean,Median,Standard Deviation&quot;);&#10;    csvRows.push(rtStats.mean + &quot;,&quot; + rtStats.median + &quot;,&quot; + rtStats.sd);&#10;    &#10;    const accuracyStats = calculateAccuracyStats();&#10;    csvRows.push(&quot;\nAccuracy Statistics&quot;);&#10;    csvRows.push(&quot;Correct Responses,Total Responses,Percentage&quot;);&#10;    csvRows.push(accuracyStats.correct + &quot;,&quot; + accuracyStats.total + &quot;,&quot; + accuracyStats.percentage + &quot;%&quot;);&#10;    &#10;    csvRows.push(&quot;\nExperiment Parameters&quot;);&#10;    csvRows.push(&quot;Parameter,Value&quot;);&#10;    csvRows.push(&quot;Paradigm,ABX&quot;);&#10;    csvRows.push(&quot;Stimulus Type,Dynamic Pitch (Falling Tone)&quot;);&#10;    csvRows.push(&quot;Total Stimulus Duration,&quot; + STIMULUS_DURATION + &quot; ms&quot;);&#10;    csvRows.push(&quot;Standard Modulation Window,&quot; + STANDARD_WINDOW + &quot; ms&quot;);&#10;    csvRows.push(&quot;Pitch Fall Amount,&quot; + PITCH_FALL_SEMITONES + &quot; semitone(s)&quot;);&#10;    csvRows.push(&quot;Max Reversals,&quot; + MAXREVERSALS);&#10;    csvRows.push(&quot;Min Reversals for Calculation,&quot; + MINIMUMREVERSALS);&#10;    csvRows.push(&quot;Max Iterations,&quot; + MAXITERATIONS);&#10;    &#10;    csvRows.push(&quot;\nDifficulty Level Mapping&quot;);&#10;    csvRows.push(&quot;Level,Modulation Window (%),Modulation Window (ms),Difference from Standard (ms),Modulation Rate (semitones/s),Slope (semitones/ms)&quot;);&#10;    for (let level = 1; level &lt;= 9; level++) {&#10;        const windowPercent = MODULATION_WINDOWS[level];&#10;        const windowDuration = getModulationWindowDuration(level);&#10;        const diffFromStandard = STANDARD_WINDOW - windowDuration;&#10;        const rate = getModulationRate(level);&#10;        const slope = getModulationSlope(level);&#10;        csvRows.push(level + &quot;,&quot; + windowPercent + &quot;,&quot; + windowDuration.toFixed(2) + &quot;,&quot; + &#10;                     diffFromStandard.toFixed(2) + &quot;,&quot; + rate.toFixed(4) + &quot;,&quot; + slope.toFixed(6));&#10;    }&#10;    &#10;    const csvContent = &quot;data:text/csv;charset=utf-8,&quot; + csvRows.join(&quot;\n&quot;);&#10;    const encodedUri = encodeURI(csvContent);&#10;    const link = document.createElement(&quot;a&quot;);&#10;    const timestamp = new Date().toISOString().replace(/[:.]/g, &quot;-&quot;);&#10;    link.setAttribute(&quot;href&quot;, encodedUri);&#10;    link.setAttribute(&quot;download&quot;, &quot;dynamic_pitch_JND_ABX_data_&quot; + timestamp + &quot;.csv&quot;);&#10;    document.body.appendChild(link);&#10;    link.click();&#10;    document.body.removeChild(link);&#10;}&#10;&#10;function window_onload() {&#10;    window.name = &quot;EXP&quot;;&#10;    NumberOfReversals = 0;&#10;    numberOfIterations = 0;&#10;    CorrectResponses = 0;&#10;    Direction = DECREASING;&#10;    currentLevel = 5;&#10;    isTestComplete = false;&#10;    Reversals = [];&#10;    trialRecords = [];&#10;    isReplayTrial = false;&#10;    &#10;    jndAbsoluteDifference = 0;&#10;    jndRatio = 0;&#10;    jndPercentDifference = 0;&#10;    thresholdWindowDuration = 0;&#10;    thresholdWindowPercent = 0;&#10;    thresholdModulationRate = 0;&#10;    thresholdSlope = 0;&#10;    webersRatio = 0;&#10;&#10;    document.getElementById('text1').value = &quot;準備完畢後請點擊\&quot;開始實驗\&quot;&quot;;&#10;    document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;    document.getElementById('start').disabled = false;&#10;    document.getElementById('viewResult').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;    &#10;    updateProgressBar(0);&#10;    &#10;    logDebug(&quot;Page reset complete&quot;);&#10;}&#10;&#10;window.onload = function() {&#10;    window_onload();&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    logDebug(&quot;Preloading &quot; + allAudios.length + &quot; audio files&quot;);&#10;    &#10;    allAudios.forEach(function(audio) {&#10;        audio.load();&#10;    });&#10;    &#10;    document.getElementById('text1').value = &quot;請點擊\&quot;開始實驗\&quot;&quot;;&#10;    &#10;    window.onerror = function(message, source, lineno, colno, error) {&#10;        logDebug(&quot;Global error: &quot; + message + &quot; at &quot; + source + &quot;:&quot; + lineno);&#10;        return false;&#10;    };&#10;    &#10;    document.getElementById('showDebug').checked = true;&#10;    toggleDebug();&#10;};&#10;&lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
                    <entry key="file:///E:/Projects/Pitch_Training/ABX_level_high.html" value="&lt;!DOCTYPE html&gt;&#10;&lt;html&gt;&#10;&lt;head&gt;&#10;    &lt;title&gt;PLOYU-Peng's Lab: Pitch Sensitivity Training&lt;/title&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;style&gt;&#10;        body {&#10;            font-family: Arial, sans-serif;&#10;            margin: 20px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .container {&#10;            max-width: 800px;&#10;            margin: 0 auto;&#10;            padding: 20px;&#10;            background-color: white;&#10;            border-radius: 10px;&#10;            box-shadow: 0 0 10px rgba(0,0,0,0.1);&#10;            display: flex;&#10;            flex-direction: column;&#10;            align-items: center;&#10;        }&#10;        .header {&#10;            text-align: center;&#10;            margin-bottom: 40px;&#10;            width: 100%;&#10;        }&#10;        .training-info {&#10;            font-size: 16px;&#10;            color: #555;&#10;            margin-top: 10px;&#10;            margin-bottom: 5px;&#10;            text-align: center;&#10;        }&#10;        .instruction-text {&#10;            font-size: 14px;&#10;            color: #777;&#10;            margin-bottom: 15px;&#10;            text-align: center;&#10;            font-style: italic;&#10;        }&#10;        .button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .prompt-text {&#10;            text-align: center;&#10;            font-size: 20px;&#10;            margin-bottom: 25px;&#10;            margin-top: 30px;&#10;            font-weight: bold;&#10;        }&#10;        .response-button {&#10;            width: 160px;&#10;            height: 160px;&#10;            font-size: 26px;&#10;            margin: 0 40px;&#10;            border-radius: 15px;&#10;            border: none;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.1);&#10;            transition: all 0.3s ease;&#10;        }&#10;        .response-button:hover:enabled {&#10;            transform: translateY(-3px);&#10;            box-shadow: 0 6px 12px rgba(0,0,0,0.15);&#10;        }&#10;        .response-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .button-playing {&#10;            animation: pulse 1s ease-in-out infinite;&#10;            box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            transform: scale(1.05);&#10;        }&#10;        @keyframes pulse {&#10;            0%, 100% {&#10;                box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            }&#10;            50% {&#10;                box-shadow: 0 0 30px rgba(102, 204, 255, 1);&#10;            }&#10;        }&#10;        .control-button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            gap: 30px;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .control-button {&#10;            padding: 14px 28px;&#10;            font-size: 18px;&#10;            border-radius: 8px;&#10;            border: none;&#10;            background-color: #4CAF50;&#10;            color: white;&#10;            cursor: pointer;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .control-button:hover:enabled {&#10;            background-color: #3e8e41;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .control-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .control-button:disabled {&#10;            background-color: #cccccc;&#10;            cursor: not-allowed;&#10;            box-shadow: none;&#10;        }&#10;        .feedback {&#10;            text-align: center;&#10;            height: 100px;&#10;            margin: 30px 0;&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;        }&#10;        .status {&#10;            width: 350px;&#10;            height: 68px;&#10;            text-align: center;&#10;            font-size: 18px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            margin: 0 auto;&#10;            padding: 10px;&#10;            background-color: #f9f9f9;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.05);&#10;        }&#10;        .debug-info {&#10;            font-size: 12px;&#10;            color: #777;&#10;            margin-top: 30px;&#10;            text-align: left;&#10;            display: none;&#10;            max-height: 300px;&#10;            overflow-y: auto;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            padding: 15px;&#10;            width: 100%;&#10;        }&#10;        .results-container {&#10;            display: none;&#10;            margin-top: 30px;&#10;            padding: 20px;&#10;            background-color: #f0f8ff;&#10;            border-radius: 8px;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.1);&#10;            width: 100%;&#10;        }&#10;        .result-heading {&#10;            text-align: center;&#10;            margin-bottom: 20px;&#10;            color: #2c3e50;&#10;        }&#10;        .result-table {&#10;            width: 100%;&#10;            border-collapse: collapse;&#10;            margin-bottom: 20px;&#10;        }&#10;        .result-table th, .result-table td {&#10;            padding: 12px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .result-table th {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .result-table tr:nth-child(even) {&#10;            background-color: #f2f2f2;&#10;        }&#10;        .result-interpretation {&#10;            background-color: #e8f4f8;&#10;            padding: 15px;&#10;            border-radius: 5px;&#10;            margin-bottom: 20px;&#10;        }&#10;        .back-button {&#10;            display: block;&#10;            margin: 0 auto;&#10;            padding: 14px 28px;&#10;            background-color: #3498db;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .back-button:hover {&#10;            background-color: #2980b9;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .back-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        .chart-container {&#10;            height: 300px;&#10;            margin: 20px 0;&#10;            background-color: white;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;            padding: 10px;&#10;        }&#10;        .auxiliary-buttons {&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            margin-top: 30px;&#10;            gap: 20px;&#10;            flex-wrap: wrap;&#10;        }&#10;        .auxiliary-buttons button {&#10;            padding: 10px 15px;&#10;            border-radius: 5px;&#10;            border: 1px solid #ddd;&#10;            background-color: #f0f0f0;&#10;            cursor: pointer;&#10;            transition: all 0.2s ease;&#10;        }&#10;        .auxiliary-buttons button:hover {&#10;            background-color: #e0e0e0;&#10;        }&#10;        .diagnostic-overlay {&#10;            position: fixed;&#10;            top: 0;&#10;            left: 0;&#10;            width: 100%;&#10;            height: 100%;&#10;            background-color: rgba(0, 0, 0, 0.8);&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            z-index: 1000;&#10;            display: none;&#10;        }&#10;        .diagnostic-content {&#10;            width: 80%;&#10;            max-width: 700px;&#10;            max-height: 80%;&#10;            overflow-y: auto;&#10;            background-color: white;&#10;            padding: 20px;&#10;            border-radius: 8px;&#10;            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);&#10;        }&#10;        .diagnostic-heading {&#10;            text-align: center;&#10;            color: #e74c3c;&#10;            margin-bottom: 20px;&#10;            font-size: 24px;&#10;        }&#10;        .diagnostic-close {&#10;            float: right;&#10;            font-size: 20px;&#10;            cursor: pointer;&#10;            color: #777;&#10;        }&#10;        .diagnostic-close:hover {&#10;            color: #333;&#10;        }&#10;        .diagnostic-section {&#10;            margin-bottom: 15px;&#10;            padding: 10px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;        }&#10;        .diagnostic-actions {&#10;            text-align: center;&#10;            margin-top: 20px;&#10;        }&#10;        .diagnostic-action-button {&#10;            padding: 10px 20px;&#10;            margin: 0 10px;&#10;            border: none;&#10;            border-radius: 5px;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;        }&#10;        .retry-button {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .retry-button:hover {&#10;            background-color: #2980b9;&#10;        }&#10;        .continue-button {&#10;            background-color: #2ecc71;&#10;            color: white;&#10;        }&#10;        .continue-button:hover {&#10;            background-color: #27ae60;&#10;        }&#10;        .diagnostic-file-check {&#10;            margin: 20px 0;&#10;        }&#10;        .diagnostic-file-status {&#10;            display: flex;&#10;            flex-wrap: wrap;&#10;            gap: 10px;&#10;        }&#10;        .file-status-item {&#10;            font-size: 12px;&#10;            padding: 5px 10px;&#10;            border-radius: 3px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .file-found {&#10;            color: #27ae60;&#10;            border-left: 3px solid #27ae60;&#10;        }&#10;        .file-missing {&#10;            color: #e74c3c;&#10;            border-left: 3px solid #e74c3c;&#10;        }&#10;        .statistics-table {&#10;            width: 100%;&#10;            margin: 10px 0;&#10;            border-collapse: collapse;&#10;        }&#10;        .statistics-table th, .statistics-table td {&#10;            padding: 8px;&#10;            text-align:center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .statistics-table th {&#10;            background-color: #f0f0f0;&#10;        }&#10;        .direction-stats-good {&#10;            color: #27ae60;&#10;        }&#10;        .direction-stats-warning {&#10;            color: #f39c12;&#10;        }&#10;        .direction-stats-bad {&#10;            color: #e74c3c;&#10;        }&#10;        @media (max-width: 600px) {&#10;            .response-button {&#10;                width: 130px;&#10;                height: 130px;&#10;                font-size: 22px;&#10;                margin: 0 20px;&#10;            }&#10;            .control-button {&#10;                padding: 12px 20px;&#10;            }&#10;        }&#10;        .print-button {&#10;            padding: 14px 28px;&#10;            margin: 20px auto;&#10;            background-color: #9b59b6;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;            display: block;&#10;        }&#10;        .print-button:hover {&#10;            background-color: #8e44ad;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .print-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        @media print {&#10;            body {&#10;                background-color: white;&#10;                margin: 0;&#10;                padding: 0;&#10;            }&#10;            .container {&#10;                max-width: 100%;&#10;                box-shadow: none;&#10;                padding: 10px;&#10;            }&#10;            .back-button, .print-button, .auxiliary-buttons {&#10;                display: none;&#10;            }&#10;            .results-container {&#10;                display: block !important;&#10;                box-shadow: none;&#10;                background-color: white;&#10;                padding: 0;&#10;            }&#10;            .chart-container {&#10;                border: 1px solid #ddd;&#10;                background-color: white;&#10;            }&#10;            .result-table th {&#10;                background-color: #f0f0f0 !important;&#10;                color: black !important;&#10;            }&#10;            .result-interpretation {&#10;                background-color: white;&#10;                border: 1px solid #ddd;&#10;            }&#10;            * {&#10;                -webkit-print-color-adjust: exact !important;&#10;                print-color-adjust: exact !important;&#10;            }&#10;        }&#10;        .progress-bar-container {&#10;            width: 100%;&#10;            height: 20px;&#10;            background-color: #e0e0e0;&#10;            border-radius: 10px;&#10;            margin: 10px 0;&#10;            overflow: hidden;&#10;        }&#10;        .progress-bar {&#10;            height: 100%;&#10;            background-color: #4CAF50;&#10;            border-radius: 10px;&#10;            transition: width 0.3s ease;&#10;        }&#10;        .progress-label {&#10;            text-align: center;&#10;            font-size: 14px;&#10;            color: #555;&#10;            margin-top: 5px;&#10;        }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;div class=&quot;container&quot;&gt;&#10;        &lt;div class=&quot;header&quot;&gt;&#10;            &lt;img src=&quot;Media/animation.gif&quot; alt=&quot;Experiment animation&quot;&gt;&#10;            &lt;div class=&quot;training-info&quot;&gt;High Register Discrimination (ABX)&lt;/div&gt;&#10;            &lt;div class=&quot;instruction-text&quot;&gt;請判斷第三個音聽起來更像第一個還是第二個音&lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div id=&quot;experimentContainer&quot;&gt;&#10;            &lt;div class=&quot;control-button-container&quot;&gt;&#10;                &lt;input id=&quot;start&quot; type=&quot;button&quot; value=&quot;開始實驗&quot; onclick=&quot;start_onclick()&quot; class=&quot;control-button&quot;&gt;&#10;                &lt;input id=&quot;viewResult&quot; type=&quot;button&quot; value=&quot;查看結果&quot; onclick=&quot;view_onclick()&quot; class=&quot;control-button&quot; disabled&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;prompt-text&quot; id=&quot;promptText&quot;&gt;&#10;                第三個音更像...&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;firstBtn&quot; type=&quot;button&quot; value=&quot;第一個音&quot; onclick=&quot;processAnswer(1)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;                &lt;input id=&quot;secondBtn&quot; type=&quot;button&quot; value=&quot;第二個音&quot; onclick=&quot;processAnswer(2)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;feedback&quot;&gt;&#10;                &lt;img id=&quot;smile&quot; src=&quot;Media/null.gif&quot; width=&quot;100&quot; height=&quot;84&quot; alt=&quot;Feedback&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;text1&quot; class=&quot;status&quot; readonly&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;progress-bar-container&quot;&gt;&#10;                &lt;div class=&quot;progress-bar&quot; id=&quot;progressBar&quot; style=&quot;width: 0%&quot;&gt;&lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;progress-label&quot; id=&quot;progressLabel&quot;&gt;Progress: 0%&lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;debug-info&quot; id=&quot;debugInfo&quot;&gt;&#10;                Debug information will be displayed here&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot;&gt;&#10;                &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;showDebug&quot; onclick=&quot;toggleDebug()&quot;&gt; Show Debug Info&lt;/label&gt;&#10;                &lt;button onclick=&quot;testAudio()&quot;&gt;Test All Audio&lt;/button&gt;&#10;                &lt;button onclick=&quot;showDiagnostics()&quot;&gt;Diagnostics&lt;/button&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot; id=&quot;exportBtn&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div id=&quot;resultsContainer&quot; class=&quot;results-container&quot;&gt;&#10;            &lt;h2 class=&quot;result-heading&quot;&gt;Pitch Discrimination Test Results (ABX)&lt;/h2&gt;&#10;            &#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Test Direction&lt;/th&gt;&#10;                        &lt;th&gt;Threshold (semitones)&lt;/th&gt;&#10;                        &lt;th&gt;Std. Deviation&lt;/th&gt;&#10;                        &lt;th&gt;Assessment&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;resultTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;div class=&quot;result-interpretation&quot; id=&quot;resultInterpretation&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Reaction Time Statistics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot; id=&quot;rtStatsTable&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Direction&lt;/th&gt;&#10;                        &lt;th&gt;Mean RT (ms)&lt;/th&gt;&#10;                        &lt;th&gt;Median RT (ms)&lt;/th&gt;&#10;                        &lt;th&gt;RT Std. Deviation&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;rtStatsTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;h3&gt;Accuracy Statistics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot; id=&quot;accuracyStatsTable&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Direction&lt;/th&gt;&#10;                        &lt;th&gt;Correct Responses&lt;/th&gt;&#10;                        &lt;th&gt;Total Responses&lt;/th&gt;&#10;                        &lt;th&gt;Accuracy&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;accuracyStatsTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;div class=&quot;chart-container&quot; id=&quot;resultChart&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;button class=&quot;print-button&quot; onclick=&quot;printResults()&quot;&gt;Print Results&lt;/button&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot; style=&quot;margin-top: 20px;&quot;&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;button class=&quot;back-button&quot; onclick=&quot;backToExperiment()&quot;&gt;Back to Experiment&lt;/button&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div class=&quot;diagnostic-overlay&quot; id=&quot;diagnosticOverlay&quot;&gt;&#10;            &lt;div class=&quot;diagnostic-content&quot;&gt;&#10;                &lt;span class=&quot;diagnostic-close&quot; onclick=&quot;closeDiagnostics()&quot;&gt;&amp;times;&lt;/span&gt;&#10;                &lt;h2 class=&quot;diagnostic-heading&quot;&gt;Experiment Diagnostics&lt;/h2&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Test Status&lt;/h3&gt;&#10;                    &lt;table class=&quot;statistics-table&quot;&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;th&gt;Direction&lt;/th&gt;&#10;                            &lt;th&gt;Trials&lt;/th&gt;&#10;                            &lt;th&gt;Reversals&lt;/th&gt;&#10;                            &lt;th&gt;Status&lt;/th&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td&gt;Higher Direction&lt;/td&gt;&#10;                            &lt;td id=&quot;higherTrials&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;higherReversals&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;higherStatus&quot;&gt;Not started&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td&gt;Lower Direction&lt;/td&gt;&#10;                            &lt;td id=&quot;lowerTrials&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;lowerReversals&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;lowerStatus&quot;&gt;Not started&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                    &lt;/table&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Audio Files Check&lt;/h3&gt;&#10;                    &lt;p&gt;Verifying necessary audio files:&lt;/p&gt;&#10;                    &lt;div id=&quot;audioFileStatus&quot; class=&quot;diagnostic-file-status&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Reversal History&lt;/h3&gt;&#10;                    &lt;div id=&quot;reversalHistory&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Recommendations&lt;/h3&gt;&#10;                    &lt;div id=&quot;diagnosticRecommendations&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-actions&quot;&gt;&#10;                    &lt;button class=&quot;diagnostic-action-button retry-button&quot; onclick=&quot;retryIncompleteDirection()&quot;&gt;Retry Incomplete Direction&lt;/button&gt;&#10;                    &lt;button class=&quot;diagnostic-action-button continue-button&quot; onclick=&quot;closeDiagnostics()&quot;&gt;Close&lt;/button&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;audio id=&quot;high_level_standard&quot; src=&quot;Media/high_level_standard.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;    &lt;audio id=&quot;high_level_1_h&quot; src=&quot;Media/high_level_1_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_2_h&quot; src=&quot;Media/high_level_2_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_3_h&quot; src=&quot;Media/high_level_3_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_4_h&quot; src=&quot;Media/high_level_4_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_5_h&quot; src=&quot;Media/high_level_5_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_6_h&quot; src=&quot;Media/high_level_6_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_7_h&quot; src=&quot;Media/high_level_7_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_8_h&quot; src=&quot;Media/high_level_8_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_9_h&quot; src=&quot;Media/high_level_9_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;    &lt;audio id=&quot;high_level_1_l&quot; src=&quot;Media/high_level_1_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_2_l&quot; src=&quot;Media/high_level_2_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_3_l&quot; src=&quot;Media/high_level_3_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_4_l&quot; src=&quot;Media/high_level_4_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_5_l&quot; src=&quot;Media/high_level_5_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_6_l&quot; src=&quot;Media/high_level_6_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_7_l&quot; src=&quot;Media/high_level_7_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_8_l&quot; src=&quot;Media/high_level_8_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_9_l&quot; src=&quot;Media/high_level_9_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;&lt;script&gt;&#10;function getLocalTimestamp() {&#10;    const now = new Date();&#10;    const year = now.getFullYear();&#10;    const month = String(now.getMonth() + 1).padStart(2, '0');&#10;    const day = String(now.getDate()).padStart(2, '0');&#10;    const hours = String(now.getHours()).padStart(2, '0');&#10;    const minutes = String(now.getMinutes()).padStart(2, '0');&#10;    const seconds = String(now.getSeconds()).padStart(2, '0');&#10;    const milliseconds = String(now.getMilliseconds()).padStart(3, '0');&#10;    &#10;    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;&#10;}&#10;&#10;// Adaptive threshold experiment constants&#10;const MAXREVERSALS = 10;&#10;const MAXITERATIONS = 50;&#10;const LOWERLIMIT = 1;&#10;const DECREASING = -1;&#10;const INCREASING = 1;&#10;const MINIMUMREVERSALS = 6;&#10;const THRESHOLD_REVERSAL_COUNT = 6;&#10;const FORCEBALANCETHRESHOLD = 5;&#10;&#10;// Experiment state variables&#10;var CorrectAnswer;&#10;var CorrectResponses = [0, 0];&#10;var Direction = [DECREASING, DECREASING];&#10;var Reversals = [[], []];&#10;var NumberOfReversals = [0, 0];&#10;var currentLevel = [5, 5];&#10;var numberOfIterations = 0;&#10;var sentAverage = [0.0, 0.0];&#10;var sentStdev = [0.0, 0.0];&#10;var currentStimDirection;&#10;var isTestComplete = [false, false];&#10;var audioUnlocked = false;&#10;var trialsPerDirection = [0, 0];&#10;var forceDirection = null;&#10;var directionHistory = [];&#10;var allFilesPresent = true;&#10;var trialRecords = [];&#10;var stimulusEndTime = 0;&#10;&#10;// ABX新增变量&#10;var standardIsFirst;&#10;var comparisonSound;&#10;var standardSound;&#10;var xSound;&#10;&#10;// 新增：重播标志&#10;var isReplayTrial = false;&#10;&#10;function printResults() {&#10;    window.print();&#10;}&#10;&#10;function logDebug(message) {&#10;    console.log(message);&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var now = new Date();&#10;    var timeStr = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + '.' + now.getMilliseconds();&#10;    debugArea.innerHTML += '&lt;p&gt;[' + timeStr + '] ' + message + '&lt;/p&gt;';&#10;    debugArea.scrollTop = debugArea.scrollHeight;&#10;}&#10;&#10;function toggleDebug() {&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var checkbox = document.getElementById('showDebug');&#10;    debugArea.style.display = checkbox.checked ? 'block' : 'none';&#10;}&#10;&#10;function showDiagnostics() {&#10;    updateDiagnostics();&#10;    document.getElementById('diagnosticOverlay').style.display = 'flex';&#10;}&#10;&#10;function closeDiagnostics() {&#10;    document.getElementById('diagnosticOverlay').style.display = 'none';&#10;}&#10;&#10;function updateDiagnostics() {&#10;    document.getElementById('higherTrials').innerText = trialsPerDirection[0];&#10;    document.getElementById('lowerTrials').innerText = trialsPerDirection[1];&#10;    document.getElementById('higherReversals').innerText = NumberOfReversals[0];&#10;    document.getElementById('lowerReversals').innerText = NumberOfReversals[1];&#10;    &#10;    let higherStatus = getDirectionStatus(0);&#10;    let lowerStatus = getDirectionStatus(1);&#10;    &#10;    document.getElementById('higherStatus').innerText = higherStatus.text;&#10;    document.getElementById('higherStatus').className = `direction-stats-${higherStatus.class}`;&#10;    document.getElementById('lowerStatus').innerText = lowerStatus.text;&#10;    document.getElementById('lowerStatus').className = `direction-stats-${lowerStatus.class}`;&#10;    &#10;    checkAudioFiles();&#10;    &#10;    let reversalHistoryHtml = '&lt;h4&gt;Higher Direction&lt;/h4&gt;';&#10;    if (Reversals[0].length === 0) {&#10;        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';&#10;    } else {&#10;        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals[0].join(', ') + '&lt;/p&gt;';&#10;    }&#10;    &#10;    reversalHistoryHtml += '&lt;h4&gt;Lower Direction&lt;/h4&gt;';&#10;    if (Reversals[1].length === 0) {&#10;        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';&#10;    } else {&#10;        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals[1].join(', ') + '&lt;/p&gt;';&#10;    }&#10;    &#10;    document.getElementById('reversalHistory').innerHTML = reversalHistoryHtml;&#10;    &#10;    generateDiagnosticRecommendations();&#10;}&#10;&#10;function getDirectionStatus(dirIndex) {&#10;    if (isTestComplete[dirIndex]) {&#10;        return { text: &quot;Complete&quot;, class: &quot;good&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals[dirIndex] &lt; 1) {&#10;        return { text: &quot;Not enough data&quot;, class: &quot;bad&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals[dirIndex] &lt; MINIMUMREVERSALS) {&#10;        return { text: &quot;Incomplete (&quot; + NumberOfReversals[dirIndex] + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals)&quot;, class: &quot;warning&quot; };&#10;    }&#10;    &#10;    return { text: &quot;In progress&quot;, class: &quot;good&quot; };&#10;}&#10;&#10;function checkAudioFiles() {&#10;    const requiredFiles = [&#10;        &quot;high_level_standard&quot;,&#10;        &quot;high_level_1_h&quot;, &quot;high_level_2_h&quot;, &quot;high_level_3_h&quot;, &quot;high_level_4_h&quot;, &quot;high_level_5_h&quot;, &#10;        &quot;high_level_6_h&quot;, &quot;high_level_7_h&quot;, &quot;high_level_8_h&quot;, &quot;high_level_9_h&quot;,&#10;        &quot;high_level_1_l&quot;, &quot;high_level_2_l&quot;, &quot;high_level_3_l&quot;, &quot;high_level_4_l&quot;, &quot;high_level_5_l&quot;, &#10;        &quot;high_level_6_l&quot;, &quot;high_level_7_l&quot;, &quot;high_level_8_l&quot;, &quot;high_level_9_l&quot;&#10;    ];&#10;    &#10;    let statusHtml = '';&#10;    allFilesPresent = true;&#10;    &#10;    requiredFiles.forEach(function(fileId) {&#10;        const audioElement = document.getElementById(fileId);&#10;        const fileFound = audioElement !== null;&#10;        &#10;        if (!fileFound) {&#10;            allFilesPresent = false;&#10;        }&#10;        &#10;        statusHtml += `&lt;div class=&quot;file-status-item ${fileFound ? 'file-found' : 'file-missing'}&quot;&gt;${fileId}: ${fileFound ? 'Found' : 'Missing'}&lt;/div&gt;`;&#10;    });&#10;    &#10;    document.getElementById('audioFileStatus').innerHTML = statusHtml;&#10;}&#10;&#10;function generateDiagnosticRecommendations() {&#10;    let recommendations = '';&#10;    let hasIssues = false;&#10;    &#10;    if (!allFilesPresent) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Critical Issue:&lt;/strong&gt; Some required audio files are missing. Please ensure all files are properly loaded.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    const directionDifference = Math.abs(trialsPerDirection[0] - trialsPerDirection[1]);&#10;    if (directionDifference &gt; 10 &amp;&amp; !isTestComplete[0] &amp;&amp; !isTestComplete[1]) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Warning:&lt;/strong&gt; Trial count is imbalanced between higher and lower directions. Consider restarting experiment.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    for (let i = 0; i &lt; 2; i++) {&#10;        if (trialsPerDirection[i] &gt;= MAXITERATIONS/2 &amp;&amp; NumberOfReversals[i] &lt; MINIMUMREVERSALS) {&#10;            recommendations += '&lt;p&gt;&lt;strong&gt;Issue:&lt;/strong&gt; ' + (i === 0 ? 'Higher' : 'Lower') + &#10;                ' direction reached maximum trials but has insufficient reversals. This might indicate audio file issues or participant response patterns.&lt;/p&gt;';&#10;            hasIssues = true;&#10;        }&#10;    }&#10;    &#10;    if (numberOfIterations &gt; 10 &amp;&amp; (trialsPerDirection[0] === 0 || trialsPerDirection[1] === 0)) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Warning:&lt;/strong&gt; One direction has not been tested at all. Algorithm may be malfunctioning.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (!hasIssues) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Good:&lt;/strong&gt; No major issues detected with the experiment setup.&lt;/p&gt;';&#10;        &#10;        if (isTestComplete[0] &amp;&amp; isTestComplete[1]) {&#10;            recommendations += '&lt;p&gt;Both test directions are complete.&lt;/p&gt;';&#10;        } else if (isTestComplete[0]) {&#10;            recommendations += '&lt;p&gt;Higher direction test is complete. Lower direction test still needs more data.&lt;/p&gt;';&#10;        } else if (isTestComplete[1]) {&#10;            recommendations += '&lt;p&gt;Lower direction test is complete. Higher direction test still needs more data.&lt;/p&gt;';&#10;        } else {&#10;            recommendations += '&lt;p&gt;Both test directions are still in progress.&lt;/p&gt;';&#10;        }&#10;    }&#10;    &#10;    document.getElementById('diagnosticRecommendations').innerHTML = recommendations;&#10;}&#10;&#10;function retryIncompleteDirection() {&#10;    let retryDirection = null;&#10;    &#10;    if (isTestComplete[0] &amp;&amp; !isTestComplete[1]) {&#10;        retryDirection = 1;&#10;    } else if (!isTestComplete[0] &amp;&amp; isTestComplete[1]) {&#10;        retryDirection = 0;&#10;    } else if (!isTestComplete[0] &amp;&amp; !isTestComplete[1]) {&#10;        retryDirection = (NumberOfReversals[0] &lt; NumberOfReversals[1]) ? 0 : 1;&#10;    } else {&#10;        alert(&quot;Both directions are already complete.&quot;);&#10;        return;&#10;    }&#10;    &#10;    resetDirection(retryDirection);&#10;    forceDirection = retryDirection;&#10;    closeDiagnostics();&#10;    &#10;    if (document.getElementById('start').disabled) {&#10;        document.getElementById('text1').value = &quot;Retrying &quot; + (retryDirection === 0 ? &quot;higher&quot; : &quot;lower&quot;) + &quot; direction...&quot;;&#10;        beginIteration();&#10;    } else {&#10;        start_onclick();&#10;    }&#10;}&#10;&#10;function resetDirection(dirIndex) {&#10;    NumberOfReversals[dirIndex] = 0;&#10;    CorrectResponses[dirIndex] = 0;&#10;    Direction[dirIndex] = DECREASING;&#10;    currentLevel[dirIndex] = 5;&#10;    isTestComplete[dirIndex] = false;&#10;    Reversals[dirIndex] = [];&#10;    trialsPerDirection[dirIndex] = 0;&#10;    &#10;    trialRecords = trialRecords.filter(record =&gt; &#10;        record.direction !== (dirIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;)&#10;    );&#10;    &#10;    logDebug((dirIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction reset&quot;);&#10;    updateProgressBar();&#10;}&#10;&#10;function testAudio() {&#10;    logDebug(&quot;Starting to test all audio files...&quot;);&#10;    var audios = document.querySelectorAll('audio');&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    var index = 0;&#10;    function playNext() {&#10;        if (index &gt;= audios.length) {&#10;            logDebug(&quot;All audio testing complete!&quot;);&#10;            return;&#10;        }&#10;        &#10;        var audio = audios[index];&#10;        logDebug(&quot;Testing audio #&quot; + (index + 1) + &quot;: &quot; + audio.id);&#10;        &#10;        audio.currentTime = 0;&#10;        &#10;        var playPromise = audio.play();&#10;        if (playPromise !== undefined) {&#10;            playPromise.then(function() {&#10;                logDebug(audio.id + &quot; played successfully&quot;);&#10;                &#10;                audio.onended = function() {&#10;                    logDebug(audio.id + &quot; playback ended&quot;);&#10;                    index++;&#10;                    setTimeout(playNext, 500);&#10;                };&#10;            }).catch(function(error) {&#10;                logDebug(&quot;Failed to play &quot; + audio.id + &quot;: &quot; + error);&#10;                index++;&#10;                setTimeout(playNext, 500);&#10;            });&#10;        }&#10;    }&#10;    &#10;    playNext();&#10;}&#10;&#10;function unlockAudioContext() {&#10;    logDebug(&quot;Attempting to unlock audio context...&quot;);&#10;    &#10;    var silentAudio = new Audio();&#10;    silentAudio.src = &quot;data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA&quot;;&#10;    &#10;    var promise = silentAudio.play();&#10;    if (promise !== undefined) {&#10;        promise.then(function() {&#10;            logDebug(&quot;Audio context unlocked successfully&quot;);&#10;            silentAudio.remove();&#10;            audioUnlocked = true;&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to unlock audio context: &quot; + error);&#10;        });&#10;    }&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    for (var i = 0; i &lt; allAudios.length; i++) {&#10;        var audio = allAudios[i];&#10;        audio.load();&#10;    }&#10;    &#10;    logDebug(&quot;Preloaded &quot; + allAudios.length + &quot; audio files&quot;);&#10;}&#10;&#10;function resetPage() {&#10;    numberOfIterations++;&#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('firstBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('secondBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    if (isTestComplete[0] &amp;&amp; isTestComplete[1]) {&#10;        document.getElementById('start').disabled = false;&#10;        document.getElementById('viewResult').disabled = false;&#10;        document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;        updateProgressBar(100);&#10;        return;&#10;    }&#10;    &#10;    if ((trialsPerDirection[currentStimDirection] &gt;= MAXITERATIONS/2) || &#10;        (NumberOfReversals[currentStimDirection] &gt;= MAXREVERSALS)) {&#10;        &#10;        if (NumberOfReversals[currentStimDirection] &gt;= MINIMUMREVERSALS) {&#10;            calculateResults(currentStimDirection);&#10;            isTestComplete[currentStimDirection] = true;&#10;        } else {&#10;            logDebug(&#10;                (currentStimDirection === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &#10;                &quot; direction reached max iterations but has only &quot; + &#10;                NumberOfReversals[currentStimDirection] + &quot;/&quot; + MINIMUMREVERSALS + &#10;                &quot; reversals. Showing diagnostics.&quot;&#10;            );&#10;            &#10;            document.getElementById('text1').value = &#10;                (currentStimDirection === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &#10;                &quot; direction has insufficient data. Check diagnostics.&quot;;&#10;            &#10;            setTimeout(function() {&#10;                showDiagnostics();&#10;            }, 500);&#10;            return;&#10;        }&#10;        &#10;        updateProgressBar();&#10;        &#10;        if (!isTestComplete[0] || !isTestComplete[1]) {&#10;            document.getElementById('text1').value = &quot;實驗繼續中...&quot;;&#10;            setTimeout(function() {&#10;                beginIteration();&#10;            }, 2000);&#10;        } else {&#10;            document.getElementById('start').disabled = false;&#10;            document.getElementById('viewResult').disabled = false;&#10;            document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;            updateProgressBar(100);&#10;        }&#10;    } else {&#10;        updateProgressBar();&#10;        beginIteration();&#10;    }&#10;}&#10;&#10;function updateProgressBar(forcePercent) {&#10;    if (typeof forcePercent === 'number') {&#10;        document.getElementById('progressBar').style.width = forcePercent + '%';&#10;        document.getElementById('progressLabel').textContent = 'Progress: ' + forcePercent + '%';&#10;        return;&#10;    }&#10;    &#10;    const higherDirMax = Math.max(MAXREVERSALS, MAXITERATIONS/2);&#10;    const higherDirValue = isTestComplete[0] ? higherDirMax : Math.max(NumberOfReversals[0], trialsPerDirection[0]);&#10;    const higherDirPercent = Math.min(50 * (higherDirValue / higherDirMax), 50);&#10;    &#10;    const lowerDirMax = Math.max(MAXREVERSALS, MAXITERATIONS/2);&#10;    const lowerDirValue = isTestComplete[1] ? lowerDirMax : Math.max(NumberOfReversals[1], trialsPerDirection[1]);&#10;    const lowerDirPercent = Math.min(50 * (lowerDirValue / lowerDirMax), 50);&#10;    &#10;    const totalPercent = higherDirPercent + lowerDirPercent;&#10;    &#10;    document.getElementById('progressBar').style.width = totalPercent + '%';&#10;    document.getElementById('progressLabel').textContent = 'Progress: ' + Math.round(totalPercent) + '%';&#10;}&#10;&#10;function calculateResults(directionIndex) {&#10;    let sum = 0.0, stddevsum = 0.0, average = 0.0, stdev = 0.0, counter = 0;&#10;    &#10;    const semitoneMap = {&#10;        1: 2.0,&#10;        2: 1.0,&#10;        3: 1/2,&#10;        4: 1/6,&#10;        5: 1/8,&#10;        6: 1/12,&#10;        7: 1/15,&#10;        8: 1/20,&#10;        9: 1/50&#10;    };&#10;    &#10;    for (let i = 0; i &lt; Reversals[directionIndex].length; i++) {&#10;        if (Reversals[directionIndex][i] &gt; 0) counter++;&#10;    }&#10;    &#10;    if (counter &lt; MINIMUMREVERSALS) {&#10;        logDebug((directionIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction test has insufficient data&quot;);&#10;        alert((directionIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction test has insufficient data. Please complete the test again.&quot;);&#10;        return;&#10;    }&#10;    &#10;    const startIndex = Math.max(0, NumberOfReversals[directionIndex] - THRESHOLD_REVERSAL_COUNT);&#10;    counter = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals[directionIndex].length; i++) {&#10;        const level = Reversals[directionIndex][i];&#10;        if (level &gt; 0) {&#10;            const semitones = semitoneMap[level];&#10;            if (semitones !== undefined) {&#10;                sum += semitones;&#10;                counter++;&#10;            }&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 0) {&#10;        average = sum / counter;&#10;        average = parseFloat(average.toFixed(4));&#10;    }&#10;    &#10;    for (let i = startIndex; i &lt; Reversals[directionIndex].length; i++) {&#10;        const level = Reversals[directionIndex][i];&#10;        if (level &gt; 0) {&#10;            const semitones = semitoneMap[level];&#10;            if (semitones !== undefined) {&#10;                stddevsum += Math.pow(semitones - average, 2);&#10;            }&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 1) {&#10;        stdev = Math.sqrt(stddevsum / (counter - 1));&#10;        stdev = parseFloat(stdev.toFixed(4));&#10;    }&#10;    &#10;    sentAverage[directionIndex] = average;&#10;    sentStdev[directionIndex] = stdev;&#10;    &#10;    logDebug((directionIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction test complete! Threshold: &quot; + average.toFixed(4) + &quot; semitones&quot;);&#10;    document.getElementById('text1').value = &#10;        (directionIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction test complete! Threshold: &quot; + average.toFixed(4) + &quot; semitones&quot;;&#10;}&#10;&#10;function beginIteration() {&#10;    isReplayTrial = false;&#10;    &#10;    if (forceDirection !== null) {&#10;        currentStimDirection = forceDirection;&#10;        &#10;        if (trialsPerDirection[forceDirection] % 5 === 0) {&#10;            logDebug(&quot;Releasing forced direction after 5 trials&quot;);&#10;            forceDirection = null;&#10;        }&#10;    } &#10;    else if (isTestComplete[0]) {&#10;        currentStimDirection = 1;&#10;    } &#10;    else if (isTestComplete[1]) {&#10;        currentStimDirection = 0;&#10;    }&#10;    else if (Math.abs(trialsPerDirection[0] - trialsPerDirection[1]) &gt; FORCEBALANCETHRESHOLD) {&#10;        currentStimDirection = (trialsPerDirection[0] &gt; trialsPerDirection[1]) ? 1 : 0;&#10;        logDebug(&quot;Forcing balance: selecting &quot; + (currentStimDirection === 0 ? &quot;higher&quot; : &quot;lower&quot;) + &quot; direction&quot;);&#10;    }&#10;    else {&#10;        currentStimDirection = Math.random() &lt; 0.5 ? 0 : 1;&#10;    }&#10;    &#10;    directionHistory.push(currentStimDirection);&#10;    &#10;    standardIsFirst = Math.random() &lt; 0.5;&#10;    var xIsStandard = Math.random() &lt; 0.5;&#10;    &#10;    if (xIsStandard) {&#10;        CorrectAnswer = standardIsFirst ? 1 : 2;&#10;    } else {&#10;        CorrectAnswer = standardIsFirst ? 2 : 1;&#10;    }&#10;    &#10;    trialsPerDirection[currentStimDirection]++;&#10;    &#10;    logDebug(&quot;Starting new iteration #&quot; + numberOfIterations + &#10;             &quot;, Direction: &quot; + (currentStimDirection === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &#10;             &quot;, Standard is &quot; + (standardIsFirst ? &quot;first&quot; : &quot;second&quot;) +&#10;             &quot;, X is &quot; + (xIsStandard ? &quot;standard&quot; : &quot;comparison&quot;) +&#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Difficulty level: &quot; + currentLevel[currentStimDirection]);&#10;    &#10;    setTimeout(function() {&#10;        playABXSequence(xIsStandard);&#10;    }, 1000);&#10;}&#10;&#10;function clearButtonAnimations() {&#10;    document.getElementById('firstBtn').classList.remove('button-playing');&#10;    document.getElementById('secondBtn').classList.remove('button-playing');&#10;}&#10;&#10;function playABXSequence(xIsStandard) {&#10;    logDebug(&quot;Playing ABX sequence&quot;);&#10;    &#10;    clearButtonAnimations();&#10;    &#10;    standardSound = document.getElementById('high_level_standard');&#10;    &#10;    const level = currentLevel[currentStimDirection];&#10;    if (currentStimDirection === 0) {&#10;        comparisonSound = document.getElementById(&quot;high_level_&quot; + level + &quot;_h&quot;);&#10;    } else {&#10;        comparisonSound = document.getElementById(&quot;high_level_&quot; + level + &quot;_l&quot;);&#10;    }&#10;    &#10;    xSound = xIsStandard ? standardSound : comparisonSound;&#10;    &#10;    if (!standardSound || !comparisonSound) {&#10;        logDebug(&quot;Error: Cannot find audio elements!&quot;);&#10;        document.getElementById('text1').value = &quot;出錯：找不到音頻文件&quot;;&#10;        setTimeout(function() {&#10;            showDiagnostics();&#10;        }, 1000);&#10;        return;&#10;    }&#10;    &#10;    var firstSound = standardIsFirst ? standardSound : comparisonSound;&#10;    document.getElementById('text1').value = &quot;播放第一個音&quot;;&#10;    &#10;    document.getElementById('firstBtn').classList.add('button-playing');&#10;    &#10;    firstSound.currentTime = 0;&#10;    var playPromise1 = firstSound.play();&#10;    &#10;    if (playPromise1 !== undefined) {&#10;        playPromise1.then(function() {&#10;            logDebug(&quot;First sound (A) played successfully&quot;);&#10;            &#10;            firstSound.onended = function() {&#10;                logDebug(&quot;First sound ended&quot;);&#10;                &#10;                document.getElementById('firstBtn').classList.remove('button-playing');&#10;                &#10;                setTimeout(function() {&#10;                    var secondSound = standardIsFirst ? comparisonSound : standardSound;&#10;                    document.getElementById('text1').value = &quot;播放第二個音&quot;;&#10;                    &#10;                    document.getElementById('secondBtn').classList.add('button-playing');&#10;                    &#10;                    secondSound.currentTime = 0;&#10;                    var playPromise2 = secondSound.play();&#10;                    &#10;                    if (playPromise2 !== undefined) {&#10;                        playPromise2.then(function() {&#10;                            logDebug(&quot;Second sound (B) played successfully&quot;);&#10;                            &#10;                            secondSound.onended = function() {&#10;                                logDebug(&quot;Second sound ended&quot;);&#10;                                &#10;                                document.getElementById('secondBtn').classList.remove('button-playing');&#10;                                &#10;                                setTimeout(function() {&#10;                                    document.getElementById('text1').value = &quot;播放第三個音&quot;;&#10;                                    &#10;                                    xSound.currentTime = 0;&#10;                                    var playPromise3 = xSound.play();&#10;                                    &#10;                                    if (playPromise3 !== undefined) {&#10;                                        playPromise3.then(function() {&#10;                                            logDebug(&quot;Third sound (X) played successfully&quot;);&#10;                                            &#10;                                            xSound.onended = function() {&#10;                                                logDebug(&quot;Third sound ended, enabling response buttons&quot;);&#10;                                                &#10;                                                stimulusEndTime = performance.now();&#10;                                                &#10;                                                document.getElementById('text1').value = &quot;請作出選擇&quot;;&#10;                                                document.getElementById('promptText').style.visibility = 'visible';&#10;                                                &#10;                                                document.getElementById('firstBtn').disabled = false;&#10;                                                document.getElementById('secondBtn').disabled = false;&#10;                                                document.getElementById('firstBtn').style.background = &quot;#66CCFF&quot;;&#10;                                                document.getElementById('secondBtn').style.background = &quot;#66CCFF&quot;;&#10;                                            };&#10;                                        }).catch(function(error) {&#10;                                            logDebug(&quot;Failed to play third sound: &quot; + error);&#10;                                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                                            clearButtonAnimations();&#10;                                            setTimeout(showDiagnostics, 1000);&#10;                                        });&#10;                                    }&#10;                                }, 1000);&#10;                            };&#10;                        }).catch(function(error) {&#10;                            logDebug(&quot;Failed to play second sound: &quot; + error);&#10;                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                            clearButtonAnimations();&#10;                            setTimeout(showDiagnostics, 1000);&#10;                        });&#10;                    }&#10;                }, 1000);&#10;            };&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to play first sound: &quot; + error);&#10;            document.getElementById('text1').value = &quot;音頻播放錯誤，請刷新頁面&quot;;&#10;            clearButtonAnimations();&#10;            setTimeout(showDiagnostics, 1000);&#10;        });&#10;    }&#10;}&#10;&#10;function start_onclick() {&#10;    logDebug(&quot;Starting experiment&quot;);&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    checkAudioFiles();&#10;    if (!allFilesPresent) {&#10;        logDebug(&quot;Cannot start experiment: Some audio files are missing&quot;);&#10;        document.getElementById('text1').value = &quot;音頻缺失&quot;;&#10;        showDiagnostics();&#10;        return;&#10;    }&#10;    &#10;    window_onload();&#10;    document.getElementById('text1').value = &quot;開始實驗...&quot;;&#10;    updateProgressBar(0);&#10;    &#10;    setTimeout(function() {&#10;        beginIteration();&#10;        document.getElementById('start').disabled = true;&#10;        document.getElementById('viewResult').disabled = true;&#10;        document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;        document.getElementById('promptText').style.visibility = 'hidden';&#10;    }, 1000);&#10;}&#10;&#10;function gotReversal(dirIndex) {&#10;    NumberOfReversals[dirIndex]++;&#10;    Reversals[dirIndex][NumberOfReversals[dirIndex] - 1] = currentLevel[dirIndex];&#10;    Direction[dirIndex] = -Direction[dirIndex];&#10;    logDebug(&quot;Recorded reversal #&quot; + NumberOfReversals[dirIndex] + &quot; at difficulty &quot; + currentLevel[dirIndex]);&#10;}&#10;&#10;function mapLevelToSemitone(level) {&#10;    const semitoneMap = {&#10;        1: 2.0,&#10;        2: 1.0,&#10;        3: 1/2,&#10;        4: 1/6,&#10;        5: 1/8,&#10;        6: 1/12,&#10;        7: 1/15,&#10;        8: 1/20,&#10;        9: 1/50&#10;    };&#10;    return semitoneMap[level] || 0;&#10;}&#10;&#10;function processAnswer(Response) {&#10;    const reactionEndTime = performance.now();&#10;    const reactionTime = reactionEndTime - stimulusEndTime;&#10;    &#10;    logDebug(&quot;User answered: &quot; + (Response === 1 ? &quot;First&quot; : &quot;Second&quot;) + &#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Is replay: &quot; + isReplayTrial);&#10;    &#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    const isCorrect = (Response === CorrectAnswer);&#10;    &#10;    if (!isReplayTrial) {&#10;        const trialInfo = {&#10;            trialNumber: numberOfIterations,&#10;            timestamp: getLocalTimestamp(),&#10;            direction: currentStimDirection === 0 ? &quot;Higher&quot; : &quot;Lower&quot;,&#10;            difficultyLevel: currentLevel[currentStimDirection],&#10;            semitoneValue: mapLevelToSemitone(currentLevel[currentStimDirection]),&#10;            userResponse: Response === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            correctResponse: CorrectAnswer === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            isCorrect: isCorrect,&#10;            reactionTime: reactionTime.toFixed(0),&#10;            isReversal: false,&#10;            stepDirection: Direction[currentStimDirection] === DECREASING ? &quot;Increasing Difficulty&quot; : &quot;Decreasing Difficulty&quot;,&#10;            standardPosition: standardIsFirst ? &quot;First&quot; : &quot;Second&quot;&#10;        };&#10;        &#10;        trialRecords.push(trialInfo);&#10;    }&#10;    &#10;    if (isCorrect) {&#10;        logDebug(&quot;Correct answer&quot;);&#10;        document.getElementById('smile').src = &quot;Media/smiley.png&quot;;&#10;        document.getElementById('text1').value = &quot;正確！&quot;;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses[currentStimDirection]++;&#10;            &#10;            if (CorrectResponses[currentStimDirection] == 2) {&#10;                logDebug(&quot;Two correct answers in a row&quot;);&#10;                CorrectResponses[currentStimDirection] = 0;&#10;                &#10;                if (Direction[currentStimDirection] == INCREASING) {&#10;                    gotReversal(currentStimDirection);&#10;                    if (trialRecords.length &gt; 0) {&#10;                        trialRecords[trialRecords.length-1].isReversal = true;&#10;                    }&#10;                }&#10;                &#10;                changeLevel(DECREASING, currentStimDirection);&#10;            }&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            resetPage();&#10;        }, 1500);&#10;    } else {&#10;        logDebug(&quot;Incorrect answer - will replay stimulus&quot;);&#10;        document.getElementById('smile').src = &quot;Media/nosmiley.png&quot;;&#10;        &#10;        var correctAnswerText = CorrectAnswer === 1 ? &quot;第一個音&quot; : &quot;第二個音&quot;;&#10;        document.getElementById('text1').value = &quot;錯誤！正確答案是：&quot; + correctAnswerText;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses[currentStimDirection] = 0;&#10;            &#10;            if (Direction[currentStimDirection] == DECREASING) {&#10;                gotReversal(currentStimDirection);&#10;                if (trialRecords.length &gt; 0) {&#10;                    trialRecords[trialRecords.length-1].isReversal = true;&#10;                }&#10;            }&#10;            &#10;            changeLevel(INCREASING, currentStimDirection);&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            document.getElementById('text1').value = &quot;重播刺激音...&quot;;&#10;            &#10;            setTimeout(function() {&#10;                isReplayTrial = true;&#10;                &#10;                var xIsStandard = (standardIsFirst &amp;&amp; CorrectAnswer === 1) || &#10;                                  (!standardIsFirst &amp;&amp; CorrectAnswer === 2);&#10;                playABXSequence(xIsStandard);&#10;            }, 1000);&#10;        }, 2000);&#10;    }&#10;}&#10;&#10;function changeLevel(whichWay, dirIndex) {&#10;    var oldLevel = currentLevel[dirIndex];&#10;    var stepSize = NumberOfReversals[dirIndex] &lt; 4 ? 2 : 1;&#10;    &#10;    if (whichWay == DECREASING) {&#10;        currentLevel[dirIndex] = Math.min(9, currentLevel[dirIndex] + stepSize);&#10;    } else {&#10;        currentLevel[dirIndex] = Math.max(LOWERLIMIT, currentLevel[dirIndex] - stepSize);&#10;    }&#10;    &#10;    logDebug(&quot;Difficulty changed from &quot; + oldLevel + &quot; to &quot; + currentLevel[dirIndex] + &#10;             (whichWay == DECREASING ? &quot; (increasing difficulty)&quot; : &quot; (decreasing difficulty)&quot;));&#10;}&#10;&#10;function getThresholdAssessment(value) {&#10;    if (value &lt;= 0.05) return &quot;Exceptional&quot;;&#10;    if (value &lt;= 0.1) return &quot;Excellent&quot;;&#10;    if (value &lt;= 0.25) return &quot;Good&quot;;&#10;    if (value &lt;= 0.5) return &quot;Average&quot;;&#10;    if (value &lt;= 1.0) return &quot;Below Average&quot;;&#10;    return &quot;Needs Improvement&quot;;&#10;}&#10;&#10;function calculateReactionTimeStats() {&#10;    let higherRTs = trialRecords.filter(t =&gt; t.direction === &quot;Higher&quot;).map(t =&gt; parseFloat(t.reactionTime));&#10;    let lowerRTs = trialRecords.filter(t =&gt; t.direction === &quot;Lower&quot;).map(t =&gt; parseFloat(t.reactionTime));&#10;    let allRTs = higherRTs.concat(lowerRTs);&#10;    &#10;    return {&#10;        higher: {&#10;            mean: higherRTs.length ? (higherRTs.reduce((a, b) =&gt; a + b, 0) / higherRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;            median: higherRTs.length ? calculateMedian(higherRTs).toFixed(0) : &quot;N/A&quot;,&#10;            sd: higherRTs.length &gt; 1 ? calculateSD(higherRTs).toFixed(0) : &quot;N/A&quot;&#10;        },&#10;        lower: {&#10;            mean: lowerRTs.length ? (lowerRTs.reduce((a, b) =&gt; a + b, 0) / lowerRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;            median: lowerRTs.length ? calculateMedian(lowerRTs).toFixed(0) : &quot;N/A&quot;,&#10;            sd: lowerRTs.length &gt; 1 ? calculateSD(lowerRTs).toFixed(0) : &quot;N/A&quot;&#10;        },&#10;        overall: {&#10;            mean: allRTs.length ? (allRTs.reduce((a, b) =&gt; a + b, 0) / allRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;            median: allRTs.length ? calculateMedian(allRTs).toFixed(0) : &quot;N/A&quot;,&#10;            sd: allRTs.length &gt; 1 ? calculateSD(allRTs).toFixed(0) : &quot;N/A&quot;&#10;        }&#10;    };&#10;}&#10;&#10;function calculateAccuracyStats() {&#10;    let higherTrials = trialRecords.filter(t =&gt; t.direction === &quot;Higher&quot;);&#10;    let lowerTrials = trialRecords.filter(t =&gt; t.direction === &quot;Lower&quot;);&#10;    let allTrials = trialRecords;&#10;    &#10;    return {&#10;        higher: {&#10;            correct: higherTrials.filter(t =&gt; t.isCorrect).length,&#10;            total: higherTrials.length,&#10;            percentage: higherTrials.length ? &#10;                (higherTrials.filter(t =&gt; t.isCorrect).length / higherTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;        },&#10;        lower: {&#10;            correct: lowerTrials.filter(t =&gt; t.isCorrect).length,&#10;            total: lowerTrials.length,&#10;            percentage: lowerTrials.length ? &#10;                (lowerTrials.filter(t =&gt; t.isCorrect).length / lowerTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;        },&#10;        overall: {&#10;            correct: allTrials.filter(t =&gt; t.isCorrect).length,&#10;            total: allTrials.length,&#10;            percentage: allTrials.length ? &#10;                (allTrials.filter(t =&gt; t.isCorrect).length / allTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;        }&#10;    };&#10;}&#10;&#10;function calculateMedian(values) {&#10;    if (!values.length) return 0;&#10;    &#10;    const sortedValues = values.slice().sort((a, b) =&gt; a - b);&#10;    const mid = Math.floor(sortedValues.length / 2);&#10;    &#10;    return sortedValues.length % 2 === 0 ? &#10;        (sortedValues[mid - 1] + sortedValues[mid]) / 2 : &#10;        sortedValues[mid];&#10;}&#10;&#10;function calculateSD(values) {&#10;    if (values.length &lt;= 1) return 0;&#10;    &#10;    const mean = values.reduce((a, b) =&gt; a + b, 0) / values.length;&#10;    const variance = values.map(x =&gt; Math.pow(x - mean, 2)).reduce((a, b) =&gt; a + b, 0) / (values.length - 1);&#10;    &#10;    return Math.sqrt(variance);&#10;}&#10;&#10;function displayResults() {&#10;    logDebug(&quot;Displaying results&quot;);&#10;    &#10;    let hasHigherData = NumberOfReversals[0] &gt;= MINIMUMREVERSALS;&#10;    let hasLowerData = NumberOfReversals[1] &gt;= MINIMUMREVERSALS;&#10;    &#10;    if (!hasHigherData || !hasLowerData) {&#10;        let message = &quot;Warning: &quot;;&#10;        if (!hasHigherData) message += &quot;Higher direction has insufficient data. &quot;;&#10;        if (!hasLowerData) message += &quot;Lower direction has insufficient data. &quot;;&#10;        message += &quot;Results may not be reliable.&quot;;&#10;        &#10;        if (confirm(message + &quot;\n\nWould you like to retry the experiment?&quot;)) {&#10;            window_onload();&#10;            return;&#10;        }&#10;    }&#10;    &#10;    document.getElementById('experimentContainer').style.display = 'none';&#10;    document.getElementById('resultsContainer').style.display = 'block';&#10;    &#10;    var tableBody = document.getElementById('resultTableBody');&#10;    tableBody.innerHTML = '';&#10;    &#10;    var higherRow = document.createElement('tr');&#10;    higherRow.innerHTML = &#10;        '&lt;td&gt;Higher Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasHigherData ? sentAverage[0].toFixed(4) : 'Insufficient data') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasHigherData ? sentStdev[0].toFixed(4) : '-') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasHigherData ? getThresholdAssessment(sentAverage[0]) : '-') + '&lt;/td&gt;';&#10;    tableBody.appendChild(higherRow);&#10;    &#10;    var lowerRow = document.createElement('tr');&#10;    lowerRow.innerHTML = &#10;        '&lt;td&gt;Lower Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasLowerData ? sentAverage[1].toFixed(4) : 'Insufficient data') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasLowerData ? sentStdev[1].toFixed(4) : '-') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasLowerData ? getThresholdAssessment(sentAverage[1]) : '-') + '&lt;/td&gt;';&#10;    tableBody.appendChild(lowerRow);&#10;    &#10;    if (hasHigherData &amp;&amp; hasLowerData) {&#10;        var avgThreshold = (sentAverage[0] + sentAverage[1]) / 2;&#10;        var combinedVariance = (Math.pow(sentStdev[0], 2) + Math.pow(sentStdev[1], 2)) / 2;&#10;        var combinedSD = Math.sqrt(combinedVariance).toFixed(4);&#10;        &#10;        var avgRow = document.createElement('tr');&#10;        avgRow.style.fontWeight = 'bold';&#10;        avgRow.innerHTML = &#10;            '&lt;td&gt;Average&lt;/td&gt;' +&#10;            '&lt;td&gt;' + avgThreshold.toFixed(4) + '&lt;/td&gt;' +&#10;            '&lt;td&gt;' + combinedSD + '&lt;/td&gt;' +&#10;            '&lt;td&gt;' + getThresholdAssessment(avgThreshold) + '&lt;/td&gt;';&#10;        tableBody.appendChild(avgRow);&#10;    }&#10;    &#10;    var interpretation = document.getElementById('resultInterpretation');&#10;    let interpretationHtml = '&lt;p&gt;&lt;strong&gt;Threshold Interpretation (ABX Task):&lt;/strong&gt;&lt;/p&gt;';&#10;    &#10;    if (hasHigherData &amp;&amp; hasLowerData) {&#10;        const avgThreshold = (sentAverage[0] + sentAverage[1]) / 2;&#10;        interpretationHtml += '&lt;p&gt;Your average pitch discrimination threshold is ' + avgThreshold.toFixed(4) + ' semitones, indicating ' + &#10;            getThresholdAssessment(avgThreshold) + ' pitch discrimination ability.&lt;/p&gt;';&#10;    } else {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Complete results not available due to insufficient data.&lt;/p&gt;';&#10;        &#10;        if (hasHigherData) {&#10;            interpretationHtml += '&lt;p&gt;Your higher direction threshold is ' + sentAverage[0].toFixed(4) + &#10;                ' semitones, indicating ' + getThresholdAssessment(sentAverage[0]) + ' discrimination ability for higher pitches.&lt;/p&gt;';&#10;        }&#10;        &#10;        if (hasLowerData) {&#10;            interpretationHtml += '&lt;p&gt;Your lower direction threshold is ' + sentAverage[1].toFixed(4) + &#10;                ' semitones, indicating ' + getThresholdAssessment(sentAverage[1]) + ' discrimination ability for lower pitches.&lt;/p&gt;';&#10;        }&#10;    }&#10;    &#10;    interpretationHtml += '&lt;p&gt;&lt;strong&gt;Performance Metrics:&lt;/strong&gt;&lt;/p&gt;';&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    const accuracyStats = calculateAccuracyStats();&#10;    &#10;    interpretationHtml += '&lt;p&gt;Your average reaction time was ' + rtStats.overall.mean + &#10;        ' ms, with ' + accuracyStats.overall.percentage + '% overall accuracy.&lt;/p&gt;';&#10;    &#10;    interpretation.innerHTML = interpretationHtml;&#10;    &#10;    var rtTableBody = document.getElementById('rtStatsTableBody');&#10;    rtTableBody.innerHTML = '';&#10;    &#10;    var higherRtRow = document.createElement('tr');&#10;    higherRtRow.innerHTML = &#10;        '&lt;td&gt;Higher Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.higher.mean + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.higher.median + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.higher.sd + '&lt;/td&gt;';&#10;    rtTableBody.appendChild(higherRtRow);&#10;    &#10;    var lowerRtRow = document.createElement('tr');&#10;    lowerRtRow.innerHTML = &#10;        '&lt;td&gt;Lower Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.lower.mean + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.lower.median + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.lower.sd + '&lt;/td&gt;';&#10;    rtTableBody.appendChild(lowerRtRow);&#10;    &#10;    var overallRtRow = document.createElement('tr');&#10;    overallRtRow.style.fontWeight = 'bold';&#10;    overallRtRow.innerHTML = &#10;        '&lt;td&gt;Overall&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.overall.mean + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.overall.median + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.overall.sd + '&lt;/td&gt;';&#10;    rtTableBody.appendChild(overallRtRow);&#10;    &#10;    var accuracyTableBody = document.getElementById('accuracyStatsTableBody');&#10;    accuracyTableBody.innerHTML = '';&#10;    &#10;    var higherAccRow = document.createElement('tr');&#10;    higherAccRow.innerHTML = &#10;        '&lt;td&gt;Higher Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.higher.correct + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.higher.total + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.higher.percentage + '%&lt;/td&gt;';&#10;    accuracyTableBody.appendChild(higherAccRow);&#10;    &#10;    var lowerAccRow = document.createElement('tr');&#10;    lowerAccRow.innerHTML = &#10;        '&lt;td&gt;Lower Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.lower.correct + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.lower.total + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.lower.percentage + '%&lt;/td&gt;';&#10;    accuracyTableBody.appendChild(lowerAccRow);&#10;    &#10;    var overallAccRow = document.createElement('tr');&#10;    overallAccRow.style.fontWeight = 'bold';&#10;    overallAccRow.innerHTML = &#10;        '&lt;td&gt;Overall&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.overall.correct + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.overall.total + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.overall.percentage + '%&lt;/td&gt;';&#10;    accuracyTableBody.appendChild(overallAccRow);&#10;    &#10;    drawResultChart(hasHigherData, hasLowerData);&#10;}&#10;&#10;function drawResultChart(hasHigherData, hasLowerData) {&#10;    var chartContainer = document.getElementById('resultChart');&#10;    &#10;    var chartHTML = '&lt;div style=&quot;display: flex; flex-direction: column; height: 100%;&quot;&gt;';&#10;    chartHTML += '&lt;div style=&quot;text-align: center; margin-bottom: 10px;&quot;&gt;&lt;strong&gt;Threshold Comparison&lt;/strong&gt;&lt;/div&gt;';&#10;    &#10;    chartHTML += '&lt;div style=&quot;display: flex; justify-content: center; margin-bottom: 10px;&quot;&gt;';&#10;    chartHTML += '&lt;span style=&quot;margin-right: 20px;&quot;&gt;&lt;span style=&quot;display: inline-block; width: 15px; height: 15px; background-color: #3498db; margin-right: 5px;&quot;&gt;&lt;/span&gt;Higher Direction&lt;/span&gt;';&#10;    chartHTML += '&lt;span&gt;&lt;span style=&quot;display: inline-block; width: 15px; height: 15px; background-color: #e74c3c; margin-right: 5px;&quot;&gt;&lt;/span&gt;Lower Direction&lt;/span&gt;';&#10;    chartHTML += '&lt;/div&gt;';&#10;    &#10;    chartHTML += '&lt;div style=&quot;flex: 1; display: flex; align-items: flex-end; border-left: 1px solid #333; border-bottom: 1px solid #333; position: relative;&quot;&gt;';&#10;    &#10;    let maxValue = 0.5;&#10;    if (hasHigherData) maxValue = Math.max(maxValue, sentAverage[0]);&#10;    if (hasLowerData) maxValue = Math.max(maxValue, sentAverage[1]);&#10;    &#10;    if (hasHigherData) {&#10;        var higherHeight = (sentAverage[0] / maxValue) * 80;&#10;        chartHTML += '&lt;div style=&quot;width: 40px; height: ' + higherHeight + '%; background-color: #3498db; margin: 0 20px; position: relative;&quot;&gt;';&#10;        chartHTML += '&lt;div style=&quot;position: absolute; top: -20px; width: 100%; text-align: center;&quot;&gt;' + sentAverage[0].toFixed(4) + '&lt;/div&gt;';&#10;        chartHTML += '&lt;/div&gt;';&#10;    } else {&#10;        chartHTML += '&lt;div style=&quot;width: 40px; height: 5%; background-color: #ccc; margin: 0 20px; position: relative;&quot;&gt;';&#10;        chartHTML += '&lt;div style=&quot;position: absolute; top: -20px; width: 100%; text-align: center;&quot;&gt;N/A&lt;/div&gt;';&#10;        chartHTML += '&lt;/div&gt;';&#10;    }&#10;    &#10;    if (hasLowerData) {&#10;        var lowerHeight = (sentAverage[1] / maxValue) * 80;&#10;        chartHTML += '&lt;div style=&quot;width: 40px; height: ' + lowerHeight + '%; background-color: #e74c3c; margin: 0 20px; position: relative;&quot;&gt;';&#10;        chartHTML += '&lt;div style=&quot;position: absolute; top: -20px; width: 100%; text-align: center;&quot;&gt;' + sentAverage[1].toFixed(4) + '&lt;/div&gt;';&#10;        chartHTML += '&lt;/div&gt;';&#10;    } else {&#10;        chartHTML += '&lt;div style=&quot;width: 40px; height: 5%; background-color: #ccc; margin: 0 20px; position: relative;&quot;&gt;';&#10;        chartHTML += '&lt;div style=&quot;position: absolute; top: -20px; width: 100%; text-align: center;&quot;&gt;N/A&lt;/div&gt;';&#10;        chartHTML += '&lt;/div&gt;';&#10;    }&#10;    &#10;    chartHTML += '&lt;div style=&quot;position: absolute; bottom: -25px; left: 20px; width: 40px; text-align: center;&quot;&gt;Higher&lt;/div&gt;';&#10;    chartHTML += '&lt;div style=&quot;position: absolute; bottom: -25px; left: 80px; width: 40px; text-align: center;&quot;&gt;Lower&lt;/div&gt;';&#10;    chartHTML += '&lt;div style=&quot;position: absolute; left: -35px; top: 20%; transform: rotate(-90deg);&quot;&gt;Threshold (semitones)&lt;/div&gt;';&#10;    &#10;    chartHTML += '&lt;/div&gt;';&#10;    chartHTML += '&lt;/div&gt;';&#10;    &#10;    chartContainer.innerHTML = chartHTML;&#10;}&#10;&#10;function backToExperiment() {&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;}&#10;&#10;function view_onclick() {&#10;    logDebug(&quot;View results button clicked&quot;);&#10;    &#10;    for (let i = 0; i &lt; 2; i++) {&#10;        if (!isTestComplete[i] &amp;&amp; NumberOfReversals[i] &gt;= MINIMUMREVERSALS) {&#10;            calculateResults(i);&#10;            isTestComplete[i] = true;&#10;        }&#10;    }&#10;    &#10;    displayResults();&#10;}&#10;&#10;function exportToCSV() {&#10;    const headers = [&#10;        &quot;Trial Number&quot;, &#10;        &quot;Timestamp&quot;, &#10;        &quot;Direction&quot;, &#10;        &quot;Difficulty Level&quot;, &#10;        &quot;Semitone Value&quot;, &#10;        &quot;Standard Position&quot;,&#10;        &quot;User Response&quot;, &#10;        &quot;Correct Response&quot;, &#10;        &quot;Is Correct&quot;, &#10;        &quot;Reaction Time (ms)&quot;, &#10;        &quot;Is Reversal&quot;,&#10;        &quot;Step Direction&quot;&#10;    ];&#10;    &#10;    const csvRows = [];&#10;    csvRows.push(headers.join(&quot;,&quot;));&#10;    &#10;    trialRecords.forEach(function(trial) {&#10;        const row = [&#10;            trial.trialNumber,&#10;            trial.timestamp,&#10;            trial.direction,&#10;            trial.difficultyLevel,&#10;            trial.semitoneValue,&#10;            trial.standardPosition,&#10;            trial.userResponse,&#10;            trial.correctResponse,&#10;            trial.isCorrect ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.reactionTime,&#10;            trial.isReversal ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.stepDirection&#10;        ];&#10;        csvRows.push(row.join(&quot;,&quot;));&#10;    });&#10;    &#10;    csvRows.push(&quot;\nRESULTS SUMMARY&quot;);&#10;    csvRows.push(&quot;\nThreshold Results (semitones)&quot;);&#10;    csvRows.push(&quot;Direction,Threshold,Standard Deviation,Assessment&quot;);&#10;    &#10;    const hasHigherData = NumberOfReversals[0] &gt;= MINIMUMREVERSALS;&#10;    const hasLowerData = NumberOfReversals[1] &gt;= MINIMUMREVERSALS;&#10;    &#10;    csvRows.push(&quot;Higher,&quot; + &#10;        (hasHigherData ? sentAverage[0].toFixed(4) : &quot;Insufficient data&quot;) + &quot;,&quot; + &#10;        (hasHigherData ? sentStdev[0].toFixed(4) : &quot;N/A&quot;) + &quot;,&quot; + &#10;        (hasHigherData ? getThresholdAssessment(sentAverage[0]) : &quot;N/A&quot;));&#10;    &#10;    csvRows.push(&quot;Lower,&quot; + &#10;        (hasLowerData ? sentAverage[1].toFixed(4) : &quot;Insufficient data&quot;) + &quot;,&quot; + &#10;        (hasLowerData ? sentStdev[1].toFixed(4) : &quot;N/A&quot;) + &quot;,&quot; + &#10;        (hasLowerData ? getThresholdAssessment(sentAverage[1]) : &quot;N/A&quot;));&#10;    &#10;    if (hasHigherData &amp;&amp; hasLowerData) {&#10;        const avgThreshold = (sentAverage[0] + sentAverage[1]) / 2;&#10;        const combinedVariance = (Math.pow(sentStdev[0], 2) + Math.pow(sentStdev[1], 2)) / 2;&#10;        const combinedSD = Math.sqrt(combinedVariance).toFixed(4);&#10;        &#10;        csvRows.push(&quot;Average,&quot; + avgThreshold.toFixed(4) + &quot;,&quot; + combinedSD + &quot;,&quot; + getThresholdAssessment(avgThreshold));&#10;    }&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    csvRows.push(&quot;\nReaction Time Statistics (ms)&quot;);&#10;    csvRows.push(&quot;Direction,Mean,Median,Standard Deviation&quot;);&#10;    csvRows.push(&quot;Higher,&quot; + rtStats.higher.mean + &quot;,&quot; + rtStats.higher.median + &quot;,&quot; + rtStats.higher.sd);&#10;    csvRows.push(&quot;Lower,&quot; + rtStats.lower.mean + &quot;,&quot; + rtStats.lower.median + &quot;,&quot; + rtStats.lower.sd);&#10;    csvRows.push(&quot;Overall,&quot; + rtStats.overall.mean + &quot;,&quot; + rtStats.overall.median + &quot;,&quot; + rtStats.overall.sd);&#10;    &#10;    const accuracyStats = calculateAccuracyStats();&#10;    csvRows.push(&quot;\nAccuracy Statistics&quot;);&#10;    csvRows.push(&quot;Direction,Correct Responses,Total Responses,Percentage&quot;);&#10;    csvRows.push(&quot;Higher,&quot; + accuracyStats.higher.correct + &quot;,&quot; + accuracyStats.higher.total + &quot;,&quot; + accuracyStats.higher.percentage + &quot;%&quot;);&#10;    csvRows.push(&quot;Lower,&quot; + accuracyStats.lower.correct + &quot;,&quot; + accuracyStats.lower.total + &quot;,&quot; + accuracyStats.lower.percentage + &quot;%&quot;);&#10;    csvRows.push(&quot;Overall,&quot; + accuracyStats.overall.correct + &quot;,&quot; + accuracyStats.overall.total + &quot;,&quot; + accuracyStats.overall.percentage + &quot;%&quot;);&#10;    &#10;    csvRows.push(&quot;\nExperiment Parameters&quot;);&#10;    csvRows.push(&quot;Paradigm,ABX&quot;);&#10;    csvRows.push(&quot;Max Reversals,&quot; + MAXREVERSALS);&#10;    csvRows.push(&quot;Min Reversals for Calculation,&quot; + MINIMUMREVERSALS);&#10;    csvRows.push(&quot;Max Iterations,&quot; + MAXITERATIONS);&#10;    &#10;    const csvContent = &quot;data:text/csv;charset=utf-8,&quot; + csvRows.join(&quot;\n&quot;);&#10;    const encodedUri = encodeURI(csvContent);&#10;    const link = document.createElement(&quot;a&quot;);&#10;    const timestamp = new Date().toISOString().replace(/[:.]/g, &quot;-&quot;);&#10;    link.setAttribute(&quot;href&quot;, encodedUri);&#10;    link.setAttribute(&quot;download&quot;, &quot;pitch_discrimination_ABX_data_&quot; + timestamp + &quot;.csv&quot;);&#10;    document.body.appendChild(link);&#10;    link.click();&#10;    document.body.removeChild(link);&#10;}&#10;&#10;function window_onload() {&#10;    window.name = &quot;EXP&quot;;&#10;    NumberOfReversals = [0, 0];&#10;    numberOfIterations = 0;&#10;    CorrectResponses = [0, 0];&#10;    Direction = [DECREASING, DECREASING];&#10;    currentLevel = [5, 5];&#10;    isTestComplete = [false, false];&#10;    Reversals = [[], []];&#10;    trialsPerDirection = [0, 0];&#10;    forceDirection = null;&#10;    directionHistory = [];&#10;    trialRecords = [];&#10;    isReplayTrial = false;&#10;&#10;    document.getElementById('text1').value = &quot;準備完畢後請點擊\&quot;開始實驗\&quot;&quot;;&#10;    document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;    document.getElementById('start').disabled = false;&#10;    document.getElementById('viewResult').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;    &#10;    updateProgressBar(0);&#10;    &#10;    logDebug(&quot;Page reset complete&quot;);&#10;}&#10;&#10;window.onload = function() {&#10;    window_onload();&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    logDebug(&quot;Preloading &quot; + allAudios.length + &quot; audio files&quot;);&#10;    &#10;    allAudios.forEach(function(audio) {&#10;        audio.load();&#10;    });&#10;    &#10;    document.getElementById('text1').value = &quot;請點擊\&quot;開始實驗\&quot;&quot;;&#10;    &#10;    window.onerror = function(message, source, lineno, colno, error) {&#10;        logDebug(&quot;Global error: &quot; + message + &quot; at &quot; + source + &quot;:&quot; + lineno);&#10;        return false;&#10;    };&#10;    &#10;    document.getElementById('showDebug').checked = true;&#10;    toggleDebug();&#10;};&#10;&lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
                    <entry key="file:///E:/Projects/Pitch_Training/ABX_level_low.html" value="&lt;!DOCTYPE html&gt;&#10;&lt;html&gt;&#10;&lt;head&gt;&#10;    &lt;title&gt;PLOYU-Peng's Lab: Pitch Sensitivity Training&lt;/title&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;style&gt;&#10;        body {&#10;            font-family: Arial, sans-serif;&#10;            margin: 20px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .container {&#10;            max-width: 800px;&#10;            margin: 0 auto;&#10;            padding: 20px;&#10;            background-color: white;&#10;            border-radius: 10px;&#10;            box-shadow: 0 0 10px rgba(0,0,0,0.1);&#10;            display: flex;&#10;            flex-direction: column;&#10;            align-items: center;&#10;        }&#10;        .header {&#10;            text-align: center;&#10;            margin-bottom: 40px;&#10;            width: 100%;&#10;        }&#10;        .training-info {&#10;            font-size: 16px;&#10;            color: #555;&#10;            margin-top: 10px;&#10;            margin-bottom: 5px;&#10;            text-align: center;&#10;        }&#10;        .instruction-text {&#10;            font-size: 14px;&#10;            color: #777;&#10;            margin-bottom: 15px;&#10;            text-align: center;&#10;            font-style: italic;&#10;        }&#10;        .button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .prompt-text {&#10;            text-align: center;&#10;            font-size: 20px;&#10;            margin-bottom: 25px;&#10;            margin-top: 30px;&#10;            font-weight: bold;&#10;        }&#10;        .response-button {&#10;            width: 160px;&#10;            height: 160px;&#10;            font-size: 26px;&#10;            margin: 0 40px;&#10;            border-radius: 15px;&#10;            border: none;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.1);&#10;            transition: all 0.3s ease;&#10;        }&#10;        .response-button:hover:enabled {&#10;            transform: translateY(-3px);&#10;            box-shadow: 0 6px 12px rgba(0,0,0,0.15);&#10;        }&#10;        .response-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .button-playing {&#10;            animation: pulse 1s ease-in-out infinite;&#10;            box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            transform: scale(1.05);&#10;        }&#10;        @keyframes pulse {&#10;            0%, 100% {&#10;                box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            }&#10;            50% {&#10;                box-shadow: 0 0 30px rgba(102, 204, 255, 1);&#10;            }&#10;        }&#10;        .control-button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            gap: 30px;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .control-button {&#10;            padding: 14px 28px;&#10;            font-size: 18px;&#10;            border-radius: 8px;&#10;            border: none;&#10;            background-color: #4CAF50;&#10;            color: white;&#10;            cursor: pointer;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .control-button:hover:enabled {&#10;            background-color: #3e8e41;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .control-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .control-button:disabled {&#10;            background-color: #cccccc;&#10;            cursor: not-allowed;&#10;            box-shadow: none;&#10;        }&#10;        .feedback {&#10;            text-align: center;&#10;            height: 100px;&#10;            margin: 30px 0;&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;        }&#10;        .status {&#10;            width: 350px;&#10;            height: 68px;&#10;            text-align: center;&#10;            font-size: 18px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            margin: 0 auto;&#10;            padding: 10px;&#10;            background-color: #f9f9f9;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.05);&#10;        }&#10;        .debug-info {&#10;            font-size: 12px;&#10;            color: #777;&#10;            margin-top: 30px;&#10;            text-align: left;&#10;            display: none;&#10;            max-height: 300px;&#10;            overflow-y: auto;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            padding: 15px;&#10;            width: 100%;&#10;        }&#10;        .results-container {&#10;            display: none;&#10;            margin-top: 30px;&#10;            padding: 20px;&#10;            background-color: #f0f8ff;&#10;            border-radius: 8px;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.1);&#10;            width: 100%;&#10;        }&#10;        .result-heading {&#10;            text-align: center;&#10;            margin-bottom: 20px;&#10;            color: #2c3e50;&#10;        }&#10;        .result-table {&#10;            width: 100%;&#10;            border-collapse: collapse;&#10;            margin-bottom: 20px;&#10;        }&#10;        .result-table th, .result-table td {&#10;            padding: 12px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .result-table th {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .result-table tr:nth-child(even) {&#10;            background-color: #f2f2f2;&#10;        }&#10;        .result-interpretation {&#10;            background-color: #e8f4f8;&#10;            padding: 15px;&#10;            border-radius: 5px;&#10;            margin-bottom: 20px;&#10;        }&#10;        .back-button {&#10;            display: block;&#10;            margin: 0 auto;&#10;            padding: 14px 28px;&#10;            background-color: #3498db;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .back-button:hover {&#10;            background-color: #2980b9;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .back-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        .chart-container {&#10;            height: 300px;&#10;            margin: 20px 0;&#10;            background-color: white;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;            padding: 10px;&#10;        }&#10;        .auxiliary-buttons {&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            margin-top: 30px;&#10;            gap: 20px;&#10;            flex-wrap: wrap;&#10;        }&#10;        .auxiliary-buttons button {&#10;            padding: 10px 15px;&#10;            border-radius: 5px;&#10;            border: 1px solid #ddd;&#10;            background-color: #f0f0f0;&#10;            cursor: pointer;&#10;            transition: all 0.2s ease;&#10;        }&#10;        .auxiliary-buttons button:hover {&#10;            background-color: #e0e0e0;&#10;        }&#10;        .diagnostic-overlay {&#10;            position: fixed;&#10;            top: 0;&#10;            left: 0;&#10;            width: 100%;&#10;            height: 100%;&#10;            background-color: rgba(0, 0, 0, 0.8);&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            z-index: 1000;&#10;            display: none;&#10;        }&#10;        .diagnostic-content {&#10;            width: 80%;&#10;            max-width: 700px;&#10;            max-height: 80%;&#10;            overflow-y: auto;&#10;            background-color: white;&#10;            padding: 20px;&#10;            border-radius: 8px;&#10;            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);&#10;        }&#10;        .diagnostic-heading {&#10;            text-align: center;&#10;            color: #e74c3c;&#10;            margin-bottom: 20px;&#10;            font-size: 24px;&#10;        }&#10;        .diagnostic-close {&#10;            float: right;&#10;            font-size: 20px;&#10;            cursor: pointer;&#10;            color: #777;&#10;        }&#10;        .diagnostic-close:hover {&#10;            color: #333;&#10;        }&#10;        .diagnostic-section {&#10;            margin-bottom: 15px;&#10;            padding: 10px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;        }&#10;        .diagnostic-actions {&#10;            text-align: center;&#10;            margin-top: 20px;&#10;        }&#10;        .diagnostic-action-button {&#10;            padding: 10px 20px;&#10;            margin: 0 10px;&#10;            border: none;&#10;            border-radius: 5px;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;        }&#10;        .retry-button {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .retry-button:hover {&#10;            background-color: #2980b9;&#10;        }&#10;        .continue-button {&#10;            background-color: #2ecc71;&#10;            color: white;&#10;        }&#10;        .continue-button:hover {&#10;            background-color: #27ae60;&#10;        }&#10;        .diagnostic-file-check {&#10;            margin: 20px 0;&#10;        }&#10;        .diagnostic-file-status {&#10;            display: flex;&#10;            flex-wrap: wrap;&#10;            gap: 10px;&#10;        }&#10;        .file-status-item {&#10;            font-size: 12px;&#10;            padding: 5px 10px;&#10;            border-radius: 3px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .file-found {&#10;            color: #27ae60;&#10;            border-left: 3px solid #27ae60;&#10;        }&#10;        .file-missing {&#10;            color: #e74c3c;&#10;            border-left: 3px solid #e74c3c;&#10;        }&#10;        .statistics-table {&#10;            width: 100%;&#10;            margin: 10px 0;&#10;            border-collapse: collapse;&#10;        }&#10;        .statistics-table th, .statistics-table td {&#10;            padding: 8px;&#10;            text-align:center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .statistics-table th {&#10;            background-color: #f0f0f0;&#10;        }&#10;        .direction-stats-good {&#10;            color: #27ae60;&#10;        }&#10;        .direction-stats-warning {&#10;            color: #f39c12;&#10;        }&#10;        .direction-stats-bad {&#10;            color: #e74c3c;&#10;        }&#10;        @media (max-width: 600px) {&#10;            .response-button {&#10;                width: 130px;&#10;                height: 130px;&#10;                font-size: 22px;&#10;                margin: 0 20px;&#10;            }&#10;            .control-button {&#10;                padding: 12px 20px;&#10;            }&#10;        }&#10;        .print-button {&#10;            padding: 14px 28px;&#10;            margin: 20px auto;&#10;            background-color: #9b59b6;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;            display: block;&#10;        }&#10;        .print-button:hover {&#10;            background-color: #8e44ad;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .print-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        @media print {&#10;            body {&#10;                background-color: white;&#10;                margin: 0;&#10;                padding: 0;&#10;            }&#10;            .container {&#10;                max-width: 100%;&#10;                box-shadow: none;&#10;                padding: 10px;&#10;            }&#10;            .back-button, .print-button, .auxiliary-buttons {&#10;                display: none;&#10;            }&#10;            .results-container {&#10;                display: block !important;&#10;                box-shadow: none;&#10;                background-color: white;&#10;                padding: 0;&#10;            }&#10;            .chart-container {&#10;                border: 1px solid #ddd;&#10;                background-color: white;&#10;            }&#10;            .result-table th {&#10;                background-color: #f0f0f0 !important;&#10;                color: black !important;&#10;            }&#10;            .result-interpretation {&#10;                background-color: white;&#10;                border: 1px solid #ddd;&#10;            }&#10;            * {&#10;                -webkit-print-color-adjust: exact !important;&#10;                print-color-adjust: exact !important;&#10;            }&#10;        }&#10;        .progress-bar-container {&#10;            width: 100%;&#10;            height: 20px;&#10;            background-color: #e0e0e0;&#10;            border-radius: 10px;&#10;            margin: 10px 0;&#10;            overflow: hidden;&#10;        }&#10;        .progress-bar {&#10;            height: 100%;&#10;            background-color: #4CAF50;&#10;            border-radius: 10px;&#10;            transition: width 0.3s ease;&#10;        }&#10;        .progress-label {&#10;            text-align: center;&#10;            font-size: 14px;&#10;            color: #555;&#10;            margin-top: 5px;&#10;        }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;div class=&quot;container&quot;&gt;&#10;        &lt;div class=&quot;header&quot;&gt;&#10;            &lt;img src=&quot;Media/animation.gif&quot; alt=&quot;Experiment animation&quot;&gt;&#10;            &lt;div class=&quot;training-info&quot;&gt;Low Register Discrimination (ABX)&lt;/div&gt;&#10;            &lt;div class=&quot;instruction-text&quot;&gt;請判斷第三個音聽起來更像第一個還是第二個音&lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div id=&quot;experimentContainer&quot;&gt;&#10;            &lt;div class=&quot;control-button-container&quot;&gt;&#10;                &lt;input id=&quot;start&quot; type=&quot;button&quot; value=&quot;開始實驗&quot; onclick=&quot;start_onclick()&quot; class=&quot;control-button&quot;&gt;&#10;                &lt;input id=&quot;viewResult&quot; type=&quot;button&quot; value=&quot;查看結果&quot; onclick=&quot;view_onclick()&quot; class=&quot;control-button&quot; disabled&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;prompt-text&quot; id=&quot;promptText&quot;&gt;&#10;                第三個音更像...&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;firstBtn&quot; type=&quot;button&quot; value=&quot;第一個音&quot; onclick=&quot;processAnswer(1)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;                &lt;input id=&quot;secondBtn&quot; type=&quot;button&quot; value=&quot;第二個音&quot; onclick=&quot;processAnswer(2)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;feedback&quot;&gt;&#10;                &lt;img id=&quot;smile&quot; src=&quot;Media/null.gif&quot; width=&quot;100&quot; height=&quot;84&quot; alt=&quot;Feedback&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;text1&quot; class=&quot;status&quot; readonly&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;progress-bar-container&quot;&gt;&#10;                &lt;div class=&quot;progress-bar&quot; id=&quot;progressBar&quot; style=&quot;width: 0%&quot;&gt;&lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;progress-label&quot; id=&quot;progressLabel&quot;&gt;Progress: 0%&lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;debug-info&quot; id=&quot;debugInfo&quot;&gt;&#10;                Debug information will be displayed here&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot;&gt;&#10;                &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;showDebug&quot; onclick=&quot;toggleDebug()&quot;&gt; Show Debug Info&lt;/label&gt;&#10;                &lt;button onclick=&quot;testAudio()&quot;&gt;Test All Audio&lt;/button&gt;&#10;                &lt;button onclick=&quot;showDiagnostics()&quot;&gt;Diagnostics&lt;/button&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot; id=&quot;exportBtn&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div id=&quot;resultsContainer&quot; class=&quot;results-container&quot;&gt;&#10;            &lt;h2 class=&quot;result-heading&quot;&gt;Pitch Discrimination Test Results (ABX)&lt;/h2&gt;&#10;            &#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Test Direction&lt;/th&gt;&#10;                        &lt;th&gt;Threshold (semitones)&lt;/th&gt;&#10;                        &lt;th&gt;Std. Deviation&lt;/th&gt;&#10;                        &lt;th&gt;Assessment&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;resultTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;div class=&quot;result-interpretation&quot; id=&quot;resultInterpretation&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Reaction Time Statistics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot; id=&quot;rtStatsTable&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Direction&lt;/th&gt;&#10;                        &lt;th&gt;Mean RT (ms)&lt;/th&gt;&#10;                        &lt;th&gt;Median RT (ms)&lt;/th&gt;&#10;                        &lt;th&gt;RT Std. Deviation&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;rtStatsTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;h3&gt;Accuracy Statistics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot; id=&quot;accuracyStatsTable&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Direction&lt;/th&gt;&#10;                        &lt;th&gt;Correct Responses&lt;/th&gt;&#10;                        &lt;th&gt;Total Responses&lt;/th&gt;&#10;                        &lt;th&gt;Accuracy&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;accuracyStatsTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;div class=&quot;chart-container&quot; id=&quot;resultChart&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;button class=&quot;print-button&quot; onclick=&quot;printResults()&quot;&gt;Print Results&lt;/button&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot; style=&quot;margin-top: 20px;&quot;&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;button class=&quot;back-button&quot; onclick=&quot;backToExperiment()&quot;&gt;Back to Experiment&lt;/button&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div class=&quot;diagnostic-overlay&quot; id=&quot;diagnosticOverlay&quot;&gt;&#10;            &lt;div class=&quot;diagnostic-content&quot;&gt;&#10;                &lt;span class=&quot;diagnostic-close&quot; onclick=&quot;closeDiagnostics()&quot;&gt;&amp;times;&lt;/span&gt;&#10;                &lt;h2 class=&quot;diagnostic-heading&quot;&gt;Experiment Diagnostics&lt;/h2&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Test Status&lt;/h3&gt;&#10;                    &lt;table class=&quot;statistics-table&quot;&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;th&gt;Direction&lt;/th&gt;&#10;                            &lt;th&gt;Trials&lt;/th&gt;&#10;                            &lt;th&gt;Reversals&lt;/th&gt;&#10;                            &lt;th&gt;Status&lt;/th&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td&gt;Higher Direction&lt;/td&gt;&#10;                            &lt;td id=&quot;higherTrials&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;higherReversals&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;higherStatus&quot;&gt;Not started&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td&gt;Lower Direction&lt;/td&gt;&#10;                            &lt;td id=&quot;lowerTrials&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;lowerReversals&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;lowerStatus&quot;&gt;Not started&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                    &lt;/table&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Audio Files Check&lt;/h3&gt;&#10;                    &lt;p&gt;Verifying necessary audio files:&lt;/p&gt;&#10;                    &lt;div id=&quot;audioFileStatus&quot; class=&quot;diagnostic-file-status&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Reversal History&lt;/h3&gt;&#10;                    &lt;div id=&quot;reversalHistory&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Recommendations&lt;/h3&gt;&#10;                    &lt;div id=&quot;diagnosticRecommendations&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-actions&quot;&gt;&#10;                    &lt;button class=&quot;diagnostic-action-button retry-button&quot; onclick=&quot;retryIncompleteDirection()&quot;&gt;Retry Incomplete Direction&lt;/button&gt;&#10;                    &lt;button class=&quot;diagnostic-action-button continue-button&quot; onclick=&quot;closeDiagnostics()&quot;&gt;Close&lt;/button&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;audio id=&quot;low_level_standard&quot; src=&quot;Media/low_level_standard.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;    &lt;audio id=&quot;low_level_1_h&quot; src=&quot;Media/low_level_1_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_2_h&quot; src=&quot;Media/low_level_2_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_3_h&quot; src=&quot;Media/low_level_3_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_4_h&quot; src=&quot;Media/low_level_4_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_5_h&quot; src=&quot;Media/low_level_5_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_6_h&quot; src=&quot;Media/low_level_6_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_7_h&quot; src=&quot;Media/low_level_7_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_8_h&quot; src=&quot;Media/low_level_8_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_9_h&quot; src=&quot;Media/low_level_9_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;    &lt;audio id=&quot;low_level_1_l&quot; src=&quot;Media/low_level_1_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_2_l&quot; src=&quot;Media/low_level_2_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_3_l&quot; src=&quot;Media/low_level_3_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_4_l&quot; src=&quot;Media/low_level_4_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_5_l&quot; src=&quot;Media/low_level_5_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_6_l&quot; src=&quot;Media/low_level_6_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_7_l&quot; src=&quot;Media/low_level_7_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_8_l&quot; src=&quot;Media/low_level_8_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_9_l&quot; src=&quot;Media/low_level_9_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;&lt;script&gt;&#10;function getLocalTimestamp() {&#10;    const now = new Date();&#10;    const year = now.getFullYear();&#10;    const month = String(now.getMonth() + 1).padStart(2, '0');&#10;    const day = String(now.getDate()).padStart(2, '0');&#10;    const hours = String(now.getHours()).padStart(2, '0');&#10;    const minutes = String(now.getMinutes()).padStart(2, '0');&#10;    const seconds = String(now.getSeconds()).padStart(2, '0');&#10;    const milliseconds = String(now.getMilliseconds()).padStart(3, '0');&#10;    &#10;    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;&#10;}&#10;&#10;// Adaptive threshold experiment constants&#10;const MAXREVERSALS = 10;&#10;const MAXITERATIONS = 50;&#10;const LOWERLIMIT = 1;&#10;const DECREASING = -1;&#10;const INCREASING = 1;&#10;const MINIMUMREVERSALS = 6;&#10;const THRESHOLD_REVERSAL_COUNT = 6;&#10;const FORCEBALANCETHRESHOLD = 5;&#10;&#10;// Experiment state variables&#10;var CorrectAnswer;&#10;var CorrectResponses = [0, 0];&#10;var Direction = [DECREASING, DECREASING];&#10;var Reversals = [[], []];&#10;var NumberOfReversals = [0, 0];&#10;var currentLevel = [5, 5];&#10;var numberOfIterations = 0;&#10;var sentAverage = [0.0, 0.0];&#10;var sentStdev = [0.0, 0.0];&#10;var currentStimDirection;&#10;var isTestComplete = [false, false];&#10;var audioUnlocked = false;&#10;var trialsPerDirection = [0, 0];&#10;var forceDirection = null;&#10;var directionHistory = [];&#10;var allFilesPresent = true;&#10;var trialRecords = [];&#10;var stimulusEndTime = 0;&#10;&#10;// ABX新增变量&#10;var standardIsFirst;&#10;var comparisonSound;&#10;var standardSound;&#10;var xSound;&#10;&#10;// 新增：重播标志&#10;var isReplayTrial = false;&#10;&#10;function printResults() {&#10;    window.print();&#10;}&#10;&#10;function logDebug(message) {&#10;    console.log(message);&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var now = new Date();&#10;    var timeStr = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + '.' + now.getMilliseconds();&#10;    debugArea.innerHTML += '&lt;p&gt;[' + timeStr + '] ' + message + '&lt;/p&gt;';&#10;    debugArea.scrollTop = debugArea.scrollHeight;&#10;}&#10;&#10;function toggleDebug() {&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var checkbox = document.getElementById('showDebug');&#10;    debugArea.style.display = checkbox.checked ? 'block' : 'none';&#10;}&#10;&#10;function showDiagnostics() {&#10;    updateDiagnostics();&#10;    document.getElementById('diagnosticOverlay').style.display = 'flex';&#10;}&#10;&#10;function closeDiagnostics() {&#10;    document.getElementById('diagnosticOverlay').style.display = 'none';&#10;}&#10;&#10;function updateDiagnostics() {&#10;    document.getElementById('higherTrials').innerText = trialsPerDirection[0];&#10;    document.getElementById('lowerTrials').innerText = trialsPerDirection[1];&#10;    document.getElementById('higherReversals').innerText = NumberOfReversals[0];&#10;    document.getElementById('lowerReversals').innerText = NumberOfReversals[1];&#10;    &#10;    let higherStatus = getDirectionStatus(0);&#10;    let lowerStatus = getDirectionStatus(1);&#10;    &#10;    document.getElementById('higherStatus').innerText = higherStatus.text;&#10;    document.getElementById('higherStatus').className = `direction-stats-${higherStatus.class}`;&#10;    document.getElementById('lowerStatus').innerText = lowerStatus.text;&#10;    document.getElementById('lowerStatus').className = `direction-stats-${lowerStatus.class}`;&#10;    &#10;    checkAudioFiles();&#10;    &#10;    let reversalHistoryHtml = '&lt;h4&gt;Higher Direction&lt;/h4&gt;';&#10;    if (Reversals[0].length === 0) {&#10;        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';&#10;    } else {&#10;        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals[0].join(', ') + '&lt;/p&gt;';&#10;    }&#10;    &#10;    reversalHistoryHtml += '&lt;h4&gt;Lower Direction&lt;/h4&gt;';&#10;    if (Reversals[1].length === 0) {&#10;        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';&#10;    } else {&#10;        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals[1].join(', ') + '&lt;/p&gt;';&#10;    }&#10;    &#10;    document.getElementById('reversalHistory').innerHTML = reversalHistoryHtml;&#10;    &#10;    generateDiagnosticRecommendations();&#10;}&#10;&#10;function getDirectionStatus(dirIndex) {&#10;    if (isTestComplete[dirIndex]) {&#10;        return { text: &quot;Complete&quot;, class: &quot;good&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals[dirIndex] &lt; 1) {&#10;        return { text: &quot;Not enough data&quot;, class: &quot;bad&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals[dirIndex] &lt; MINIMUMREVERSALS) {&#10;        return { text: &quot;Incomplete (&quot; + NumberOfReversals[dirIndex] + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals)&quot;, class: &quot;warning&quot; };&#10;    }&#10;    &#10;    return { text: &quot;In progress&quot;, class: &quot;good&quot; };&#10;}&#10;&#10;function checkAudioFiles() {&#10;    const requiredFiles = [&#10;        &quot;low_level_standard&quot;,&#10;        &quot;low_level_1_h&quot;, &quot;low_level_2_h&quot;, &quot;low_level_3_h&quot;, &quot;low_level_4_h&quot;, &quot;low_level_5_h&quot;, &#10;        &quot;low_level_6_h&quot;, &quot;low_level_7_h&quot;, &quot;low_level_8_h&quot;, &quot;low_level_9_h&quot;,&#10;        &quot;low_level_1_l&quot;, &quot;low_level_2_l&quot;, &quot;low_level_3_l&quot;, &quot;low_level_4_l&quot;, &quot;low_level_5_l&quot;, &#10;        &quot;low_level_6_l&quot;, &quot;low_level_7_l&quot;, &quot;low_level_8_l&quot;, &quot;low_level_9_l&quot;&#10;    ];&#10;    &#10;    let statusHtml = '';&#10;    allFilesPresent = true;&#10;    &#10;    requiredFiles.forEach(function(fileId) {&#10;        const audioElement = document.getElementById(fileId);&#10;        const fileFound = audioElement !== null;&#10;        &#10;        if (!fileFound) {&#10;            allFilesPresent = false;&#10;        }&#10;        &#10;        statusHtml += `&lt;div class=&quot;file-status-item ${fileFound ? 'file-found' : 'file-missing'}&quot;&gt;${fileId}: ${fileFound ? 'Found' : 'Missing'}&lt;/div&gt;`;&#10;    });&#10;    &#10;    document.getElementById('audioFileStatus').innerHTML = statusHtml;&#10;}&#10;&#10;function generateDiagnosticRecommendations() {&#10;    let recommendations = '';&#10;    let hasIssues = false;&#10;    &#10;    if (!allFilesPresent) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Critical Issue:&lt;/strong&gt; Some required audio files are missing. Please ensure all files are properly loaded.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    const directionDifference = Math.abs(trialsPerDirection[0] - trialsPerDirection[1]);&#10;    if (directionDifference &gt; 10 &amp;&amp; !isTestComplete[0] &amp;&amp; !isTestComplete[1]) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Warning:&lt;/strong&gt; Trial count is imbalanced between higher and lower directions. Consider restarting experiment.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    for (let i = 0; i &lt; 2; i++) {&#10;        if (trialsPerDirection[i] &gt;= MAXITERATIONS/2 &amp;&amp; NumberOfReversals[i] &lt; MINIMUMREVERSALS) {&#10;            recommendations += '&lt;p&gt;&lt;strong&gt;Issue:&lt;/strong&gt; ' + (i === 0 ? 'Higher' : 'Lower') + &#10;                ' direction reached maximum trials but has insufficient reversals. This might indicate audio file issues or participant response patterns.&lt;/p&gt;';&#10;            hasIssues = true;&#10;        }&#10;    }&#10;    &#10;    if (numberOfIterations &gt; 10 &amp;&amp; (trialsPerDirection[0] === 0 || trialsPerDirection[1] === 0)) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Warning:&lt;/strong&gt; One direction has not been tested at all. Algorithm may be malfunctioning.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (!hasIssues) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Good:&lt;/strong&gt; No major issues detected with the experiment setup.&lt;/p&gt;';&#10;        &#10;        if (isTestComplete[0] &amp;&amp; isTestComplete[1]) {&#10;            recommendations += '&lt;p&gt;Both test directions are complete.&lt;/p&gt;';&#10;        } else if (isTestComplete[0]) {&#10;            recommendations += '&lt;p&gt;Higher direction test is complete. Lower direction test still needs more data.&lt;/p&gt;';&#10;        } else if (isTestComplete[1]) {&#10;            recommendations += '&lt;p&gt;Lower direction test is complete. Higher direction test still needs more data.&lt;/p&gt;';&#10;        } else {&#10;            recommendations += '&lt;p&gt;Both test directions are still in progress.&lt;/p&gt;';&#10;        }&#10;    }&#10;    &#10;    document.getElementById('diagnosticRecommendations').innerHTML = recommendations;&#10;}&#10;&#10;function retryIncompleteDirection() {&#10;    let retryDirection = null;&#10;    &#10;    if (isTestComplete[0] &amp;&amp; !isTestComplete[1]) {&#10;        retryDirection = 1;&#10;    } else if (!isTestComplete[0] &amp;&amp; isTestComplete[1]) {&#10;        retryDirection = 0;&#10;    } else if (!isTestComplete[0] &amp;&amp; !isTestComplete[1]) {&#10;        retryDirection = (NumberOfReversals[0] &lt; NumberOfReversals[1]) ? 0 : 1;&#10;    } else {&#10;        alert(&quot;Both directions are already complete.&quot;);&#10;        return;&#10;    }&#10;    &#10;    resetDirection(retryDirection);&#10;    forceDirection = retryDirection;&#10;    closeDiagnostics();&#10;    &#10;    if (document.getElementById('start').disabled) {&#10;        document.getElementById('text1').value = &quot;Retrying &quot; + (retryDirection === 0 ? &quot;higher&quot; : &quot;lower&quot;) + &quot; direction...&quot;;&#10;        beginIteration();&#10;    } else {&#10;        start_onclick();&#10;    }&#10;}&#10;&#10;function resetDirection(dirIndex) {&#10;    NumberOfReversals[dirIndex] = 0;&#10;    CorrectResponses[dirIndex] = 0;&#10;    Direction[dirIndex] = DECREASING;&#10;    currentLevel[dirIndex] = 5;&#10;    isTestComplete[dirIndex] = false;&#10;    Reversals[dirIndex] = [];&#10;    trialsPerDirection[dirIndex] = 0;&#10;    &#10;    trialRecords = trialRecords.filter(record =&gt; &#10;        record.direction !== (dirIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;)&#10;    );&#10;    &#10;    logDebug((dirIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction reset&quot;);&#10;    updateProgressBar();&#10;}&#10;&#10;function testAudio() {&#10;    logDebug(&quot;Starting to test all audio files...&quot;);&#10;    var audios = document.querySelectorAll('audio');&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    var index = 0;&#10;    function playNext() {&#10;        if (index &gt;= audios.length) {&#10;            logDebug(&quot;All audio testing complete!&quot;);&#10;            return;&#10;        }&#10;        &#10;        var audio = audios[index];&#10;        logDebug(&quot;Testing audio #&quot; + (index + 1) + &quot;: &quot; + audio.id);&#10;        &#10;        audio.currentTime = 0;&#10;        &#10;        var playPromise = audio.play();&#10;        if (playPromise !== undefined) {&#10;            playPromise.then(function() {&#10;                logDebug(audio.id + &quot; played successfully&quot;);&#10;                &#10;                audio.onended = function() {&#10;                    logDebug(audio.id + &quot; playback ended&quot;);&#10;                    index++;&#10;                    setTimeout(playNext, 500);&#10;                };&#10;            }).catch(function(error) {&#10;                logDebug(&quot;Failed to play &quot; + audio.id + &quot;: &quot; + error);&#10;                index++;&#10;                setTimeout(playNext, 500);&#10;            });&#10;        }&#10;    }&#10;    &#10;    playNext();&#10;}&#10;&#10;function unlockAudioContext() {&#10;    logDebug(&quot;Attempting to unlock audio context...&quot;);&#10;    &#10;    var silentAudio = new Audio();&#10;    silentAudio.src = &quot;data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA&quot;;&#10;    &#10;    var promise = silentAudio.play();&#10;    if (promise !== undefined) {&#10;        promise.then(function() {&#10;            logDebug(&quot;Audio context unlocked successfully&quot;);&#10;            silentAudio.remove();&#10;            audioUnlocked = true;&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to unlock audio context: &quot; + error);&#10;        });&#10;    }&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    for (var i = 0; i &lt; allAudios.length; i++) {&#10;        var audio = allAudios[i];&#10;        audio.load();&#10;    }&#10;    &#10;    logDebug(&quot;Preloaded &quot; + allAudios.length + &quot; audio files&quot;);&#10;}&#10;&#10;function resetPage() {&#10;    numberOfIterations++;&#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('firstBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('secondBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    if (isTestComplete[0] &amp;&amp; isTestComplete[1]) {&#10;        document.getElementById('start').disabled = false;&#10;        document.getElementById('viewResult').disabled = false;&#10;        document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;        updateProgressBar(100);&#10;        return;&#10;    }&#10;    &#10;    if ((trialsPerDirection[currentStimDirection] &gt;= MAXITERATIONS/2) || &#10;        (NumberOfReversals[currentStimDirection] &gt;= MAXREVERSALS)) {&#10;        &#10;        if (NumberOfReversals[currentStimDirection] &gt;= MINIMUMREVERSALS) {&#10;            calculateResults(currentStimDirection);&#10;            isTestComplete[currentStimDirection] = true;&#10;        } else {&#10;            logDebug(&#10;                (currentStimDirection === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &#10;                &quot; direction reached max iterations but has only &quot; + &#10;                NumberOfReversals[currentStimDirection] + &quot;/&quot; + MINIMUMREVERSALS + &#10;                &quot; reversals. Showing diagnostics.&quot;&#10;            );&#10;            &#10;            document.getElementById('text1').value = &#10;                (currentStimDirection === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &#10;                &quot; direction has insufficient data. Check diagnostics.&quot;;&#10;            &#10;            setTimeout(function() {&#10;                showDiagnostics();&#10;            }, 500);&#10;            return;&#10;        }&#10;        &#10;        updateProgressBar();&#10;        &#10;        if (!isTestComplete[0] || !isTestComplete[1]) {&#10;            document.getElementById('text1').value = &quot;實驗繼續中...&quot;;&#10;            setTimeout(function() {&#10;                beginIteration();&#10;            }, 2000);&#10;        } else {&#10;            document.getElementById('start').disabled = false;&#10;            document.getElementById('viewResult').disabled = false;&#10;            document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;            updateProgressBar(100);&#10;        }&#10;    } else {&#10;        updateProgressBar();&#10;        beginIteration();&#10;    }&#10;}&#10;&#10;function updateProgressBar(forcePercent) {&#10;    if (typeof forcePercent === 'number') {&#10;        document.getElementById('progressBar').style.width = forcePercent + '%';&#10;        document.getElementById('progressLabel').textContent = 'Progress: ' + forcePercent + '%';&#10;        return;&#10;    }&#10;    &#10;    const higherDirMax = Math.max(MAXREVERSALS, MAXITERATIONS/2);&#10;    const higherDirValue = isTestComplete[0] ? higherDirMax : Math.max(NumberOfReversals[0], trialsPerDirection[0]);&#10;    const higherDirPercent = Math.min(50 * (higherDirValue / higherDirMax), 50);&#10;    &#10;    const lowerDirMax = Math.max(MAXREVERSALS, MAXITERATIONS/2);&#10;    const lowerDirValue = isTestComplete[1] ? lowerDirMax : Math.max(NumberOfReversals[1], trialsPerDirection[1]);&#10;    const lowerDirPercent = Math.min(50 * (lowerDirValue / lowerDirMax), 50);&#10;    &#10;    const totalPercent = higherDirPercent + lowerDirPercent;&#10;    &#10;    document.getElementById('progressBar').style.width = totalPercent + '%';&#10;    document.getElementById('progressLabel').textContent = 'Progress: ' + Math.round(totalPercent) + '%';&#10;}&#10;&#10;function calculateResults(directionIndex) {&#10;    let sum = 0.0, stddevsum = 0.0, average = 0.0, stdev = 0.0, counter = 0;&#10;    &#10;    const semitoneMap = {&#10;        1: 2.0,&#10;        2: 1.0,&#10;        3: 1/2,&#10;        4: 1/6,&#10;        5: 1/8,&#10;        6: 1/12,&#10;        7: 1/15,&#10;        8: 1/20,&#10;        9: 1/50&#10;    };&#10;    &#10;    for (let i = 0; i &lt; Reversals[directionIndex].length; i++) {&#10;        if (Reversals[directionIndex][i] &gt; 0) counter++;&#10;    }&#10;    &#10;    if (counter &lt; MINIMUMREVERSALS) {&#10;        logDebug((directionIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction test has insufficient data&quot;);&#10;        alert((directionIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction test has insufficient data. Please complete the test again.&quot;);&#10;        return;&#10;    }&#10;    &#10;    const startIndex = Math.max(0, NumberOfReversals[directionIndex] - THRESHOLD_REVERSAL_COUNT);&#10;    counter = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals[directionIndex].length; i++) {&#10;        const level = Reversals[directionIndex][i];&#10;        if (level &gt; 0) {&#10;            const semitones = semitoneMap[level];&#10;            if (semitones !== undefined) {&#10;                sum += semitones;&#10;                counter++;&#10;            }&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 0) {&#10;        average = sum / counter;&#10;        average = parseFloat(average.toFixed(4));&#10;    }&#10;    &#10;    for (let i = startIndex; i &lt; Reversals[directionIndex].length; i++) {&#10;        const level = Reversals[directionIndex][i];&#10;        if (level &gt; 0) {&#10;            const semitones = semitoneMap[level];&#10;            if (semitones !== undefined) {&#10;                stddevsum += Math.pow(semitones - average, 2);&#10;            }&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 1) {&#10;        stdev = Math.sqrt(stddevsum / (counter - 1));&#10;        stdev = parseFloat(stdev.toFixed(4));&#10;    }&#10;    &#10;    sentAverage[directionIndex] = average;&#10;    sentStdev[directionIndex] = stdev;&#10;    &#10;    logDebug((directionIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction test complete! Threshold: &quot; + average.toFixed(4) + &quot; semitones&quot;);&#10;    document.getElementById('text1').value = &#10;        (directionIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction test complete! Threshold: &quot; + average.toFixed(4) + &quot; semitones&quot;;&#10;}&#10;&#10;function beginIteration() {&#10;    isReplayTrial = false;&#10;    &#10;    if (forceDirection !== null) {&#10;        currentStimDirection = forceDirection;&#10;        &#10;        if (trialsPerDirection[forceDirection] % 5 === 0) {&#10;            logDebug(&quot;Releasing forced direction after 5 trials&quot;);&#10;            forceDirection = null;&#10;        }&#10;    } &#10;    else if (isTestComplete[0]) {&#10;        currentStimDirection = 1;&#10;    } &#10;    else if (isTestComplete[1]) {&#10;        currentStimDirection = 0;&#10;    }&#10;    else if (Math.abs(trialsPerDirection[0] - trialsPerDirection[1]) &gt; FORCEBALANCETHRESHOLD) {&#10;        currentStimDirection = (trialsPerDirection[0] &gt; trialsPerDirection[1]) ? 1 : 0;&#10;        logDebug(&quot;Forcing balance: selecting &quot; + (currentStimDirection === 0 ? &quot;higher&quot; : &quot;lower&quot;) + &quot; direction&quot;);&#10;    }&#10;    else {&#10;        currentStimDirection = Math.random() &lt; 0.5 ? 0 : 1;&#10;    }&#10;    &#10;    directionHistory.push(currentStimDirection);&#10;    &#10;    standardIsFirst = Math.random() &lt; 0.5;&#10;    var xIsStandard = Math.random() &lt; 0.5;&#10;    &#10;    if (xIsStandard) {&#10;        CorrectAnswer = standardIsFirst ? 1 : 2;&#10;    } else {&#10;        CorrectAnswer = standardIsFirst ? 2 : 1;&#10;    }&#10;    &#10;    trialsPerDirection[currentStimDirection]++;&#10;    &#10;    logDebug(&quot;Starting new iteration #&quot; + numberOfIterations + &#10;             &quot;, Direction: &quot; + (currentStimDirection === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &#10;             &quot;, Standard is &quot; + (standardIsFirst ? &quot;first&quot; : &quot;second&quot;) +&#10;             &quot;, X is &quot; + (xIsStandard ? &quot;standard&quot; : &quot;comparison&quot;) +&#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Difficulty level: &quot; + currentLevel[currentStimDirection]);&#10;    &#10;    setTimeout(function() {&#10;        playABXSequence(xIsStandard);&#10;    }, 1000);&#10;}&#10;&#10;function clearButtonAnimations() {&#10;    document.getElementById('firstBtn').classList.remove('button-playing');&#10;    document.getElementById('secondBtn').classList.remove('button-playing');&#10;}&#10;&#10;function playABXSequence(xIsStandard) {&#10;    logDebug(&quot;Playing ABX sequence&quot;);&#10;    &#10;    clearButtonAnimations();&#10;&#10;    standardSound = document.getElementById('low_level_standard');&#10;&#10;    const level = currentLevel[currentStimDirection];&#10;    if (currentStimDirection === 0) {&#10;        comparisonSound = document.getElementById(&quot;low_level_&quot; + level + &quot;_h&quot;);&#10;    } else {&#10;        comparisonSound = document.getElementById(&quot;low_level_&quot; + level + &quot;_l&quot;);&#10;    }&#10;    &#10;    xSound = xIsStandard ? standardSound : comparisonSound;&#10;    &#10;    if (!standardSound || !comparisonSound) {&#10;        logDebug(&quot;Error: Cannot find audio elements!&quot;);&#10;        document.getElementById('text1').value = &quot;出錯：找不到音頻文件&quot;;&#10;        setTimeout(function() {&#10;            showDiagnostics();&#10;        }, 1000);&#10;        return;&#10;    }&#10;    &#10;    var firstSound = standardIsFirst ? standardSound : comparisonSound;&#10;    document.getElementById('text1').value = &quot;播放第一個音&quot;;&#10;    &#10;    document.getElementById('firstBtn').classList.add('button-playing');&#10;    &#10;    firstSound.currentTime = 0;&#10;    var playPromise1 = firstSound.play();&#10;    &#10;    if (playPromise1 !== undefined) {&#10;        playPromise1.then(function() {&#10;            logDebug(&quot;First sound (A) played successfully&quot;);&#10;            &#10;            firstSound.onended = function() {&#10;                logDebug(&quot;First sound ended&quot;);&#10;                &#10;                document.getElementById('firstBtn').classList.remove('button-playing');&#10;                &#10;                setTimeout(function() {&#10;                    var secondSound = standardIsFirst ? comparisonSound : standardSound;&#10;                    document.getElementById('text1').value = &quot;播放第二個音&quot;;&#10;                    &#10;                    document.getElementById('secondBtn').classList.add('button-playing');&#10;                    &#10;                    secondSound.currentTime = 0;&#10;                    var playPromise2 = secondSound.play();&#10;                    &#10;                    if (playPromise2 !== undefined) {&#10;                        playPromise2.then(function() {&#10;                            logDebug(&quot;Second sound (B) played successfully&quot;);&#10;                            &#10;                            secondSound.onended = function() {&#10;                                logDebug(&quot;Second sound ended&quot;);&#10;                                &#10;                                document.getElementById('secondBtn').classList.remove('button-playing');&#10;                                &#10;                                setTimeout(function() {&#10;                                    document.getElementById('text1').value = &quot;播放第三個音&quot;;&#10;                                    &#10;                                    xSound.currentTime = 0;&#10;                                    var playPromise3 = xSound.play();&#10;                                    &#10;                                    if (playPromise3 !== undefined) {&#10;                                        playPromise3.then(function() {&#10;                                            logDebug(&quot;Third sound (X) played successfully&quot;);&#10;                                            &#10;                                            xSound.onended = function() {&#10;                                                logDebug(&quot;Third sound ended, enabling response buttons&quot;);&#10;                                                &#10;                                                stimulusEndTime = performance.now();&#10;                                                &#10;                                                document.getElementById('text1').value = &quot;請作出選擇&quot;;&#10;                                                document.getElementById('promptText').style.visibility = 'visible';&#10;                                                &#10;                                                document.getElementById('firstBtn').disabled = false;&#10;                                                document.getElementById('secondBtn').disabled = false;&#10;                                                document.getElementById('firstBtn').style.background = &quot;#66CCFF&quot;;&#10;                                                document.getElementById('secondBtn').style.background = &quot;#66CCFF&quot;;&#10;                                            };&#10;                                        }).catch(function(error) {&#10;                                            logDebug(&quot;Failed to play third sound: &quot; + error);&#10;                                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                                            clearButtonAnimations();&#10;                                            setTimeout(showDiagnostics, 1000);&#10;                                        });&#10;                                    }&#10;                                }, 1000);&#10;                            };&#10;                        }).catch(function(error) {&#10;                            logDebug(&quot;Failed to play second sound: &quot; + error);&#10;                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                            clearButtonAnimations();&#10;                            setTimeout(showDiagnostics, 1000);&#10;                        });&#10;                    }&#10;                }, 1000);&#10;            };&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to play first sound: &quot; + error);&#10;            document.getElementById('text1').value = &quot;音頻播放錯誤，請刷新頁面&quot;;&#10;            clearButtonAnimations();&#10;            setTimeout(showDiagnostics, 1000);&#10;        });&#10;    }&#10;}&#10;&#10;function start_onclick() {&#10;    logDebug(&quot;Starting experiment&quot;);&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    checkAudioFiles();&#10;    if (!allFilesPresent) {&#10;        logDebug(&quot;Cannot start experiment: Some audio files are missing&quot;);&#10;        document.getElementById('text1').value = &quot;音頻缺失&quot;;&#10;        showDiagnostics();&#10;        return;&#10;    }&#10;    &#10;    window_onload();&#10;    document.getElementById('text1').value = &quot;開始實驗...&quot;;&#10;    updateProgressBar(0);&#10;    &#10;    setTimeout(function() {&#10;        beginIteration();&#10;        document.getElementById('start').disabled = true;&#10;        document.getElementById('viewResult').disabled = true;&#10;        document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;        document.getElementById('promptText').style.visibility = 'hidden';&#10;    }, 1000);&#10;}&#10;&#10;function gotReversal(dirIndex) {&#10;    NumberOfReversals[dirIndex]++;&#10;    Reversals[dirIndex][NumberOfReversals[dirIndex] - 1] = currentLevel[dirIndex];&#10;    Direction[dirIndex] = -Direction[dirIndex];&#10;    logDebug(&quot;Recorded reversal #&quot; + NumberOfReversals[dirIndex] + &quot; at difficulty &quot; + currentLevel[dirIndex]);&#10;}&#10;&#10;function mapLevelToSemitone(level) {&#10;    const semitoneMap = {&#10;        1: 2.0,&#10;        2: 1.0,&#10;        3: 1/2,&#10;        4: 1/6,&#10;        5: 1/8,&#10;        6: 1/12,&#10;        7: 1/15,&#10;        8: 1/20,&#10;        9: 1/50&#10;    };&#10;    return semitoneMap[level] || 0;&#10;}&#10;&#10;function processAnswer(Response) {&#10;    const reactionEndTime = performance.now();&#10;    const reactionTime = reactionEndTime - stimulusEndTime;&#10;    &#10;    logDebug(&quot;User answered: &quot; + (Response === 1 ? &quot;First&quot; : &quot;Second&quot;) + &#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Is replay: &quot; + isReplayTrial);&#10;    &#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    const isCorrect = (Response === CorrectAnswer);&#10;    &#10;    if (!isReplayTrial) {&#10;        const trialInfo = {&#10;            trialNumber: numberOfIterations,&#10;            timestamp: getLocalTimestamp(),&#10;            direction: currentStimDirection === 0 ? &quot;Higher&quot; : &quot;Lower&quot;,&#10;            difficultyLevel: currentLevel[currentStimDirection],&#10;            semitoneValue: mapLevelToSemitone(currentLevel[currentStimDirection]),&#10;            userResponse: Response === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            correctResponse: CorrectAnswer === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            isCorrect: isCorrect,&#10;            reactionTime: reactionTime.toFixed(0),&#10;            isReversal: false,&#10;            stepDirection: Direction[currentStimDirection] === DECREASING ? &quot;Increasing Difficulty&quot; : &quot;Decreasing Difficulty&quot;,&#10;            standardPosition: standardIsFirst ? &quot;First&quot; : &quot;Second&quot;&#10;        };&#10;        &#10;        trialRecords.push(trialInfo);&#10;    }&#10;    &#10;    if (isCorrect) {&#10;        logDebug(&quot;Correct answer&quot;);&#10;        document.getElementById('smile').src = &quot;Media/smiley.png&quot;;&#10;        document.getElementById('text1').value = &quot;正確！&quot;;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses[currentStimDirection]++;&#10;            &#10;            if (CorrectResponses[currentStimDirection] == 2) {&#10;                logDebug(&quot;Two correct answers in a row&quot;);&#10;                CorrectResponses[currentStimDirection] = 0;&#10;                &#10;                if (Direction[currentStimDirection] == INCREASING) {&#10;                    gotReversal(currentStimDirection);&#10;                    if (trialRecords.length &gt; 0) {&#10;                        trialRecords[trialRecords.length-1].isReversal = true;&#10;                    }&#10;                }&#10;                &#10;                changeLevel(DECREASING, currentStimDirection);&#10;            }&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            resetPage();&#10;        }, 1500);&#10;    } else {&#10;        logDebug(&quot;Incorrect answer - will replay stimulus&quot;);&#10;        document.getElementById('smile').src = &quot;Media/nosmiley.png&quot;;&#10;        &#10;        var correctAnswerText = CorrectAnswer === 1 ? &quot;第一個音&quot; : &quot;第二個音&quot;;&#10;        document.getElementById('text1').value = &quot;錯誤！正確答案是：&quot; + correctAnswerText;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses[currentStimDirection] = 0;&#10;            &#10;            if (Direction[currentStimDirection] == DECREASING) {&#10;                gotReversal(currentStimDirection);&#10;                if (trialRecords.length &gt; 0) {&#10;                    trialRecords[trialRecords.length-1].isReversal = true;&#10;                }&#10;            }&#10;            &#10;            changeLevel(INCREASING, currentStimDirection);&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            document.getElementById('text1').value = &quot;重播刺激音...&quot;;&#10;            &#10;            setTimeout(function() {&#10;                isReplayTrial = true;&#10;                &#10;                var xIsStandard = (standardIsFirst &amp;&amp; CorrectAnswer === 1) || &#10;                                  (!standardIsFirst &amp;&amp; CorrectAnswer === 2);&#10;                playABXSequence(xIsStandard);&#10;            }, 1000);&#10;        }, 2000);&#10;    }&#10;}&#10;&#10;function changeLevel(whichWay, dirIndex) {&#10;    var oldLevel = currentLevel[dirIndex];&#10;    var stepSize = NumberOfReversals[dirIndex] &lt; 4 ? 2 : 1;&#10;    &#10;    if (whichWay == DECREASING) {&#10;        currentLevel[dirIndex] = Math.min(9, currentLevel[dirIndex] + stepSize);&#10;    } else {&#10;        currentLevel[dirIndex] = Math.max(LOWERLIMIT, currentLevel[dirIndex] - stepSize);&#10;    }&#10;    &#10;    logDebug(&quot;Difficulty changed from &quot; + oldLevel + &quot; to &quot; + currentLevel[dirIndex] + &#10;             (whichWay == DECREASING ? &quot; (increasing difficulty)&quot; : &quot; (decreasing difficulty)&quot;));&#10;}&#10;&#10;function getThresholdAssessment(value) {&#10;    if (value &lt;= 0.05) return &quot;Exceptional&quot;;&#10;    if (value &lt;= 0.1) return &quot;Excellent&quot;;&#10;    if (value &lt;= 0.25) return &quot;Good&quot;;&#10;    if (value &lt;= 0.5) return &quot;Average&quot;;&#10;    if (value &lt;= 1.0) return &quot;Below Average&quot;;&#10;    return &quot;Needs Improvement&quot;;&#10;}&#10;&#10;function calculateReactionTimeStats() {&#10;    let higherRTs = trialRecords.filter(t =&gt; t.direction === &quot;Higher&quot;).map(t =&gt; parseFloat(t.reactionTime));&#10;    let lowerRTs = trialRecords.filter(t =&gt; t.direction === &quot;Lower&quot;).map(t =&gt; parseFloat(t.reactionTime));&#10;    let allRTs = higherRTs.concat(lowerRTs);&#10;    &#10;    return {&#10;        higher: {&#10;            mean: higherRTs.length ? (higherRTs.reduce((a, b) =&gt; a + b, 0) / higherRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;            median: higherRTs.length ? calculateMedian(higherRTs).toFixed(0) : &quot;N/A&quot;,&#10;            sd: higherRTs.length &gt; 1 ? calculateSD(higherRTs).toFixed(0) : &quot;N/A&quot;&#10;        },&#10;        lower: {&#10;            mean: lowerRTs.length ? (lowerRTs.reduce((a, b) =&gt; a + b, 0) / lowerRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;            median: lowerRTs.length ? calculateMedian(lowerRTs).toFixed(0) : &quot;N/A&quot;,&#10;            sd: lowerRTs.length &gt; 1 ? calculateSD(lowerRTs).toFixed(0) : &quot;N/A&quot;&#10;        },&#10;        overall: {&#10;            mean: allRTs.length ? (allRTs.reduce((a, b) =&gt; a + b, 0) / allRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;            median: allRTs.length ? calculateMedian(allRTs).toFixed(0) : &quot;N/A&quot;,&#10;            sd: allRTs.length &gt; 1 ? calculateSD(allRTs).toFixed(0) : &quot;N/A&quot;&#10;        }&#10;    };&#10;}&#10;&#10;function calculateAccuracyStats() {&#10;    let higherTrials = trialRecords.filter(t =&gt; t.direction === &quot;Higher&quot;);&#10;    let lowerTrials = trialRecords.filter(t =&gt; t.direction === &quot;Lower&quot;);&#10;    let allTrials = trialRecords;&#10;    &#10;    return {&#10;        higher: {&#10;            correct: higherTrials.filter(t =&gt; t.isCorrect).length,&#10;            total: higherTrials.length,&#10;            percentage: higherTrials.length ? &#10;                (higherTrials.filter(t =&gt; t.isCorrect).length / higherTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;        },&#10;        lower: {&#10;            correct: lowerTrials.filter(t =&gt; t.isCorrect).length,&#10;            total: lowerTrials.length,&#10;            percentage: lowerTrials.length ? &#10;                (lowerTrials.filter(t =&gt; t.isCorrect).length / lowerTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;        },&#10;        overall: {&#10;            correct: allTrials.filter(t =&gt; t.isCorrect).length,&#10;            total: allTrials.length,&#10;            percentage: allTrials.length ? &#10;                (allTrials.filter(t =&gt; t.isCorrect).length / allTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;        }&#10;    };&#10;}&#10;&#10;function calculateMedian(values) {&#10;    if (!values.length) return 0;&#10;    &#10;    const sortedValues = values.slice().sort((a, b) =&gt; a - b);&#10;    const mid = Math.floor(sortedValues.length / 2);&#10;    &#10;    return sortedValues.length % 2 === 0 ? &#10;        (sortedValues[mid - 1] + sortedValues[mid]) / 2 : &#10;        sortedValues[mid];&#10;}&#10;&#10;function calculateSD(values) {&#10;    if (values.length &lt;= 1) return 0;&#10;    &#10;    const mean = values.reduce((a, b) =&gt; a + b, 0) / values.length;&#10;    const variance = values.map(x =&gt; Math.pow(x - mean, 2)).reduce((a, b) =&gt; a + b, 0) / (values.length - 1);&#10;    &#10;    return Math.sqrt(variance);&#10;}&#10;&#10;function displayResults() {&#10;    logDebug(&quot;Displaying results&quot;);&#10;    &#10;    let hasHigherData = NumberOfReversals[0] &gt;= MINIMUMREVERSALS;&#10;    let hasLowerData = NumberOfReversals[1] &gt;= MINIMUMREVERSALS;&#10;    &#10;    if (!hasHigherData || !hasLowerData) {&#10;        let message = &quot;Warning: &quot;;&#10;        if (!hasHigherData) message += &quot;Higher direction has insufficient data. &quot;;&#10;        if (!hasLowerData) message += &quot;Lower direction has insufficient data. &quot;;&#10;        message += &quot;Results may not be reliable.&quot;;&#10;        &#10;        if (confirm(message + &quot;\n\nWould you like to retry the experiment?&quot;)) {&#10;            window_onload();&#10;            return;&#10;        }&#10;    }&#10;    &#10;    document.getElementById('experimentContainer').style.display = 'none';&#10;    document.getElementById('resultsContainer').style.display = 'block';&#10;    &#10;    var tableBody = document.getElementById('resultTableBody');&#10;    tableBody.innerHTML = '';&#10;    &#10;    var higherRow = document.createElement('tr');&#10;    higherRow.innerHTML = &#10;        '&lt;td&gt;Higher Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasHigherData ? sentAverage[0].toFixed(4) : 'Insufficient data') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasHigherData ? sentStdev[0].toFixed(4) : '-') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasHigherData ? getThresholdAssessment(sentAverage[0]) : '-') + '&lt;/td&gt;';&#10;    tableBody.appendChild(higherRow);&#10;    &#10;    var lowerRow = document.createElement('tr');&#10;    lowerRow.innerHTML = &#10;        '&lt;td&gt;Lower Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasLowerData ? sentAverage[1].toFixed(4) : 'Insufficient data') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasLowerData ? sentStdev[1].toFixed(4) : '-') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasLowerData ? getThresholdAssessment(sentAverage[1]) : '-') + '&lt;/td&gt;';&#10;    tableBody.appendChild(lowerRow);&#10;    &#10;    if (hasHigherData &amp;&amp; hasLowerData) {&#10;        var avgThreshold = (sentAverage[0] + sentAverage[1]) / 2;&#10;        var combinedVariance = (Math.pow(sentStdev[0], 2) + Math.pow(sentStdev[1], 2)) / 2;&#10;        var combinedSD = Math.sqrt(combinedVariance).toFixed(4);&#10;        &#10;        var avgRow = document.createElement('tr');&#10;        avgRow.style.fontWeight = 'bold';&#10;        avgRow.innerHTML = &#10;            '&lt;td&gt;Average&lt;/td&gt;' +&#10;            '&lt;td&gt;' + avgThreshold.toFixed(4) + '&lt;/td&gt;' +&#10;            '&lt;td&gt;' + combinedSD + '&lt;/td&gt;' +&#10;            '&lt;td&gt;' + getThresholdAssessment(avgThreshold) + '&lt;/td&gt;';&#10;        tableBody.appendChild(avgRow);&#10;    }&#10;    &#10;    var interpretation = document.getElementById('resultInterpretation');&#10;    let interpretationHtml = '&lt;p&gt;&lt;strong&gt;Threshold Interpretation (ABX Task):&lt;/strong&gt;&lt;/p&gt;';&#10;    &#10;    if (hasHigherData &amp;&amp; hasLowerData) {&#10;        const avgThreshold = (sentAverage[0] + sentAverage[1]) / 2;&#10;        interpretationHtml += '&lt;p&gt;Your average pitch discrimination threshold is ' + avgThreshold.toFixed(4) + ' semitones, indicating ' + &#10;            getThresholdAssessment(avgThreshold) + ' pitch discrimination ability.&lt;/p&gt;';&#10;    } else {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Complete results not available due to insufficient data.&lt;/p&gt;';&#10;        &#10;        if (hasHigherData) {&#10;            interpretationHtml += '&lt;p&gt;Your higher direction threshold is ' + sentAverage[0].toFixed(4) + &#10;                ' semitones, indicating ' + getThresholdAssessment(sentAverage[0]) + ' discrimination ability for higher pitches.&lt;/p&gt;';&#10;        }&#10;        &#10;        if (hasLowerData) {&#10;            interpretationHtml += '&lt;p&gt;Your lower direction threshold is ' + sentAverage[1].toFixed(4) + &#10;                ' semitones, indicating ' + getThresholdAssessment(sentAverage[1]) + ' discrimination ability for lower pitches.&lt;/p&gt;';&#10;        }&#10;    }&#10;    &#10;    interpretationHtml += '&lt;p&gt;&lt;strong&gt;Performance Metrics:&lt;/strong&gt;&lt;/p&gt;';&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    const accuracyStats = calculateAccuracyStats();&#10;    &#10;    interpretationHtml += '&lt;p&gt;Your average reaction time was ' + rtStats.overall.mean + &#10;        ' ms, with ' + accuracyStats.overall.percentage + '% overall accuracy.&lt;/p&gt;';&#10;    &#10;    interpretation.innerHTML = interpretationHtml;&#10;    &#10;    var rtTableBody = document.getElementById('rtStatsTableBody');&#10;    rtTableBody.innerHTML = '';&#10;    &#10;    var higherRtRow = document.createElement('tr');&#10;    higherRtRow.innerHTML = &#10;        '&lt;td&gt;Higher Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.higher.mean + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.higher.median + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.higher.sd + '&lt;/td&gt;';&#10;    rtTableBody.appendChild(higherRtRow);&#10;    &#10;    var lowerRtRow = document.createElement('tr');&#10;    lowerRtRow.innerHTML = &#10;        '&lt;td&gt;Lower Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.lower.mean + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.lower.median + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.lower.sd + '&lt;/td&gt;';&#10;    rtTableBody.appendChild(lowerRtRow);&#10;    &#10;    var overallRtRow = document.createElement('tr');&#10;    overallRtRow.style.fontWeight = 'bold';&#10;    overallRtRow.innerHTML = &#10;        '&lt;td&gt;Overall&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.overall.mean + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.overall.median + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.overall.sd + '&lt;/td&gt;';&#10;    rtTableBody.appendChild(overallRtRow);&#10;    &#10;    var accuracyTableBody = document.getElementById('accuracyStatsTableBody');&#10;    accuracyTableBody.innerHTML = '';&#10;    &#10;    var higherAccRow = document.createElement('tr');&#10;    higherAccRow.innerHTML = &#10;        '&lt;td&gt;Higher Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.higher.correct + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.higher.total + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.higher.percentage + '%&lt;/td&gt;';&#10;    accuracyTableBody.appendChild(higherAccRow);&#10;    &#10;    var lowerAccRow = document.createElement('tr');&#10;    lowerAccRow.innerHTML = &#10;        '&lt;td&gt;Lower Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.lower.correct + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.lower.total + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.lower.percentage + '%&lt;/td&gt;';&#10;    accuracyTableBody.appendChild(lowerAccRow);&#10;    &#10;    var overallAccRow = document.createElement('tr');&#10;    overallAccRow.style.fontWeight = 'bold';&#10;    overallAccRow.innerHTML = &#10;        '&lt;td&gt;Overall&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.overall.correct + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.overall.total + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.overall.percentage + '%&lt;/td&gt;';&#10;    accuracyTableBody.appendChild(overallAccRow);&#10;    &#10;    drawResultChart(hasHigherData, hasLowerData);&#10;}&#10;&#10;function drawResultChart(hasHigherData, hasLowerData) {&#10;    var chartContainer = document.getElementById('resultChart');&#10;    &#10;    var chartHTML = '&lt;div style=&quot;display: flex; flex-direction: column; height: 100%;&quot;&gt;';&#10;    chartHTML += '&lt;div style=&quot;text-align: center; margin-bottom: 10px;&quot;&gt;&lt;strong&gt;Threshold Comparison&lt;/strong&gt;&lt;/div&gt;';&#10;    &#10;    chartHTML += '&lt;div style=&quot;display: flex; justify-content: center; margin-bottom: 10px;&quot;&gt;';&#10;    chartHTML += '&lt;span style=&quot;margin-right: 20px;&quot;&gt;&lt;span style=&quot;display: inline-block; width: 15px; height: 15px; background-color: #3498db; margin-right: 5px;&quot;&gt;&lt;/span&gt;Higher Direction&lt;/span&gt;';&#10;    chartHTML += '&lt;span&gt;&lt;span style=&quot;display: inline-block; width: 15px; height: 15px; background-color: #e74c3c; margin-right: 5px;&quot;&gt;&lt;/span&gt;Lower Direction&lt;/span&gt;';&#10;    chartHTML += '&lt;/div&gt;';&#10;    &#10;    chartHTML += '&lt;div style=&quot;flex: 1; display: flex; align-items: flex-end; border-left: 1px solid #333; border-bottom: 1px solid #333; position: relative;&quot;&gt;';&#10;    &#10;    let maxValue = 0.5;&#10;    if (hasHigherData) maxValue = Math.max(maxValue, sentAverage[0]);&#10;    if (hasLowerData) maxValue = Math.max(maxValue, sentAverage[1]);&#10;    &#10;    if (hasHigherData) {&#10;        var higherHeight = (sentAverage[0] / maxValue) * 80;&#10;        chartHTML += '&lt;div style=&quot;width: 40px; height: ' + higherHeight + '%; background-color: #3498db; margin: 0 20px; position: relative;&quot;&gt;';&#10;        chartHTML += '&lt;div style=&quot;position: absolute; top: -20px; width: 100%; text-align: center;&quot;&gt;' + sentAverage[0].toFixed(4) + '&lt;/div&gt;';&#10;        chartHTML += '&lt;/div&gt;';&#10;    } else {&#10;        chartHTML += '&lt;div style=&quot;width: 40px; height: 5%; background-color: #ccc; margin: 0 20px; position: relative;&quot;&gt;';&#10;        chartHTML += '&lt;div style=&quot;position: absolute; top: -20px; width: 100%; text-align: center;&quot;&gt;N/A&lt;/div&gt;';&#10;        chartHTML += '&lt;/div&gt;';&#10;    }&#10;    &#10;    if (hasLowerData) {&#10;        var lowerHeight = (sentAverage[1] / maxValue) * 80;&#10;        chartHTML += '&lt;div style=&quot;width: 40px; height: ' + lowerHeight + '%; background-color: #e74c3c; margin: 0 20px; position: relative;&quot;&gt;';&#10;        chartHTML += '&lt;div style=&quot;position: absolute; top: -20px; width: 100%; text-align: center;&quot;&gt;' + sentAverage[1].toFixed(4) + '&lt;/div&gt;';&#10;        chartHTML += '&lt;/div&gt;';&#10;    } else {&#10;        chartHTML += '&lt;div style=&quot;width: 40px; height: 5%; background-color: #ccc; margin: 0 20px; position: relative;&quot;&gt;';&#10;        chartHTML += '&lt;div style=&quot;position: absolute; top: -20px; width: 100%; text-align: center;&quot;&gt;N/A&lt;/div&gt;';&#10;        chartHTML += '&lt;/div&gt;';&#10;    }&#10;    &#10;    chartHTML += '&lt;div style=&quot;position: absolute; bottom: -25px; left: 20px; width: 40px; text-align: center;&quot;&gt;Higher&lt;/div&gt;';&#10;    chartHTML += '&lt;div style=&quot;position: absolute; bottom: -25px; left: 80px; width: 40px; text-align: center;&quot;&gt;Lower&lt;/div&gt;';&#10;    chartHTML += '&lt;div style=&quot;position: absolute; left: -35px; top: 20%; transform: rotate(-90deg);&quot;&gt;Threshold (semitones)&lt;/div&gt;';&#10;    &#10;    chartHTML += '&lt;/div&gt;';&#10;    chartHTML += '&lt;/div&gt;';&#10;    &#10;    chartContainer.innerHTML = chartHTML;&#10;}&#10;&#10;function backToExperiment() {&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;}&#10;&#10;function view_onclick() {&#10;    logDebug(&quot;View results button clicked&quot;);&#10;    &#10;    for (let i = 0; i &lt; 2; i++) {&#10;        if (!isTestComplete[i] &amp;&amp; NumberOfReversals[i] &gt;= MINIMUMREVERSALS) {&#10;            calculateResults(i);&#10;            isTestComplete[i] = true;&#10;        }&#10;    }&#10;    &#10;    displayResults();&#10;}&#10;&#10;function exportToCSV() {&#10;    const headers = [&#10;        &quot;Trial Number&quot;, &#10;        &quot;Timestamp&quot;, &#10;        &quot;Direction&quot;, &#10;        &quot;Difficulty Level&quot;, &#10;        &quot;Semitone Value&quot;, &#10;        &quot;Standard Position&quot;,&#10;        &quot;User Response&quot;, &#10;        &quot;Correct Response&quot;, &#10;        &quot;Is Correct&quot;, &#10;        &quot;Reaction Time (ms)&quot;, &#10;        &quot;Is Reversal&quot;,&#10;        &quot;Step Direction&quot;&#10;    ];&#10;    &#10;    const csvRows = [];&#10;    csvRows.push(headers.join(&quot;,&quot;));&#10;    &#10;    trialRecords.forEach(function(trial) {&#10;        const row = [&#10;            trial.trialNumber,&#10;            trial.timestamp,&#10;            trial.direction,&#10;            trial.difficultyLevel,&#10;            trial.semitoneValue,&#10;            trial.standardPosition,&#10;            trial.userResponse,&#10;            trial.correctResponse,&#10;            trial.isCorrect ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.reactionTime,&#10;            trial.isReversal ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.stepDirection&#10;        ];&#10;        csvRows.push(row.join(&quot;,&quot;));&#10;    });&#10;    &#10;    csvRows.push(&quot;\nRESULTS SUMMARY&quot;);&#10;    csvRows.push(&quot;\nThreshold Results (semitones)&quot;);&#10;    csvRows.push(&quot;Direction,Threshold,Standard Deviation,Assessment&quot;);&#10;    &#10;    const hasHigherData = NumberOfReversals[0] &gt;= MINIMUMREVERSALS;&#10;    const hasLowerData = NumberOfReversals[1] &gt;= MINIMUMREVERSALS;&#10;    &#10;    csvRows.push(&quot;Higher,&quot; + &#10;        (hasHigherData ? sentAverage[0].toFixed(4) : &quot;Insufficient data&quot;) + &quot;,&quot; + &#10;        (hasHigherData ? sentStdev[0].toFixed(4) : &quot;N/A&quot;) + &quot;,&quot; + &#10;        (hasHigherData ? getThresholdAssessment(sentAverage[0]) : &quot;N/A&quot;));&#10;    &#10;    csvRows.push(&quot;Lower,&quot; + &#10;        (hasLowerData ? sentAverage[1].toFixed(4) : &quot;Insufficient data&quot;) + &quot;,&quot; + &#10;        (hasLowerData ? sentStdev[1].toFixed(4) : &quot;N/A&quot;) + &quot;,&quot; + &#10;        (hasLowerData ? getThresholdAssessment(sentAverage[1]) : &quot;N/A&quot;));&#10;    &#10;    if (hasHigherData &amp;&amp; hasLowerData) {&#10;        const avgThreshold = (sentAverage[0] + sentAverage[1]) / 2;&#10;        const combinedVariance = (Math.pow(sentStdev[0], 2) + Math.pow(sentStdev[1], 2)) / 2;&#10;        const combinedSD = Math.sqrt(combinedVariance).toFixed(4);&#10;        &#10;        csvRows.push(&quot;Average,&quot; + avgThreshold.toFixed(4) + &quot;,&quot; + combinedSD + &quot;,&quot; + getThresholdAssessment(avgThreshold));&#10;    }&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    csvRows.push(&quot;\nReaction Time Statistics (ms)&quot;);&#10;    csvRows.push(&quot;Direction,Mean,Median,Standard Deviation&quot;);&#10;    csvRows.push(&quot;Higher,&quot; + rtStats.higher.mean + &quot;,&quot; + rtStats.higher.median + &quot;,&quot; + rtStats.higher.sd);&#10;    csvRows.push(&quot;Lower,&quot; + rtStats.lower.mean + &quot;,&quot; + rtStats.lower.median + &quot;,&quot; + rtStats.lower.sd);&#10;    csvRows.push(&quot;Overall,&quot; + rtStats.overall.mean + &quot;,&quot; + rtStats.overall.median + &quot;,&quot; + rtStats.overall.sd);&#10;    &#10;    const accuracyStats = calculateAccuracyStats();&#10;    csvRows.push(&quot;\nAccuracy Statistics&quot;);&#10;    csvRows.push(&quot;Direction,Correct Responses,Total Responses,Percentage&quot;);&#10;    csvRows.push(&quot;Higher,&quot; + accuracyStats.higher.correct + &quot;,&quot; + accuracyStats.higher.total + &quot;,&quot; + accuracyStats.higher.percentage + &quot;%&quot;);&#10;    csvRows.push(&quot;Lower,&quot; + accuracyStats.lower.correct + &quot;,&quot; + accuracyStats.lower.total + &quot;,&quot; + accuracyStats.lower.percentage + &quot;%&quot;);&#10;    csvRows.push(&quot;Overall,&quot; + accuracyStats.overall.correct + &quot;,&quot; + accuracyStats.overall.total + &quot;,&quot; + accuracyStats.overall.percentage + &quot;%&quot;);&#10;    &#10;    csvRows.push(&quot;\nExperiment Parameters&quot;);&#10;    csvRows.push(&quot;Paradigm,ABX&quot;);&#10;    csvRows.push(&quot;Max Reversals,&quot; + MAXREVERSALS);&#10;    csvRows.push(&quot;Min Reversals for Calculation,&quot; + MINIMUMREVERSALS);&#10;    csvRows.push(&quot;Max Iterations,&quot; + MAXITERATIONS);&#10;    &#10;    const csvContent = &quot;data:text/csv;charset=utf-8,&quot; + csvRows.join(&quot;\n&quot;);&#10;    const encodedUri = encodeURI(csvContent);&#10;    const link = document.createElement(&quot;a&quot;);&#10;    const timestamp = new Date().toISOString().replace(/[:.]/g, &quot;-&quot;);&#10;    link.setAttribute(&quot;href&quot;, encodedUri);&#10;    link.setAttribute(&quot;download&quot;, &quot;pitch_discrimination_ABX_data_&quot; + timestamp + &quot;.csv&quot;);&#10;    document.body.appendChild(link);&#10;    link.click();&#10;    document.body.removeChild(link);&#10;}&#10;&#10;function window_onload() {&#10;    window.name = &quot;EXP&quot;;&#10;    NumberOfReversals = [0, 0];&#10;    numberOfIterations = 0;&#10;    CorrectResponses = [0, 0];&#10;    Direction = [DECREASING, DECREASING];&#10;    currentLevel = [5, 5];&#10;    isTestComplete = [false, false];&#10;    Reversals = [[], []];&#10;    trialsPerDirection = [0, 0];&#10;    forceDirection = null;&#10;    directionHistory = [];&#10;    trialRecords = [];&#10;    isReplayTrial = false;&#10;&#10;    document.getElementById('text1').value = &quot;準備完畢後請點擊\&quot;開始實驗\&quot;&quot;;&#10;    document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;    document.getElementById('start').disabled = false;&#10;    document.getElementById('viewResult').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;    &#10;    updateProgressBar(0);&#10;    &#10;    logDebug(&quot;Page reset complete&quot;);&#10;}&#10;&#10;window.onload = function() {&#10;    window_onload();&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    logDebug(&quot;Preloading &quot; + allAudios.length + &quot; audio files&quot;);&#10;    &#10;    allAudios.forEach(function(audio) {&#10;        audio.load();&#10;    });&#10;    &#10;    document.getElementById('text1').value = &quot;請點擊\&quot;開始實驗\&quot;&quot;;&#10;    &#10;    window.onerror = function(message, source, lineno, colno, error) {&#10;        logDebug(&quot;Global error: &quot; + message + &quot; at &quot; + source + &quot;:&quot; + lineno);&#10;        return false;&#10;    };&#10;    &#10;    document.getElementById('showDebug').checked = true;&#10;    toggleDebug();&#10;};&#10;&lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
                    <entry key="file:///E:/Projects/Pitch_Training/ABX_rising_high.html" value="&lt;!DOCTYPE html&gt;&#10;&lt;html&gt;&#10;&lt;head&gt;&#10;    &lt;title&gt;PLOYU-Peng's Lab: Pitch Sensitivity Training&lt;/title&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;style&gt;&#10;        body {&#10;            font-family: Arial, sans-serif;&#10;            margin: 20px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .container {&#10;            max-width: 800px;&#10;            margin: 0 auto;&#10;            padding: 20px;&#10;            background-color: white;&#10;            border-radius: 10px;&#10;            box-shadow: 0 0 10px rgba(0,0,0,0.1);&#10;            display: flex;&#10;            flex-direction: column;&#10;            align-items: center;&#10;        }&#10;        .header {&#10;            text-align: center;&#10;            margin-bottom: 40px;&#10;            width: 100%;&#10;        }&#10;        .training-info {&#10;            font-size: 16px;&#10;            color: #555;&#10;            margin-top: 10px;&#10;            margin-bottom: 5px;&#10;            text-align: center;&#10;        }&#10;        .instruction-text {&#10;            font-size: 14px;&#10;            color: #777;&#10;            margin-bottom: 15px;&#10;            text-align: center;&#10;            font-style: italic;&#10;        }&#10;        .button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .prompt-text {&#10;            text-align: center;&#10;            font-size: 20px;&#10;            margin-bottom: 25px;&#10;            margin-top: 30px;&#10;            font-weight: bold;&#10;        }&#10;        .response-button {&#10;            width: 160px;&#10;            height: 160px;&#10;            font-size: 26px;&#10;            margin: 0 40px;&#10;            border-radius: 15px;&#10;            border: none;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.1);&#10;            transition: all 0.3s ease;&#10;        }&#10;        .response-button:hover:enabled {&#10;            transform: translateY(-3px);&#10;            box-shadow: 0 6px 12px rgba(0,0,0,0.15);&#10;        }&#10;        .response-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .button-playing {&#10;            animation: pulse 1s ease-in-out infinite;&#10;            box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            transform: scale(1.05);&#10;        }&#10;        @keyframes pulse {&#10;            0%, 100% {&#10;                box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            }&#10;            50% {&#10;                box-shadow: 0 0 30px rgba(102, 204, 255, 1);&#10;            }&#10;        }&#10;        .control-button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            gap: 30px;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .control-button {&#10;            padding: 14px 28px;&#10;            font-size: 18px;&#10;            border-radius: 8px;&#10;            border: none;&#10;            background-color: #4CAF50;&#10;            color: white;&#10;            cursor: pointer;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .control-button:hover:enabled {&#10;            background-color: #3e8e41;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .control-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .control-button:disabled {&#10;            background-color: #cccccc;&#10;            cursor: not-allowed;&#10;            box-shadow: none;&#10;        }&#10;        .feedback {&#10;            text-align: center;&#10;            height: 100px;&#10;            margin: 30px 0;&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;        }&#10;        .status {&#10;            width: 350px;&#10;            height: 68px;&#10;            text-align: center;&#10;            font-size: 18px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            margin: 0 auto;&#10;            padding: 10px;&#10;            background-color: #f9f9f9;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.05);&#10;        }&#10;        .debug-info {&#10;            font-size: 12px;&#10;            color: #777;&#10;            margin-top: 30px;&#10;            text-align: left;&#10;            display: none;&#10;            max-height: 300px;&#10;            overflow-y: auto;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            padding: 15px;&#10;            width: 100%;&#10;        }&#10;        .results-container {&#10;            display: none;&#10;            margin-top: 30px;&#10;            padding: 20px;&#10;            background-color: #f0f8ff;&#10;            border-radius: 8px;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.1);&#10;            width: 100%;&#10;        }&#10;        .result-heading {&#10;            text-align: center;&#10;            margin-bottom: 20px;&#10;            color: #2c3e50;&#10;        }&#10;        .result-table {&#10;            width: 100%;&#10;            border-collapse: collapse;&#10;            margin-bottom: 20px;&#10;        }&#10;        .result-table th, .result-table td {&#10;            padding: 12px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .result-table th {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .result-table tr:nth-child(even) {&#10;            background-color: #f2f2f2;&#10;        }&#10;        .result-interpretation {&#10;            background-color: #e8f4f8;&#10;            padding: 15px;&#10;            border-radius: 5px;&#10;            margin-bottom: 20px;&#10;        }&#10;        .back-button {&#10;            display: block;&#10;            margin: 0 auto;&#10;            padding: 14px 28px;&#10;            background-color: #3498db;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .back-button:hover {&#10;            background-color: #2980b9;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .back-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        .chart-container {&#10;            height: 300px;&#10;            margin: 20px 0;&#10;            background-color: white;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;            padding: 10px;&#10;        }&#10;        .auxiliary-buttons {&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            margin-top: 30px;&#10;            gap: 20px;&#10;            flex-wrap: wrap;&#10;        }&#10;        .auxiliary-buttons button {&#10;            padding: 10px 15px;&#10;            border-radius: 5px;&#10;            border: 1px solid #ddd;&#10;            background-color: #f0f0f0;&#10;            cursor: pointer;&#10;            transition: all 0.2s ease;&#10;        }&#10;        .auxiliary-buttons button:hover {&#10;            background-color: #e0e0e0;&#10;        }&#10;        .diagnostic-overlay {&#10;            position: fixed;&#10;            top: 0;&#10;            left: 0;&#10;            width: 100%;&#10;            height: 100%;&#10;            background-color: rgba(0, 0, 0, 0.8);&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            z-index: 1000;&#10;            display: none;&#10;        }&#10;        .diagnostic-content {&#10;            width: 80%;&#10;            max-width: 700px;&#10;            max-height: 80%;&#10;            overflow-y: auto;&#10;            background-color: white;&#10;            padding: 20px;&#10;            border-radius: 8px;&#10;            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);&#10;        }&#10;        .diagnostic-heading {&#10;            text-align: center;&#10;            color: #e74c3c;&#10;            margin-bottom: 20px;&#10;            font-size: 24px;&#10;        }&#10;        .diagnostic-close {&#10;            float: right;&#10;            font-size: 20px;&#10;            cursor: pointer;&#10;            color: #777;&#10;        }&#10;        .diagnostic-close:hover {&#10;            color: #333;&#10;        }&#10;        .diagnostic-section {&#10;            margin-bottom: 15px;&#10;            padding: 10px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;        }&#10;        .diagnostic-actions {&#10;            text-align: center;&#10;            margin-top: 20px;&#10;        }&#10;        .diagnostic-action-button {&#10;            padding: 10px 20px;&#10;            margin: 0 10px;&#10;            border: none;&#10;            border-radius: 5px;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;        }&#10;        .retry-button {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .retry-button:hover {&#10;            background-color: #2980b9;&#10;        }&#10;        .continue-button {&#10;            background-color: #2ecc71;&#10;            color: white;&#10;        }&#10;        .continue-button:hover {&#10;            background-color: #27ae60;&#10;        }&#10;        .diagnostic-file-status {&#10;            display: flex;&#10;            flex-wrap: wrap;&#10;            gap: 10px;&#10;        }&#10;        .file-status-item {&#10;            font-size: 12px;&#10;            padding: 5px 10px;&#10;            border-radius: 3px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .file-found {&#10;            color: #27ae60;&#10;            border-left: 3px solid #27ae60;&#10;        }&#10;        .file-missing {&#10;            color: #e74c3c;&#10;            border-left: 3px solid #e74c3c;&#10;        }&#10;        .statistics-table {&#10;            width: 100%;&#10;            margin: 10px 0;&#10;            border-collapse: collapse;&#10;        }&#10;        .statistics-table th, .statistics-table td {&#10;            padding: 8px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .statistics-table th {&#10;            background-color: #f0f0f0;&#10;        }&#10;        .direction-stats-good {&#10;            color: #27ae60;&#10;        }&#10;        .direction-stats-warning {&#10;            color: #f39c12;&#10;        }&#10;        .direction-stats-bad {&#10;            color: #e74c3c;&#10;        }&#10;        @media (max-width: 600px) {&#10;            .response-button {&#10;                width: 130px;&#10;                height: 130px;&#10;                font-size: 22px;&#10;                margin: 0 20px;&#10;            }&#10;            .control-button {&#10;                padding: 12px 20px;&#10;            }&#10;        }&#10;        .print-button {&#10;            padding: 14px 28px;&#10;            margin: 20px auto;&#10;            background-color: #9b59b6;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;            display: block;&#10;        }&#10;        .print-button:hover {&#10;            background-color: #8e44ad;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .print-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        @media print {&#10;            body {&#10;                background-color: white;&#10;                margin: 0;&#10;                padding: 0;&#10;            }&#10;            .container {&#10;                max-width: 100%;&#10;                box-shadow: none;&#10;                padding: 10px;&#10;            }&#10;            .back-button, .print-button, .auxiliary-buttons {&#10;                display: none;&#10;            }&#10;            .results-container {&#10;                display: block !important;&#10;                box-shadow: none;&#10;                background-color: white;&#10;                padding: 0;&#10;            }&#10;            .chart-container {&#10;                border: 1px solid #ddd;&#10;                background-color: white;&#10;            }&#10;            .result-table th {&#10;                background-color: #f0f0f0 !important;&#10;                color: black !important;&#10;            }&#10;            .result-interpretation {&#10;                background-color: white;&#10;                border: 1px solid #ddd;&#10;            }&#10;            * {&#10;                -webkit-print-color-adjust: exact !important;&#10;                print-color-adjust: exact !important;&#10;            }&#10;        }&#10;        .progress-bar-container {&#10;            width: 100%;&#10;            height: 20px;&#10;            background-color: #e0e0e0;&#10;            border-radius: 10px;&#10;            margin: 10px 0;&#10;            overflow: hidden;&#10;        }&#10;        .progress-bar {&#10;            height: 100%;&#10;            background-color: #4CAF50;&#10;            border-radius: 10px;&#10;            transition: width 0.3s ease;&#10;        }&#10;        .progress-label {&#10;            text-align: center;&#10;            font-size: 14px;&#10;            color: #555;&#10;            margin-top: 5px;&#10;        }&#10;        .highlight-box {&#10;            background-color: #fffacd;&#10;            border: 2px solid #ffd700;&#10;            padding: 15px;&#10;            border-radius: 8px;&#10;            margin: 20px 0;&#10;            text-align: center;&#10;        }&#10;        .highlight-value {&#10;            font-size: 28px;&#10;            font-weight: bold;&#10;            color: #e74c3c;&#10;            margin: 10px 0;&#10;        }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;div class=&quot;container&quot;&gt;&#10;        &lt;div class=&quot;header&quot;&gt;&#10;            &lt;img src=&quot;Media/animation.gif&quot; alt=&quot;Experiment animation&quot;&gt;&#10;            &lt;div class=&quot;training-info&quot;&gt;High Rising Tone Discrimination (ABX)&lt;/div&gt;&#10;            &lt;div class=&quot;instruction-text&quot;&gt;請判斷第三個音聽起來更像第一個還是第二個音&lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div id=&quot;experimentContainer&quot;&gt;&#10;            &lt;div class=&quot;control-button-container&quot;&gt;&#10;                &lt;input id=&quot;start&quot; type=&quot;button&quot; value=&quot;開始實驗&quot; onclick=&quot;start_onclick()&quot; class=&quot;control-button&quot;&gt;&#10;                &lt;input id=&quot;viewResult&quot; type=&quot;button&quot; value=&quot;查看結果&quot; onclick=&quot;view_onclick()&quot; class=&quot;control-button&quot; disabled&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;prompt-text&quot; id=&quot;promptText&quot;&gt;&#10;                第三個音更像...&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;firstBtn&quot; type=&quot;button&quot; value=&quot;第一個音&quot; onclick=&quot;processAnswer(1)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;                &lt;input id=&quot;secondBtn&quot; type=&quot;button&quot; value=&quot;第二個音&quot; onclick=&quot;processAnswer(2)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;feedback&quot;&gt;&#10;                &lt;img id=&quot;smile&quot; src=&quot;Media/null.gif&quot; width=&quot;100&quot; height=&quot;84&quot; alt=&quot;Feedback&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;text1&quot; class=&quot;status&quot; readonly&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;progress-bar-container&quot;&gt;&#10;                &lt;div class=&quot;progress-bar&quot; id=&quot;progressBar&quot; style=&quot;width: 0%&quot;&gt;&lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;progress-label&quot; id=&quot;progressLabel&quot;&gt;Progress: 0%&lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;debug-info&quot; id=&quot;debugInfo&quot;&gt;&#10;                Debug information will be displayed here&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot;&gt;&#10;                &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;showDebug&quot; onclick=&quot;toggleDebug()&quot;&gt; Show Debug Info&lt;/label&gt;&#10;                &lt;button onclick=&quot;testAudio()&quot;&gt;Test All Audio&lt;/button&gt;&#10;                &lt;button onclick=&quot;showDiagnostics()&quot;&gt;Diagnostics&lt;/button&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot; id=&quot;exportBtn&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div id=&quot;resultsContainer&quot; class=&quot;results-container&quot;&gt;&#10;            &lt;h2 class=&quot;result-heading&quot;&gt;Dynamic Pitch Discrimination Test Results (ABX)&lt;/h2&gt;&#10;            &#10;            &lt;div class=&quot;highlight-box&quot;&gt;&#10;                &lt;h3 style=&quot;margin-top: 0;&quot;&gt;Just Noticeable Difference (JND)&lt;/h3&gt;&#10;                &lt;div class=&quot;highlight-value&quot; id=&quot;jndValue&quot;&gt;--&lt;/div&gt;&#10;                &lt;p style=&quot;margin-bottom: 0; font-size: 14px; color: #666;&quot;&gt;&#10;                    This represents the minimum detectable difference in modulation window duration&lt;br&gt;&#10;                    &lt;strong&gt;Smaller JND = Better discrimination ability&lt;/strong&gt;&#10;                &lt;/p&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Perceptual Discrimination Thresholds&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Parameter&lt;/th&gt;&#10;                        &lt;th&gt;Standard (Reference)&lt;/th&gt;&#10;                        &lt;th&gt;Threshold (Your JND)&lt;/th&gt;&#10;                        &lt;th&gt;Difference Ratio&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;resultTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;div class=&quot;result-interpretation&quot; id=&quot;resultInterpretation&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Detailed Threshold Metrics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Metric&lt;/th&gt;&#10;                        &lt;th&gt;Value&lt;/th&gt;&#10;                        &lt;th&gt;Interpretation&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;detailedMetricsBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;h3&gt;Performance Statistics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Metric&lt;/th&gt;&#10;                        &lt;th&gt;Value&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;performanceStatsBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;button class=&quot;print-button&quot; onclick=&quot;printResults()&quot;&gt;Print Results&lt;/button&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot; style=&quot;margin-top: 20px;&quot;&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;button class=&quot;back-button&quot; onclick=&quot;backToExperiment()&quot;&gt;Back to Experiment&lt;/button&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div class=&quot;diagnostic-overlay&quot; id=&quot;diagnosticOverlay&quot;&gt;&#10;            &lt;div class=&quot;diagnostic-content&quot;&gt;&#10;                &lt;span class=&quot;diagnostic-close&quot; onclick=&quot;closeDiagnostics()&quot;&gt;&amp;times;&lt;/span&gt;&#10;                &lt;h2 class=&quot;diagnostic-heading&quot;&gt;Experiment Diagnostics&lt;/h2&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Test Status&lt;/h3&gt;&#10;                    &lt;table class=&quot;statistics-table&quot;&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;th&gt;Trials&lt;/th&gt;&#10;                            &lt;th&gt;Reversals&lt;/th&gt;&#10;                            &lt;th&gt;Status&lt;/th&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td id=&quot;totalTrials&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;totalReversals&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;testStatus&quot;&gt;Not started&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                    &lt;/table&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Audio Files Check&lt;/h3&gt;&#10;                    &lt;p&gt;Verifying necessary audio files:&lt;/p&gt;&#10;                    &lt;div id=&quot;audioFileStatus&quot; class=&quot;diagnostic-file-status&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Reversal History&lt;/h3&gt;&#10;                    &lt;div id=&quot;reversalHistory&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Recommendations&lt;/h3&gt;&#10;                    &lt;div id=&quot;diagnosticRecommendations&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-actions&quot;&gt;&#10;                    &lt;button class=&quot;diagnostic-action-button continue-button&quot; onclick=&quot;closeDiagnostics()&quot;&gt;Close&lt;/button&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;audio id=&quot;high_rising_standard&quot; src=&quot;Media/high_rising_standard.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;    &lt;audio id=&quot;high_rising_1&quot; src=&quot;Media/high_rising_1.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_rising_2&quot; src=&quot;Media/high_rising_2.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_rising_3&quot; src=&quot;Media/high_rising_3.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_rising_4&quot; src=&quot;Media/high_rising_4.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_rising_5&quot; src=&quot;Media/high_rising_5.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_rising_6&quot; src=&quot;Media/high_rising_6.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_rising_7&quot; src=&quot;Media/high_rising_7.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_rising_8&quot; src=&quot;Media/high_rising_8.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_rising_9&quot; src=&quot;Media/high_rising_9.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;&lt;script&gt;&#10;function getLocalTimestamp() {&#10;    const now = new Date();&#10;    const year = now.getFullYear();&#10;    const month = String(now.getMonth() + 1).padStart(2, '0');&#10;    const day = String(now.getDate()).padStart(2, '0');&#10;    const hours = String(now.getHours()).padStart(2, '0');&#10;    const minutes = String(now.getMinutes()).padStart(2, '0');&#10;    const seconds = String(now.getSeconds()).padStart(2, '0');&#10;    const milliseconds = String(now.getMilliseconds()).padStart(3, '0');&#10;    &#10;    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;&#10;}&#10;&#10;// Stimulus parameters for dynamic pitch modulation&#10;const STIMULUS_DURATION = 450; // ms, total duration&#10;const STANDARD_WINDOW = 400; // ms, modulation window for standard (100%)&#10;const STANDARD_WINDOW_PERCENT = 100; // percentage&#10;&#10;// Modulation window percentages for each difficulty level&#10;const MODULATION_WINDOWS = {&#10;    1: 20,   // easiest - 20% of standard window (80 ms)&#10;    2: 40,   // 160 ms&#10;    3: 50,   // 200 ms&#10;    4: 60,   // 240 ms&#10;    5: 70,   // 280 ms&#10;    6: 80,   // 320 ms&#10;    7: 90,   // 360 ms&#10;    8: 95,   // 380 ms&#10;    9: 98    // hardest - 98% of standard window (392 ms)&#10;};&#10;&#10;function getModulationWindowDuration(level) {&#10;    return (MODULATION_WINDOWS[level] / 100) * STANDARD_WINDOW;&#10;}&#10;&#10;const PITCH_RISE_SEMITONES = 1.0;&#10;&#10;function getModulationRate(level) {&#10;    const windowDuration = getModulationWindowDuration(level);&#10;    const windowDurationSec = windowDuration / 1000;&#10;    return PITCH_RISE_SEMITONES / windowDurationSec;&#10;}&#10;&#10;function getModulationSlope(level) {&#10;    const windowDuration = getModulationWindowDuration(level);&#10;    return PITCH_RISE_SEMITONES / windowDuration;&#10;}&#10;&#10;// Adaptive threshold experiment constants&#10;const MAXREVERSALS = 10;&#10;const MAXITERATIONS = 50;&#10;const LOWERLIMIT = 1;&#10;const DECREASING = -1;&#10;const INCREASING = 1;&#10;const MINIMUMREVERSALS = 6;&#10;const THRESHOLD_REVERSAL_COUNT = 6;&#10;&#10;// Experiment state variables&#10;var CorrectAnswer;&#10;var CorrectResponses = 0;&#10;var Direction = DECREASING;&#10;var Reversals = [];&#10;var NumberOfReversals = 0;&#10;var currentLevel = 5;&#10;var numberOfIterations = 0;&#10;var sentAverage = 0.0;&#10;var sentStdev = 0.0;&#10;var isTestComplete = false;&#10;var audioUnlocked = false;&#10;var allFilesPresent = true;&#10;var trialRecords = [];&#10;var stimulusEndTime = 0;&#10;&#10;// ABX variables&#10;var standardIsFirst;&#10;var comparisonSound;&#10;var standardSound;&#10;var xSound;&#10;&#10;var isReplayTrial = false;&#10;&#10;// Results variables - JND-based&#10;var jndAbsoluteDifference = 0;&#10;var jndRatio = 0;&#10;var jndPercentDifference = 0;&#10;var thresholdWindowDuration = 0;&#10;var thresholdWindowPercent = 0;&#10;var thresholdModulationRate = 0;&#10;var thresholdSlope = 0;&#10;var webersRatio = 0;&#10;&#10;function printResults() {&#10;    window.print();&#10;}&#10;&#10;function logDebug(message) {&#10;    console.log(message);&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var now = new Date();&#10;    var timeStr = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + '.' + now.getMilliseconds();&#10;    debugArea.innerHTML += '&lt;p&gt;[' + timeStr + '] ' + message + '&lt;/p&gt;';&#10;    debugArea.scrollTop = debugArea.scrollHeight;&#10;}&#10;&#10;function toggleDebug() {&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var checkbox = document.getElementById('showDebug');&#10;    debugArea.style.display = checkbox.checked ? 'block' : 'none';&#10;}&#10;&#10;function showDiagnostics() {&#10;    updateDiagnostics();&#10;    document.getElementById('diagnosticOverlay').style.display = 'flex';&#10;}&#10;&#10;function closeDiagnostics() {&#10;    document.getElementById('diagnosticOverlay').style.display = 'none';&#10;}&#10;&#10;function updateDiagnostics() {&#10;    document.getElementById('totalTrials').innerText = numberOfIterations;&#10;    document.getElementById('totalReversals').innerText = NumberOfReversals;&#10;    &#10;    let testStatus = getTestStatus();&#10;    document.getElementById('testStatus').innerText = testStatus.text;&#10;    document.getElementById('testStatus').className = `direction-stats-${testStatus.class}`;&#10;    &#10;    checkAudioFiles();&#10;    &#10;    let reversalHistoryHtml = '';&#10;    if (Reversals.length === 0) {&#10;        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';&#10;    } else {&#10;        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals.join(', ') + '&lt;/p&gt;';&#10;        reversalHistoryHtml += '&lt;p&gt;Corresponding modulation windows: ';&#10;        reversalHistoryHtml += Reversals.map(level =&gt; MODULATION_WINDOWS[level] + '% (' + getModulationWindowDuration(level) + ' ms)').join(', ') + '&lt;/p&gt;';&#10;    }&#10;    &#10;    document.getElementById('reversalHistory').innerHTML = reversalHistoryHtml;&#10;    &#10;    generateDiagnosticRecommendations();&#10;}&#10;&#10;function getTestStatus() {&#10;    if (isTestComplete) {&#10;        return { text: &quot;Complete&quot;, class: &quot;good&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals &lt; 1) {&#10;        return { text: &quot;Not enough data&quot;, class: &quot;bad&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals &lt; MINIMUMREVERSALS) {&#10;        return { text: &quot;Incomplete (&quot; + NumberOfReversals + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals)&quot;, class: &quot;warning&quot; };&#10;    }&#10;    &#10;    return { text: &quot;In progress&quot;, class: &quot;good&quot; };&#10;}&#10;&#10;function checkAudioFiles() {&#10;    const requiredFiles = [&#10;        &quot;high_rising_standard&quot;,&#10;        &quot;high_rising_1&quot;, &quot;high_rising_2&quot;, &quot;high_rising_3&quot;, &quot;high_rising_4&quot;, &quot;high_rising_5&quot;, &#10;        &quot;high_rising_6&quot;, &quot;high_rising_7&quot;, &quot;high_rising_8&quot;, &quot;high_rising_9&quot;&#10;    ];&#10;    &#10;    let statusHtml = '';&#10;    allFilesPresent = true;&#10;    &#10;    requiredFiles.forEach(function(fileId) {&#10;        const audioElement = document.getElementById(fileId);&#10;        const fileFound = audioElement !== null;&#10;        &#10;        if (!fileFound) {&#10;            allFilesPresent = false;&#10;        }&#10;        &#10;        statusHtml += `&lt;div class=&quot;file-status-item ${fileFound ? 'file-found' : 'file-missing'}&quot;&gt;${fileId}: ${fileFound ? 'Found' : 'Missing'}&lt;/div&gt;`;&#10;    });&#10;    &#10;    document.getElementById('audioFileStatus').innerHTML = statusHtml;&#10;}&#10;&#10;function generateDiagnosticRecommendations() {&#10;    let recommendations = '';&#10;    let hasIssues = false;&#10;    &#10;    if (!allFilesPresent) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Critical Issue:&lt;/strong&gt; Some required audio files are missing. Please ensure all files are properly loaded.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (numberOfIterations &gt;= MAXITERATIONS &amp;&amp; NumberOfReversals &lt; MINIMUMREVERSALS) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Issue:&lt;/strong&gt; Reached maximum trials but has insufficient reversals. This might indicate audio file issues or participant response patterns.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (!hasIssues) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Good:&lt;/strong&gt; No major issues detected with the experiment setup.&lt;/p&gt;';&#10;        &#10;        if (isTestComplete) {&#10;            recommendations += '&lt;p&gt;Test is complete.&lt;/p&gt;';&#10;        } else {&#10;            recommendations += '&lt;p&gt;Test is still in progress.&lt;/p&gt;';&#10;        }&#10;    }&#10;    &#10;    document.getElementById('diagnosticRecommendations').innerHTML = recommendations;&#10;}&#10;&#10;function testAudio() {&#10;    logDebug(&quot;Starting to test all audio files...&quot;);&#10;    var audios = document.querySelectorAll('audio');&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    var index = 0;&#10;    function playNext() {&#10;        if (index &gt;= audios.length) {&#10;            logDebug(&quot;All audio testing complete!&quot;);&#10;            return;&#10;        }&#10;        &#10;        var audio = audios[index];&#10;        logDebug(&quot;Testing audio #&quot; + (index + 1) + &quot;: &quot; + audio.id);&#10;        &#10;        audio.currentTime = 0;&#10;        &#10;        var playPromise = audio.play();&#10;        if (playPromise !== undefined) {&#10;            playPromise.then(function() {&#10;                logDebug(audio.id + &quot; played successfully&quot;);&#10;                &#10;                audio.onended = function() {&#10;                    logDebug(audio.id + &quot; playback ended&quot;);&#10;                    index++;&#10;                    setTimeout(playNext, 500);&#10;                };&#10;            }).catch(function(error) {&#10;                logDebug(&quot;Failed to play &quot; + audio.id + &quot;: &quot; + error);&#10;                index++;&#10;                setTimeout(playNext, 500);&#10;            });&#10;        }&#10;    }&#10;    &#10;    playNext();&#10;}&#10;&#10;function unlockAudioContext() {&#10;    logDebug(&quot;Attempting to unlock audio context...&quot;);&#10;    &#10;    var silentAudio = new Audio();&#10;    silentAudio.src = &quot;data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA&quot;;&#10;    &#10;    var promise = silentAudio.play();&#10;    if (promise !== undefined) {&#10;        promise.then(function() {&#10;            logDebug(&quot;Audio context unlocked successfully&quot;);&#10;            silentAudio.remove();&#10;            audioUnlocked = true;&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to unlock audio context: &quot; + error);&#10;        });&#10;    }&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    for (var i = 0; i &lt; allAudios.length; i++) {&#10;        var audio = allAudios[i];&#10;        audio.load();&#10;    }&#10;    &#10;    logDebug(&quot;Preloaded &quot; + allAudios.length + &quot; audio files&quot;);&#10;}&#10;&#10;function resetPage() {&#10;    numberOfIterations++;&#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('firstBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('secondBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    if (isTestComplete) {&#10;        document.getElementById('start').disabled = false;&#10;        document.getElementById('viewResult').disabled = false;&#10;        document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;        updateProgressBar(100);&#10;        return;&#10;    }&#10;    &#10;    if ((numberOfIterations &gt;= MAXITERATIONS) || (NumberOfReversals &gt;= MAXREVERSALS)) {&#10;        if (NumberOfReversals &gt;= MINIMUMREVERSALS) {&#10;            calculateResults();&#10;            isTestComplete = true;&#10;            document.getElementById('start').disabled = false;&#10;            document.getElementById('viewResult').disabled = false;&#10;            document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;            updateProgressBar(100);&#10;        } else {&#10;            logDebug(&quot;Reached max iterations but has only &quot; + NumberOfReversals + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals. Showing diagnostics.&quot;);&#10;            document.getElementById('text1').value = &quot;Insufficient data. Check diagnostics.&quot;;&#10;            setTimeout(function() {&#10;                showDiagnostics();&#10;            }, 500);&#10;            return;&#10;        }&#10;    } else {&#10;        updateProgressBar();&#10;        beginIteration();&#10;    }&#10;}&#10;&#10;function updateProgressBar(forcePercent) {&#10;    if (typeof forcePercent === 'number') {&#10;        document.getElementById('progressBar').style.width = forcePercent + '%';&#10;        document.getElementById('progressLabel').textContent = 'Progress: ' + forcePercent + '%';&#10;        return;&#10;    }&#10;    &#10;    const maxValue = Math.max(MAXREVERSALS, MAXITERATIONS);&#10;    const currentValue = isTestComplete ? maxValue : Math.max(NumberOfReversals, numberOfIterations);&#10;    const totalPercent = Math.min(100 * (currentValue / maxValue), 100);&#10;    &#10;    document.getElementById('progressBar').style.width = totalPercent + '%';&#10;    document.getElementById('progressLabel').textContent = 'Progress: ' + Math.round(totalPercent) + '%';&#10;}&#10;&#10;function calculateResults() {&#10;    let sum = 0.0, stddevsum = 0.0, average = 0.0, stdev = 0.0, counter = 0;&#10;    &#10;    for (let i = 0; i &lt; Reversals.length; i++) {&#10;        if (Reversals[i] &gt; 0) counter++;&#10;    }&#10;    &#10;    if (counter &lt; MINIMUMREVERSALS) {&#10;        logDebug(&quot;Test has insufficient data&quot;);&#10;        alert(&quot;Test has insufficient data. Please complete the test again.&quot;);&#10;        return;&#10;    }&#10;    &#10;    const startIndex = Math.max(0, NumberOfReversals - THRESHOLD_REVERSAL_COUNT);&#10;    counter = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0) {&#10;            sum += level;&#10;            counter++;&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 0) {&#10;        average = sum / counter;&#10;        average = parseFloat(average.toFixed(2));&#10;    }&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0) {&#10;            stddevsum += Math.pow(level - average, 2);&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 1) {&#10;        stdev = Math.sqrt(stddevsum / (counter - 1));&#10;        stdev = parseFloat(stdev.toFixed(2));&#10;    }&#10;    &#10;    sentAverage = average;&#10;    sentStdev = stdev;&#10;    &#10;    thresholdWindowPercent = calculateAverageWindowPercent(startIndex);&#10;    thresholdWindowDuration = (thresholdWindowPercent / 100) * STANDARD_WINDOW;&#10;    thresholdModulationRate = PITCH_RISE_SEMITONES / (thresholdWindowDuration / 1000);&#10;    thresholdSlope = PITCH_RISE_SEMITONES / thresholdWindowDuration;&#10;    &#10;    jndAbsoluteDifference = STANDARD_WINDOW - thresholdWindowDuration;&#10;    jndRatio = thresholdWindowDuration / STANDARD_WINDOW;&#10;    jndPercentDifference = 100 - thresholdWindowPercent;&#10;    webersRatio = jndAbsoluteDifference / STANDARD_WINDOW;&#10;    &#10;    logDebug(&quot;Test complete! Average difficulty level: &quot; + average.toFixed(2));&#10;    logDebug(&quot;Threshold window: &quot; + thresholdWindowPercent.toFixed(2) + &quot;% (&quot; + thresholdWindowDuration.toFixed(2) + &quot; ms)&quot;);&#10;    logDebug(&quot;JND Absolute Difference: &quot; + jndAbsoluteDifference.toFixed(2) + &quot; ms&quot;);&#10;    logDebug(&quot;JND Ratio: &quot; + jndRatio.toFixed(4));&#10;    logDebug(&quot;JND Percent Difference: &quot; + jndPercentDifference.toFixed(2) + &quot;%&quot;);&#10;    logDebug(&quot;Weber's Ratio: &quot; + webersRatio.toFixed(4));&#10;    &#10;    document.getElementById('text1').value = &quot;Test complete! JND: &quot; + jndAbsoluteDifference.toFixed(1) + &quot; ms&quot;;&#10;}&#10;&#10;function calculateAverageWindowPercent(startIndex) {&#10;    let sum = 0;&#10;    let count = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0 &amp;&amp; MODULATION_WINDOWS[level] !== undefined) {&#10;            sum += MODULATION_WINDOWS[level];&#10;            count++;&#10;        }&#10;    }&#10;    &#10;    return count &gt; 0 ? sum / count : 0;&#10;}&#10;&#10;function calculateReactionTimeStats() {&#10;    let allRTs = trialRecords.map(t =&gt; parseFloat(t.reactionTime));&#10;    &#10;    return {&#10;        mean: allRTs.length ? (allRTs.reduce((a, b) =&gt; a + b, 0) / allRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;        median: allRTs.length ? calculateMedian(allRTs).toFixed(0) : &quot;N/A&quot;,&#10;        sd: allRTs.length &gt; 1 ? calculateSD(allRTs).toFixed(0) : &quot;N/A&quot;&#10;    };&#10;}&#10;&#10;function calculateAccuracyStats() {&#10;    let allTrials = trialRecords;&#10;    &#10;    return {&#10;        correct: allTrials.filter(t =&gt; t.isCorrect).length,&#10;        total: allTrials.length,&#10;        percentage: allTrials.length ? &#10;            (allTrials.filter(t =&gt; t.isCorrect).length / allTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;    };&#10;}&#10;&#10;function calculateMedian(values) {&#10;    if (!values.length) return 0;&#10;    &#10;    const sortedValues = values.slice().sort((a, b) =&gt; a - b);&#10;    const mid = Math.floor(sortedValues.length / 2);&#10;    &#10;    return sortedValues.length % 2 === 0 ? &#10;        (sortedValues[mid - 1] + sortedValues[mid]) / 2 : &#10;        sortedValues[mid];&#10;}&#10;&#10;function calculateSD(values) {&#10;    if (values.length &lt;= 1) return 0;&#10;    &#10;    const mean = values.reduce((a, b) =&gt; a + b, 0) / values.length;&#10;    const variance = values.map(x =&gt; Math.pow(x - mean, 2)).reduce((a, b) =&gt; a + b, 0) / (values.length - 1);&#10;    &#10;    return Math.sqrt(variance);&#10;}&#10;&#10;function displayResults() {&#10;    logDebug(&quot;Displaying results&quot;);&#10;    &#10;    let hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;&#10;    &#10;    if (!hasData) {&#10;        let message = &quot;Warning: Insufficient data. Results may not be reliable.&quot;;&#10;        &#10;        if (confirm(message + &quot;\n\nWould you like to retry the experiment?&quot;)) {&#10;            window_onload();&#10;            return;&#10;        }&#10;    }&#10;    &#10;    document.getElementById('experimentContainer').style.display = 'none';&#10;    document.getElementById('resultsContainer').style.display = 'block';&#10;    &#10;    if (hasData) {&#10;        document.getElementById('jndValue').innerHTML = &#10;            jndAbsoluteDifference.toFixed(2) + ' ms&lt;br&gt;' +&#10;            '&lt;span style=&quot;font-size: 18px;&quot;&gt;(' + jndPercentDifference.toFixed(2) + '% difference from standard)&lt;/span&gt;';&#10;    } else {&#10;        document.getElementById('jndValue').textContent = 'Insufficient Data';&#10;    }&#10;    &#10;    var tableBody = document.getElementById('resultTableBody');&#10;    tableBody.innerHTML = '';&#10;    &#10;    var windowRow = document.createElement('tr');&#10;    windowRow.innerHTML = &#10;        '&lt;td&gt;Modulation Window Duration&lt;/td&gt;' +&#10;        '&lt;td&gt;' + STANDARD_WINDOW + ' ms (100%)&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? thresholdWindowDuration.toFixed(2) + ' ms (' + thresholdWindowPercent.toFixed(2) + '%)' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? jndRatio.toFixed(4) + ' : 1&lt;br&gt;(Threshold/Standard)' : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(windowRow);&#10;    &#10;    var diffRow = document.createElement('tr');&#10;    diffRow.innerHTML = &#10;        '&lt;td&gt;Absolute Difference (JND)&lt;/td&gt;' +&#10;        '&lt;td&gt;0 ms (reference)&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? jndAbsoluteDifference.toFixed(2) + ' ms' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? 'Weber Ratio: ' + webersRatio.toFixed(4) : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(diffRow);&#10;    &#10;    var rateStandard = PITCH_RISE_SEMITONES / (STANDARD_WINDOW / 1000);&#10;    var rateRow = document.createElement('tr');&#10;    rateRow.innerHTML = &#10;        '&lt;td&gt;Modulation Rate&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rateStandard.toFixed(4) + ' semitones/s&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? thresholdModulationRate.toFixed(4) + ' semitones/s' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? (thresholdModulationRate / rateStandard).toFixed(4) + ' : 1' : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(rateRow);&#10;    &#10;    var interpretation = document.getElementById('resultInterpretation');&#10;    let interpretationHtml = '&lt;h3 style=&quot;margin-top: 0;&quot;&gt;Performance Interpretation&lt;/h3&gt;';&#10;    &#10;    if (hasData) {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Your Just Noticeable Difference (JND):&lt;/strong&gt;&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;You can reliably detect a difference when the modulation window changes by &lt;strong&gt;' + &#10;            jndAbsoluteDifference.toFixed(2) + ' ms&lt;/strong&gt; (or &lt;strong&gt;' + jndPercentDifference.toFixed(2) + &#10;            '%&lt;/strong&gt; of the standard 400 ms window).&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;In other words, you can discriminate between:&lt;/p&gt;';&#10;        interpretationHtml += '&lt;ul&gt;';&#10;        interpretationHtml += '&lt;li&gt;Standard stimulus: 400 ms modulation window&lt;/li&gt;';&#10;        interpretationHtml += '&lt;li&gt;Your threshold: ' + thresholdWindowDuration.toFixed(2) + ' ms modulation window&lt;/li&gt;';&#10;        interpretationHtml += '&lt;li&gt;Difference: ' + jndAbsoluteDifference.toFixed(2) + ' ms&lt;/li&gt;';&#10;        interpretationHtml += '&lt;/ul&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Weber\'s Ratio:&lt;/strong&gt; ' + webersRatio.toFixed(4) + &#10;            ' (smaller Weber\'s ratio = better discrimination sensitivity)&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;&lt;em&gt;Note: A &lt;strong&gt;smaller JND&lt;/strong&gt; indicates &lt;strong&gt;better sensitivity&lt;/strong&gt; to dynamic pitch changes, ' +&#10;            'as it means you can detect smaller differences between stimuli.&lt;/em&gt;&lt;/p&gt;';&#10;    } else {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Complete results not available due to insufficient data.&lt;/p&gt;';&#10;    }&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    const accuracyStats = calculateAccuracyStats();&#10;    &#10;    interpretationHtml += '&lt;p&gt;&lt;strong&gt;Overall Performance:&lt;/strong&gt; ' + accuracyStats.percentage + &#10;        '% accuracy with average reaction time of ' + rtStats.mean + ' ms across ' + &#10;        accuracyStats.total + ' trials.&lt;/p&gt;';&#10;    &#10;    interpretation.innerHTML = interpretationHtml;&#10;    &#10;    var detailedBody = document.getElementById('detailedMetricsBody');&#10;    detailedBody.innerHTML = '';&#10;    &#10;    var metrics = [&#10;        { name: 'Average Difficulty Level', value: hasData ? sentAverage.toFixed(2) : 'N/A', interp: hasData ? 'SD: ' + sentStdev.toFixed(2) : 'N/A' },&#10;        { name: 'Threshold Slope', value: hasData ? thresholdSlope.toFixed(6) + ' semitones/ms' : 'N/A', interp: hasData ? 'Rate of pitch change' : 'N/A' },&#10;        { name: 'Number of Reversals', value: NumberOfReversals, interp: 'Minimum required: ' + MINIMUMREVERSALS },&#10;        { name: 'Total Trials', value: numberOfIterations, interp: 'Maximum allowed: ' + MAXITERATIONS }&#10;    ];&#10;    &#10;    metrics.forEach(function(metric) {&#10;        var row = document.createElement('tr');&#10;        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;&lt;td&gt;' + metric.interp + '&lt;/td&gt;';&#10;        detailedBody.appendChild(row);&#10;    });&#10;    &#10;    var perfBody = document.getElementById('performanceStatsBody');&#10;    perfBody.innerHTML = '';&#10;    &#10;    var perfMetrics = [&#10;        { name: 'Total Trials', value: accuracyStats.total },&#10;        { name: 'Correct Responses', value: accuracyStats.correct },&#10;        { name: 'Overall Accuracy', value: accuracyStats.percentage + '%' },&#10;        { name: 'Mean Reaction Time', value: rtStats.mean + ' ms' },&#10;        { name: 'Median Reaction Time', value: rtStats.median + ' ms' },&#10;        { name: 'RT Standard Deviation', value: rtStats.sd + ' ms' }&#10;    ];&#10;    &#10;    perfMetrics.forEach(function(metric) {&#10;        var row = document.createElement('tr');&#10;        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;';&#10;        perfBody.appendChild(row);&#10;    });&#10;}&#10;&#10;function backToExperiment() {&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;}&#10;&#10;function view_onclick() {&#10;    logDebug(&quot;View results button clicked&quot;);&#10;    &#10;    if (!isTestComplete &amp;&amp; NumberOfReversals &gt;= MINIMUMREVERSALS) {&#10;        calculateResults();&#10;        isTestComplete = true;&#10;    }&#10;    &#10;    displayResults();&#10;}&#10;&#10;function beginIteration() {&#10;    isReplayTrial = false;&#10;    &#10;    standardIsFirst = Math.random() &lt; 0.5;&#10;    var xIsStandard = Math.random() &lt; 0.5;&#10;    &#10;    if (xIsStandard) {&#10;        CorrectAnswer = standardIsFirst ? 1 : 2;&#10;    } else {&#10;        CorrectAnswer = standardIsFirst ? 2 : 1;&#10;    }&#10;    &#10;    logDebug(&quot;Starting new iteration #&quot; + numberOfIterations + &#10;             &quot;, Standard is &quot; + (standardIsFirst ? &quot;first&quot; : &quot;second&quot;) +&#10;             &quot;, X is &quot; + (xIsStandard ? &quot;standard&quot; : &quot;comparison&quot;) +&#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Difficulty level: &quot; + currentLevel +&#10;             &quot;, Modulation window: &quot; + MODULATION_WINDOWS[currentLevel] + &quot;% (&quot; + &#10;             getModulationWindowDuration(currentLevel) + &quot; ms)&quot;);&#10;    &#10;    setTimeout(function() {&#10;        playABXSequence(xIsStandard);&#10;    }, 1000);&#10;}&#10;&#10;function clearButtonAnimations() {&#10;    document.getElementById('firstBtn').classList.remove('button-playing');&#10;    document.getElementById('secondBtn').classList.remove('button-playing');&#10;}&#10;&#10;function playABXSequence(xIsStandard) {&#10;    logDebug(&quot;Playing ABX sequence&quot;);&#10;    &#10;    clearButtonAnimations();&#10;    &#10;    standardSound = document.getElementById('high_rising_standard');&#10;    comparisonSound = document.getElementById(&quot;high_rising_&quot; + currentLevel);&#10;    &#10;    xSound = xIsStandard ? standardSound : comparisonSound;&#10;    &#10;    if (!standardSound || !comparisonSound) {&#10;        logDebug(&quot;Error: Cannot find audio elements!&quot;);&#10;        document.getElementById('text1').value = &quot;出錯：找不到音頻文件&quot;;&#10;        setTimeout(function() {&#10;            showDiagnostics();&#10;        }, 1000);&#10;        return;&#10;    }&#10;    &#10;    var firstSound = standardIsFirst ? standardSound : comparisonSound;&#10;    document.getElementById('text1').value = &quot;播放第一個音&quot;;&#10;    &#10;    document.getElementById('firstBtn').classList.add('button-playing');&#10;    &#10;    firstSound.currentTime = 0;&#10;    var playPromise1 = firstSound.play();&#10;    &#10;    if (playPromise1 !== undefined) {&#10;        playPromise1.then(function() {&#10;            logDebug(&quot;First sound (A) played successfully&quot;);&#10;            &#10;            firstSound.onended = function() {&#10;                logDebug(&quot;First sound ended&quot;);&#10;                &#10;                document.getElementById('firstBtn').classList.remove('button-playing');&#10;                &#10;                setTimeout(function() {&#10;                    var secondSound = standardIsFirst ? comparisonSound : standardSound;&#10;                    document.getElementById('text1').value = &quot;播放第二個音&quot;;&#10;                    &#10;                    document.getElementById('secondBtn').classList.add('button-playing');&#10;                    &#10;                    secondSound.currentTime = 0;&#10;                    var playPromise2 = secondSound.play();&#10;                    &#10;                    if (playPromise2 !== undefined) {&#10;                        playPromise2.then(function() {&#10;                            logDebug(&quot;Second sound (B) played successfully&quot;);&#10;                            &#10;                            secondSound.onended = function() {&#10;                                logDebug(&quot;Second sound ended&quot;);&#10;                                &#10;                                document.getElementById('secondBtn').classList.remove('button-playing');&#10;                                &#10;                                setTimeout(function() {&#10;                                    document.getElementById('text1').value = &quot;播放第三個音&quot;;&#10;                                    &#10;                                    xSound.currentTime = 0;&#10;                                    var playPromise3 = xSound.play();&#10;                                    &#10;                                    if (playPromise3 !== undefined) {&#10;                                        playPromise3.then(function() {&#10;                                            logDebug(&quot;Third sound (X) played successfully&quot;);&#10;                                            &#10;                                            xSound.onended = function() {&#10;                                                logDebug(&quot;Third sound ended, enabling response buttons&quot;);&#10;                                                &#10;                                                stimulusEndTime = performance.now();&#10;                                                &#10;                                                document.getElementById('text1').value = &quot;請作出選擇&quot;;&#10;                                                document.getElementById('promptText').style.visibility = 'visible';&#10;                                                &#10;                                                document.getElementById('firstBtn').disabled = false;&#10;                                                document.getElementById('secondBtn').disabled = false;&#10;                                                document.getElementById('firstBtn').style.background = &quot;#66CCFF&quot;;&#10;                                                document.getElementById('secondBtn').style.background = &quot;#66CCFF&quot;;&#10;                                            };&#10;                                        }).catch(function(error) {&#10;                                            logDebug(&quot;Failed to play third sound: &quot; + error);&#10;                                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                                            clearButtonAnimations();&#10;                                            setTimeout(showDiagnostics, 1000);&#10;                                        });&#10;                                    }&#10;                                }, 1000);&#10;                            };&#10;                        }).catch(function(error) {&#10;                            logDebug(&quot;Failed to play second sound: &quot; + error);&#10;                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                            clearButtonAnimations();&#10;                            setTimeout(showDiagnostics, 1000);&#10;                        });&#10;                    }&#10;                }, 1000);&#10;            };&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to play first sound: &quot; + error);&#10;            document.getElementById('text1').value = &quot;音頻播放錯誤，請刷新頁面&quot;;&#10;            clearButtonAnimations();&#10;            setTimeout(showDiagnostics, 1000);&#10;        });&#10;    }&#10;}&#10;&#10;function start_onclick() {&#10;    logDebug(&quot;Starting experiment&quot;);&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    checkAudioFiles();&#10;    if (!allFilesPresent) {&#10;        logDebug(&quot;Cannot start experiment: Some audio files are missing&quot;);&#10;        document.getElementById('text1').value = &quot;音頻缺失&quot;;&#10;        showDiagnostics();&#10;        return;&#10;    }&#10;    &#10;    window_onload();&#10;    document.getElementById('text1').value = &quot;開始實驗...&quot;;&#10;    updateProgressBar(0);&#10;    &#10;    setTimeout(function() {&#10;        beginIteration();&#10;        document.getElementById('start').disabled = true;&#10;        document.getElementById('viewResult').disabled = true;&#10;        document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;        document.getElementById('promptText').style.visibility = 'hidden';&#10;    }, 1000);&#10;}&#10;&#10;function gotReversal() {&#10;    NumberOfReversals++;&#10;    Reversals[NumberOfReversals - 1] = currentLevel;&#10;    Direction = -Direction;&#10;    logDebug(&quot;Recorded reversal #&quot; + NumberOfReversals + &quot; at difficulty &quot; + currentLevel + &#10;             &quot; (window: &quot; + MODULATION_WINDOWS[currentLevel] + &quot;%, &quot; + &#10;             getModulationWindowDuration(currentLevel) + &quot; ms)&quot;);&#10;}&#10;&#10;function processAnswer(Response) {&#10;    const reactionEndTime = performance.now();&#10;    const reactionTime = reactionEndTime - stimulusEndTime;&#10;    &#10;    logDebug(&quot;User answered: &quot; + (Response === 1 ? &quot;First&quot; : &quot;Second&quot;) + &#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Is replay: &quot; + isReplayTrial);&#10;    &#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    const isCorrect = (Response === CorrectAnswer);&#10;    &#10;    if (!isReplayTrial) {&#10;        const windowPercent = MODULATION_WINDOWS[currentLevel];&#10;        const windowDuration = getModulationWindowDuration(currentLevel);&#10;        const modulationRate = getModulationRate(currentLevel);&#10;        const slope = getModulationSlope(currentLevel);&#10;        &#10;        const trialInfo = {&#10;            trialNumber: numberOfIterations,&#10;            timestamp: getLocalTimestamp(),&#10;            difficultyLevel: currentLevel,&#10;            modulationWindowPercent: windowPercent,&#10;            modulationWindowDuration: windowDuration.toFixed(2),&#10;            modulationRate: modulationRate.toFixed(4),&#10;            slope: slope.toFixed(6),&#10;            userResponse: Response === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            correctResponse: CorrectAnswer === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            isCorrect: isCorrect,&#10;            reactionTime: reactionTime.toFixed(0),&#10;            isReversal: false,&#10;            stepDirection: Direction === DECREASING ? &quot;Increasing Difficulty&quot; : &quot;Decreasing Difficulty&quot;,&#10;            standardPosition: standardIsFirst ? &quot;First&quot; : &quot;Second&quot;&#10;        };&#10;        &#10;        trialRecords.push(trialInfo);&#10;    }&#10;    &#10;    if (isCorrect) {&#10;        logDebug(&quot;Correct answer&quot;);&#10;        document.getElementById('smile').src = &quot;Media/smiley.png&quot;;&#10;        document.getElementById('text1').value = &quot;正確！&quot;;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses++;&#10;            &#10;            if (CorrectResponses == 2) {&#10;                logDebug(&quot;Two correct answers in a row&quot;);&#10;                CorrectResponses = 0;&#10;                &#10;                if (Direction == INCREASING) {&#10;                    gotReversal();&#10;                    if (trialRecords.length &gt; 0) {&#10;                        trialRecords[trialRecords.length-1].isReversal = true;&#10;                    }&#10;                }&#10;                &#10;                changeLevel(DECREASING);&#10;            }&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            resetPage();&#10;        }, 1500);&#10;    } else {&#10;        logDebug(&quot;Incorrect answer - will replay stimulus&quot;);&#10;        document.getElementById('smile').src = &quot;Media/nosmiley.png&quot;;&#10;        &#10;        var correctAnswerText = CorrectAnswer === 1 ? &quot;第一個音&quot; : &quot;第二個音&quot;;&#10;        document.getElementById('text1').value = &quot;錯誤！正確答案是：&quot; + correctAnswerText;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses = 0;&#10;            &#10;            if (Direction == DECREASING) {&#10;                gotReversal();&#10;                if (trialRecords.length &gt; 0) {&#10;                    trialRecords[trialRecords.length-1].isReversal = true;&#10;                }&#10;            }&#10;            &#10;            changeLevel(INCREASING);&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            document.getElementById('text1').value = &quot;重播刺激音...&quot;;&#10;            &#10;            setTimeout(function() {&#10;                isReplayTrial = true;&#10;                &#10;                var xIsStandard = (standardIsFirst &amp;&amp; CorrectAnswer === 1) || &#10;                                  (!standardIsFirst &amp;&amp; CorrectAnswer === 2);&#10;                playABXSequence(xIsStandard);&#10;            }, 1000);&#10;        }, 2000);&#10;    }&#10;}&#10;&#10;function changeLevel(whichWay) {&#10;    var oldLevel = currentLevel;&#10;    var stepSize = NumberOfReversals &lt; 4 ? 2 : 1;&#10;    &#10;    if (whichWay == DECREASING) {&#10;        currentLevel = Math.min(9, currentLevel + stepSize);&#10;    } else {&#10;        currentLevel = Math.max(LOWERLIMIT, currentLevel - stepSize);&#10;    }&#10;    &#10;    logDebug(&quot;Difficulty changed from level &quot; + oldLevel + &quot; (&quot; + MODULATION_WINDOWS[oldLevel] + &quot;%, &quot; +&#10;             getModulationWindowDuration(oldLevel) + &quot; ms) to level &quot; + &#10;             currentLevel + &quot; (&quot; + MODULATION_WINDOWS[currentLevel] + &quot;%, &quot; +&#10;             getModulationWindowDuration(currentLevel) + &quot; ms) &quot; +&#10;             (whichWay == DECREASING ? &quot;(increasing difficulty)&quot; : &quot;(decreasing difficulty)&quot;));&#10;}&#10;&#10;function exportToCSV() {&#10;    const headers = [&#10;        &quot;Trial Number&quot;, &#10;        &quot;Timestamp&quot;, &#10;        &quot;Difficulty Level&quot;, &#10;        &quot;Modulation Window (%)&quot;,&#10;        &quot;Modulation Window (ms)&quot;,&#10;        &quot;Modulation Rate (semitones/s)&quot;,&#10;        &quot;Slope (semitones/ms)&quot;,&#10;        &quot;Standard Position&quot;,&#10;        &quot;User Response&quot;, &#10;        &quot;Correct Response&quot;, &#10;        &quot;Is Correct&quot;, &#10;        &quot;Reaction Time (ms)&quot;, &#10;        &quot;Is Reversal&quot;,&#10;        &quot;Step Direction&quot;&#10;    ];&#10;    &#10;    const csvRows = [];&#10;    csvRows.push(headers.join(&quot;,&quot;));&#10;    &#10;    trialRecords.forEach(function(trial) {&#10;        const row = [&#10;            trial.trialNumber,&#10;            trial.timestamp,&#10;            trial.difficultyLevel,&#10;            trial.modulationWindowPercent,&#10;            trial.modulationWindowDuration,&#10;            trial.modulationRate,&#10;            trial.slope,&#10;            trial.standardPosition,&#10;            trial.userResponse,&#10;            trial.correctResponse,&#10;            trial.isCorrect ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.reactionTime,&#10;            trial.isReversal ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.stepDirection&#10;        ];&#10;        csvRows.push(row.join(&quot;,&quot;));&#10;    });&#10;    &#10;    csvRows.push(&quot;\nRESULTS SUMMARY - JUST NOTICEABLE DIFFERENCE (JND)&quot;);&#10;    csvRows.push(&quot;\nJND Metrics&quot;);&#10;    csvRows.push(&quot;Parameter,Value,Unit,Description&quot;);&#10;    &#10;    const hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;&#10;    &#10;    csvRows.push(&quot;JND Absolute Difference,&quot; + &#10;        (hasData ? jndAbsoluteDifference.toFixed(2) : &quot;N/A&quot;) + &quot;,ms,Detectable difference from standard (smaller = better)&quot;);&#10;    &#10;    csvRows.push(&quot;JND Percentage Difference,&quot; + &#10;        (hasData ? jndPercentDifference.toFixed(2) : &quot;N/A&quot;) + &quot;,%,Percentage difference from standard (smaller = better)&quot;);&#10;    &#10;    csvRows.push(&quot;JND Ratio (Threshold/Standard),&quot; + &#10;        (hasData ? jndRatio.toFixed(4) : &quot;N/A&quot;) + &quot;,ratio,Threshold modulation window / Standard window&quot;);&#10;    &#10;    csvRows.push(&quot;Weber's Ratio,&quot; + &#10;        (hasData ? webersRatio.toFixed(4) : &quot;N/A&quot;) + &quot;,ratio,ΔI / I (smaller = better sensitivity)&quot;);&#10;    &#10;    csvRows.push(&quot;\nThreshold Parameters&quot;);&#10;    csvRows.push(&quot;Parameter,Value,Unit&quot;);&#10;    &#10;    csvRows.push(&quot;Standard Modulation Window,&quot; + STANDARD_WINDOW + &quot;,ms&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Modulation Window,&quot; + &#10;        (hasData ? thresholdWindowDuration.toFixed(2) : &quot;N/A&quot;) + &quot;,ms&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Window Percentage,&quot; + &#10;        (hasData ? thresholdWindowPercent.toFixed(2) : &quot;N/A&quot;) + &quot;,%&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Modulation Rate,&quot; + &#10;        (hasData ? thresholdModulationRate.toFixed(4) : &quot;N/A&quot;) + &quot;,semitones/s&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Slope,&quot; + &#10;        (hasData ? thresholdSlope.toFixed(6) : &quot;N/A&quot;) + &quot;,semitones/ms&quot;);&#10;    &#10;    csvRows.push(&quot;Average Difficulty Level,&quot; + &#10;        (hasData ? sentAverage.toFixed(2) : &quot;N/A&quot;) + &quot;,level (1-9)&quot;);&#10;    &#10;    csvRows.push(&quot;Difficulty Level SD,&quot; + &#10;        (hasData ? sentStdev.toFixed(2) : &quot;N/A&quot;) + &quot;,level&quot;);&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    csvRows.push(&quot;\nReaction Time Statistics&quot;);&#10;    csvRows.push(&quot;Mean,Median,Standard Deviation&quot;);&#10;    csvRows.push(rtStats.mean + &quot;,&quot; + rtStats.median + &quot;,&quot; + rtStats.sd);&#10;    &#10;    const accuracyStats = calculateAccuracyStats();&#10;    csvRows.push(&quot;\nAccuracy Statistics&quot;);&#10;    csvRows.push(&quot;Correct Responses,Total Responses,Percentage&quot;);&#10;    csvRows.push(accuracyStats.correct + &quot;,&quot; + accuracyStats.total + &quot;,&quot; + accuracyStats.percentage + &quot;%&quot;);&#10;    &#10;    csvRows.push(&quot;\nExperiment Parameters&quot;);&#10;    csvRows.push(&quot;Parameter,Value&quot;);&#10;    csvRows.push(&quot;Paradigm,ABX&quot;);&#10;    csvRows.push(&quot;Stimulus Type,Dynamic Pitch (Rising Tone)&quot;);&#10;    csvRows.push(&quot;Total Stimulus Duration,&quot; + STIMULUS_DURATION + &quot; ms&quot;);&#10;    csvRows.push(&quot;Standard Modulation Window,&quot; + STANDARD_WINDOW + &quot; ms&quot;);&#10;    csvRows.push(&quot;Pitch Rise Amount,&quot; + PITCH_RISE_SEMITONES + &quot; semitone(s)&quot;);&#10;    csvRows.push(&quot;Max Reversals,&quot; + MAXREVERSALS);&#10;    csvRows.push(&quot;Min Reversals for Calculation,&quot; + MINIMUMREVERSALS);&#10;    csvRows.push(&quot;Max Iterations,&quot; + MAXITERATIONS);&#10;    &#10;    csvRows.push(&quot;\nDifficulty Level Mapping&quot;);&#10;    csvRows.push(&quot;Level,Modulation Window (%),Modulation Window (ms),Difference from Standard (ms),Modulation Rate (semitones/s),Slope (semitones/ms)&quot;);&#10;    for (let level = 1; level &lt;= 9; level++) {&#10;        const windowPercent = MODULATION_WINDOWS[level];&#10;        const windowDuration = getModulationWindowDuration(level);&#10;        const diffFromStandard = STANDARD_WINDOW - windowDuration;&#10;        const rate = getModulationRate(level);&#10;        const slope = getModulationSlope(level);&#10;        csvRows.push(level + &quot;,&quot; + windowPercent + &quot;,&quot; + windowDuration.toFixed(2) + &quot;,&quot; + &#10;                     diffFromStandard.toFixed(2) + &quot;,&quot; + rate.toFixed(4) + &quot;,&quot; + slope.toFixed(6));&#10;    }&#10;    &#10;    const csvContent = &quot;data:text/csv;charset=utf-8,&quot; + csvRows.join(&quot;\n&quot;);&#10;    const encodedUri = encodeURI(csvContent);&#10;    const link = document.createElement(&quot;a&quot;);&#10;    const timestamp = new Date().toISOString().replace(/[:.]/g, &quot;-&quot;);&#10;    link.setAttribute(&quot;href&quot;, encodedUri);&#10;    link.setAttribute(&quot;download&quot;, &quot;dynamic_pitch_JND_ABX_data_&quot; + timestamp + &quot;.csv&quot;);&#10;    document.body.appendChild(link);&#10;    link.click();&#10;    document.body.removeChild(link);&#10;}&#10;&#10;function window_onload() {&#10;    window.name = &quot;EXP&quot;;&#10;    NumberOfReversals = 0;&#10;    numberOfIterations = 0;&#10;    CorrectResponses = 0;&#10;    Direction = DECREASING;&#10;    currentLevel = 5;&#10;    isTestComplete = false;&#10;    Reversals = [];&#10;    trialRecords = [];&#10;    isReplayTrial = false;&#10;    &#10;    jndAbsoluteDifference = 0;&#10;    jndRatio = 0;&#10;    jndPercentDifference = 0;&#10;    thresholdWindowDuration = 0;&#10;    thresholdWindowPercent = 0;&#10;    thresholdModulationRate = 0;&#10;    thresholdSlope = 0;&#10;    webersRatio = 0;&#10;&#10;    document.getElementById('text1').value = &quot;準備完畢後請點擊\&quot;開始實驗\&quot;&quot;;&#10;    document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;    document.getElementById('start').disabled = false;&#10;    document.getElementById('viewResult').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;    &#10;    updateProgressBar(0);&#10;    &#10;    logDebug(&quot;Page reset complete&quot;);&#10;}&#10;&#10;window.onload = function() {&#10;    window_onload();&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    logDebug(&quot;Preloading &quot; + allAudios.length + &quot; audio files&quot;);&#10;    &#10;    allAudios.forEach(function(audio) {&#10;        audio.load();&#10;    });&#10;    &#10;    document.getElementById('text1').value = &quot;請點擊\&quot;開始實驗\&quot;&quot;;&#10;    &#10;    window.onerror = function(message, source, lineno, colno, error) {&#10;        logDebug(&quot;Global error: &quot; + message + &quot; at &quot; + source + &quot;:&quot; + lineno);&#10;        return false;&#10;    };&#10;    &#10;    document.getElementById('showDebug').checked = true;&#10;    toggleDebug();&#10;};&#10;&lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
                    <entry key="file:///E:/Projects/Pitch_Training/ABX_rising_low.html" value="&lt;!DOCTYPE html&gt;&#10;&lt;html&gt;&#10;&lt;head&gt;&#10;    &lt;title&gt;PLOYU-Peng's Lab: Pitch Sensitivity Training&lt;/title&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;style&gt;&#10;        body {&#10;            font-family: Arial, sans-serif;&#10;            margin: 20px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .container {&#10;            max-width: 800px;&#10;            margin: 0 auto;&#10;            padding: 20px;&#10;            background-color: white;&#10;            border-radius: 10px;&#10;            box-shadow: 0 0 10px rgba(0,0,0,0.1);&#10;            display: flex;&#10;            flex-direction: column;&#10;            align-items: center;&#10;        }&#10;        .header {&#10;            text-align: center;&#10;            margin-bottom: 40px;&#10;            width: 100%;&#10;        }&#10;        .training-info {&#10;            font-size: 16px;&#10;            color: #555;&#10;            margin-top: 10px;&#10;            margin-bottom: 5px;&#10;            text-align: center;&#10;        }&#10;        .instruction-text {&#10;            font-size: 14px;&#10;            color: #777;&#10;            margin-bottom: 15px;&#10;            text-align: center;&#10;            font-style: italic;&#10;        }&#10;        .button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .prompt-text {&#10;            text-align: center;&#10;            font-size: 20px;&#10;            margin-bottom: 25px;&#10;            margin-top: 30px;&#10;            font-weight: bold;&#10;        }&#10;        .response-button {&#10;            width: 160px;&#10;            height: 160px;&#10;            font-size: 26px;&#10;            margin: 0 40px;&#10;            border-radius: 15px;&#10;            border: none;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.1);&#10;            transition: all 0.3s ease;&#10;        }&#10;        .response-button:hover:enabled {&#10;            transform: translateY(-3px);&#10;            box-shadow: 0 6px 12px rgba(0,0,0,0.15);&#10;        }&#10;        .response-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .button-playing {&#10;            animation: pulse 1s ease-in-out infinite;&#10;            box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            transform: scale(1.05);&#10;        }&#10;        @keyframes pulse {&#10;            0%, 100% {&#10;                box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            }&#10;            50% {&#10;                box-shadow: 0 0 30px rgba(102, 204, 255, 1);&#10;            }&#10;        }&#10;        .control-button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            gap: 30px;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .control-button {&#10;            padding: 14px 28px;&#10;            font-size: 18px;&#10;            border-radius: 8px;&#10;            border: none;&#10;            background-color: #4CAF50;&#10;            color: white;&#10;            cursor: pointer;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .control-button:hover:enabled {&#10;            background-color: #3e8e41;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .control-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .control-button:disabled {&#10;            background-color: #cccccc;&#10;            cursor: not-allowed;&#10;            box-shadow: none;&#10;        }&#10;        .feedback {&#10;            text-align: center;&#10;            height: 100px;&#10;            margin: 30px 0;&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;        }&#10;        .status {&#10;            width: 350px;&#10;            height: 68px;&#10;            text-align: center;&#10;            font-size: 18px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            margin: 0 auto;&#10;            padding: 10px;&#10;            background-color: #f9f9f9;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.05);&#10;        }&#10;        .debug-info {&#10;            font-size: 12px;&#10;            color: #777;&#10;            margin-top: 30px;&#10;            text-align: left;&#10;            display: none;&#10;            max-height: 300px;&#10;            overflow-y: auto;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            padding: 15px;&#10;            width: 100%;&#10;        }&#10;        .results-container {&#10;            display: none;&#10;            margin-top: 30px;&#10;            padding: 20px;&#10;            background-color: #f0f8ff;&#10;            border-radius: 8px;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.1);&#10;            width: 100%;&#10;        }&#10;        .result-heading {&#10;            text-align: center;&#10;            margin-bottom: 20px;&#10;            color: #2c3e50;&#10;        }&#10;        .result-table {&#10;            width: 100%;&#10;            border-collapse: collapse;&#10;            margin-bottom: 20px;&#10;        }&#10;        .result-table th, .result-table td {&#10;            padding: 12px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .result-table th {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .result-table tr:nth-child(even) {&#10;            background-color: #f2f2f2;&#10;        }&#10;        .result-interpretation {&#10;            background-color: #e8f4f8;&#10;            padding: 15px;&#10;            border-radius: 5px;&#10;            margin-bottom: 20px;&#10;        }&#10;        .back-button {&#10;            display: block;&#10;            margin: 0 auto;&#10;            padding: 14px 28px;&#10;            background-color: #3498db;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .back-button:hover {&#10;            background-color: #2980b9;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .back-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        .chart-container {&#10;            height: 300px;&#10;            margin: 20px 0;&#10;            background-color: white;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;            padding: 10px;&#10;        }&#10;        .auxiliary-buttons {&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            margin-top: 30px;&#10;            gap: 20px;&#10;            flex-wrap: wrap;&#10;        }&#10;        .auxiliary-buttons button {&#10;            padding: 10px 15px;&#10;            border-radius: 5px;&#10;            border: 1px solid #ddd;&#10;            background-color: #f0f0f0;&#10;            cursor: pointer;&#10;            transition: all 0.2s ease;&#10;        }&#10;        .auxiliary-buttons button:hover {&#10;            background-color: #e0e0e0;&#10;        }&#10;        .diagnostic-overlay {&#10;            position: fixed;&#10;            top: 0;&#10;            left: 0;&#10;            width: 100%;&#10;            height: 100%;&#10;            background-color: rgba(0, 0, 0, 0.8);&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            z-index: 1000;&#10;            display: none;&#10;        }&#10;        .diagnostic-content {&#10;            width: 80%;&#10;            max-width: 700px;&#10;            max-height: 80%;&#10;            overflow-y: auto;&#10;            background-color: white;&#10;            padding: 20px;&#10;            border-radius: 8px;&#10;            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);&#10;        }&#10;        .diagnostic-heading {&#10;            text-align: center;&#10;            color: #e74c3c;&#10;            margin-bottom: 20px;&#10;            font-size: 24px;&#10;        }&#10;        .diagnostic-close {&#10;            float: right;&#10;            font-size: 20px;&#10;            cursor: pointer;&#10;            color: #777;&#10;        }&#10;        .diagnostic-close:hover {&#10;            color: #333;&#10;        }&#10;        .diagnostic-section {&#10;            margin-bottom: 15px;&#10;            padding: 10px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;        }&#10;        .diagnostic-actions {&#10;            text-align: center;&#10;            margin-top: 20px;&#10;        }&#10;        .diagnostic-action-button {&#10;            padding: 10px 20px;&#10;            margin: 0 10px;&#10;            border: none;&#10;            border-radius: 5px;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;        }&#10;        .retry-button {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .retry-button:hover {&#10;            background-color: #2980b9;&#10;        }&#10;        .continue-button {&#10;            background-color: #2ecc71;&#10;            color: white;&#10;        }&#10;        .continue-button:hover {&#10;            background-color: #27ae60;&#10;        }&#10;        .diagnostic-file-status {&#10;            display: flex;&#10;            flex-wrap: wrap;&#10;            gap: 10px;&#10;        }&#10;        .file-status-item {&#10;            font-size: 12px;&#10;            padding: 5px 10px;&#10;            border-radius: 3px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .file-found {&#10;            color: #27ae60;&#10;            border-left: 3px solid #27ae60;&#10;        }&#10;        .file-missing {&#10;            color: #e74c3c;&#10;            border-left: 3px solid #e74c3c;&#10;        }&#10;        .statistics-table {&#10;            width: 100%;&#10;            margin: 10px 0;&#10;            border-collapse: collapse;&#10;        }&#10;        .statistics-table th, .statistics-table td {&#10;            padding: 8px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .statistics-table th {&#10;            background-color: #f0f0f0;&#10;        }&#10;        .direction-stats-good {&#10;            color: #27ae60;&#10;        }&#10;        .direction-stats-warning {&#10;            color: #f39c12;&#10;        }&#10;        .direction-stats-bad {&#10;            color: #e74c3c;&#10;        }&#10;        @media (max-width: 600px) {&#10;            .response-button {&#10;                width: 130px;&#10;                height: 130px;&#10;                font-size: 22px;&#10;                margin: 0 20px;&#10;            }&#10;            .control-button {&#10;                padding: 12px 20px;&#10;            }&#10;        }&#10;        .print-button {&#10;            padding: 14px 28px;&#10;            margin: 20px auto;&#10;            background-color: #9b59b6;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;            display: block;&#10;        }&#10;        .print-button:hover {&#10;            background-color: #8e44ad;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .print-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        @media print {&#10;            body {&#10;                background-color: white;&#10;                margin: 0;&#10;                padding: 0;&#10;            }&#10;            .container {&#10;                max-width: 100%;&#10;                box-shadow: none;&#10;                padding: 10px;&#10;            }&#10;            .back-button, .print-button, .auxiliary-buttons {&#10;                display: none;&#10;            }&#10;            .results-container {&#10;                display: block !important;&#10;                box-shadow: none;&#10;                background-color: white;&#10;                padding: 0;&#10;            }&#10;            .chart-container {&#10;                border: 1px solid #ddd;&#10;                background-color: white;&#10;            }&#10;            .result-table th {&#10;                background-color: #f0f0f0 !important;&#10;                color: black !important;&#10;            }&#10;            .result-interpretation {&#10;                background-color: white;&#10;                border: 1px solid #ddd;&#10;            }&#10;            * {&#10;                -webkit-print-color-adjust: exact !important;&#10;                print-color-adjust: exact !important;&#10;            }&#10;        }&#10;        .progress-bar-container {&#10;            width: 100%;&#10;            height: 20px;&#10;            background-color: #e0e0e0;&#10;            border-radius: 10px;&#10;            margin: 10px 0;&#10;            overflow: hidden;&#10;        }&#10;        .progress-bar {&#10;            height: 100%;&#10;            background-color: #4CAF50;&#10;            border-radius: 10px;&#10;            transition: width 0.3s ease;&#10;        }&#10;        .progress-label {&#10;            text-align: center;&#10;            font-size: 14px;&#10;            color: #555;&#10;            margin-top: 5px;&#10;        }&#10;        .highlight-box {&#10;            background-color: #fffacd;&#10;            border: 2px solid #ffd700;&#10;            padding: 15px;&#10;            border-radius: 8px;&#10;            margin: 20px 0;&#10;            text-align: center;&#10;        }&#10;        .highlight-value {&#10;            font-size: 28px;&#10;            font-weight: bold;&#10;            color: #e74c3c;&#10;            margin: 10px 0;&#10;        }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;div class=&quot;container&quot;&gt;&#10;        &lt;div class=&quot;header&quot;&gt;&#10;            &lt;img src=&quot;Media/animation.gif&quot; alt=&quot;Experiment animation&quot;&gt;&#10;            &lt;div class=&quot;training-info&quot;&gt;Low Rising Tone Discrimination (ABX)&lt;/div&gt;&#10;            &lt;div class=&quot;instruction-text&quot;&gt;請判斷第三個音聽起來更像第一個還是第二個音&lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div id=&quot;experimentContainer&quot;&gt;&#10;            &lt;div class=&quot;control-button-container&quot;&gt;&#10;                &lt;input id=&quot;start&quot; type=&quot;button&quot; value=&quot;開始實驗&quot; onclick=&quot;start_onclick()&quot; class=&quot;control-button&quot;&gt;&#10;                &lt;input id=&quot;viewResult&quot; type=&quot;button&quot; value=&quot;查看結果&quot; onclick=&quot;view_onclick()&quot; class=&quot;control-button&quot; disabled&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;prompt-text&quot; id=&quot;promptText&quot;&gt;&#10;                第三個音更像...&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;firstBtn&quot; type=&quot;button&quot; value=&quot;第一個音&quot; onclick=&quot;processAnswer(1)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;                &lt;input id=&quot;secondBtn&quot; type=&quot;button&quot; value=&quot;第二個音&quot; onclick=&quot;processAnswer(2)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;feedback&quot;&gt;&#10;                &lt;img id=&quot;smile&quot; src=&quot;Media/null.gif&quot; width=&quot;100&quot; height=&quot;84&quot; alt=&quot;Feedback&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;text1&quot; class=&quot;status&quot; readonly&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;progress-bar-container&quot;&gt;&#10;                &lt;div class=&quot;progress-bar&quot; id=&quot;progressBar&quot; style=&quot;width: 0%&quot;&gt;&lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;progress-label&quot; id=&quot;progressLabel&quot;&gt;Progress: 0%&lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;debug-info&quot; id=&quot;debugInfo&quot;&gt;&#10;                Debug information will be displayed here&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot;&gt;&#10;                &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;showDebug&quot; onclick=&quot;toggleDebug()&quot;&gt; Show Debug Info&lt;/label&gt;&#10;                &lt;button onclick=&quot;testAudio()&quot;&gt;Test All Audio&lt;/button&gt;&#10;                &lt;button onclick=&quot;showDiagnostics()&quot;&gt;Diagnostics&lt;/button&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot; id=&quot;exportBtn&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div id=&quot;resultsContainer&quot; class=&quot;results-container&quot;&gt;&#10;            &lt;h2 class=&quot;result-heading&quot;&gt;Dynamic Pitch Discrimination Test Results (ABX)&lt;/h2&gt;&#10;            &#10;            &lt;div class=&quot;highlight-box&quot;&gt;&#10;                &lt;h3 style=&quot;margin-top: 0;&quot;&gt;Just Noticeable Difference (JND)&lt;/h3&gt;&#10;                &lt;div class=&quot;highlight-value&quot; id=&quot;jndValue&quot;&gt;--&lt;/div&gt;&#10;                &lt;p style=&quot;margin-bottom: 0; font-size: 14px; color: #666;&quot;&gt;&#10;                    This represents the minimum detectable difference in modulation window duration&lt;br&gt;&#10;                    &lt;strong&gt;Smaller JND = Better discrimination ability&lt;/strong&gt;&#10;                &lt;/p&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Perceptual Discrimination Thresholds&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Parameter&lt;/th&gt;&#10;                        &lt;th&gt;Standard (Reference)&lt;/th&gt;&#10;                        &lt;th&gt;Threshold (Your JND)&lt;/th&gt;&#10;                        &lt;th&gt;Difference Ratio&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;resultTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;div class=&quot;result-interpretation&quot; id=&quot;resultInterpretation&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Detailed Threshold Metrics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Metric&lt;/th&gt;&#10;                        &lt;th&gt;Value&lt;/th&gt;&#10;                        &lt;th&gt;Interpretation&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;detailedMetricsBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;h3&gt;Performance Statistics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Metric&lt;/th&gt;&#10;                        &lt;th&gt;Value&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;performanceStatsBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;button class=&quot;print-button&quot; onclick=&quot;printResults()&quot;&gt;Print Results&lt;/button&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot; style=&quot;margin-top: 20px;&quot;&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;button class=&quot;back-button&quot; onclick=&quot;backToExperiment()&quot;&gt;Back to Experiment&lt;/button&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div class=&quot;diagnostic-overlay&quot; id=&quot;diagnosticOverlay&quot;&gt;&#10;            &lt;div class=&quot;diagnostic-content&quot;&gt;&#10;                &lt;span class=&quot;diagnostic-close&quot; onclick=&quot;closeDiagnostics()&quot;&gt;&amp;times;&lt;/span&gt;&#10;                &lt;h2 class=&quot;diagnostic-heading&quot;&gt;Experiment Diagnostics&lt;/h2&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Test Status&lt;/h3&gt;&#10;                    &lt;table class=&quot;statistics-table&quot;&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;th&gt;Trials&lt;/th&gt;&#10;                            &lt;th&gt;Reversals&lt;/th&gt;&#10;                            &lt;th&gt;Status&lt;/th&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td id=&quot;totalTrials&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;totalReversals&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;testStatus&quot;&gt;Not started&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                    &lt;/table&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Audio Files Check&lt;/h3&gt;&#10;                    &lt;p&gt;Verifying necessary audio files:&lt;/p&gt;&#10;                    &lt;div id=&quot;audioFileStatus&quot; class=&quot;diagnostic-file-status&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Reversal History&lt;/h3&gt;&#10;                    &lt;div id=&quot;reversalHistory&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Recommendations&lt;/h3&gt;&#10;                    &lt;div id=&quot;diagnosticRecommendations&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-actions&quot;&gt;&#10;                    &lt;button class=&quot;diagnostic-action-button continue-button&quot; onclick=&quot;closeDiagnostics()&quot;&gt;Close&lt;/button&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;audio id=&quot;low_rising_standard&quot; src=&quot;Media/low_rising_standard.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;    &lt;audio id=&quot;low_rising_1&quot; src=&quot;Media/low_rising_1.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_rising_2&quot; src=&quot;Media/low_rising_2.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_rising_3&quot; src=&quot;Media/low_rising_3.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_rising_4&quot; src=&quot;Media/low_rising_4.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_rising_5&quot; src=&quot;Media/low_rising_5.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_rising_6&quot; src=&quot;Media/low_rising_6.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_rising_7&quot; src=&quot;Media/low_rising_7.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_rising_8&quot; src=&quot;Media/low_rising_8.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_rising_9&quot; src=&quot;Media/low_rising_9.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;&lt;script&gt;&#10;function getLocalTimestamp() {&#10;    const now = new Date();&#10;    const year = now.getFullYear();&#10;    const month = String(now.getMonth() + 1).padStart(2, '0');&#10;    const day = String(now.getDate()).padStart(2, '0');&#10;    const hours = String(now.getHours()).padStart(2, '0');&#10;    const minutes = String(now.getMinutes()).padStart(2, '0');&#10;    const seconds = String(now.getSeconds()).padStart(2, '0');&#10;    const milliseconds = String(now.getMilliseconds()).padStart(3, '0');&#10;    &#10;    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;&#10;}&#10;&#10;// Stimulus parameters for dynamic pitch modulation&#10;const STIMULUS_DURATION = 450; // ms, total duration&#10;const STANDARD_WINDOW = 400; // ms, modulation window for standard (100%)&#10;const STANDARD_WINDOW_PERCENT = 100; // percentage&#10;&#10;// Modulation window percentages for each difficulty level&#10;const MODULATION_WINDOWS = {&#10;    1: 20,   // easiest - 20% of standard window (80 ms)&#10;    2: 40,   // 160 ms&#10;    3: 50,   // 200 ms&#10;    4: 60,   // 240 ms&#10;    5: 70,   // 280 ms&#10;    6: 80,   // 320 ms&#10;    7: 90,   // 360 ms&#10;    8: 95,   // 380 ms&#10;    9: 98    // hardest - 98% of standard window (392 ms)&#10;};&#10;&#10;function getModulationWindowDuration(level) {&#10;    return (MODULATION_WINDOWS[level] / 100) * STANDARD_WINDOW;&#10;}&#10;&#10;const PITCH_RISE_SEMITONES = 1.0;&#10;&#10;function getModulationRate(level) {&#10;    const windowDuration = getModulationWindowDuration(level);&#10;    const windowDurationSec = windowDuration / 1000;&#10;    return PITCH_RISE_SEMITONES / windowDurationSec;&#10;}&#10;&#10;function getModulationSlope(level) {&#10;    const windowDuration = getModulationWindowDuration(level);&#10;    return PITCH_RISE_SEMITONES / windowDuration;&#10;}&#10;&#10;// Adaptive threshold experiment constants&#10;const MAXREVERSALS = 10;&#10;const MAXITERATIONS = 50;&#10;const LOWERLIMIT = 1;&#10;const DECREASING = -1;&#10;const INCREASING = 1;&#10;const MINIMUMREVERSALS = 6;&#10;const THRESHOLD_REVERSAL_COUNT = 6;&#10;&#10;// Experiment state variables&#10;var CorrectAnswer;&#10;var CorrectResponses = 0;&#10;var Direction = DECREASING;&#10;var Reversals = [];&#10;var NumberOfReversals = 0;&#10;var currentLevel = 5;&#10;var numberOfIterations = 0;&#10;var sentAverage = 0.0;&#10;var sentStdev = 0.0;&#10;var isTestComplete = false;&#10;var audioUnlocked = false;&#10;var allFilesPresent = true;&#10;var trialRecords = [];&#10;var stimulusEndTime = 0;&#10;&#10;// ABX variables&#10;var standardIsFirst;&#10;var comparisonSound;&#10;var standardSound;&#10;var xSound;&#10;&#10;var isReplayTrial = false;&#10;&#10;// Results variables - JND-based&#10;var jndAbsoluteDifference = 0;&#10;var jndRatio = 0;&#10;var jndPercentDifference = 0;&#10;var thresholdWindowDuration = 0;&#10;var thresholdWindowPercent = 0;&#10;var thresholdModulationRate = 0;&#10;var thresholdSlope = 0;&#10;var webersRatio = 0;&#10;&#10;function printResults() {&#10;    window.print();&#10;}&#10;&#10;function logDebug(message) {&#10;    console.log(message);&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var now = new Date();&#10;    var timeStr = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + '.' + now.getMilliseconds();&#10;    debugArea.innerHTML += '&lt;p&gt;[' + timeStr + '] ' + message + '&lt;/p&gt;';&#10;    debugArea.scrollTop = debugArea.scrollHeight;&#10;}&#10;&#10;function toggleDebug() {&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var checkbox = document.getElementById('showDebug');&#10;    debugArea.style.display = checkbox.checked ? 'block' : 'none';&#10;}&#10;&#10;function showDiagnostics() {&#10;    updateDiagnostics();&#10;    document.getElementById('diagnosticOverlay').style.display = 'flex';&#10;}&#10;&#10;function closeDiagnostics() {&#10;    document.getElementById('diagnosticOverlay').style.display = 'none';&#10;}&#10;&#10;function updateDiagnostics() {&#10;    document.getElementById('totalTrials').innerText = numberOfIterations;&#10;    document.getElementById('totalReversals').innerText = NumberOfReversals;&#10;    &#10;    let testStatus = getTestStatus();&#10;    document.getElementById('testStatus').innerText = testStatus.text;&#10;    document.getElementById('testStatus').className = `direction-stats-${testStatus.class}`;&#10;    &#10;    checkAudioFiles();&#10;    &#10;    let reversalHistoryHtml = '';&#10;    if (Reversals.length === 0) {&#10;        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';&#10;    } else {&#10;        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals.join(', ') + '&lt;/p&gt;';&#10;        reversalHistoryHtml += '&lt;p&gt;Corresponding modulation windows: ';&#10;        reversalHistoryHtml += Reversals.map(level =&gt; MODULATION_WINDOWS[level] + '% (' + getModulationWindowDuration(level) + ' ms)').join(', ') + '&lt;/p&gt;';&#10;    }&#10;    &#10;    document.getElementById('reversalHistory').innerHTML = reversalHistoryHtml;&#10;    &#10;    generateDiagnosticRecommendations();&#10;}&#10;&#10;function getTestStatus() {&#10;    if (isTestComplete) {&#10;        return { text: &quot;Complete&quot;, class: &quot;good&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals &lt; 1) {&#10;        return { text: &quot;Not enough data&quot;, class: &quot;bad&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals &lt; MINIMUMREVERSALS) {&#10;        return { text: &quot;Incomplete (&quot; + NumberOfReversals + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals)&quot;, class: &quot;warning&quot; };&#10;    }&#10;    &#10;    return { text: &quot;In progress&quot;, class: &quot;good&quot; };&#10;}&#10;&#10;function checkAudioFiles() {&#10;    const requiredFiles = [&#10;        &quot;low_rising_standard&quot;,&#10;        &quot;low_rising_1&quot;, &quot;low_rising_2&quot;, &quot;low_rising_3&quot;, &quot;low_rising_4&quot;, &quot;low_rising_5&quot;, &#10;        &quot;low_rising_6&quot;, &quot;low_rising_7&quot;, &quot;low_rising_8&quot;, &quot;low_rising_9&quot;&#10;    ];&#10;    &#10;    let statusHtml = '';&#10;    allFilesPresent = true;&#10;    &#10;    requiredFiles.forEach(function(fileId) {&#10;        const audioElement = document.getElementById(fileId);&#10;        const fileFound = audioElement !== null;&#10;        &#10;        if (!fileFound) {&#10;            allFilesPresent = false;&#10;        }&#10;        &#10;        statusHtml += `&lt;div class=&quot;file-status-item ${fileFound ? 'file-found' : 'file-missing'}&quot;&gt;${fileId}: ${fileFound ? 'Found' : 'Missing'}&lt;/div&gt;`;&#10;    });&#10;    &#10;    document.getElementById('audioFileStatus').innerHTML = statusHtml;&#10;}&#10;&#10;function generateDiagnosticRecommendations() {&#10;    let recommendations = '';&#10;    let hasIssues = false;&#10;    &#10;    if (!allFilesPresent) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Critical Issue:&lt;/strong&gt; Some required audio files are missing. Please ensure all files are properly loaded.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (numberOfIterations &gt;= MAXITERATIONS &amp;&amp; NumberOfReversals &lt; MINIMUMREVERSALS) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Issue:&lt;/strong&gt; Reached maximum trials but has insufficient reversals. This might indicate audio file issues or participant response patterns.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (!hasIssues) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Good:&lt;/strong&gt; No major issues detected with the experiment setup.&lt;/p&gt;';&#10;        &#10;        if (isTestComplete) {&#10;            recommendations += '&lt;p&gt;Test is complete.&lt;/p&gt;';&#10;        } else {&#10;            recommendations += '&lt;p&gt;Test is still in progress.&lt;/p&gt;';&#10;        }&#10;    }&#10;    &#10;    document.getElementById('diagnosticRecommendations').innerHTML = recommendations;&#10;}&#10;&#10;function testAudio() {&#10;    logDebug(&quot;Starting to test all audio files...&quot;);&#10;    var audios = document.querySelectorAll('audio');&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    var index = 0;&#10;    function playNext() {&#10;        if (index &gt;= audios.length) {&#10;            logDebug(&quot;All audio testing complete!&quot;);&#10;            return;&#10;        }&#10;        &#10;        var audio = audios[index];&#10;        logDebug(&quot;Testing audio #&quot; + (index + 1) + &quot;: &quot; + audio.id);&#10;        &#10;        audio.currentTime = 0;&#10;        &#10;        var playPromise = audio.play();&#10;        if (playPromise !== undefined) {&#10;            playPromise.then(function() {&#10;                logDebug(audio.id + &quot; played successfully&quot;);&#10;                &#10;                audio.onended = function() {&#10;                    logDebug(audio.id + &quot; playback ended&quot;);&#10;                    index++;&#10;                    setTimeout(playNext, 500);&#10;                };&#10;            }).catch(function(error) {&#10;                logDebug(&quot;Failed to play &quot; + audio.id + &quot;: &quot; + error);&#10;                index++;&#10;                setTimeout(playNext, 500);&#10;            });&#10;        }&#10;    }&#10;    &#10;    playNext();&#10;}&#10;&#10;function unlockAudioContext() {&#10;    logDebug(&quot;Attempting to unlock audio context...&quot;);&#10;    &#10;    var silentAudio = new Audio();&#10;    silentAudio.src = &quot;data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA&quot;;&#10;    &#10;    var promise = silentAudio.play();&#10;    if (promise !== undefined) {&#10;        promise.then(function() {&#10;            logDebug(&quot;Audio context unlocked successfully&quot;);&#10;            silentAudio.remove();&#10;            audioUnlocked = true;&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to unlock audio context: &quot; + error);&#10;        });&#10;    }&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    for (var i = 0; i &lt; allAudios.length; i++) {&#10;        var audio = allAudios[i];&#10;        audio.load();&#10;    }&#10;    &#10;    logDebug(&quot;Preloaded &quot; + allAudios.length + &quot; audio files&quot;);&#10;}&#10;&#10;function resetPage() {&#10;    numberOfIterations++;&#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('firstBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('secondBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    if (isTestComplete) {&#10;        document.getElementById('start').disabled = false;&#10;        document.getElementById('viewResult').disabled = false;&#10;        document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;        updateProgressBar(100);&#10;        return;&#10;    }&#10;    &#10;    if ((numberOfIterations &gt;= MAXITERATIONS) || (NumberOfReversals &gt;= MAXREVERSALS)) {&#10;        if (NumberOfReversals &gt;= MINIMUMREVERSALS) {&#10;            calculateResults();&#10;            isTestComplete = true;&#10;            document.getElementById('start').disabled = false;&#10;            document.getElementById('viewResult').disabled = false;&#10;            document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;            updateProgressBar(100);&#10;        } else {&#10;            logDebug(&quot;Reached max iterations but has only &quot; + NumberOfReversals + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals. Showing diagnostics.&quot;);&#10;            document.getElementById('text1').value = &quot;Insufficient data. Check diagnostics.&quot;;&#10;            setTimeout(function() {&#10;                showDiagnostics();&#10;            }, 500);&#10;            return;&#10;        }&#10;    } else {&#10;        updateProgressBar();&#10;        beginIteration();&#10;    }&#10;}&#10;&#10;function updateProgressBar(forcePercent) {&#10;    if (typeof forcePercent === 'number') {&#10;        document.getElementById('progressBar').style.width = forcePercent + '%';&#10;        document.getElementById('progressLabel').textContent = 'Progress: ' + forcePercent + '%';&#10;        return;&#10;    }&#10;    &#10;    const maxValue = Math.max(MAXREVERSALS, MAXITERATIONS);&#10;    const currentValue = isTestComplete ? maxValue : Math.max(NumberOfReversals, numberOfIterations);&#10;    const totalPercent = Math.min(100 * (currentValue / maxValue), 100);&#10;    &#10;    document.getElementById('progressBar').style.width = totalPercent + '%';&#10;    document.getElementById('progressLabel').textContent = 'Progress: ' + Math.round(totalPercent) + '%';&#10;}&#10;&#10;function calculateResults() {&#10;    let sum = 0.0, stddevsum = 0.0, average = 0.0, stdev = 0.0, counter = 0;&#10;    &#10;    for (let i = 0; i &lt; Reversals.length; i++) {&#10;        if (Reversals[i] &gt; 0) counter++;&#10;    }&#10;    &#10;    if (counter &lt; MINIMUMREVERSALS) {&#10;        logDebug(&quot;Test has insufficient data&quot;);&#10;        alert(&quot;Test has insufficient data. Please complete the test again.&quot;);&#10;        return;&#10;    }&#10;    &#10;    const startIndex = Math.max(0, NumberOfReversals - THRESHOLD_REVERSAL_COUNT);&#10;    counter = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0) {&#10;            sum += level;&#10;            counter++;&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 0) {&#10;        average = sum / counter;&#10;        average = parseFloat(average.toFixed(2));&#10;    }&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0) {&#10;            stddevsum += Math.pow(level - average, 2);&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 1) {&#10;        stdev = Math.sqrt(stddevsum / (counter - 1));&#10;        stdev = parseFloat(stdev.toFixed(2));&#10;    }&#10;    &#10;    sentAverage = average;&#10;    sentStdev = stdev;&#10;    &#10;    thresholdWindowPercent = calculateAverageWindowPercent(startIndex);&#10;    thresholdWindowDuration = (thresholdWindowPercent / 100) * STANDARD_WINDOW;&#10;    thresholdModulationRate = PITCH_RISE_SEMITONES / (thresholdWindowDuration / 1000);&#10;    thresholdSlope = PITCH_RISE_SEMITONES / thresholdWindowDuration;&#10;    &#10;    jndAbsoluteDifference = STANDARD_WINDOW - thresholdWindowDuration;&#10;    jndRatio = thresholdWindowDuration / STANDARD_WINDOW;&#10;    jndPercentDifference = 100 - thresholdWindowPercent;&#10;    webersRatio = jndAbsoluteDifference / STANDARD_WINDOW;&#10;    &#10;    logDebug(&quot;Test complete! Average difficulty level: &quot; + average.toFixed(2));&#10;    logDebug(&quot;Threshold window: &quot; + thresholdWindowPercent.toFixed(2) + &quot;% (&quot; + thresholdWindowDuration.toFixed(2) + &quot; ms)&quot;);&#10;    logDebug(&quot;JND Absolute Difference: &quot; + jndAbsoluteDifference.toFixed(2) + &quot; ms&quot;);&#10;    logDebug(&quot;JND Ratio: &quot; + jndRatio.toFixed(4));&#10;    logDebug(&quot;JND Percent Difference: &quot; + jndPercentDifference.toFixed(2) + &quot;%&quot;);&#10;    logDebug(&quot;Weber's Ratio: &quot; + webersRatio.toFixed(4));&#10;    &#10;    document.getElementById('text1').value = &quot;Test complete! JND: &quot; + jndAbsoluteDifference.toFixed(1) + &quot; ms&quot;;&#10;}&#10;&#10;function calculateAverageWindowPercent(startIndex) {&#10;    let sum = 0;&#10;    let count = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0 &amp;&amp; MODULATION_WINDOWS[level] !== undefined) {&#10;            sum += MODULATION_WINDOWS[level];&#10;            count++;&#10;        }&#10;    }&#10;    &#10;    return count &gt; 0 ? sum / count : 0;&#10;}&#10;&#10;function calculateReactionTimeStats() {&#10;    let allRTs = trialRecords.map(t =&gt; parseFloat(t.reactionTime));&#10;    &#10;    return {&#10;        mean: allRTs.length ? (allRTs.reduce((a, b) =&gt; a + b, 0) / allRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;        median: allRTs.length ? calculateMedian(allRTs).toFixed(0) : &quot;N/A&quot;,&#10;        sd: allRTs.length &gt; 1 ? calculateSD(allRTs).toFixed(0) : &quot;N/A&quot;&#10;    };&#10;}&#10;&#10;function calculateAccuracyStats() {&#10;    let allTrials = trialRecords;&#10;    &#10;    return {&#10;        correct: allTrials.filter(t =&gt; t.isCorrect).length,&#10;        total: allTrials.length,&#10;        percentage: allTrials.length ? &#10;            (allTrials.filter(t =&gt; t.isCorrect).length / allTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;    };&#10;}&#10;&#10;function calculateMedian(values) {&#10;    if (!values.length) return 0;&#10;    &#10;    const sortedValues = values.slice().sort((a, b) =&gt; a - b);&#10;    const mid = Math.floor(sortedValues.length / 2);&#10;    &#10;    return sortedValues.length % 2 === 0 ? &#10;        (sortedValues[mid - 1] + sortedValues[mid]) / 2 : &#10;        sortedValues[mid];&#10;}&#10;&#10;function calculateSD(values) {&#10;    if (values.length &lt;= 1) return 0;&#10;    &#10;    const mean = values.reduce((a, b) =&gt; a + b, 0) / values.length;&#10;    const variance = values.map(x =&gt; Math.pow(x - mean, 2)).reduce((a, b) =&gt; a + b, 0) / (values.length - 1);&#10;    &#10;    return Math.sqrt(variance);&#10;}&#10;&#10;function displayResults() {&#10;    logDebug(&quot;Displaying results&quot;);&#10;    &#10;    let hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;&#10;    &#10;    if (!hasData) {&#10;        let message = &quot;Warning: Insufficient data. Results may not be reliable.&quot;;&#10;        &#10;        if (confirm(message + &quot;\n\nWould you like to retry the experiment?&quot;)) {&#10;            window_onload();&#10;            return;&#10;        }&#10;    }&#10;    &#10;    document.getElementById('experimentContainer').style.display = 'none';&#10;    document.getElementById('resultsContainer').style.display = 'block';&#10;    &#10;    if (hasData) {&#10;        document.getElementById('jndValue').innerHTML = &#10;            jndAbsoluteDifference.toFixed(2) + ' ms&lt;br&gt;' +&#10;            '&lt;span style=&quot;font-size: 18px;&quot;&gt;(' + jndPercentDifference.toFixed(2) + '% difference from standard)&lt;/span&gt;';&#10;    } else {&#10;        document.getElementById('jndValue').textContent = 'Insufficient Data';&#10;    }&#10;    &#10;    var tableBody = document.getElementById('resultTableBody');&#10;    tableBody.innerHTML = '';&#10;    &#10;    var windowRow = document.createElement('tr');&#10;    windowRow.innerHTML = &#10;        '&lt;td&gt;Modulation Window Duration&lt;/td&gt;' +&#10;        '&lt;td&gt;' + STANDARD_WINDOW + ' ms (100%)&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? thresholdWindowDuration.toFixed(2) + ' ms (' + thresholdWindowPercent.toFixed(2) + '%)' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? jndRatio.toFixed(4) + ' : 1&lt;br&gt;(Threshold/Standard)' : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(windowRow);&#10;    &#10;    var diffRow = document.createElement('tr');&#10;    diffRow.innerHTML = &#10;        '&lt;td&gt;Absolute Difference (JND)&lt;/td&gt;' +&#10;        '&lt;td&gt;0 ms (reference)&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? jndAbsoluteDifference.toFixed(2) + ' ms' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? 'Weber Ratio: ' + webersRatio.toFixed(4) : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(diffRow);&#10;    &#10;    var rateStandard = PITCH_RISE_SEMITONES / (STANDARD_WINDOW / 1000);&#10;    var rateRow = document.createElement('tr');&#10;    rateRow.innerHTML = &#10;        '&lt;td&gt;Modulation Rate&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rateStandard.toFixed(4) + ' semitones/s&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? thresholdModulationRate.toFixed(4) + ' semitones/s' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? (thresholdModulationRate / rateStandard).toFixed(4) + ' : 1' : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(rateRow);&#10;    &#10;    var interpretation = document.getElementById('resultInterpretation');&#10;    let interpretationHtml = '&lt;h3 style=&quot;margin-top: 0;&quot;&gt;Performance Interpretation&lt;/h3&gt;';&#10;    &#10;    if (hasData) {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Your Just Noticeable Difference (JND):&lt;/strong&gt;&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;You can reliably detect a difference when the modulation window changes by &lt;strong&gt;' + &#10;            jndAbsoluteDifference.toFixed(2) + ' ms&lt;/strong&gt; (or &lt;strong&gt;' + jndPercentDifference.toFixed(2) + &#10;            '%&lt;/strong&gt; of the standard 400 ms window).&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;In other words, you can discriminate between:&lt;/p&gt;';&#10;        interpretationHtml += '&lt;ul&gt;';&#10;        interpretationHtml += '&lt;li&gt;Standard stimulus: 400 ms modulation window&lt;/li&gt;';&#10;        interpretationHtml += '&lt;li&gt;Your threshold: ' + thresholdWindowDuration.toFixed(2) + ' ms modulation window&lt;/li&gt;';&#10;        interpretationHtml += '&lt;li&gt;Difference: ' + jndAbsoluteDifference.toFixed(2) + ' ms&lt;/li&gt;';&#10;        interpretationHtml += '&lt;/ul&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Weber\'s Ratio:&lt;/strong&gt; ' + webersRatio.toFixed(4) + &#10;            ' (smaller Weber\'s ratio = better discrimination sensitivity)&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;&lt;em&gt;Note: A &lt;strong&gt;smaller JND&lt;/strong&gt; indicates &lt;strong&gt;better sensitivity&lt;/strong&gt; to dynamic pitch changes, ' +&#10;            'as it means you can detect smaller differences between stimuli.&lt;/em&gt;&lt;/p&gt;';&#10;    } else {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Complete results not available due to insufficient data.&lt;/p&gt;';&#10;    }&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    const accuracyStats = calculateAccuracyStats();&#10;    &#10;    interpretationHtml += '&lt;p&gt;&lt;strong&gt;Overall Performance:&lt;/strong&gt; ' + accuracyStats.percentage + &#10;        '% accuracy with average reaction time of ' + rtStats.mean + ' ms across ' + &#10;        accuracyStats.total + ' trials.&lt;/p&gt;';&#10;    &#10;    interpretation.innerHTML = interpretationHtml;&#10;    &#10;    var detailedBody = document.getElementById('detailedMetricsBody');&#10;    detailedBody.innerHTML = '';&#10;    &#10;    var metrics = [&#10;        { name: 'Average Difficulty Level', value: hasData ? sentAverage.toFixed(2) : 'N/A', interp: hasData ? 'SD: ' + sentStdev.toFixed(2) : 'N/A' },&#10;        { name: 'Threshold Slope', value: hasData ? thresholdSlope.toFixed(6) + ' semitones/ms' : 'N/A', interp: hasData ? 'Rate of pitch change' : 'N/A' },&#10;        { name: 'Number of Reversals', value: NumberOfReversals, interp: 'Minimum required: ' + MINIMUMREVERSALS },&#10;        { name: 'Total Trials', value: numberOfIterations, interp: 'Maximum allowed: ' + MAXITERATIONS }&#10;    ];&#10;    &#10;    metrics.forEach(function(metric) {&#10;        var row = document.createElement('tr');&#10;        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;&lt;td&gt;' + metric.interp + '&lt;/td&gt;';&#10;        detailedBody.appendChild(row);&#10;    });&#10;    &#10;    var perfBody = document.getElementById('performanceStatsBody');&#10;    perfBody.innerHTML = '';&#10;    &#10;    var perfMetrics = [&#10;        { name: 'Total Trials', value: accuracyStats.total },&#10;        { name: 'Correct Responses', value: accuracyStats.correct },&#10;        { name: 'Overall Accuracy', value: accuracyStats.percentage + '%' },&#10;        { name: 'Mean Reaction Time', value: rtStats.mean + ' ms' },&#10;        { name: 'Median Reaction Time', value: rtStats.median + ' ms' },&#10;        { name: 'RT Standard Deviation', value: rtStats.sd + ' ms' }&#10;    ];&#10;    &#10;    perfMetrics.forEach(function(metric) {&#10;        var row = document.createElement('tr');&#10;        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;';&#10;        perfBody.appendChild(row);&#10;    });&#10;}&#10;&#10;function backToExperiment() {&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;}&#10;&#10;function view_onclick() {&#10;    logDebug(&quot;View results button clicked&quot;);&#10;    &#10;    if (!isTestComplete &amp;&amp; NumberOfReversals &gt;= MINIMUMREVERSALS) {&#10;        calculateResults();&#10;        isTestComplete = true;&#10;    }&#10;    &#10;    displayResults();&#10;}&#10;&#10;function beginIteration() {&#10;    isReplayTrial = false;&#10;    &#10;    standardIsFirst = Math.random() &lt; 0.5;&#10;    var xIsStandard = Math.random() &lt; 0.5;&#10;    &#10;    if (xIsStandard) {&#10;        CorrectAnswer = standardIsFirst ? 1 : 2;&#10;    } else {&#10;        CorrectAnswer = standardIsFirst ? 2 : 1;&#10;    }&#10;    &#10;    logDebug(&quot;Starting new iteration #&quot; + numberOfIterations + &#10;             &quot;, Standard is &quot; + (standardIsFirst ? &quot;first&quot; : &quot;second&quot;) +&#10;             &quot;, X is &quot; + (xIsStandard ? &quot;standard&quot; : &quot;comparison&quot;) +&#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Difficulty level: &quot; + currentLevel +&#10;             &quot;, Modulation window: &quot; + MODULATION_WINDOWS[currentLevel] + &quot;% (&quot; + &#10;             getModulationWindowDuration(currentLevel) + &quot; ms)&quot;);&#10;    &#10;    setTimeout(function() {&#10;        playABXSequence(xIsStandard);&#10;    }, 1000);&#10;}&#10;&#10;function clearButtonAnimations() {&#10;    document.getElementById('firstBtn').classList.remove('button-playing');&#10;    document.getElementById('secondBtn').classList.remove('button-playing');&#10;}&#10;&#10;function playABXSequence(xIsStandard) {&#10;    logDebug(&quot;Playing ABX sequence&quot;);&#10;    &#10;    clearButtonAnimations();&#10;&#10;    standardSound = document.getElementById('low_rising_standard');&#10;    comparisonSound = document.getElementById(&quot;low_rising_&quot; + currentLevel);&#10;&#10;    xSound = xIsStandard ? standardSound : comparisonSound;&#10;    &#10;    if (!standardSound || !comparisonSound) {&#10;        logDebug(&quot;Error: Cannot find audio elements!&quot;);&#10;        document.getElementById('text1').value = &quot;出錯：找不到音頻文件&quot;;&#10;        setTimeout(function() {&#10;            showDiagnostics();&#10;        }, 1000);&#10;        return;&#10;    }&#10;    &#10;    var firstSound = standardIsFirst ? standardSound : comparisonSound;&#10;    document.getElementById('text1').value = &quot;播放第一個音&quot;;&#10;    &#10;    document.getElementById('firstBtn').classList.add('button-playing');&#10;    &#10;    firstSound.currentTime = 0;&#10;    var playPromise1 = firstSound.play();&#10;    &#10;    if (playPromise1 !== undefined) {&#10;        playPromise1.then(function() {&#10;            logDebug(&quot;First sound (A) played successfully&quot;);&#10;            &#10;            firstSound.onended = function() {&#10;                logDebug(&quot;First sound ended&quot;);&#10;                &#10;                document.getElementById('firstBtn').classList.remove('button-playing');&#10;                &#10;                setTimeout(function() {&#10;                    var secondSound = standardIsFirst ? comparisonSound : standardSound;&#10;                    document.getElementById('text1').value = &quot;播放第二個音&quot;;&#10;                    &#10;                    document.getElementById('secondBtn').classList.add('button-playing');&#10;                    &#10;                    secondSound.currentTime = 0;&#10;                    var playPromise2 = secondSound.play();&#10;                    &#10;                    if (playPromise2 !== undefined) {&#10;                        playPromise2.then(function() {&#10;                            logDebug(&quot;Second sound (B) played successfully&quot;);&#10;                            &#10;                            secondSound.onended = function() {&#10;                                logDebug(&quot;Second sound ended&quot;);&#10;                                &#10;                                document.getElementById('secondBtn').classList.remove('button-playing');&#10;                                &#10;                                setTimeout(function() {&#10;                                    document.getElementById('text1').value = &quot;播放第三個音&quot;;&#10;                                    &#10;                                    xSound.currentTime = 0;&#10;                                    var playPromise3 = xSound.play();&#10;                                    &#10;                                    if (playPromise3 !== undefined) {&#10;                                        playPromise3.then(function() {&#10;                                            logDebug(&quot;Third sound (X) played successfully&quot;);&#10;                                            &#10;                                            xSound.onended = function() {&#10;                                                logDebug(&quot;Third sound ended, enabling response buttons&quot;);&#10;                                                &#10;                                                stimulusEndTime = performance.now();&#10;                                                &#10;                                                document.getElementById('text1').value = &quot;請作出選擇&quot;;&#10;                                                document.getElementById('promptText').style.visibility = 'visible';&#10;                                                &#10;                                                document.getElementById('firstBtn').disabled = false;&#10;                                                document.getElementById('secondBtn').disabled = false;&#10;                                                document.getElementById('firstBtn').style.background = &quot;#66CCFF&quot;;&#10;                                                document.getElementById('secondBtn').style.background = &quot;#66CCFF&quot;;&#10;                                            };&#10;                                        }).catch(function(error) {&#10;                                            logDebug(&quot;Failed to play third sound: &quot; + error);&#10;                                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                                            clearButtonAnimations();&#10;                                            setTimeout(showDiagnostics, 1000);&#10;                                        });&#10;                                    }&#10;                                }, 1000);&#10;                            };&#10;                        }).catch(function(error) {&#10;                            logDebug(&quot;Failed to play second sound: &quot; + error);&#10;                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                            clearButtonAnimations();&#10;                            setTimeout(showDiagnostics, 1000);&#10;                        });&#10;                    }&#10;                }, 1000);&#10;            };&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to play first sound: &quot; + error);&#10;            document.getElementById('text1').value = &quot;音頻播放錯誤，請刷新頁面&quot;;&#10;            clearButtonAnimations();&#10;            setTimeout(showDiagnostics, 1000);&#10;        });&#10;    }&#10;}&#10;&#10;function start_onclick() {&#10;    logDebug(&quot;Starting experiment&quot;);&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    checkAudioFiles();&#10;    if (!allFilesPresent) {&#10;        logDebug(&quot;Cannot start experiment: Some audio files are missing&quot;);&#10;        document.getElementById('text1').value = &quot;音頻缺失&quot;;&#10;        showDiagnostics();&#10;        return;&#10;    }&#10;    &#10;    window_onload();&#10;    document.getElementById('text1').value = &quot;開始實驗...&quot;;&#10;    updateProgressBar(0);&#10;    &#10;    setTimeout(function() {&#10;        beginIteration();&#10;        document.getElementById('start').disabled = true;&#10;        document.getElementById('viewResult').disabled = true;&#10;        document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;        document.getElementById('promptText').style.visibility = 'hidden';&#10;    }, 1000);&#10;}&#10;&#10;function gotReversal() {&#10;    NumberOfReversals++;&#10;    Reversals[NumberOfReversals - 1] = currentLevel;&#10;    Direction = -Direction;&#10;    logDebug(&quot;Recorded reversal #&quot; + NumberOfReversals + &quot; at difficulty &quot; + currentLevel + &#10;             &quot; (window: &quot; + MODULATION_WINDOWS[currentLevel] + &quot;%, &quot; + &#10;             getModulationWindowDuration(currentLevel) + &quot; ms)&quot;);&#10;}&#10;&#10;function processAnswer(Response) {&#10;    const reactionEndTime = performance.now();&#10;    const reactionTime = reactionEndTime - stimulusEndTime;&#10;    &#10;    logDebug(&quot;User answered: &quot; + (Response === 1 ? &quot;First&quot; : &quot;Second&quot;) + &#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Is replay: &quot; + isReplayTrial);&#10;    &#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    const isCorrect = (Response === CorrectAnswer);&#10;    &#10;    if (!isReplayTrial) {&#10;        const windowPercent = MODULATION_WINDOWS[currentLevel];&#10;        const windowDuration = getModulationWindowDuration(currentLevel);&#10;        const modulationRate = getModulationRate(currentLevel);&#10;        const slope = getModulationSlope(currentLevel);&#10;        &#10;        const trialInfo = {&#10;            trialNumber: numberOfIterations,&#10;            timestamp: getLocalTimestamp(),&#10;            difficultyLevel: currentLevel,&#10;            modulationWindowPercent: windowPercent,&#10;            modulationWindowDuration: windowDuration.toFixed(2),&#10;            modulationRate: modulationRate.toFixed(4),&#10;            slope: slope.toFixed(6),&#10;            userResponse: Response === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            correctResponse: CorrectAnswer === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            isCorrect: isCorrect,&#10;            reactionTime: reactionTime.toFixed(0),&#10;            isReversal: false,&#10;            stepDirection: Direction === DECREASING ? &quot;Increasing Difficulty&quot; : &quot;Decreasing Difficulty&quot;,&#10;            standardPosition: standardIsFirst ? &quot;First&quot; : &quot;Second&quot;&#10;        };&#10;        &#10;        trialRecords.push(trialInfo);&#10;    }&#10;    &#10;    if (isCorrect) {&#10;        logDebug(&quot;Correct answer&quot;);&#10;        document.getElementById('smile').src = &quot;Media/smiley.png&quot;;&#10;        document.getElementById('text1').value = &quot;正確！&quot;;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses++;&#10;            &#10;            if (CorrectResponses == 2) {&#10;                logDebug(&quot;Two correct answers in a row&quot;);&#10;                CorrectResponses = 0;&#10;                &#10;                if (Direction == INCREASING) {&#10;                    gotReversal();&#10;                    if (trialRecords.length &gt; 0) {&#10;                        trialRecords[trialRecords.length-1].isReversal = true;&#10;                    }&#10;                }&#10;                &#10;                changeLevel(DECREASING);&#10;            }&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            resetPage();&#10;        }, 1500);&#10;    } else {&#10;        logDebug(&quot;Incorrect answer - will replay stimulus&quot;);&#10;        document.getElementById('smile').src = &quot;Media/nosmiley.png&quot;;&#10;        &#10;        var correctAnswerText = CorrectAnswer === 1 ? &quot;第一個音&quot; : &quot;第二個音&quot;;&#10;        document.getElementById('text1').value = &quot;錯誤！正確答案是：&quot; + correctAnswerText;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses = 0;&#10;            &#10;            if (Direction == DECREASING) {&#10;                gotReversal();&#10;                if (trialRecords.length &gt; 0) {&#10;                    trialRecords[trialRecords.length-1].isReversal = true;&#10;                }&#10;            }&#10;            &#10;            changeLevel(INCREASING);&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            document.getElementById('text1').value = &quot;重播刺激音...&quot;;&#10;            &#10;            setTimeout(function() {&#10;                isReplayTrial = true;&#10;                &#10;                var xIsStandard = (standardIsFirst &amp;&amp; CorrectAnswer === 1) || &#10;                                  (!standardIsFirst &amp;&amp; CorrectAnswer === 2);&#10;                playABXSequence(xIsStandard);&#10;            }, 1000);&#10;        }, 2000);&#10;    }&#10;}&#10;&#10;function changeLevel(whichWay) {&#10;    var oldLevel = currentLevel;&#10;    var stepSize = NumberOfReversals &lt; 4 ? 2 : 1;&#10;    &#10;    if (whichWay == DECREASING) {&#10;        currentLevel = Math.min(9, currentLevel + stepSize);&#10;    } else {&#10;        currentLevel = Math.max(LOWERLIMIT, currentLevel - stepSize);&#10;    }&#10;    &#10;    logDebug(&quot;Difficulty changed from level &quot; + oldLevel + &quot; (&quot; + MODULATION_WINDOWS[oldLevel] + &quot;%, &quot; +&#10;             getModulationWindowDuration(oldLevel) + &quot; ms) to level &quot; + &#10;             currentLevel + &quot; (&quot; + MODULATION_WINDOWS[currentLevel] + &quot;%, &quot; +&#10;             getModulationWindowDuration(currentLevel) + &quot; ms) &quot; +&#10;             (whichWay == DECREASING ? &quot;(increasing difficulty)&quot; : &quot;(decreasing difficulty)&quot;));&#10;}&#10;&#10;function exportToCSV() {&#10;    const headers = [&#10;        &quot;Trial Number&quot;, &#10;        &quot;Timestamp&quot;, &#10;        &quot;Difficulty Level&quot;, &#10;        &quot;Modulation Window (%)&quot;,&#10;        &quot;Modulation Window (ms)&quot;,&#10;        &quot;Modulation Rate (semitones/s)&quot;,&#10;        &quot;Slope (semitones/ms)&quot;,&#10;        &quot;Standard Position&quot;,&#10;        &quot;User Response&quot;, &#10;        &quot;Correct Response&quot;, &#10;        &quot;Is Correct&quot;, &#10;        &quot;Reaction Time (ms)&quot;, &#10;        &quot;Is Reversal&quot;,&#10;        &quot;Step Direction&quot;&#10;    ];&#10;    &#10;    const csvRows = [];&#10;    csvRows.push(headers.join(&quot;,&quot;));&#10;    &#10;    trialRecords.forEach(function(trial) {&#10;        const row = [&#10;            trial.trialNumber,&#10;            trial.timestamp,&#10;            trial.difficultyLevel,&#10;            trial.modulationWindowPercent,&#10;            trial.modulationWindowDuration,&#10;            trial.modulationRate,&#10;            trial.slope,&#10;            trial.standardPosition,&#10;            trial.userResponse,&#10;            trial.correctResponse,&#10;            trial.isCorrect ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.reactionTime,&#10;            trial.isReversal ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.stepDirection&#10;        ];&#10;        csvRows.push(row.join(&quot;,&quot;));&#10;    });&#10;    &#10;    csvRows.push(&quot;\nRESULTS SUMMARY - JUST NOTICEABLE DIFFERENCE (JND)&quot;);&#10;    csvRows.push(&quot;\nJND Metrics&quot;);&#10;    csvRows.push(&quot;Parameter,Value,Unit,Description&quot;);&#10;    &#10;    const hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;&#10;    &#10;    csvRows.push(&quot;JND Absolute Difference,&quot; + &#10;        (hasData ? jndAbsoluteDifference.toFixed(2) : &quot;N/A&quot;) + &quot;,ms,Detectable difference from standard (smaller = better)&quot;);&#10;    &#10;    csvRows.push(&quot;JND Percentage Difference,&quot; + &#10;        (hasData ? jndPercentDifference.toFixed(2) : &quot;N/A&quot;) + &quot;,%,Percentage difference from standard (smaller = better)&quot;);&#10;    &#10;    csvRows.push(&quot;JND Ratio (Threshold/Standard),&quot; + &#10;        (hasData ? jndRatio.toFixed(4) : &quot;N/A&quot;) + &quot;,ratio,Threshold modulation window / Standard window&quot;);&#10;    &#10;    csvRows.push(&quot;Weber's Ratio,&quot; + &#10;        (hasData ? webersRatio.toFixed(4) : &quot;N/A&quot;) + &quot;,ratio,ΔI / I (smaller = better sensitivity)&quot;);&#10;    &#10;    csvRows.push(&quot;\nThreshold Parameters&quot;);&#10;    csvRows.push(&quot;Parameter,Value,Unit&quot;);&#10;    &#10;    csvRows.push(&quot;Standard Modulation Window,&quot; + STANDARD_WINDOW + &quot;,ms&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Modulation Window,&quot; + &#10;        (hasData ? thresholdWindowDuration.toFixed(2) : &quot;N/A&quot;) + &quot;,ms&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Window Percentage,&quot; + &#10;        (hasData ? thresholdWindowPercent.toFixed(2) : &quot;N/A&quot;) + &quot;,%&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Modulation Rate,&quot; + &#10;        (hasData ? thresholdModulationRate.toFixed(4) : &quot;N/A&quot;) + &quot;,semitones/s&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Slope,&quot; + &#10;        (hasData ? thresholdSlope.toFixed(6) : &quot;N/A&quot;) + &quot;,semitones/ms&quot;);&#10;    &#10;    csvRows.push(&quot;Average Difficulty Level,&quot; + &#10;        (hasData ? sentAverage.toFixed(2) : &quot;N/A&quot;) + &quot;,level (1-9)&quot;);&#10;    &#10;    csvRows.push(&quot;Difficulty Level SD,&quot; + &#10;        (hasData ? sentStdev.toFixed(2) : &quot;N/A&quot;) + &quot;,level&quot;);&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    csvRows.push(&quot;\nReaction Time Statistics&quot;);&#10;    csvRows.push(&quot;Mean,Median,Standard Deviation&quot;);&#10;    csvRows.push(rtStats.mean + &quot;,&quot; + rtStats.median + &quot;,&quot; + rtStats.sd);&#10;    &#10;    const accuracyStats = calculateAccuracyStats();&#10;    csvRows.push(&quot;\nAccuracy Statistics&quot;);&#10;    csvRows.push(&quot;Correct Responses,Total Responses,Percentage&quot;);&#10;    csvRows.push(accuracyStats.correct + &quot;,&quot; + accuracyStats.total + &quot;,&quot; + accuracyStats.percentage + &quot;%&quot;);&#10;    &#10;    csvRows.push(&quot;\nExperiment Parameters&quot;);&#10;    csvRows.push(&quot;Parameter,Value&quot;);&#10;    csvRows.push(&quot;Paradigm,ABX&quot;);&#10;    csvRows.push(&quot;Stimulus Type,Dynamic Pitch (Rising Tone)&quot;);&#10;    csvRows.push(&quot;Total Stimulus Duration,&quot; + STIMULUS_DURATION + &quot; ms&quot;);&#10;    csvRows.push(&quot;Standard Modulation Window,&quot; + STANDARD_WINDOW + &quot; ms&quot;);&#10;    csvRows.push(&quot;Pitch Rise Amount,&quot; + PITCH_RISE_SEMITONES + &quot; semitone(s)&quot;);&#10;    csvRows.push(&quot;Max Reversals,&quot; + MAXREVERSALS);&#10;    csvRows.push(&quot;Min Reversals for Calculation,&quot; + MINIMUMREVERSALS);&#10;    csvRows.push(&quot;Max Iterations,&quot; + MAXITERATIONS);&#10;    &#10;    csvRows.push(&quot;\nDifficulty Level Mapping&quot;);&#10;    csvRows.push(&quot;Level,Modulation Window (%),Modulation Window (ms),Difference from Standard (ms),Modulation Rate (semitones/s),Slope (semitones/ms)&quot;);&#10;    for (let level = 1; level &lt;= 9; level++) {&#10;        const windowPercent = MODULATION_WINDOWS[level];&#10;        const windowDuration = getModulationWindowDuration(level);&#10;        const diffFromStandard = STANDARD_WINDOW - windowDuration;&#10;        const rate = getModulationRate(level);&#10;        const slope = getModulationSlope(level);&#10;        csvRows.push(level + &quot;,&quot; + windowPercent + &quot;,&quot; + windowDuration.toFixed(2) + &quot;,&quot; + &#10;                     diffFromStandard.toFixed(2) + &quot;,&quot; + rate.toFixed(4) + &quot;,&quot; + slope.toFixed(6));&#10;    }&#10;    &#10;    const csvContent = &quot;data:text/csv;charset=utf-8,&quot; + csvRows.join(&quot;\n&quot;);&#10;    const encodedUri = encodeURI(csvContent);&#10;    const link = document.createElement(&quot;a&quot;);&#10;    const timestamp = new Date().toISOString().replace(/[:.]/g, &quot;-&quot;);&#10;    link.setAttribute(&quot;href&quot;, encodedUri);&#10;    link.setAttribute(&quot;download&quot;, &quot;dynamic_pitch_JND_ABX_data_&quot; + timestamp + &quot;.csv&quot;);&#10;    document.body.appendChild(link);&#10;    link.click();&#10;    document.body.removeChild(link);&#10;}&#10;&#10;function window_onload() {&#10;    window.name = &quot;EXP&quot;;&#10;    NumberOfReversals = 0;&#10;    numberOfIterations = 0;&#10;    CorrectResponses = 0;&#10;    Direction = DECREASING;&#10;    currentLevel = 5;&#10;    isTestComplete = false;&#10;    Reversals = [];&#10;    trialRecords = [];&#10;    isReplayTrial = false;&#10;    &#10;    jndAbsoluteDifference = 0;&#10;    jndRatio = 0;&#10;    jndPercentDifference = 0;&#10;    thresholdWindowDuration = 0;&#10;    thresholdWindowPercent = 0;&#10;    thresholdModulationRate = 0;&#10;    thresholdSlope = 0;&#10;    webersRatio = 0;&#10;&#10;    document.getElementById('text1').value = &quot;準備完畢後請點擊\&quot;開始實驗\&quot;&quot;;&#10;    document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;    document.getElementById('start').disabled = false;&#10;    document.getElementById('viewResult').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;    &#10;    updateProgressBar(0);&#10;    &#10;    logDebug(&quot;Page reset complete&quot;);&#10;}&#10;&#10;window.onload = function() {&#10;    window_onload();&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    logDebug(&quot;Preloading &quot; + allAudios.length + &quot; audio files&quot;);&#10;    &#10;    allAudios.forEach(function(audio) {&#10;        audio.load();&#10;    });&#10;    &#10;    document.getElementById('text1').value = &quot;請點擊\&quot;開始實驗\&quot;&quot;;&#10;    &#10;    window.onerror = function(message, source, lineno, colno, error) {&#10;        logDebug(&quot;Global error: &quot; + message + &quot; at &quot; + source + &quot;:&quot; + lineno);&#10;        return false;&#10;    };&#10;    &#10;    document.getElementById('showDebug').checked = true;&#10;    toggleDebug();&#10;};&#10;&lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
                    <entry key="file:///E:/Projects/Pitch_Training/index.html" value="&lt;!DOCTYPE html&gt;&#10;&lt;html lang=&quot;zh-CN&quot;&gt;&#10;&lt;head&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;title&gt;PLOYU-Peng's Lab: 音高敏感度训练系统&lt;/title&gt;&#10;    &lt;style&gt;&#10;        * {&#10;            margin: 0;&#10;            padding: 0;&#10;            box-sizing: border-box;&#10;        }&#10;&#10;        body {&#10;            font-family: 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif;&#10;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&#10;            min-height: 100vh;&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            padding: 20px;&#10;        }&#10;&#10;        .container {&#10;            max-width: 1200px;&#10;            width: 100%;&#10;            background: white;&#10;            border-radius: 20px;&#10;            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);&#10;            overflow: hidden;&#10;        }&#10;&#10;        .header {&#10;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&#10;            color: white;&#10;            padding: 40px;&#10;            text-align: center;&#10;        }&#10;&#10;        .header h1 {&#10;            font-size: 36px;&#10;            margin-bottom: 10px;&#10;            font-weight: 600;&#10;        }&#10;&#10;        .header p {&#10;            font-size: 18px;&#10;            opacity: 0.9;&#10;        }&#10;&#10;        .content {&#10;            padding: 40px;&#10;        }&#10;&#10;        .intro {&#10;            text-align: center;&#10;            margin-bottom: 40px;&#10;            color: #555;&#10;        }&#10;&#10;        .intro h2 {&#10;            color: #333;&#10;            margin-bottom: 15px;&#10;            font-size: 28px;&#10;        }&#10;&#10;        .intro p {&#10;            font-size: 16px;&#10;            line-height: 1.6;&#10;            max-width: 800px;&#10;            margin: 0 auto;&#10;        }&#10;&#10;        .experiments-grid {&#10;            display: grid;&#10;            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));&#10;            gap: 25px;&#10;            margin-top: 30px;&#10;        }&#10;&#10;        .experiment-card {&#10;            background: #f8f9fa;&#10;            border-radius: 15px;&#10;            padding: 30px;&#10;            text-align: center;&#10;            transition: all 0.3s ease;&#10;            border: 2px solid transparent;&#10;            cursor: pointer;&#10;            position: relative;&#10;            overflow: hidden;&#10;        }&#10;&#10;        .experiment-card::before {&#10;            content: '';&#10;            position: absolute;&#10;            top: 0;&#10;            left: 0;&#10;            width: 100%;&#10;            height: 5px;&#10;            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);&#10;            transform: scaleX(0);&#10;            transition: transform 0.3s ease;&#10;        }&#10;&#10;        .experiment-card:hover {&#10;            transform: translateY(-5px);&#10;            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);&#10;            border-color: #667eea;&#10;        }&#10;&#10;        .experiment-card:hover::before {&#10;            transform: scaleX(1);&#10;        }&#10;&#10;        .experiment-icon {&#10;            font-size: 48px;&#10;            margin-bottom: 15px;&#10;        }&#10;&#10;        .experiment-card h3 {&#10;            color: #333;&#10;            font-size: 22px;&#10;            margin-bottom: 10px;&#10;        }&#10;&#10;        .experiment-card p {&#10;            color: #666;&#10;            font-size: 14px;&#10;            margin-bottom: 20px;&#10;            line-height: 1.5;&#10;        }&#10;&#10;        .experiment-card .btn {&#10;            display: inline-block;&#10;            padding: 12px 30px;&#10;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&#10;            color: white;&#10;            text-decoration: none;&#10;            border-radius: 25px;&#10;            font-weight: 600;&#10;            transition: all 0.3s ease;&#10;            border: none;&#10;            cursor: pointer;&#10;            font-size: 16px;&#10;        }&#10;&#10;        .experiment-card .btn:hover {&#10;            transform: scale(1.05);&#10;            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);&#10;        }&#10;&#10;        .info-section {&#10;            background: #e8f4f8;&#10;            border-radius: 15px;&#10;            padding: 30px;&#10;            margin-top: 40px;&#10;        }&#10;&#10;        .info-section h3 {&#10;            color: #2c3e50;&#10;            margin-bottom: 15px;&#10;            font-size: 24px;&#10;        }&#10;&#10;        .info-section ul {&#10;            list-style: none;&#10;            padding-left: 0;&#10;        }&#10;&#10;        .info-section li {&#10;            padding: 10px 0;&#10;            color: #555;&#10;            font-size: 15px;&#10;            line-height: 1.6;&#10;        }&#10;&#10;        .info-section li::before {&#10;            content: &quot;✓&quot;;&#10;            color: #667eea;&#10;            font-weight: bold;&#10;            margin-right: 10px;&#10;        }&#10;&#10;        .footer {&#10;            text-align: center;&#10;            padding: 20px;&#10;            color: #999;&#10;            font-size: 14px;&#10;            border-top: 1px solid #eee;&#10;        }&#10;&#10;        @media (max-width: 768px) {&#10;            .header h1 {&#10;                font-size: 28px;&#10;            }&#10;&#10;            .header p {&#10;                font-size: 16px;&#10;            }&#10;&#10;            .experiments-grid {&#10;                grid-template-columns: 1fr;&#10;            }&#10;&#10;            .content {&#10;                padding: 20px;&#10;            }&#10;        }&#10;&#10;        .badge {&#10;            display: inline-block;&#10;            padding: 5px 12px;&#10;            background: #667eea;&#10;            color: white;&#10;            border-radius: 12px;&#10;            font-size: 12px;&#10;            font-weight: 600;&#10;            margin-top: 10px;&#10;        }&#10;&#10;        .rising { background: #3498db; }&#10;        .falling { background: #e74c3c; }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;&lt;div class=&quot;container&quot;&gt;&#10;    &lt;div class=&quot;header&quot;&gt;&#10;        &lt;h1&gt; PLOYU-Peng's Lab&lt;/h1&gt;&#10;        &lt;p&gt;音高敏感度训练系统 - Pitch Sensitivity Training System&lt;/p&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;content&quot;&gt;&#10;        &lt;div class=&quot;intro&quot;&gt;&#10;            &lt;h2&gt;欢迎来到音高辨别实验平台&lt;/h2&gt;&#10;            &lt;p&gt;&#10;                本系统采用ABX范式进行动态音高敏感度训练与测试。通过自适应阈值实验，&#10;                精确测量您对不同音高变化模式的辨别能力（Just Noticeable Difference, JND）。&#10;                请选择以下任一实验开始您的音高感知训练。&#10;            &lt;/p&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div class=&quot;experiments-grid&quot;&gt;&#10;            &lt;div class=&quot;experiment-card&quot; onclick=&quot;window.location.href='ABX_rising_low.html'&quot;&gt;&#10;                &lt;div class=&quot;experiment-icon&quot;&gt;&lt;/div&gt;&#10;                &lt;h3&gt;动态音高辨别-低升调&lt;/h3&gt;&#10;                &lt;span class=&quot;badge rising&quot;&gt;Rising Tone&lt;/span&gt;&#10;                &lt;p&gt;测试对低音区升调变化的敏感度。通过调节调制窗口时长，评估您对缓慢音高上升的辨别能力。&lt;/p&gt;&#10;                &lt;a href=&quot;ABX_rising_low.html&quot; class=&quot;btn&quot; onclick=&quot;event.stopPropagation()&quot;&gt;开始实验&lt;/a&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;experiment-card&quot; onclick=&quot;window.location.href='ABX_rising_high.html'&quot;&gt;&#10;                &lt;div class=&quot;experiment-icon&quot;&gt;&lt;/div&gt;&#10;                &lt;h3&gt;动态音高辨别-高升调&lt;/h3&gt;&#10;                &lt;span class=&quot;badge rising&quot;&gt;Rising Tone&lt;/span&gt;&#10;                &lt;p&gt;测试对高音区升调变化的敏感度。评估您在高频范围内对音高上升的感知精度。&lt;/p&gt;&#10;                &lt;a href=&quot;ABX_rising_high.html&quot; class=&quot;btn&quot; onclick=&quot;event.stopPropagation()&quot;&gt;开始实验&lt;/a&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;experiment-card&quot; onclick=&quot;window.location.href='ABX_falling_low.html'&quot;&gt;&#10;                &lt;div class=&quot;experiment-icon&quot;&gt;&lt;/div&gt;&#10;                &lt;h3&gt;动态音高辨别-低降调&lt;/h3&gt;&#10;                &lt;span class=&quot;badge falling&quot;&gt;Falling Tone&lt;/span&gt;&#10;                &lt;p&gt;测试对低音区降调变化的敏感度。通过调节调制窗口时长，评估您对音高下降的辨别能力。&lt;/p&gt;&#10;                &lt;a href=&quot;ABX_falling_low.html&quot; class=&quot;btn&quot; onclick=&quot;event.stopPropagation()&quot;&gt;开始实验&lt;/a&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;experiment-card&quot; onclick=&quot;window.location.href='ABX_falling_high.html'&quot;&gt;&#10;                &lt;div class=&quot;experiment-icon&quot;&gt;&lt;/div&gt;&#10;                &lt;h3&gt;动态音高辨别-高降调&lt;/h3&gt;&#10;                &lt;span class=&quot;badge falling&quot;&gt;Falling Tone&lt;/span&gt;&#10;                &lt;p&gt;测试对低音区平调变化的敏感度。评估您在高频范围内对音高下降的感知精度。&lt;/p&gt;&#10;                &lt;a href=&quot;ABX_falling_high.html&quot; class=&quot;btn&quot; onclick=&quot;event.stopPropagation()&quot;&gt;开始实验&lt;/a&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;experiment-card&quot; onclick=&quot;window.location.href='ABX_level_high.html'&quot;&gt;&#10;                &lt;div class=&quot;experiment-icon&quot;&gt;&lt;/div&gt;&#10;                &lt;h3&gt;静态音高辨别-高调域&lt;/h3&gt;&#10;                &lt;span class=&quot;badge rising&quot;&gt;Rising Tone&lt;/span&gt;&#10;                &lt;p&gt;测试对高音区平调变化的敏感度。评估您在高频范围内对音高的辨别能力。&lt;/p&gt;&#10;                &lt;a href=&quot;ABX_level_high.html&quot; class=&quot;btn&quot; onclick=&quot;event.stopPropagation()&quot;&gt;开始实验&lt;/a&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;experiment-card&quot; onclick=&quot;window.location.href='ABX_level_low.html'&quot;&gt;&#10;                &lt;div class=&quot;experiment-icon&quot;&gt;&lt;/div&gt;&#10;                &lt;h3&gt;静态音高辨别-低调域&lt;/h3&gt;&#10;                &lt;span class=&quot;badge falling&quot;&gt;Falling Tone&lt;/span&gt;&#10;                &lt;p&gt;测试对低音区平调变化的敏感度。评估您在低频范围内对音高的辨别能力。&lt;/p&gt;&#10;                &lt;a href=&quot;ABX_level_low.html&quot; class=&quot;btn&quot; onclick=&quot;event.stopPropagation()&quot;&gt;开始实验&lt;/a&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div class=&quot;info-section&quot;&gt;&#10;            &lt;h3&gt; 实验说明&lt;/h3&gt;&#10;            &lt;ul&gt;&#10;                &lt;li&gt;&lt;strong&gt;实验范式：&lt;/strong&gt;ABX三音辨别任务 - 您将听到三个音，判断第三个音更像第一个还是第二个&lt;/li&gt;&#10;                &lt;li&gt;&lt;strong&gt;自适应算法：&lt;/strong&gt;系统会根据您的表现自动调整难度，精确定位您的辨别阈值&lt;/li&gt;&#10;                &lt;li&gt;&lt;strong&gt;测量指标：&lt;/strong&gt;Just Noticeable Difference (JND) - 可察觉的最小差异&lt;/li&gt;&#10;                &lt;li&gt;&lt;strong&gt;实验时长：&lt;/strong&gt;每个实验约需10-15分钟完成&lt;/li&gt;&#10;                &lt;li&gt;&lt;strong&gt;结果分析：&lt;/strong&gt;实验结束后可查看详细的阈值分析报告和性能统计&lt;/li&gt;&#10;                &lt;li&gt;&lt;strong&gt;数据导出：&lt;/strong&gt;支持导出CSV格式的详细实验数据&lt;/li&gt;&#10;                &lt;li&gt;&lt;strong&gt;建议环境：&lt;/strong&gt;请在安静环境下使用耳机完成实验，以获得最佳测试效果&lt;/li&gt;&#10;            &lt;/ul&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div class=&quot;info-section&quot; style=&quot;background: #fff3cd; margin-top: 20px;&quot;&gt;&#10;            &lt;h3&gt;⚠️ 注意事项&lt;/h3&gt;&#10;            &lt;ul&gt;&#10;                &lt;li&gt;首次使用时，浏览器可能会请求音频播放权限，请点击允许&lt;/li&gt;&#10;                &lt;li&gt;建议使用Chrome、Firefox或Edge等现代浏览器&lt;/li&gt;&#10;                &lt;li&gt;实验过程中请保持专注，避免中途退出&lt;/li&gt;&#10;                &lt;li&gt;如遇到音频播放问题，可点击实验页面中的&quot;Diagnostics&quot;按钮进行诊断&lt;/li&gt;&#10;            &lt;/ul&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;footer&quot;&gt;&#10;        &lt;p&gt;&amp;copy; 2024 PLOYU-Peng's Lab | Pitch Sensitivity Training System&lt;/p&gt;&#10;        &lt;p style=&quot;margin-top: 5px; font-size: 12px;&quot;&gt;Powered by Adaptive Threshold Experiment Technology&lt;/p&gt;&#10;    &lt;/div&gt;&#10;&lt;/div&gt;&#10;&#10;&lt;script&gt;&#10;    // 页面加载动画&#10;    document.addEventListener('DOMContentLoaded', function() {&#10;        const cards = document.querySelectorAll('.experiment-card');&#10;        cards.forEach((card, index) =&gt; {&#10;            card.style.opacity = '0';&#10;            card.style.transform = 'translateY(20px)';&#10;            setTimeout(() =&gt; {&#10;                card.style.transition = 'all 0.5s ease';&#10;                card.style.opacity = '1';&#10;                card.style.transform = 'translateY(0)';&#10;            }, index * 100);&#10;        });&#10;    });&#10;&#10;    // 检查实验文件是否存在&#10;    window.addEventListener('load', function() {&#10;        const experimentFiles = [&#10;            'ABX_rising_low.html',&#10;            'ABX_rising_high.html',&#10;            'ABX_falling_low.html',&#10;            'ABX_falling_high.html',&#10;            'ABX_rising_mid.html',&#10;            'ABX_falling_mid.html'&#10;        ];&#10;&#10;        // 可以在这里添加文件存在性检查逻辑&#10;        console.log('实验系统已加载');&#10;        console.log('可用实验:', experimentFiles);&#10;    });&#10;&lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
                  </map>
                </option>
                <option name="inputToken" value="33869" />
                <option name="messageId" value="019a672d1c1a7fdfb87b56e0d5fdd88d" />
                <option name="model" value="claude-4.5-sonnet" />
                <option name="outputToken" value="1376" />
                <option name="protocol" value="ag-ui" />
                <option name="question" value="我希望在实验完成后，将实验结果发送到指定的邮箱，请先给我几个方案，另外，发邮件的功能需要封装在一个新的文件中，由各文件复用" />
                <option name="rating" value="UNRATED" />
                <option name="referenceBeans">
                  <list />
                </option>
                <option name="status" value="SUCCESS" />
                <option name="totalToken" value="35245" />
                <option name="variables">
                  <list />
                </option>
              </Turn>
              <Turn>
                <option name="agent" value="" />
                <option name="aguiRpcList">
                  <list>
                    <option value="{&quot;type&quot;:&quot;RUN_STARTED&quot;,&quot;timestamp&quot;:1762667960,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;threadId&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;runId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762667963,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762667967,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;我已经仔细阅读了您的代码。我将为您创建一个使用EmailJS的邮件发送服务，并在实验完成后自动将CSV文件作为附件发送到指定邮箱。\n\n让我先检查一下项目结构，然后创建封装的邮件服务模块。&quot;},&quot;timestamp&quot;:1762667967,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762667969,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762667969,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_lIfAeFL4TVSKBqLoLbjnkw&quot;,&quot;name&quot;:&quot;list_dir&quot;,&quot;display_name&quot;:&quot;查找目录&quot;,&quot;render_type&quot;:&quot;ListItems&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_lIfAeFL4TVSKBqLoLbjnkw&quot;,&quot;toolCallName&quot;:&quot;list_dir&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762667970,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_lIfAeFL4TVSKBqLoLbjnkw&quot;,&quot;document&quot;:{&quot;path&quot;:&quot;E:/Projects/Pitch_Training&quot;,&quot;sub_content&quot;:&quot;Pitch_Training&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training&quot;}},&quot;toolCallId&quot;:&quot;tooluse_lIfAeFL4TVSKBqLoLbjnkw&quot;,&quot;delta&quot;:&quot;{\&quot;path\&quot;: \&quot;E:/Projects/Pitch_Training\&quot;, \&quot;explanation\&quot;: \&quot;检查项目目录结构，确认是否已有js文件夹\&quot;}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762667970,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_lIfAeFL4TVSKBqLoLbjnkw&quot;},&quot;toolCallId&quot;:&quot;tooluse_lIfAeFL4TVSKBqLoLbjnkw&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762667970,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_lIfAeFL4TVSKBqLoLbjnkw&quot;,&quot;result&quot;:{&quot;items&quot;:[{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;.gitattributes&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/.gitattributes&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/.gitattributes&quot;,&quot;suffix_content&quot;:&quot;280 Byte&quot;},{&quot;item_type&quot;:&quot;directory&quot;,&quot;content&quot;:&quot;2AFC/&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_falling_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_high.html&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_high.html&quot;,&quot;suffix_content&quot;:&quot;60.05 KB&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_falling_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;suffix_content&quot;:&quot;60.02 KB&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_level_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_high.html&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_high.html&quot;,&quot;suffix_content&quot;:&quot;68.25 KB&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_level_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;suffix_content&quot;:&quot;68.18 KB&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_rising_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_high.html&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_high.html&quot;,&quot;suffix_content&quot;:&quot;60.03 KB&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_rising_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_low.html&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_low.html&quot;,&quot;suffix_content&quot;:&quot;59.99 KB&quot;},{&quot;item_type&quot;:&quot;directory&quot;,&quot;content&quot;:&quot;Media/&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;index.html&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/index.html&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/index.html&quot;,&quot;suffix_content&quot;:&quot;12.26 KB&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;training materials memo.docx&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/training materials memo.docx&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/training materials memo.docx&quot;,&quot;suffix_content&quot;:&quot;1016.61 KB&quot;}]},&quot;suffix_content&quot;:&quot;找到11个结果&quot;,&quot;suffix_content_tip&quot;:&quot;找到11个结果&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_lIfAeFL4TVSKBqLoLbjnkw&quot;,&quot;content&quot;:&quot;[{\&quot;file\&quot;: \&quot;.gitattributes\&quot;, \&quot;fileSize\&quot;: \&quot;280 Byte\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: false}, {\&quot;file\&quot;: \&quot;2AFC/\&quot;, \&quot;fileType\&quot;: \&quot;directory\&quot;, \&quot;subItemCnt\&quot;: 13}, {\&quot;file\&quot;: \&quot;ABX_falling_high.html\&quot;, \&quot;fileSize\&quot;: \&quot;60.05 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: true}, {\&quot;file\&quot;: \&quot;ABX_falling_low.html\&quot;, \&quot;fileSize\&quot;: \&quot;60.02 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: true}, {\&quot;file\&quot;: \&quot;ABX_level_high.html\&quot;, \&quot;fileSize\&quot;: \&quot;68.25 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: true}, {\&quot;file\&quot;: \&quot;ABX_level_low.html\&quot;, \&quot;fileSize\&quot;: \&quot;68.18 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: true}, {\&quot;file\&quot;: \&quot;ABX_rising_high.html\&quot;, \&quot;fileSize\&quot;: \&quot;60.03 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: true}, {\&quot;file\&quot;: \&quot;ABX_rising_low.html\&quot;, \&quot;fileSize\&quot;: \&quot;59.99 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: true}, {\&quot;file\&quot;: \&quot;Media/\&quot;, \&quot;fileType\&quot;: \&quot;directory\&quot;, \&quot;subItemCnt\&quot;: 13}, {\&quot;file\&quot;: \&quot;index.html\&quot;, \&quot;fileSize\&quot;: \&quot;12.26 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: false}, {\&quot;file\&quot;: \&quot;training materials memo.docx\&quot;, \&quot;fileSize\&quot;: \&quot;1016.61 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: true}]&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762667970,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:189,&quot;prompt_tokens&quot;:36029,&quot;total_tokens&quot;:36218,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:null,&quot;cache_write_tokens&quot;:36025},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762667970,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762667976,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;好的，我看到项目中还没有js文件夹。现在我将：\n1. 创建js文件夹和emailService.js文件\n2. 创建配置文件\n3. 修改所有实验HTML文件以集成邮件发送功能\n\n让我开始创建邮件服务模块：&quot;},&quot;timestamp&quot;:1762667976,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762667977,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762667977,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_vF2_41WKS-aimhhXoSaFrA&quot;,&quot;name&quot;:&quot;terminal&quot;,&quot;display_name&quot;:&quot;执行命令&quot;,&quot;render_type&quot;:&quot;RunTerminal&quot;,&quot;default_show&quot;:true,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_vF2_41WKS-aimhhXoSaFrA&quot;,&quot;toolCallName&quot;:&quot;terminal&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762667977,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_vF2_41WKS-aimhhXoSaFrA&quot;,&quot;document&quot;:{&quot;command&quot;:&quot;mkdir js&quot;,&quot;cwd&quot;:&quot;E:/Projects/Pitch_Training&quot;,&quot;shell_type&quot;:&quot;powershell&quot;,&quot;sub_content&quot;:&quot;mkdir js&quot;,&quot;sub_content_tip&quot;:&quot;mkdir js&quot;}},&quot;toolCallId&quot;:&quot;tooluse_vF2_41WKS-aimhhXoSaFrA&quot;,&quot;delta&quot;:&quot;{\&quot;command\&quot;: \&quot;mkdir js\&quot;, \&quot;commandWorkingDirectory\&quot;: \&quot;E:/Projects/Pitch_Training\&quot;}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762667977,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_vF2_41WKS-aimhhXoSaFrA&quot;},&quot;toolCallId&quot;:&quot;tooluse_vF2_41WKS-aimhhXoSaFrA&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762667980,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_vF2_41WKS-aimhhXoSaFrA&quot;,&quot;result&quot;:{&quot;content&quot;:&quot;\n\n    目录: E:\\Projects\\Pitch_Training\n\n\nMode                 LastWriteTime         Length Name                                                                 \n----                 -------------         ------ ----                                                                 \nd-----         2025/11/9     13:59                js                                                                   \n\n\n&quot;,&quot;command&quot;:&quot;&quot;,&quot;real_command&quot;:&quot;mkdir js&quot;,&quot;status&quot;:&quot;success&quot;,&quot;operation&quot;:&quot;&quot;},&quot;sub_content&quot;:&quot;mkdir js&quot;,&quot;sub_content_tip&quot;:&quot;mkdir js&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_vF2_41WKS-aimhhXoSaFrA&quot;,&quot;content&quot;:&quot;\n\n    目录: E:\\Projects\\Pitch_Training\n\n\nMode                 LastWriteTime         Length Name                                                                 \n----                 -------------         ------ ----                                                                 \nd-----         2025/11/9     13:59                js                                                                   \n\n\n&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762667980,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:169,&quot;prompt_tokens&quot;:36768,&quot;total_tokens&quot;:36937,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:36025,&quot;cache_write_tokens&quot;:736},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762667980,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762667986,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_OuQZugLsRYC4T0MyvruA3w&quot;,&quot;name&quot;:&quot;edit_file&quot;,&quot;display_name&quot;:&quot;编辑文件&quot;,&quot;render_type&quot;:&quot;CodeApply&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_OuQZugLsRYC4T0MyvruA3w&quot;,&quot;toolCallName&quot;:&quot;edit_file&quot;}" />
                    <option value="{&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_OuQZugLsRYC4T0MyvruA3w&quot;,&quot;document&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/js/emailService.js&quot;,&quot;sub_content&quot;:&quot;emailService.js&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/js/emailService.js&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/js/emailService.js&quot;,&quot;apply_content&quot;:&quot;/**\n * Email Service Module - 使用 EmailJS 发送实验结果\n * \n * 使用说明：\n * 1. 在 EmailJS 官网 (https://www.emailjs.com/) 注册账户\n * 2. 创建邮件服务（如 Gmail）\n * 3. 创建邮件模板\n * 4. 获取 Service ID, Template ID 和 Public Key\n * 5. 在 emailConfig.js 中配置这些参数\n */\n\n// EmailJS 配置（从 emailConfig.js 导入）\nlet emailConfig = {\n    serviceId: 'YOUR_SERVICE_ID',        // 替换为您的 EmailJS Service ID\n    templateId: 'YOUR_TEMPLATE_ID',      // 替换为您的 EmailJS Template ID\n    publicKey: 'YOUR_PUBLIC_KEY',        // 替换为您的 EmailJS Public Key\n    recipientEmail: 'recipient@example.com'  // 收件人邮箱\n};\n\n/**\n * 初始化 EmailJS 配置\n * @param {Object} config - 配置对象\n */\nfunction initEmailService(config) {\n    if (config) {\n        emailConfig = { ...emailConfig, ...config };\n    }\n    \n    // 初始化 EmailJS\n    if (typeof emailjs !== 'undefined') {\n        emailjs.init(emailConfig.publicKey);\n        console.log('[EmailService] EmailJS initialized successfully');\n    } else {\n        console.error('[EmailService] EmailJS library not loaded');\n    }\n}\n\n/**\n * 生成 CSV 内容（从实验数据生成）\n * @param {Array} trialRecords - 试验记录数组\n * @param {Object} results - 实验结果对象\n * @param {Object} experimentInfo - 实验信息\n * @returns {string} CSV 格式的字符串\n */\nfunction generateCSVContent(trialRecords, results, experimentInfo) {\n    const headers = [\n        \&quot;Trial Number\&quot;, \n        \&quot;Timestamp\&quot;, \n        \&quot;Difficulty Level\&quot;, \n        \&quot;Modulation Window (%)\&quot;,\n        \&quot;Modulation Window (ms)\&quot;,\n        \&quot;Modulation Rate (semitones/s)\&quot;,\n        \&quot;Slope (semitones/ms)\&quot;,\n        \&quot;Standard Position\&quot;,\n        \&quot;User Response\&quot;, \n        \&quot;Correct Response\&quot;, \n        \&quot;Is Correct\&quot;, \n        \&quot;Reaction Time (ms)\&quot;, \n        \&quot;Is Reversal\&quot;,\n        \&quot;Step Direction\&quot;\n    ];\n    \n    const csvRows = [];\n    csvRows.push(headers.join(\&quot;,\&quot;));\n    \n    // 添加试验数据\n    trialRecords.forEach(function(trial) {\n        const row = [\n            trial.trialNumber,\n            trial.timestamp,\n            trial.difficultyLevel,\n            trial.modulationWindowPercent || 'N/A',\n            trial.modulationWindowDuration || 'N/A',\n            trial.modulationRate || 'N/A',\n            trial.slope || 'N/A',\n            trial.standardPosition || 'N/A',\n            trial.userResponse,\n            trial.correctResponse,\n            trial.isCorrect ? \&quot;1\&quot; : \&quot;0\&quot;,\n            trial.reactionTime,\n            trial.isReversal ? \&quot;1\&quot; : \&quot;0\&quot;,\n            trial.stepDirection || 'N/A'\n        ];\n        csvRows.push(row.join(\&quot;,\&quot;));\n    });\n    \n    // 添加结果摘要\n    if (results) {\n        csvRows.push(\&quot;\\nRESULTS SUMMARY\&quot;);\n        csvRows.push(\&quot;\\nJND Metrics\&quot;);\n        csvRows.push(\&quot;Parameter,Value,Unit,Description\&quot;);\n        \n        if (results.jndAbsoluteDifference !== undefined) {\n            csvRows.push(\&quot;JND Absolute Difference,\&quot; + \n                results.jndAbsoluteDifference.toFixed(2) + \&quot;,ms,Detectable difference from standard\&quot;);\n        }\n        \n        if (results.jndPercentDifference !== undefined) {\n            csvRows.push(\&quot;JND Percentage Difference,\&quot; + \n                results.jndPercentDifference.toFixed(2) + \&quot;,%,Percentage difference from standard\&quot;);\n        }\n        \n        if (results.webersRatio !== undefined) {\n            csvRows.push(\&quot;Weber's Ratio,\&quot; + \n                results.webersRatio.toFixed(4) + \&quot;,ratio,Sensitivity measure\&quot;);\n        }\n        \n        // 添加实验信息\n        if (experimentInfo) {\n            csvRows.push(\&quot;\\nExperiment Information\&quot;);\n            csvRows.push(\&quot;Parameter,Value\&quot;);\n            csvRows.push(\&quot;Experiment Type,\&quot; + (experimentInfo.type || 'N/A'));\n            csvRows.push(\&quot;Completion Date,\&quot; + (experimentInfo.completionDate || new Date().toISOString()));\n            csvRows.push(\&quot;Total Trials,\&quot; + (experimentInfo.totalTrials || trialRecords.length));\n            csvRows.push(\&quot;Total Reversals,\&quot; + (experimentInfo.totalReversals || 'N/A'));\n        }\n    }\n    \n    return csvRows.join(\&quot;\\n\&quot;);\n}\n\n/**\n * 将 CSV 内容转换为 Base64 编码（用于附件）\n * @param {string} csvContent - CSV 内容字符串\n * @returns {string} Base64 编码的字符串\n */\nfunction csvToBase64(csvContent) {\n    // 使用 UTF-8 BOM 确保中文正确显示\n    const BOM = '\\uFEFF';\n    const contentWithBOM = BOM + csvContent;\n    return btoa(unescape(encodeURIComponent(contentWithBOM)));\n}\n\n/**\n * 发送实验结果邮件（带 CSV 附件）\n * @param {Object} params - 参数对象\n * @param {Array} params.trialRecords - 试验记录数组\n * @param {Object} params.results - 实验结果对象\n * @param {Object} params.experimentInfo - 实验信息\n * @param {Function} params.onSuccess - 成功回调函数\n * @param {Function} params.onError - 错误回调函数\n */\nfunction sendExperimentResults(params) {\n    const {\n        trialRecords = [],\n        results = {},\n        experimentInfo = {},\n        onSuccess = null,\n        onError = null\n    } = params;\n    \n    console.log('[EmailService] Preparing to send email...');\n    \n    // 检查 EmailJS 是否已加载\n    if (typeof emailjs === 'undefined') {\n        const errorMsg = 'EmailJS library not loaded. Please include EmailJS script in your HTML.';\n        console.error('[EmailService]', errorMsg);\n        if (onError) onError(new Error(errorMsg));\n        return;\n    }\n    \n    // 生成 CSV 内容\n    const csvContent = generateCSVContent(trialRecords, results, experimentInfo);\n    const csvBase64 = csvToBase64(csvContent);\n    \n    // 生成文件名（包含时间戳）\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-').substring(0, 19);\n    const fileName = `experiment_results_${experimentInfo.type || 'data'}_${timestamp}.csv`;\n    \n    // 准备邮件参数\n    const templateParams = {\n        to_email: emailConfig.recipientEmail,\n        experiment_type: experimentInfo.type || 'Pitch Training Experiment',\n        completion_date: experimentInfo.completionDate || new Date().toLocaleString('zh-CN'),\n        total_trials: experimentInfo.totalTrials || trialRecords.length,\n        total_reversals: experimentInfo.totalReversals || 'N/A',\n        jnd_value: results.jndAbsoluteDifference ? results.jndAbsoluteDifference.toFixed(2) + ' ms' : 'N/A',\n        accuracy: experimentInfo.accuracy || 'N/A',\n        mean_rt: experimentInfo.meanRT || 'N/A',\n        attachment_name: fileName,\n        attachment_content: csvBase64,\n        // 添加简短的结果摘要\n        results_summary: generateResultsSummary(results, experimentInfo)\n    };\n    \n    console.log('[EmailService] Sending email with parameters:', {\n        to: templateParams.to_email,\n        experimentType: templateParams.experiment_type,\n        fileName: fileName\n    });\n    \n    // 发送邮件\n    emailjs.send(\n        emailConfig.serviceId,\n        emailConfig.templateId,\n        templateParams\n    )\n    .then(function(response) {\n        console.log('[EmailService] Email sent successfully!', response.status, response.text);\n        if (onSuccess) {\n            onSuccess(response);\n        }\n    })\n    .catch(function(error) {\n        console.error('[EmailService] Failed to send email:', error);\n        if (onError) {\n            onError(error);\n        }\n    });\n}\n\n/**\n * 生成结果摘要文本\n * @param {Object} results - 实验结果\n * @param {Object} experimentInfo - 实验信息\n * @returns {string} 摘要文本\n */\nfunction generateResultsSummary(results, experimentInfo) {\n    let summary = '';\n    \n    if (results.jndAbsoluteDifference !== undefined) {\n        summary += `JND: ${results.jndAbsoluteDifference.toFixed(2)} ms\\n`;\n    }\n    \n    if (results.jndPercentDifference !== undefined) {\n        summary += `JND Percentage: ${results.jndPercentDifference.toFixed(2)}%\\n`;\n    }\n    \n    if (experimentInfo.accuracy) {\n        summary += `Accuracy: ${experimentInfo.accuracy}\\n`;\n    }\n    \n    if (experimentInfo.meanRT) {\n        summary += `Mean RT: ${experimentInfo.meanRT} ms\\n`;\n    }\n    \n    return summary || 'See attached CSV file for detailed results.';\n}\n\n/**\n * 快速发送函数 - 自动从全局变量获取数据\n * 此函数假设实验页面中已定义相关全局变量\n */\nfunction sendCurrentExperimentResults() {\n    // 尝试从全局作用域获取实验数据\n    const trialRecords = window.trialRecords || [];\n    const results = {\n        jndAbsoluteDifference: window.jndAbsoluteDifference,\n        jndPercentDifference: window.jndPercentDifference,\n        jndRatio: window.jndRatio,\n        webersRatio: window.webersRatio,\n        thresholdWindowDuration: window.thresholdWindowDuration,\n        thresholdWindowPercent: window.thresholdWindowPercent\n    };\n    \n    const experimentInfo = {\n        type: document.querySelector('.training-info')?.textContent || 'Pitch Training',\n        completionDate: new Date().toLocaleString('zh-CN'),\n        totalTrials: window.numberOfIterations || trialRecords.length,\n        totalReversals: window.NumberOfReversals || 0,\n        accuracy: calculateAccuracyForEmail(),\n        meanRT: calculateMeanRTForEmail()\n    };\n    \n    sendExperimentResults({\n        trialRecords: trialRecords,\n        results: results,\n        experimentInfo: experimentInfo,\n        onSuccess: function(response) {\n            alert('实验结果已成功发送到指定邮箱！');\n        },\n        onError: function(error) {\n            alert('发送邮件失败：' + error.message + '\\n请检查网络连接或联系管理员。');\n        }\n    });\n}\n\n/**\n * 辅助函数：计算准确率（用于邮件）\n */\nfunction calculateAccuracyForEmail() {\n    if (!window.trialRecords || window.trialRecords.length === 0) {\n        return 'N/A';\n    }\n    \n    const correct = window.trialRecords.filter(t =&gt; t.isCorrect).length;\n    const total = window.trialRecords.length;\n    const percentage = (correct / total * 100).toFixed(1);\n    \n    return `${percentage}% (${correct}/${total})`;\n}\n\n/**\n * 辅助函数：计算平均反应时间（用于邮件）\n */\nfunction calculateMeanRTForEmail() {\n    if (!window.trialRecords || window.trialRecords.length === 0) {\n        return 'N/A';\n    }\n    \n    const allRTs = window.trialRecords.map(t =&gt; parseFloat(t.reactionTime));\n    const mean = allRTs.reduce((a, b) =&gt; a + b, 0) / allRTs.length;\n    \n    return mean.toFixed(0) + ' ms';\n}\n\n// 导出函数（如果使用模块化）\nif (typeof module !== 'undefined' &amp;&amp; module.exports) {\n    module.exports = {\n        initEmailService,\n        sendExperimentResults,\n        sendCurrentExperimentResults,\n        generateCSVContent\n    };\n}\n&quot;,&quot;instruction&quot;:&quot;创建一个新的邮件服务模块，使用EmailJS发送实验结果CSV文件作为附件&quot;,&quot;apply_mode&quot;:&quot;apply_only&quot;}},&quot;timestamp&quot;:1762667986,&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668020,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_OuQZugLsRYC4T0MyvruA3w&quot;},&quot;toolCallId&quot;:&quot;tooluse_OuQZugLsRYC4T0MyvruA3w&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668021,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_OuQZugLsRYC4T0MyvruA3w&quot;,&quot;result&quot;:{&quot;commit_id&quot;:[&quot;478a7f4413208062924812a3658503bacc325f9e&quot;,&quot;8b856a7bbf4cc14f96cd8c413fb83be1b57ca0d1&quot;]}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_OuQZugLsRYC4T0MyvruA3w&quot;,&quot;content&quot;:&quot;&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668021,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:3592,&quot;prompt_tokens&quot;:37174,&quot;total_tokens&quot;:40766,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:36761,&quot;cache_write_tokens&quot;:406},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668021,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668041,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_dEKp894eRVuvresnqfva8g&quot;,&quot;name&quot;:&quot;edit_file&quot;,&quot;display_name&quot;:&quot;编辑文件&quot;,&quot;render_type&quot;:&quot;CodeApply&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_dEKp894eRVuvresnqfva8g&quot;,&quot;toolCallName&quot;:&quot;edit_file&quot;}" />
                    <option value="{&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_dEKp894eRVuvresnqfva8g&quot;,&quot;document&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/js/emailConfig.js&quot;,&quot;sub_content&quot;:&quot;emailConfig.js&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/js/emailConfig.js&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/js/emailConfig.js&quot;,&quot;apply_content&quot;:&quot;/**\n * Email Configuration File\n * 邮件配置文件\n * \n * 请在此处配置您的 EmailJS 参数\n */\n\nconst EMAIL_CONFIG = {\n    // EmailJS Service ID（从 EmailJS 控制台获取）\n    serviceId: 'YOUR_SERVICE_ID',\n    \n    // EmailJS Template ID（从 EmailJS 控制台获取）\n    templateId: 'YOUR_TEMPLATE_ID',\n    \n    // EmailJS Public Key（从 EmailJS 控制台获取）\n    publicKey: 'YOUR_PUBLIC_KEY',\n    \n    // 收件人邮箱（固定接收实验结果的邮箱）\n    recipientEmail: 'your-email@example.com'\n};\n\n/**\n * EmailJS 设置步骤：\n * \n * 1. 访问 https://www.emailjs.com/ 并注册账户（免费版每月200封邮件）\n * \n * 2. 添加邮件服务：\n *    - 登录后，进入 \&quot;Email Services\&quot;\n *    - 点击 \&quot;Add New Service\&quot;\n *    - 选择您的邮件提供商（如 Gmail, Outlook 等）\n *    - 按照提示连接您的邮箱\n *    - 记录 Service ID\n * \n * 3. 创建邮件模板：\n *    - 进入 \&quot;Email Templates\&quot;\n *    - 点击 \&quot;Create New Template\&quot;\n *    - 使用以下模板内容：\n * \n *    主题 (Subject):\n *    实验结果 - {{experiment_type}} - {{completion_date}}\n * \n *    内容 (Content):\n *    您好，\n *    \n *    以下是实验结果的详细信息：\n *    \n *    实验类型：{{experiment_type}}\n *    完成时间：{{completion_date}}\n *    总试验次数：{{total_trials}}\n *    总反转次数：{{total_reversals}}\n *    JND 值：{{jnd_value}}\n *    准确率：{{accuracy}}\n *    平均反应时间：{{mean_rt}}\n *    \n *    结果摘要：\n *    {{results_summary}}\n *    \n *    详细数据请查看附件 CSV 文件。\n *    \n *    此邮件由实验系统自动发送。\n * \n *    附件设置：\n *    - 在模板编辑器中，添加附件字段\n *    - 附件名称变量：{{attachment_name}}\n *    - 附件内容变量：{{attachment_content}}\n *    - 附件类型：text/csv\n * \n * 4. 获取 Public Key：\n *    - 进入 \&quot;Account\&quot; -&gt; \&quot;General\&quot;\n *    - 找到 \&quot;Public Key\&quot; 并复制\n * \n * 5. 将上述信息填入本配置文件的对应位置\n */\n\n// 初始化 EmailJS（在页面加载时自动调用）\nif (typeof initEmailService === 'function') {\n    initEmailService(EMAIL_CONFIG);\n}\n&quot;,&quot;instruction&quot;:&quot;创建邮件配置文件，包含EmailJS的配置参数和详细的设置说明&quot;,&quot;apply_mode&quot;:&quot;apply_only&quot;}},&quot;timestamp&quot;:1762668041,&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668045,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_dEKp894eRVuvresnqfva8g&quot;},&quot;toolCallId&quot;:&quot;tooluse_dEKp894eRVuvresnqfva8g&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668045,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_dEKp894eRVuvresnqfva8g&quot;,&quot;result&quot;:{&quot;commit_id&quot;:[&quot;9a663e2febf34afa4e851d4a45fa9bea92e16aa3&quot;,&quot;9d1df328cbcbbec1e052f220957664d550cf944e&quot;]}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_dEKp894eRVuvresnqfva8g&quot;,&quot;content&quot;:&quot;&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668045,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:1036,&quot;prompt_tokens&quot;:40917,&quot;total_tokens&quot;:41953,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:37167,&quot;cache_write_tokens&quot;:3743},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668045,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668051,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;现在我需要修改实验HTML文件，在实验完成后自动发送邮件。我将修改`ABX_falling_low.html`文件，在`calculateResults()`函数完成后自动调用邮件发送功能：&quot;},&quot;timestamp&quot;:1762668051,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668052,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668052,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_jMo_BNStRvKM4d0sUHf02A&quot;,&quot;name&quot;:&quot;read_file&quot;,&quot;display_name&quot;:&quot;读取文件&quot;,&quot;render_type&quot;:&quot;None&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_jMo_BNStRvKM4d0sUHf02A&quot;,&quot;toolCallName&quot;:&quot;read_file&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762668052,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_jMo_BNStRvKM4d0sUHf02A&quot;,&quot;document&quot;:{&quot;sub_content&quot;:&quot;ABX_falling_low.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;}},&quot;toolCallId&quot;:&quot;tooluse_jMo_BNStRvKM4d0sUHf02A&quot;,&quot;delta&quot;:&quot;{\&quot;path\&quot;: \&quot;E:/Projects/Pitch_Training/ABX_falling_low.html\&quot;, \&quot;offset\&quot;: 1, \&quot;limit\&quot;: 50, \&quot;explanation\&quot;: \&quot;需要读取HTML文件的head部分，以便在合适位置添加EmailJS和邮件服务的引用。由于文件是大文件，分段读取。\&quot;}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668052,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_jMo_BNStRvKM4d0sUHf02A&quot;},&quot;toolCallId&quot;:&quot;tooluse_jMo_BNStRvKM4d0sUHf02A&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668053,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_jMo_BNStRvKM4d0sUHf02A&quot;,&quot;result&quot;:{}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_jMo_BNStRvKM4d0sUHf02A&quot;,&quot;content&quot;:&quot;{\&quot;content\&quot;: \&quot;&lt;!DOCTYPE html&gt;\\n&lt;html&gt;\\n&lt;head&gt;\\n    &lt;title&gt;PLOYU-Peng's Lab: Pitch Sensitivity Training&lt;/title&gt;\\n    &lt;meta charset=\\\&quot;UTF-8\\\&quot;&gt;\\n    &lt;meta name=\\\&quot;viewport\\\&quot; content=\\\&quot;width=device-width, initial-scale=1.0\\\&quot;&gt;\\n    &lt;style&gt;\\n        body {\\n            font-family: Arial, sans-serif;\\n            margin: 20px;\\n            background-color: #f8f8f8;\\n        }\\n        .container {\\n            max-width: 800px;\\n            margin: 0 auto;\\n            padding: 20px;\\n            background-color: white;\\n            border-radius: 10px;\\n            box-shadow: 0 0 10px rgba(0,0,0,0.1);\\n            display: flex;\\n            flex-direction: column;\\n            align-items: center;\\n        }\\n        .header {\\n            text-align: center;\\n            margin-bottom: 40px;\\n            width: 100%;\\n        }\\n        .training-info {\\n            font-size: 16px;\\n            color: #555;\\n            margin-top: 10px;\\n            margin-bottom: 5px;\\n            text-align: center;\\n        }\\n        .instruction-text {\\n            font-size: 14px;\\n            color: #777;\\n            margin-bottom: 15px;\\n            text-align: center;\\n            font-style: italic;\\n        }\\n        .button-container {\\n            display: flex;\\n            justify-content: center;\\n            margin: 30px 0;\\n            width: 100%;\\n        }\\n        .prompt-text {\\n            text-align: center;\\n            font-size: 20px;\\n... extra lines ...\\n\&quot;, \&quot;fileSize\&quot;: \&quot;60.02 KB\&quot;, \&quot;isBigFile\&quot;: true, \&quot;totalLines\&quot;: 1687}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668053,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:234,&quot;prompt_tokens&quot;:42105,&quot;total_tokens&quot;:42339,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:40910,&quot;cache_write_tokens&quot;:1188},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668053,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668059,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_T9nrLY4iQ0-POY6CTzz0uw&quot;,&quot;name&quot;:&quot;grep_search&quot;,&quot;display_name&quot;:&quot;查找文件&quot;,&quot;render_type&quot;:&quot;ListItems&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_T9nrLY4iQ0-POY6CTzz0uw&quot;,&quot;toolCallName&quot;:&quot;grep_search&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762668059,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_T9nrLY4iQ0-POY6CTzz0uw&quot;,&quot;document&quot;:{&quot;search_directory&quot;:&quot;E:/Projects/Pitch_Training&quot;,&quot;query&quot;:&quot;&lt;/head&gt;&quot;,&quot;sub_content&quot;:&quot;&lt;/head&gt;&quot;,&quot;sub_content_tip&quot;:&quot;&lt;/head&gt;&quot;}},&quot;toolCallId&quot;:&quot;tooluse_T9nrLY4iQ0-POY6CTzz0uw&quot;,&quot;delta&quot;:&quot;{\&quot;explanation\&quot;: \&quot;查找HTML文件中&lt;/head&gt;标签的位置，以便在其前面添加EmailJS脚本引用\&quot;, \&quot;searchDirectory\&quot;: \&quot;E:/Projects/Pitch_Training\&quot;, \&quot;query\&quot;: \&quot;&lt;/head&gt;\&quot;, \&quot;useRegex\&quot;: false}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668059,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_T9nrLY4iQ0-POY6CTzz0uw&quot;},&quot;toolCallId&quot;:&quot;tooluse_T9nrLY4iQ0-POY6CTzz0uw&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668059,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_T9nrLY4iQ0-POY6CTzz0uw&quot;,&quot;result&quot;:{&quot;items&quot;:[{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;2AFC_level_high.html&quot;,&quot;suffix_content&quot;:&quot;L428&quot;,&quot;suffix_content_tip&quot;:&quot;L428&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/2AFC/2AFC_level_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/2AFC/2AFC_level_high.html&quot;,&quot;range&quot;:[428,428]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_falling_high.html&quot;,&quot;suffix_content&quot;:&quot;L452&quot;,&quot;suffix_content_tip&quot;:&quot;L452&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_high.html&quot;,&quot;range&quot;:[452,452]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;2AFC_rising_high.html&quot;,&quot;suffix_content&quot;:&quot;L223,1280&quot;,&quot;suffix_content_tip&quot;:&quot;L223,1280&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/2AFC/2AFC_rising_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/2AFC/2AFC_rising_high.html&quot;,&quot;range&quot;:[223,223]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;2AFC_level_low.html&quot;,&quot;suffix_content&quot;:&quot;L428&quot;,&quot;suffix_content_tip&quot;:&quot;L428&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/2AFC/2AFC_level_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/2AFC/2AFC_level_low.html&quot;,&quot;range&quot;:[428,428]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_level_high.html&quot;,&quot;suffix_content&quot;:&quot;L441&quot;,&quot;suffix_content_tip&quot;:&quot;L441&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_high.html&quot;,&quot;range&quot;:[441,441]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_rising_low.html&quot;,&quot;suffix_content&quot;:&quot;L452&quot;,&quot;suffix_content_tip&quot;:&quot;L452&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_low.html&quot;,&quot;range&quot;:[452,452]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_rising_high.html&quot;,&quot;suffix_content&quot;:&quot;L452&quot;,&quot;suffix_content_tip&quot;:&quot;L452&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_high.html&quot;,&quot;range&quot;:[452,452]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_level_low.html&quot;,&quot;suffix_content&quot;:&quot;L441&quot;,&quot;suffix_content_tip&quot;:&quot;L441&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;range&quot;:[441,441]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_falling_low.html&quot;,&quot;suffix_content&quot;:&quot;L452&quot;,&quot;suffix_content_tip&quot;:&quot;L452&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;range&quot;:[452,452]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;index.html&quot;,&quot;suffix_content&quot;:&quot;L224&quot;,&quot;suffix_content_tip&quot;:&quot;L224&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/index.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/index.html&quot;,&quot;range&quot;:[224,224]}}]},&quot;suffix_content&quot;:&quot;找到10个结果&quot;,&quot;suffix_content_tip&quot;:&quot;找到10个结果&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_T9nrLY4iQ0-POY6CTzz0uw&quot;,&quot;content&quot;:&quot;## Search Results for: `&lt;/head&gt;`\n\n**Found 11 matches in 10 files**\n\n### File: E:/Projects/Pitch_Training/2AFC/2AFC_level_high.html\n\n- **Size**: 75.9 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n428: &lt;/head&gt;\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/ABX_falling_high.html\n\n- **Size**: 60.1 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n452: &lt;/head&gt;\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/2AFC/2AFC_rising_high.html\n\n- **Size**: 54.1 KB, **isBigFile**: true\n- **Matches**: 2\n\n```\n223: &lt;/head&gt;\n1280: &lt;/head&gt;\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/2AFC/2AFC_level_low.html\n\n- **Size**: 75.8 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n428: &lt;/head&gt;\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/ABX_level_high.html\n\n- **Size**: 68.2 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n441: &lt;/head&gt;\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/ABX_rising_low.html\n\n- **Size**: 60.0 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n452: &lt;/head&gt;\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/ABX_rising_high.html\n\n- **Size**: 60.0 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n452: &lt;/head&gt;\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/ABX_level_low.html\n\n- **Size**: 68.2 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n441: &lt;/head&gt;\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/ABX_falling_low.html\n\n- **Size**: 60.0 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n452: &lt;/head&gt;\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/index.html\n\n- **Size**: 12.3 KB, **isBigFile**: false\n- **Matches**: 1\n\n```\n224: &lt;/head&gt;\n```\n\n---\n\n&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668059,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:143,&quot;prompt_tokens&quot;:42966,&quot;total_tokens&quot;:43109,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:42098,&quot;cache_write_tokens&quot;:861},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668059,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668064,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_mxt2p17wT1m5JZb2jC0P4A&quot;,&quot;name&quot;:&quot;read_file&quot;,&quot;display_name&quot;:&quot;读取文件&quot;,&quot;render_type&quot;:&quot;None&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_mxt2p17wT1m5JZb2jC0P4A&quot;,&quot;toolCallName&quot;:&quot;read_file&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762668064,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_mxt2p17wT1m5JZb2jC0P4A&quot;,&quot;document&quot;:{&quot;sub_content&quot;:&quot;ABX_falling_low.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;}},&quot;toolCallId&quot;:&quot;tooluse_mxt2p17wT1m5JZb2jC0P4A&quot;,&quot;delta&quot;:&quot;{\&quot;limit\&quot;: 460, \&quot;path\&quot;: \&quot;E:/Projects/Pitch_Training/ABX_falling_low.html\&quot;, \&quot;explanation\&quot;: \&quot;读取到&lt;/head&gt;标签附近的内容，以便准确添加EmailJS脚本引用\&quot;, \&quot;offset\&quot;: 440}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668064,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_mxt2p17wT1m5JZb2jC0P4A&quot;},&quot;toolCallId&quot;:&quot;tooluse_mxt2p17wT1m5JZb2jC0P4A&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668064,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_mxt2p17wT1m5JZb2jC0P4A&quot;,&quot;result&quot;:{}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_mxt2p17wT1m5JZb2jC0P4A&quot;,&quot;content&quot;:&quot;{\&quot;content\&quot;: \&quot;... 439 lines before line 440 ...\\n            padding: 15px;\\n            border-radius: 8px;\\n            margin: 20px 0;\\n            text-align: center;\\n        }\\n        .highlight-value {\\n            font-size: 28px;\\n            font-weight: bold;\\n            color: #e74c3c;\\n            margin: 10px 0;\\n        }\\n    &lt;/style&gt;\\n&lt;/head&gt;\\n&lt;body&gt;\\n    &lt;div class=\\\&quot;container\\\&quot;&gt;\\n        &lt;div class=\\\&quot;header\\\&quot;&gt;\\n            &lt;img src=\\\&quot;Media/animation.gif\\\&quot; alt=\\\&quot;Experiment animation\\\&quot;&gt;\\n            &lt;div class=\\\&quot;training-info\\\&quot;&gt;Low Falling Tone Discrimination (ABX)&lt;/div&gt;\\n            &lt;div class=\\\&quot;instruction-text\\\&quot;&gt;請判斷第三個音聽起來更像第一個還是第二個音&lt;/div&gt;\\n        &lt;/div&gt;\\n\\n        &lt;div id=\\\&quot;experimentContainer\\\&quot;&gt;\\n            &lt;div class=\\\&quot;control-button-container\\\&quot;&gt;\\n                &lt;input id=\\\&quot;start\\\&quot; type=\\\&quot;button\\\&quot; value=\\\&quot;開始實驗\\\&quot; onclick=\\\&quot;start_onclick()\\\&quot; class=\\\&quot;control-button\\\&quot;&gt;\\n                &lt;input id=\\\&quot;viewResult\\\&quot; type=\\\&quot;button\\\&quot; value=\\\&quot;查看結果\\\&quot; onclick=\\\&quot;view_onclick()\\\&quot; class=\\\&quot;control-button\\\&quot; disabled&gt;\\n            &lt;/div&gt;\\n\\n            &lt;div class=\\\&quot;prompt-text\\\&quot; id=\\\&quot;promptText\\\&quot;&gt;\\n                第三個音更像...\\n            &lt;/div&gt;\\n            \\n            &lt;div class=\\\&quot;button-container\\\&quot;&gt;\\n                &lt;input id=\\\&quot;firstBtn\\\&quot; type=\\\&quot;button\\\&quot; value=\\\&quot;第一個音\\\&quot; onclick=\\\&quot;processAnswer(1)\\\&quot; disabled \\n                    class=\\\&quot;response-button\\\&quot; style=\\\&quot;background:#FF6666;\\\&quot;&gt;\\n                &lt;input id=\\\&quot;secondBtn\\\&quot; type=\\\&quot;button\\\&quot; value=\\\&quot;第二個音\\\&quot; onclick=\\\&quot;processAnswer(2)\\\&quot; disabled \\n                    class=\\\&quot;response-button\\\&quot; style=\\\&quot;background:#FF6666;\\\&quot;&gt;\\n            &lt;/div&gt;\\n\\n            &lt;div class=\\\&quot;feedback\\\&quot;&gt;\\n                &lt;img id=\\\&quot;smile\\\&quot; src=\\\&quot;Media/null.gif\\\&quot; width=\\\&quot;100\\\&quot; height=\\\&quot;84\\\&quot; alt=\\\&quot;Feedback\\\&quot;&gt;\\n            &lt;/div&gt;\\n            \\n            &lt;div class=\\\&quot;button-container\\\&quot;&gt;\\n                &lt;input id=\\\&quot;text1\\\&quot; class=\\\&quot;status\\\&quot; readonly&gt;\\n            &lt;/div&gt;\\n            \\n            &lt;div class=\\\&quot;progress-bar-container\\\&quot;&gt;\\n                &lt;div class=\\\&quot;progress-bar\\\&quot; id=\\\&quot;progressBar\\\&quot; style=\\\&quot;width: 0%\\\&quot;&gt;&lt;/div&gt;\\n            &lt;/div&gt;\\n            &lt;div class=\\\&quot;progress-label\\\&quot; id=\\\&quot;progressLabel\\\&quot;&gt;Progress: 0%&lt;/div&gt;\\n            \\n            &lt;div class=\\\&quot;debug-info\\\&quot; id=\\\&quot;debugInfo\\\&quot;&gt;\\n                Debug information will be displayed here\\n            &lt;/div&gt;\\n            \\n            &lt;div class=\\\&quot;auxiliary-buttons\\\&quot;&gt;\\n                &lt;label&gt;&lt;input type=\\\&quot;checkbox\\\&quot; id=\\\&quot;showDebug\\\&quot; onclick=\\\&quot;toggleDebug()\\\&quot;&gt; Show Debug Info&lt;/label&gt;\\n                &lt;button onclick=\\\&quot;testAudio()\\\&quot;&gt;Test All Audio&lt;/button&gt;\\n                &lt;button onclick=\\\&quot;showDiagnostics()\\\&quot;&gt;Diagnostics&lt;/button&gt;\\n                &lt;button onclick=\\\&quot;exportToCSV()\\\&quot; id=\\\&quot;exportBtn\\\&quot;&gt;Export Data (CSV)&lt;/button&gt;\\n            &lt;/div&gt;\\n        &lt;/div&gt;\\n        \\n        &lt;div id=\\\&quot;resultsContainer\\\&quot; class=\\\&quot;results-container\\\&quot;&gt;\\n            &lt;h2 class=\\\&quot;result-heading\\\&quot;&gt;Dynamic Pitch Discrimination Test Results (ABX)&lt;/h2&gt;\\n            \\n            &lt;div class=\\\&quot;highlight-box\\\&quot;&gt;\\n                &lt;h3 style=\\\&quot;margin-top: 0;\\\&quot;&gt;Just Noticeable Difference (JND)&lt;/h3&gt;\\n                &lt;div class=\\\&quot;highlight-value\\\&quot; id=\\\&quot;jndValue\\\&quot;&gt;--&lt;/div&gt;\\n                &lt;p style=\\\&quot;margin-bottom: 0; font-size: 14px; color: #666;\\\&quot;&gt;\\n                    This represents the minimum detectable difference in modulation window duration&lt;br&gt;\\n                    &lt;strong&gt;Smaller JND = Better discrimination ability&lt;/strong&gt;\\n                &lt;/p&gt;\\n            &lt;/div&gt;\\n            \\n            &lt;h3&gt;Perceptual Discrimination Thresholds&lt;/h3&gt;\\n            &lt;table class=\\\&quot;result-table\\\&quot;&gt;\\n                &lt;thead&gt;\\n                    &lt;tr&gt;\\n                        &lt;th&gt;Parameter&lt;/th&gt;\\n                        &lt;th&gt;Standard (Reference)&lt;/th&gt;\\n                        &lt;th&gt;Threshold (Your JND)&lt;/th&gt;\\n                        &lt;th&gt;Difference Ratio&lt;/th&gt;\\n                    &lt;/tr&gt;\\n                &lt;/thead&gt;\\n                &lt;tbody id=\\\&quot;resultTableBody\\\&quot;&gt;\\n                &lt;/tbody&gt;\\n            &lt;/table&gt;\\n            \\n            &lt;div class=\\\&quot;result-interpretation\\\&quot; id=\\\&quot;resultInterpretation\\\&quot;&gt;\\n            &lt;/div&gt;\\n            \\n            &lt;h3&gt;Detailed Threshold Metrics&lt;/h3&gt;\\n            &lt;table class=\\\&quot;result-table\\\&quot;&gt;\\n                &lt;thead&gt;\\n                    &lt;tr&gt;\\n                        &lt;th&gt;Metric&lt;/th&gt;\\n                        &lt;th&gt;Value&lt;/th&gt;\\n                        &lt;th&gt;Interpretation&lt;/th&gt;\\n                    &lt;/tr&gt;\\n                &lt;/thead&gt;\\n                &lt;tbody id=\\\&quot;detailedMetricsBody\\\&quot;&gt;\\n                &lt;/tbody&gt;\\n            &lt;/table&gt;\\n            \\n            &lt;h3&gt;Performance Statistics&lt;/h3&gt;\\n            &lt;table class=\\\&quot;result-table\\\&quot;&gt;\\n                &lt;thead&gt;\\n                    &lt;tr&gt;\\n                        &lt;th&gt;Metric&lt;/th&gt;\\n                        &lt;th&gt;Value&lt;/th&gt;\\n                    &lt;/tr&gt;\\n                &lt;/thead&gt;\\n                &lt;tbody id=\\\&quot;performanceStatsBody\\\&quot;&gt;\\n                &lt;/tbody&gt;\\n            &lt;/table&gt;\\n            \\n            &lt;button class=\\\&quot;print-button\\\&quot; onclick=\\\&quot;printResults()\\\&quot;&gt;Print Results&lt;/button&gt;\\n            \\n            &lt;div class=\\\&quot;auxiliary-buttons\\\&quot; style=\\\&quot;margin-top: 20px;\\\&quot;&gt;\\n                &lt;button onclick=\\\&quot;exportToCSV()\\\&quot;&gt;Export Data (CSV)&lt;/button&gt;\\n            &lt;/div&gt;\\n            \\n            &lt;button class=\\\&quot;back-button\\\&quot; onclick=\\\&quot;backToExperiment()\\\&quot;&gt;Back to Experiment&lt;/button&gt;\\n        &lt;/div&gt;\\n        \\n        &lt;div class=\\\&quot;diagnostic-overlay\\\&quot; id=\\\&quot;diagnosticOverlay\\\&quot;&gt;\\n            &lt;div class=\\\&quot;diagnostic-content\\\&quot;&gt;\\n                &lt;span class=\\\&quot;diagnostic-close\\\&quot; onclick=\\\&quot;closeDiagnostics()\\\&quot;&gt;&amp;times;&lt;/span&gt;\\n                &lt;h2 class=\\\&quot;diagnostic-heading\\\&quot;&gt;Experiment Diagnostics&lt;/h2&gt;\\n                \\n                &lt;div class=\\\&quot;diagnostic-section\\\&quot;&gt;\\n                    &lt;h3&gt;Test Status&lt;/h3&gt;\\n                    &lt;table class=\\\&quot;statistics-table\\\&quot;&gt;\\n                        &lt;tr&gt;\\n                            &lt;th&gt;Trials&lt;/th&gt;\\n                            &lt;th&gt;Reversals&lt;/th&gt;\\n                            &lt;th&gt;Status&lt;/th&gt;\\n                        &lt;/tr&gt;\\n                        &lt;tr&gt;\\n                            &lt;td id=\\\&quot;totalTrials\\\&quot;&gt;0&lt;/td&gt;\\n                            &lt;td id=\\\&quot;totalReversals\\\&quot;&gt;0&lt;/td&gt;\\n                            &lt;td id=\\\&quot;testStatus\\\&quot;&gt;Not started&lt;/td&gt;\\n                        &lt;/tr&gt;\\n                    &lt;/table&gt;\\n                &lt;/div&gt;\\n                \\n                &lt;div class=\\\&quot;diagnostic-section\\\&quot;&gt;\\n                    &lt;h3&gt;Audio Files Check&lt;/h3&gt;\\n                    &lt;p&gt;Verifying necessary audio files:&lt;/p&gt;\\n                    &lt;div id=\\\&quot;audioFileStatus\\\&quot; class=\\\&quot;diagnostic-file-status\\\&quot;&gt;\\n                    &lt;/div&gt;\\n                &lt;/div&gt;\\n                \\n                &lt;div class=\\\&quot;diagnostic-section\\\&quot;&gt;\\n                    &lt;h3&gt;Reversal History&lt;/h3&gt;\\n                    &lt;div id=\\\&quot;reversalHistory\\\&quot;&gt;\\n                    &lt;/div&gt;\\n                &lt;/div&gt;\\n                \\n                &lt;div class=\\\&quot;diagnostic-section\\\&quot;&gt;\\n                    &lt;h3&gt;Recommendations&lt;/h3&gt;\\n                    &lt;div id=\\\&quot;diagnosticRecommendations\\\&quot;&gt;\\n                    &lt;/div&gt;\\n                &lt;/div&gt;\\n                \\n                &lt;div class=\\\&quot;diagnostic-actions\\\&quot;&gt;\\n                    &lt;button class=\\\&quot;diagnostic-action-button continue-button\\\&quot; onclick=\\\&quot;closeDiagnostics()\\\&quot;&gt;Close&lt;/button&gt;\\n                &lt;/div&gt;\\n            &lt;/div&gt;\\n        &lt;/div&gt;\\n    &lt;/div&gt;\\n\\n    &lt;audio id=\\\&quot;low_falling_standard\\\&quot; src=\\\&quot;Media/low_falling_standard.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n\\n    &lt;audio id=\\\&quot;low_falling_1\\\&quot; src=\\\&quot;Media/low_falling_1.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_falling_2\\\&quot; src=\\\&quot;Media/low_falling_2.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_falling_3\\\&quot; src=\\\&quot;Media/low_falling_3.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_falling_4\\\&quot; src=\\\&quot;Media/low_falling_4.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_falling_5\\\&quot; src=\\\&quot;Media/low_falling_5.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_falling_6\\\&quot; src=\\\&quot;Media/low_falling_6.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_falling_7\\\&quot; src=\\\&quot;Media/low_falling_7.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_falling_8\\\&quot; src=\\\&quot;Media/low_falling_8.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_falling_9\\\&quot; src=\\\&quot;Media/low_falling_9.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n\\n&lt;script&gt;\\nfunction getLocalTimestamp() {\\n    const now = new Date();\\n    const year = now.getFullYear();\\n    const month = String(now.getMonth() + 1).padStart(2, '0');\\n    const day = String(now.getDate()).padStart(2, '0');\\n    const hours = String(now.getHours()).padStart(2, '0');\\n    const minutes = String(now.getMinutes()).padStart(2, '0');\\n    const seconds = String(now.getSeconds()).padStart(2, '0');\\n    const milliseconds = String(now.getMilliseconds()).padStart(3, '0');\\n    \\n    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;\\n}\\n\\n// Stimulus parameters for dynamic pitch modulation\\nconst STIMULUS_DURATION = 450; // ms, total duration\\nconst STANDARD_WINDOW = 400; // ms, modulation window for standard (100%)\\nconst STANDARD_WINDOW_PERCENT = 100; // percentage\\n\\n// Modulation window percentages for each difficulty level\\nconst MODULATION_WINDOWS = {\\n    1: 20,   // easiest - 20% of standard window (80 ms)\\n    2: 40,   // 160 ms\\n    3: 50,   // 200 ms\\n    4: 60,   // 240 ms\\n    5: 70,   // 280 ms\\n    6: 80,   // 320 ms\\n    7: 90,   // 360 ms\\n    8: 95,   // 380 ms\\n    9: 98    // hardest - 98% of standard window (392 ms)\\n};\\n\\nfunction getModulationWindowDuration(level) {\\n    return (MODULATION_WINDOWS[level] / 100) * STANDARD_WINDOW;\\n}\\n\\nconst PITCH_FALL_SEMITONES = 1.0;\\n\\nfunction getModulationRate(level) {\\n    const windowDuration = getModulationWindowDuration(level);\\n    const windowDurationSec = windowDuration / 1000;\\n    return PITCH_FALL_SEMITONES / windowDurationSec;\\n}\\n\\nfunction getModulationSlope(level) {\\n    const windowDuration = getModulationWindowDuration(level);\\n    return PITCH_FALL_SEMITONES / windowDuration;\\n}\\n\\n// Adaptive threshold experiment constants\\nconst MAXREVERSALS = 10;\\nconst MAXITERATIONS = 50;\\nconst LOWERLIMIT = 1;\\nconst DECREASING = -1;\\nconst INCREASING = 1;\\nconst MINIMUMREVERSALS = 6;\\nconst THRESHOLD_REVERSAL_COUNT = 6;\\n\\n// Experiment state variables\\nvar CorrectAnswer;\\nvar CorrectResponses = 0;\\nvar Direction = DECREASING;\\nvar Reversals = [];\\nvar NumberOfReversals = 0;\\nvar currentLevel = 5;\\nvar numberOfIterations = 0;\\nvar sentAverage = 0.0;\\nvar sentStdev = 0.0;\\nvar isTestComplete = false;\\nvar audioUnlocked = false;\\nvar allFilesPresent = true;\\nvar trialRecords = [];\\nvar stimulusEndTime = 0;\\n\\n// ABX variables\\nvar standardIsFirst;\\nvar comparisonSound;\\nvar standardSound;\\nvar xSound;\\n\\nvar isReplayTrial = false;\\n\\n// Results variables - JND-based\\nvar jndAbsoluteDifference = 0;\\nvar jndRatio = 0;\\nvar jndPercentDifference = 0;\\nvar thresholdWindowDuration = 0;\\nvar thresholdWindowPercent = 0;\\nvar thresholdModulationRate = 0;\\nvar thresholdSlope = 0;\\nvar webersRatio = 0;\\n\\nfunction printResults() {\\n    window.print();\\n}\\n\\nfunction logDebug(message) {\\n    console.log(message);\\n    var debugArea = document.getElementById('debugInfo');\\n    var now = new Date();\\n    var timeStr = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + '.' + now.getMilliseconds();\\n    debugArea.innerHTML += '&lt;p&gt;[' + timeStr + '] ' + message + '&lt;/p&gt;';\\n    debugArea.scrollTop = debugArea.scrollHeight;\\n}\\n\\nfunction toggleDebug() {\\n    var debugArea = document.getElementById('debugInfo');\\n    var checkbox = document.getElementById('showDebug');\\n    debugArea.style.display = checkbox.checked ? 'block' : 'none';\\n}\\n\\nfunction showDiagnostics() {\\n    updateDiagnostics();\\n    document.getElementById('diagnosticOverlay').style.display = 'flex';\\n}\\n\\nfunction closeDiagnostics() {\\n    document.getElementById('diagnosticOverlay').style.display = 'none';\\n}\\n\\nfunction updateDiagnostics() {\\n    document.getElementById('totalTrials').innerText = numberOfIterations;\\n    document.getElementById('totalReversals').innerText = NumberOfReversals;\\n    \\n    let testStatus = getTestStatus();\\n    document.getElementById('testStatus').innerText = testStatus.text;\\n    document.getElementById('testStatus').className = `direction-stats-${testStatus.class}`;\\n    \\n    checkAudioFiles();\\n    \\n    let reversalHistoryHtml = '';\\n    if (Reversals.length === 0) {\\n        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';\\n    } else {\\n        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals.join(', ') + '&lt;/p&gt;';\\n        reversalHistoryHtml += '&lt;p&gt;Corresponding modulation windows: ';\\n        reversalHistoryHtml += Reversals.map(level =&gt; MODULATION_WINDOWS[level] + '% (' + getModulationWindowDuration(level) + ' ms)').join(', ') + '&lt;/p&gt;';\\n    }\\n    \\n    document.getElementById('reversalHistory').innerHTML = reversalHistoryHtml;\\n    \\n    generateDiagnosticRecommendations();\\n}\\n\\nfunction getTestStatus() {\\n    if (isTestComplete) {\\n        return { text: \\\&quot;Complete\\\&quot;, class: \\\&quot;good\\\&quot; };\\n    }\\n    \\n    if (NumberOfReversals &lt; 1) {\\n        return { text: \\\&quot;Not enough data\\\&quot;, class: \\\&quot;bad\\\&quot; };\\n    }\\n    \\n    if (NumberOfReversals &lt; MINIMUMREVERSALS) {\\n        return { text: \\\&quot;Incomplete (\\\&quot; + NumberOfReversals + \\\&quot;/\\\&quot; + MINIMUMREVERSALS + \\\&quot; reversals)\\\&quot;, class: \\\&quot;warning\\\&quot; };\\n    }\\n    \\n    return { text: \\\&quot;In progress\\\&quot;, class: \\\&quot;good\\\&quot; };\\n}\\n\\nfunction checkAudioFiles() {\\n    const requiredFiles = [\\n        \\\&quot;low_falling_standard\\\&quot;,\\n        \\\&quot;low_falling_1\\\&quot;, \\\&quot;low_falling_2\\\&quot;, \\\&quot;low_falling_3\\\&quot;, \\\&quot;low_falling_4\\\&quot;, \\\&quot;low_falling_5\\\&quot;, \\n        \\\&quot;low_falling_6\\\&quot;, \\\&quot;low_falling_7\\\&quot;, \\\&quot;low_falling_8\\\&quot;, \\\&quot;low_falling_9\\\&quot;\\n    ];\\n    \\n    let statusHtml = '';\\n    allFilesPresent = true;\\n    \\n    requiredFiles.forEach(function(fileId) {\\n        const audioElement = document.getElementById(fileId);\\n        const fileFound = audioElement !== null;\\n        \\n        if (!fileFound) {\\n            allFilesPresent = false;\\n        }\\n        \\n        statusHtml += `&lt;div class=\\\&quot;file-status-item ${fileFound ? 'file-found' : 'file-missing'}\\\&quot;&gt;${fileId}: ${fileFound ? 'Found' : 'Missing'}&lt;/div&gt;`;\\n    });\\n    \\n    document.getElementById('audioFileStatus').innerHTML = statusHtml;\\n}\\n\\nfunction generateDiagnosticRecommendations() {\\n    let recommendations = '';\\n    let hasIssues = false;\\n    \\n    if (!allFilesPresent) {\\n        recommendations += '&lt;p&gt;&lt;strong&gt;Critical Issue:&lt;/strong&gt; Some required audio files are missing. Please ensure all files are properly loaded.&lt;/p&gt;';\\n        hasIssues = true;\\n    }\\n    \\n    if (numberOfIterations &gt;= MAXITERATIONS &amp;&amp; NumberOfReversals &lt; MINIMUMREVERSALS) {\\n        recommendations += '&lt;p&gt;&lt;strong&gt;Issue:&lt;/strong&gt; Reached maximum trials but has insufficient reversals. This might indicate audio file issues or participant response patterns.&lt;/p&gt;';\\n        hasIssues = true;\\n    }\\n    \\n    if (!hasIssues) {\\n        recommendations += '&lt;p&gt;&lt;strong&gt;Good:&lt;/strong&gt; No major issues detected with the experiment setup.&lt;/p&gt;';\\n        \\n        if (isTestComplete) {\\n            recommendations += '&lt;p&gt;Test is complete.&lt;/p&gt;';\\n        } else {\\n            recommendations += '&lt;p&gt;Test is still in progress.&lt;/p&gt;';\\n        }\\n    }\\n    \\n    document.getElementById('diagnosticRecommendations').innerHTML = recommendations;\\n}\\n\\nfunction testAudio() {\\n    logDebug(\\\&quot;Starting to test all audio files...\\\&quot;);\\n    var audios = document.querySelectorAll('audio');\\n    \\n    if (!audioUnlocked) {\\n        unlockAudioContext();\\n    }\\n    \\n    var index = 0;\\n    function playNext() {\\n        if (index &gt;= audios.length) {\\n            logDebug(\\\&quot;All audio testing complete!\\\&quot;);\\n            return;\\n        }\\n        \\n        var audio = audios[index];\\n        logDebug(\\\&quot;Testing audio #\\\&quot; + (index + 1) + \\\&quot;: \\\&quot; + audio.id);\\n        \\n        audio.currentTime = 0;\\n        \\n        var playPromise = audio.play();\\n        if (playPromise !== undefined) {\\n            playPromise.then(function() {\\n                logDebug(audio.id + \\\&quot; played successfully\\\&quot;);\\n                \\n                audio.onended = function() {\\n                    logDebug(audio.id + \\\&quot; playback ended\\\&quot;);\\n                    index++;\\n                    setTimeout(playNext, 500);\\n                };\\n            }).catch(function(error) {\\n                logDebug(\\\&quot;Failed to play \\\&quot; + audio.id + \\\&quot;: \\\&quot; + error);\\n                index++;\\n                setTimeout(playNext, 500);\\n            });\\n        }\\n    }\\n    \\n    playNext();\\n}\\n\\nfunction unlockAudioContext() {\\n    logDebug(\\\&quot;Attempting to unlock audio context...\\\&quot;);\\n    \\n    var silentAudio = new Audio();\\n    silentAudio.src = \\\&quot;data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA\\\&quot;;\\n    \\n    var promise = silentAudio.play();\\n    if (promise !== undefined) {\\n        promise.then(function() {\\n            logDebug(\\\&quot;Audio context unlocked successfully\\\&quot;);\\n            silentAudio.remove();\\n            audioUnlocked = true;\\n        }).catch(function(error) {\\n            logDebug(\\\&quot;Failed to unlock audio context: \\\&quot; + error);\\n        });\\n    }\\n    \\n    var allAudios = document.querySelectorAll('audio');\\n    for (var i = 0; i &lt; allAudios.length; i++) {\\n        var audio = allAudios[i];\\n        audio.load();\\n    }\\n    \\n    logDebug(\\\&quot;Preloaded \\\&quot; + allAudios.length + \\\&quot; audio files\\\&quot;);\\n... extra lines ...\\n\&quot;, \&quot;fileSize\&quot;: \&quot;60.02 KB\&quot;, \&quot;isBigFile\&quot;: true, \&quot;totalLines\&quot;: 1687}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668065,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:146,&quot;prompt_tokens&quot;:44094,&quot;total_tokens&quot;:44240,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:42959,&quot;cache_write_tokens&quot;:1128},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668065,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668072,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;现在我将修改HTML文件，添加EmailJS脚本引用和邮件发送功能。我需要：\n1. 在`&lt;/head&gt;`前添加EmailJS库和我们的邮件服务脚本\n2. 在`calculateResults()`函数完成后自动发送邮件&quot;},&quot;timestamp&quot;:1762668072,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668072,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668072,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_oshq3w1eRHCz3gG6YLzUHw&quot;,&quot;name&quot;:&quot;replace_in_file&quot;,&quot;display_name&quot;:&quot;编辑文件&quot;,&quot;render_type&quot;:&quot;CodeReplace&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_oshq3w1eRHCz3gG6YLzUHw&quot;,&quot;toolCallName&quot;:&quot;replace_in_file&quot;}" />
                    <option value="{&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_oshq3w1eRHCz3gG6YLzUHw&quot;,&quot;document&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;sub_content&quot;:&quot;ABX_falling_low.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;old_string&quot;:&quot;        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;&quot;,&quot;new_string&quot;:&quot;        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n    \n    &lt;!-- EmailJS Library --&gt;\n    &lt;script type=\&quot;text/javascript\&quot; src=\&quot;https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js\&quot;&gt;&lt;/script&gt;\n    \n    &lt;!-- Email Configuration and Service --&gt;\n    &lt;script src=\&quot;js/emailConfig.js\&quot;&gt;&lt;/script&gt;\n    &lt;script src=\&quot;js/emailService.js\&quot;&gt;&lt;/script&gt;\n&lt;/head&gt;&quot;,&quot;apply_mode&quot;:&quot;apply_only&quot;}},&quot;timestamp&quot;:1762668072,&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668074,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_oshq3w1eRHCz3gG6YLzUHw&quot;},&quot;toolCallId&quot;:&quot;tooluse_oshq3w1eRHCz3gG6YLzUHw&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668074,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_oshq3w1eRHCz3gG6YLzUHw&quot;,&quot;result&quot;:{&quot;commit_id&quot;:[&quot;3c1661908f746182e0f679f4dc1c4e8799c21e1c&quot;,&quot;42362690be99de72b2b50da6acf163fc92215403&quot;]}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_oshq3w1eRHCz3gG6YLzUHw&quot;,&quot;content&quot;:&quot;*File replaced success*&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668074,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:429,&quot;prompt_tokens&quot;:49355,&quot;total_tokens&quot;:49784,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:44087,&quot;cache_write_tokens&quot;:5261},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668074,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668081,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;现在我需要找到`calculateResults()`函数，在其完成后添加自动发送邮件的代码：&quot;},&quot;timestamp&quot;:1762668081,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668082,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668082,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_6gxByn9ETcau_WIsPTQfzg&quot;,&quot;name&quot;:&quot;grep_search&quot;,&quot;display_name&quot;:&quot;查找文件&quot;,&quot;render_type&quot;:&quot;ListItems&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_6gxByn9ETcau_WIsPTQfzg&quot;,&quot;toolCallName&quot;:&quot;grep_search&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762668082,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_6gxByn9ETcau_WIsPTQfzg&quot;,&quot;document&quot;:{&quot;search_directory&quot;:&quot;E:/Projects/Pitch_Training&quot;,&quot;query&quot;:&quot;function calculateResults()&quot;,&quot;sub_content&quot;:&quot;function calculateResults()&quot;,&quot;sub_content_tip&quot;:&quot;function calculateResults()&quot;}},&quot;toolCallId&quot;:&quot;tooluse_6gxByn9ETcau_WIsPTQfzg&quot;,&quot;delta&quot;:&quot;{\&quot;useRegex\&quot;: false, \&quot;explanation\&quot;: \&quot;查找calculateResults函数的位置\&quot;, \&quot;searchDirectory\&quot;: \&quot;E:/Projects/Pitch_Training\&quot;, \&quot;query\&quot;: \&quot;function calculateResults()\&quot;}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668082,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_6gxByn9ETcau_WIsPTQfzg&quot;},&quot;toolCallId&quot;:&quot;tooluse_6gxByn9ETcau_WIsPTQfzg&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668082,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_6gxByn9ETcau_WIsPTQfzg&quot;,&quot;result&quot;:{&quot;items&quot;:[{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_falling_high.html&quot;,&quot;suffix_content&quot;:&quot;L956&quot;,&quot;suffix_content_tip&quot;:&quot;L956&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_high.html&quot;,&quot;range&quot;:[956,956]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_falling_low.html&quot;,&quot;suffix_content&quot;:&quot;L963&quot;,&quot;suffix_content_tip&quot;:&quot;L963&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;range&quot;:[963,963]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_level_low.html&quot;,&quot;suffix_content&quot;:&quot;L1022&quot;,&quot;suffix_content_tip&quot;:&quot;L1022&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;range&quot;:[1022,1022]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_level_high.html&quot;,&quot;suffix_content&quot;:&quot;L1022&quot;,&quot;suffix_content_tip&quot;:&quot;L1022&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_high.html&quot;,&quot;range&quot;:[1022,1022]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;2AFC_level_high.html&quot;,&quot;suffix_content&quot;:&quot;L1065&quot;,&quot;suffix_content_tip&quot;:&quot;L1065&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/2AFC/2AFC_level_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/2AFC/2AFC_level_high.html&quot;,&quot;range&quot;:[1065,1065]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;2AFC_level_low.html&quot;,&quot;suffix_content&quot;:&quot;L1064&quot;,&quot;suffix_content_tip&quot;:&quot;L1064&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/2AFC/2AFC_level_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/2AFC/2AFC_level_low.html&quot;,&quot;range&quot;:[1064,1064]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;2AFC_rising_high.html&quot;,&quot;suffix_content&quot;:&quot;L1025&quot;,&quot;suffix_content_tip&quot;:&quot;L1025&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/2AFC/2AFC_rising_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/2AFC/2AFC_rising_high.html&quot;,&quot;range&quot;:[1025,1025]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_rising_low.html&quot;,&quot;suffix_content&quot;:&quot;L956&quot;,&quot;suffix_content_tip&quot;:&quot;L956&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_low.html&quot;,&quot;range&quot;:[956,956]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_rising_high.html&quot;,&quot;suffix_content&quot;:&quot;L956&quot;,&quot;suffix_content_tip&quot;:&quot;L956&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_high.html&quot;,&quot;range&quot;:[956,956]}}]},&quot;suffix_content&quot;:&quot;找到9个结果&quot;,&quot;suffix_content_tip&quot;:&quot;找到9个结果&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_6gxByn9ETcau_WIsPTQfzg&quot;,&quot;content&quot;:&quot;## Search Results for: `function calculateResults()`\n\n**Found 9 matches in 9 files**\n\n### File: E:/Projects/Pitch_Training/ABX_falling_high.html\n\n- **Size**: 60.1 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n956: function calculateResults() {\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/ABX_falling_low.html\n\n- **Size**: 60.3 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n963: function calculateResults() {\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/ABX_level_low.html\n\n- **Size**: 68.2 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n1022: function calculateResults(directionIndex) {\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/ABX_level_high.html\n\n- **Size**: 68.2 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n1022: function calculateResults(directionIndex) {\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/2AFC/2AFC_level_high.html\n\n- **Size**: 75.9 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n1065: function calculateResults(directionIndex) {\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/2AFC/2AFC_level_low.html\n\n- **Size**: 75.8 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n1064: function calculateResults(directionIndex) {\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/2AFC/2AFC_rising_high.html\n\n- **Size**: 54.1 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n1025: function calculateResults() {\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/ABX_rising_low.html\n\n- **Size**: 60.0 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n956: function calculateResults() {\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/ABX_rising_high.html\n\n- **Size**: 60.0 KB, **isBigFile**: true\n- **Matches**: 1\n\n```\n956: function calculateResults() {\n```\n\n---\n\n&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668082,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:159,&quot;prompt_tokens&quot;:49909,&quot;total_tokens&quot;:50068,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:49348,&quot;cache_write_tokens&quot;:554},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668082,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668089,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_Zb7u_DmlRdmAqlZbBpi0Lw&quot;,&quot;name&quot;:&quot;view_code_item&quot;,&quot;display_name&quot;:&quot;查找文件&quot;,&quot;render_type&quot;:&quot;ListItems&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_Zb7u_DmlRdmAqlZbBpi0Lw&quot;,&quot;toolCallName&quot;:&quot;view_code_item&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762668090,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_Zb7u_DmlRdmAqlZbBpi0Lw&quot;,&quot;document&quot;:{&quot;sub_content&quot;:&quot;calculateResults&quot;,&quot;sub_content_tip&quot;:&quot;calculateResults&quot;}},&quot;toolCallId&quot;:&quot;tooluse_Zb7u_DmlRdmAqlZbBpi0Lw&quot;,&quot;delta&quot;:&quot;{\&quot;explanation\&quot;: \&quot;查看calculateResults函数的完整内容，以便在合适位置添加邮件发送功能\&quot;, \&quot;file\&quot;: \&quot;E:/Projects/Pitch_Training/ABX_falling_low.html\&quot;, \&quot;symbolName\&quot;: \&quot;calculateResults\&quot;}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668090,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_Zb7u_DmlRdmAqlZbBpi0Lw&quot;},&quot;toolCallId&quot;:&quot;tooluse_Zb7u_DmlRdmAqlZbBpi0Lw&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668090,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_Zb7u_DmlRdmAqlZbBpi0Lw&quot;,&quot;result&quot;:{&quot;items&quot;:[]},&quot;suffix_content&quot;:&quot;未找到结果&quot;,&quot;suffix_content_tip&quot;:&quot;未找到结果&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_Zb7u_DmlRdmAqlZbBpi0Lw&quot;,&quot;content&quot;:&quot;&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668090,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:134,&quot;prompt_tokens&quot;:51027,&quot;total_tokens&quot;:51161,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:49902,&quot;cache_write_tokens&quot;:1118},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668090,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668096,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_ZD8fC3P4TLyWsX7jZLUaIw&quot;,&quot;name&quot;:&quot;read_file&quot;,&quot;display_name&quot;:&quot;读取文件&quot;,&quot;render_type&quot;:&quot;None&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_ZD8fC3P4TLyWsX7jZLUaIw&quot;,&quot;toolCallName&quot;:&quot;read_file&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762668096,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_ZD8fC3P4TLyWsX7jZLUaIw&quot;,&quot;document&quot;:{&quot;sub_content&quot;:&quot;ABX_falling_low.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;}},&quot;toolCallId&quot;:&quot;tooluse_ZD8fC3P4TLyWsX7jZLUaIw&quot;,&quot;delta&quot;:&quot;{\&quot;limit\&quot;: 1050, \&quot;path\&quot;: \&quot;E:/Projects/Pitch_Training/ABX_falling_low.html\&quot;, \&quot;explanation\&quot;: \&quot;读取calculateResults函数及其后续代码，以便在函数结束时添加邮件发送功能\&quot;, \&quot;offset\&quot;: 963}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668096,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_ZD8fC3P4TLyWsX7jZLUaIw&quot;},&quot;toolCallId&quot;:&quot;tooluse_ZD8fC3P4TLyWsX7jZLUaIw&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668097,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_ZD8fC3P4TLyWsX7jZLUaIw&quot;,&quot;result&quot;:{}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_ZD8fC3P4TLyWsX7jZLUaIw&quot;,&quot;content&quot;:&quot;{\&quot;content\&quot;: \&quot;... 962 lines before line 963 ...\\nfunction calculateResults() {\\n    let sum = 0.0, stddevsum = 0.0, average = 0.0, stdev = 0.0, counter = 0;\\n    \\n    for (let i = 0; i &lt; Reversals.length; i++) {\\n        if (Reversals[i] &gt; 0) counter++;\\n    }\\n    \\n    if (counter &lt; MINIMUMREVERSALS) {\\n        logDebug(\\\&quot;Test has insufficient data\\\&quot;);\\n        alert(\\\&quot;Test has insufficient data. Please complete the test again.\\\&quot;);\\n        return;\\n    }\\n    \\n    const startIndex = Math.max(0, NumberOfReversals - THRESHOLD_REVERSAL_COUNT);\\n    counter = 0;\\n    \\n    for (let i = startIndex; i &lt; Reversals.length; i++) {\\n        const level = Reversals[i];\\n        if (level &gt; 0) {\\n            sum += level;\\n            counter++;\\n        }\\n    }\\n    \\n    if (counter &gt; 0) {\\n        average = sum / counter;\\n        average = parseFloat(average.toFixed(2));\\n    }\\n    \\n    for (let i = startIndex; i &lt; Reversals.length; i++) {\\n        const level = Reversals[i];\\n        if (level &gt; 0) {\\n            stddevsum += Math.pow(level - average, 2);\\n        }\\n    }\\n    \\n    if (counter &gt; 1) {\\n        stdev = Math.sqrt(stddevsum / (counter - 1));\\n        stdev = parseFloat(stdev.toFixed(2));\\n    }\\n    \\n    sentAverage = average;\\n    sentStdev = stdev;\\n    \\n    thresholdWindowPercent = calculateAverageWindowPercent(startIndex);\\n    thresholdWindowDuration = (thresholdWindowPercent / 100) * STANDARD_WINDOW;\\n    thresholdModulationRate = PITCH_FALL_SEMITONES / (thresholdWindowDuration / 1000);\\n    thresholdSlope = PITCH_FALL_SEMITONES / thresholdWindowDuration;\\n\\n    jndAbsoluteDifference = STANDARD_WINDOW - thresholdWindowDuration;\\n    jndRatio = thresholdWindowDuration / STANDARD_WINDOW;\\n    jndPercentDifference = 100 - thresholdWindowPercent;\\n    webersRatio = jndAbsoluteDifference / STANDARD_WINDOW;\\n    \\n    logDebug(\\\&quot;Test complete! Average difficulty level: \\\&quot; + average.toFixed(2));\\n    logDebug(\\\&quot;Threshold window: \\\&quot; + thresholdWindowPercent.toFixed(2) + \\\&quot;% (\\\&quot; + thresholdWindowDuration.toFixed(2) + \\\&quot; ms)\\\&quot;);\\n    logDebug(\\\&quot;JND Absolute Difference: \\\&quot; + jndAbsoluteDifference.toFixed(2) + \\\&quot; ms\\\&quot;);\\n    logDebug(\\\&quot;JND Ratio: \\\&quot; + jndRatio.toFixed(4));\\n    logDebug(\\\&quot;JND Percent Difference: \\\&quot; + jndPercentDifference.toFixed(2) + \\\&quot;%\\\&quot;);\\n    logDebug(\\\&quot;Weber's Ratio: \\\&quot; + webersRatio.toFixed(4));\\n    \\n    document.getElementById('text1').value = \\\&quot;Test complete! JND: \\\&quot; + jndAbsoluteDifference.toFixed(1) + \\\&quot; ms\\\&quot;;\\n}\\n\\nfunction calculateAverageWindowPercent(startIndex) {\\n    let sum = 0;\\n    let count = 0;\\n    \\n    for (let i = startIndex; i &lt; Reversals.length; i++) {\\n        const level = Reversals[i];\\n        if (level &gt; 0 &amp;&amp; MODULATION_WINDOWS[level] !== undefined) {\\n            sum += MODULATION_WINDOWS[level];\\n            count++;\\n        }\\n    }\\n    \\n    return count &gt; 0 ? sum / count : 0;\\n}\\n\\nfunction calculateReactionTimeStats() {\\n    let allRTs = trialRecords.map(t =&gt; parseFloat(t.reactionTime));\\n    \\n    return {\\n        mean: allRTs.length ? (allRTs.reduce((a, b) =&gt; a + b, 0) / allRTs.length).toFixed(0) : \\\&quot;N/A\\\&quot;,\\n        median: allRTs.length ? calculateMedian(allRTs).toFixed(0) : \\\&quot;N/A\\\&quot;,\\n        sd: allRTs.length &gt; 1 ? calculateSD(allRTs).toFixed(0) : \\\&quot;N/A\\\&quot;\\n    };\\n}\\n\\nfunction calculateAccuracyStats() {\\n    let allTrials = trialRecords;\\n    \\n    return {\\n        correct: allTrials.filter(t =&gt; t.isCorrect).length,\\n        total: allTrials.length,\\n        percentage: allTrials.length ? \\n            (allTrials.filter(t =&gt; t.isCorrect).length / allTrials.length * 100).toFixed(1) : \\\&quot;N/A\\\&quot;\\n    };\\n}\\n\\nfunction calculateMedian(values) {\\n    if (!values.length) return 0;\\n    \\n    const sortedValues = values.slice().sort((a, b) =&gt; a - b);\\n    const mid = Math.floor(sortedValues.length / 2);\\n    \\n    return sortedValues.length % 2 === 0 ? \\n        (sortedValues[mid - 1] + sortedValues[mid]) / 2 : \\n        sortedValues[mid];\\n}\\n\\nfunction calculateSD(values) {\\n    if (values.length &lt;= 1) return 0;\\n    \\n    const mean = values.reduce((a, b) =&gt; a + b, 0) / values.length;\\n    const variance = values.map(x =&gt; Math.pow(x - mean, 2)).reduce((a, b) =&gt; a + b, 0) / (values.length - 1);\\n    \\n    return Math.sqrt(variance);\\n}\\n\\nfunction displayResults() {\\n    logDebug(\\\&quot;Displaying results\\\&quot;);\\n    \\n    let hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;\\n    \\n    if (!hasData) {\\n        let message = \\\&quot;Warning: Insufficient data. Results may not be reliable.\\\&quot;;\\n        \\n        if (confirm(message + \\\&quot;\\\\n\\\\nWould you like to retry the experiment?\\\&quot;)) {\\n            window_onload();\\n            return;\\n        }\\n    }\\n    \\n    document.getElementById('experimentContainer').style.display = 'none';\\n    document.getElementById('resultsContainer').style.display = 'block';\\n    \\n    if (hasData) {\\n        document.getElementById('jndValue').innerHTML = \\n            jndAbsoluteDifference.toFixed(2) + ' ms&lt;br&gt;' +\\n            '&lt;span style=\\\&quot;font-size: 18px;\\\&quot;&gt;(' + jndPercentDifference.toFixed(2) + '% difference from standard)&lt;/span&gt;';\\n    } else {\\n        document.getElementById('jndValue').textContent = 'Insufficient Data';\\n    }\\n    \\n    var tableBody = document.getElementById('resultTableBody');\\n    tableBody.innerHTML = '';\\n    \\n    var windowRow = document.createElement('tr');\\n    windowRow.innerHTML = \\n        '&lt;td&gt;Modulation Window Duration&lt;/td&gt;' +\\n        '&lt;td&gt;' + STANDARD_WINDOW + ' ms (100%)&lt;/td&gt;' +\\n        '&lt;td&gt;' + (hasData ? thresholdWindowDuration.toFixed(2) + ' ms (' + thresholdWindowPercent.toFixed(2) + '%)' : 'N/A') + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + (hasData ? jndRatio.toFixed(4) + ' : 1&lt;br&gt;(Threshold/Standard)' : 'N/A') + '&lt;/td&gt;';\\n    tableBody.appendChild(windowRow);\\n    \\n    var diffRow = document.createElement('tr');\\n    diffRow.innerHTML = \\n        '&lt;td&gt;Absolute Difference (JND)&lt;/td&gt;' +\\n        '&lt;td&gt;0 ms (reference)&lt;/td&gt;' +\\n        '&lt;td&gt;' + (hasData ? jndAbsoluteDifference.toFixed(2) + ' ms' : 'N/A') + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + (hasData ? 'Weber Ratio: ' + webersRatio.toFixed(4) : 'N/A') + '&lt;/td&gt;';\\n    tableBody.appendChild(diffRow);\\n    \\n    var rateStandard = PITCH_FALL_SEMITONES / (STANDARD_WINDOW / 1000);\\n    var rateRow = document.createElement('tr');\\n    rateRow.innerHTML = \\n        '&lt;td&gt;Modulation Rate&lt;/td&gt;' +\\n        '&lt;td&gt;' + rateStandard.toFixed(4) + ' semitones/s&lt;/td&gt;' +\\n        '&lt;td&gt;' + (hasData ? thresholdModulationRate.toFixed(4) + ' semitones/s' : 'N/A') + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + (hasData ? (thresholdModulationRate / rateStandard).toFixed(4) + ' : 1' : 'N/A') + '&lt;/td&gt;';\\n    tableBody.appendChild(rateRow);\\n    \\n    var interpretation = document.getElementById('resultInterpretation');\\n    let interpretationHtml = '&lt;h3 style=\\\&quot;margin-top: 0;\\\&quot;&gt;Performance Interpretation&lt;/h3&gt;';\\n    \\n    if (hasData) {\\n        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Your Just Noticeable Difference (JND):&lt;/strong&gt;&lt;/p&gt;';\\n        \\n        interpretationHtml += '&lt;p&gt;You can reliably detect a difference when the modulation window changes by &lt;strong&gt;' + \\n            jndAbsoluteDifference.toFixed(2) + ' ms&lt;/strong&gt; (or &lt;strong&gt;' + jndPercentDifference.toFixed(2) + \\n            '%&lt;/strong&gt; of the standard 400 ms window).&lt;/p&gt;';\\n        \\n        interpretationHtml += '&lt;p&gt;In other words, you can discriminate between:&lt;/p&gt;';\\n        interpretationHtml += '&lt;ul&gt;';\\n        interpretationHtml += '&lt;li&gt;Standard stimulus: 400 ms modulation window&lt;/li&gt;';\\n        interpretationHtml += '&lt;li&gt;Your threshold: ' + thresholdWindowDuration.toFixed(2) + ' ms modulation window&lt;/li&gt;';\\n        interpretationHtml += '&lt;li&gt;Difference: ' + jndAbsoluteDifference.toFixed(2) + ' ms&lt;/li&gt;';\\n        interpretationHtml += '&lt;/ul&gt;';\\n        \\n        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Weber\\\\'s Ratio:&lt;/strong&gt; ' + webersRatio.toFixed(4) + \\n            ' (smaller Weber\\\\'s ratio = better discrimination sensitivity)&lt;/p&gt;';\\n        \\n        interpretationHtml += '&lt;p&gt;&lt;em&gt;Note: A &lt;strong&gt;smaller JND&lt;/strong&gt; indicates &lt;strong&gt;better sensitivity&lt;/strong&gt; to dynamic pitch changes, ' +\\n            'as it means you can detect smaller differences between stimuli.&lt;/em&gt;&lt;/p&gt;';\\n    } else {\\n        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Complete results not available due to insufficient data.&lt;/p&gt;';\\n    }\\n    \\n    const rtStats = calculateReactionTimeStats();\\n    const accuracyStats = calculateAccuracyStats();\\n    \\n    interpretationHtml += '&lt;p&gt;&lt;strong&gt;Overall Performance:&lt;/strong&gt; ' + accuracyStats.percentage + \\n        '% accuracy with average reaction time of ' + rtStats.mean + ' ms across ' + \\n        accuracyStats.total + ' trials.&lt;/p&gt;';\\n    \\n    interpretation.innerHTML = interpretationHtml;\\n    \\n    var detailedBody = document.getElementById('detailedMetricsBody');\\n    detailedBody.innerHTML = '';\\n    \\n    var metrics = [\\n        { name: 'Average Difficulty Level', value: hasData ? sentAverage.toFixed(2) : 'N/A', interp: hasData ? 'SD: ' + sentStdev.toFixed(2) : 'N/A' },\\n        { name: 'Threshold Slope', value: hasData ? thresholdSlope.toFixed(6) + ' semitones/ms' : 'N/A', interp: hasData ? 'Rate of pitch change' : 'N/A' },\\n        { name: 'Number of Reversals', value: NumberOfReversals, interp: 'Minimum required: ' + MINIMUMREVERSALS },\\n        { name: 'Total Trials', value: numberOfIterations, interp: 'Maximum allowed: ' + MAXITERATIONS }\\n    ];\\n    \\n    metrics.forEach(function(metric) {\\n        var row = document.createElement('tr');\\n        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;&lt;td&gt;' + metric.interp + '&lt;/td&gt;';\\n        detailedBody.appendChild(row);\\n    });\\n    \\n    var perfBody = document.getElementById('performanceStatsBody');\\n    perfBody.innerHTML = '';\\n    \\n    var perfMetrics = [\\n        { name: 'Total Trials', value: accuracyStats.total },\\n        { name: 'Correct Responses', value: accuracyStats.correct },\\n        { name: 'Overall Accuracy', value: accuracyStats.percentage + '%' },\\n        { name: 'Mean Reaction Time', value: rtStats.mean + ' ms' },\\n        { name: 'Median Reaction Time', value: rtStats.median + ' ms' },\\n        { name: 'RT Standard Deviation', value: rtStats.sd + ' ms' }\\n    ];\\n    \\n    perfMetrics.forEach(function(metric) {\\n        var row = document.createElement('tr');\\n        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;';\\n        perfBody.appendChild(row);\\n    });\\n}\\n\\nfunction backToExperiment() {\\n    document.getElementById('experimentContainer').style.display = 'block';\\n    document.getElementById('resultsContainer').style.display = 'none';\\n}\\n\\nfunction view_onclick() {\\n    logDebug(\\\&quot;View results button clicked\\\&quot;);\\n    \\n    if (!isTestComplete &amp;&amp; NumberOfReversals &gt;= MINIMUMREVERSALS) {\\n        calculateResults();\\n        isTestComplete = true;\\n    }\\n    \\n    displayResults();\\n}\\n\\nfunction beginIteration() {\\n    isReplayTrial = false;\\n    \\n    standardIsFirst = Math.random() &lt; 0.5;\\n    var xIsStandard = Math.random() &lt; 0.5;\\n    \\n    if (xIsStandard) {\\n        CorrectAnswer = standardIsFirst ? 1 : 2;\\n    } else {\\n        CorrectAnswer = standardIsFirst ? 2 : 1;\\n    }\\n    \\n    logDebug(\\\&quot;Starting new iteration #\\\&quot; + numberOfIterations + \\n             \\\&quot;, Standard is \\\&quot; + (standardIsFirst ? \\\&quot;first\\\&quot; : \\\&quot;second\\\&quot;) +\\n             \\\&quot;, X is \\\&quot; + (xIsStandard ? \\\&quot;standard\\\&quot; : \\\&quot;comparison\\\&quot;) +\\n             \\\&quot;, Correct answer: \\\&quot; + (CorrectAnswer === 1 ? \\\&quot;First\\\&quot; : \\\&quot;Second\\\&quot;) +\\n             \\\&quot;, Difficulty level: \\\&quot; + currentLevel +\\n             \\\&quot;, Modulation window: \\\&quot; + MODULATION_WINDOWS[currentLevel] + \\\&quot;% (\\\&quot; + \\n             getModulationWindowDuration(currentLevel) + \\\&quot; ms)\\\&quot;);\\n    \\n    setTimeout(function() {\\n        playABXSequence(xIsStandard);\\n    }, 1000);\\n}\\n\\nfunction clearButtonAnimations() {\\n    document.getElementById('firstBtn').classList.remove('button-playing');\\n    document.getElementById('secondBtn').classList.remove('button-playing');\\n}\\n\\nfunction playABXSequence(xIsStandard) {\\n    logDebug(\\\&quot;Playing ABX sequence\\\&quot;);\\n    \\n    clearButtonAnimations();\\n\\n    standardSound = document.getElementById('low_falling_standard');\\n    comparisonSound = document.getElementById(\\\&quot;low_falling_\\\&quot; + currentLevel);\\n\\n    xSound = xIsStandard ? standardSound : comparisonSound;\\n    \\n    if (!standardSound || !comparisonSound) {\\n        logDebug(\\\&quot;Error: Cannot find audio elements!\\\&quot;);\\n        document.getElementById('text1').value = \\\&quot;出錯：找不到音頻文件\\\&quot;;\\n        setTimeout(function() {\\n            showDiagnostics();\\n        }, 1000);\\n        return;\\n    }\\n    \\n    var firstSound = standardIsFirst ? standardSound : comparisonSound;\\n    document.getElementById('text1').value = \\\&quot;播放第一個音\\\&quot;;\\n    \\n    document.getElementById('firstBtn').classList.add('button-playing');\\n    \\n    firstSound.currentTime = 0;\\n    var playPromise1 = firstSound.play();\\n    \\n    if (playPromise1 !== undefined) {\\n        playPromise1.then(function() {\\n            logDebug(\\\&quot;First sound (A) played successfully\\\&quot;);\\n            \\n            firstSound.onended = function() {\\n                logDebug(\\\&quot;First sound ended\\\&quot;);\\n                \\n                document.getElementById('firstBtn').classList.remove('button-playing');\\n                \\n                setTimeout(function() {\\n                    var secondSound = standardIsFirst ? comparisonSound : standardSound;\\n                    document.getElementById('text1').value = \\\&quot;播放第二個音\\\&quot;;\\n                    \\n                    document.getElementById('secondBtn').classList.add('button-playing');\\n                    \\n                    secondSound.currentTime = 0;\\n                    var playPromise2 = secondSound.play();\\n                    \\n                    if (playPromise2 !== undefined) {\\n                        playPromise2.then(function() {\\n                            logDebug(\\\&quot;Second sound (B) played successfully\\\&quot;);\\n                            \\n                            secondSound.onended = function() {\\n                                logDebug(\\\&quot;Second sound ended\\\&quot;);\\n                                \\n                                document.getElementById('secondBtn').classList.remove('button-playing');\\n                                \\n                                setTimeout(function() {\\n                                    document.getElementById('text1').value = \\\&quot;播放第三個音\\\&quot;;\\n                                    \\n                                    xSound.currentTime = 0;\\n                                    var playPromise3 = xSound.play();\\n                                    \\n                                    if (playPromise3 !== undefined) {\\n                                        playPromise3.then(function() {\\n                                            logDebug(\\\&quot;Third sound (X) played successfully\\\&quot;);\\n                                            \\n                                            xSound.onended = function() {\\n                                                logDebug(\\\&quot;Third sound ended, enabling response buttons\\\&quot;);\\n                                                \\n                                                stimulusEndTime = performance.now();\\n                                                \\n                                                document.getElementById('text1').value = \\\&quot;請作出選擇\\\&quot;;\\n                                                document.getElementById('promptText').style.visibility = 'visible';\\n                                                \\n                                                document.getElementById('firstBtn').disabled = false;\\n                                                document.getElementById('secondBtn').disabled = false;\\n                                                document.getElementById('firstBtn').style.background = \\\&quot;#66CCFF\\\&quot;;\\n                                                document.getElementById('secondBtn').style.background = \\\&quot;#66CCFF\\\&quot;;\\n                                            };\\n                                        }).catch(function(error) {\\n                                            logDebug(\\\&quot;Failed to play third sound: \\\&quot; + error);\\n                                            document.getElementById('text1').value = \\\&quot;音頻播放錯誤\\\&quot;;\\n                                            clearButtonAnimations();\\n                                            setTimeout(showDiagnostics, 1000);\\n                                        });\\n                                    }\\n                                }, 1000);\\n                            };\\n                        }).catch(function(error) {\\n                            logDebug(\\\&quot;Failed to play second sound: \\\&quot; + error);\\n                            document.getElementById('text1').value = \\\&quot;音頻播放錯誤\\\&quot;;\\n                            clearButtonAnimations();\\n                            setTimeout(showDiagnostics, 1000);\\n                        });\\n                    }\\n                }, 1000);\\n            };\\n        }).catch(function(error) {\\n            logDebug(\\\&quot;Failed to play first sound: \\\&quot; + error);\\n            document.getElementById('text1').value = \\\&quot;音頻播放錯誤，請刷新頁面\\\&quot;;\\n            clearButtonAnimations();\\n            setTimeout(showDiagnostics, 1000);\\n        });\\n    }\\n}\\n\\nfunction start_onclick() {\\n    logDebug(\\\&quot;Starting experiment\\\&quot;);\\n    \\n    if (!audioUnlocked) {\\n        unlockAudioContext();\\n    }\\n    \\n    checkAudioFiles();\\n    if (!allFilesPresent) {\\n        logDebug(\\\&quot;Cannot start experiment: Some audio files are missing\\\&quot;);\\n        document.getElementById('text1').value = \\\&quot;音頻缺失\\\&quot;;\\n        showDiagnostics();\\n        return;\\n    }\\n    \\n    window_onload();\\n    document.getElementById('text1').value = \\\&quot;開始實驗...\\\&quot;;\\n    updateProgressBar(0);\\n    \\n    setTimeout(function() {\\n        beginIteration();\\n        document.getElementById('start').disabled = true;\\n        document.getElementById('viewResult').disabled = true;\\n        document.getElementById('smile').src = \\\&quot;Media/null.gif\\\&quot;;\\n        document.getElementById('promptText').style.visibility = 'hidden';\\n    }, 1000);\\n}\\n\\nfunction gotReversal() {\\n    NumberOfReversals++;\\n    Reversals[NumberOfReversals - 1] = currentLevel;\\n    Direction = -Direction;\\n    logDebug(\\\&quot;Recorded reversal #\\\&quot; + NumberOfReversals + \\\&quot; at difficulty \\\&quot; + currentLevel + \\n             \\\&quot; (window: \\\&quot; + MODULATION_WINDOWS[currentLevel] + \\\&quot;%, \\\&quot; + \\n             getModulationWindowDuration(currentLevel) + \\\&quot; ms)\\\&quot;);\\n}\\n\\nfunction processAnswer(Response) {\\n    const reactionEndTime = performance.now();\\n    const reactionTime = reactionEndTime - stimulusEndTime;\\n    \\n    logDebug(\\\&quot;User answered: \\\&quot; + (Response === 1 ? \\\&quot;First\\\&quot; : \\\&quot;Second\\\&quot;) + \\n             \\\&quot;, Correct answer: \\\&quot; + (CorrectAnswer === 1 ? \\\&quot;First\\\&quot; : \\\&quot;Second\\\&quot;) +\\n             \\\&quot;, Is replay: \\\&quot; + isReplayTrial);\\n    \\n    document.getElementById('firstBtn').disabled = true;\\n    document.getElementById('secondBtn').disabled = true;\\n    document.getElementById('promptText').style.visibility = 'hidden';\\n    \\n    const isCorrect = (Response === CorrectAnswer);\\n    \\n    if (!isReplayTrial) {\\n        const windowPercent = MODULATION_WINDOWS[currentLevel];\\n        const windowDuration = getModulationWindowDuration(currentLevel);\\n        const modulationRate = getModulationRate(currentLevel);\\n        const slope = getModulationSlope(currentLevel);\\n        \\n        const trialInfo = {\\n            trialNumber: numberOfIterations,\\n            timestamp: getLocalTimestamp(),\\n            difficultyLevel: currentLevel,\\n            modulationWindowPercent: windowPercent,\\n            modulationWindowDuration: windowDuration.toFixed(2),\\n            modulationRate: modulationRate.toFixed(4),\\n            slope: slope.toFixed(6),\\n            userResponse: Response === 1 ? \\\&quot;First Tone\\\&quot; : \\\&quot;Second Tone\\\&quot;,\\n            correctResponse: CorrectAnswer === 1 ? \\\&quot;First Tone\\\&quot; : \\\&quot;Second Tone\\\&quot;,\\n            isCorrect: isCorrect,\\n            reactionTime: reactionTime.toFixed(0),\\n            isReversal: false,\\n            stepDirection: Direction === DECREASING ? \\\&quot;Increasing Difficulty\\\&quot; : \\\&quot;Decreasing Difficulty\\\&quot;,\\n            standardPosition: standardIsFirst ? \\\&quot;First\\\&quot; : \\\&quot;Second\\\&quot;\\n        };\\n        \\n        trialRecords.push(trialInfo);\\n    }\\n    \\n    if (isCorrect) {\\n        logDebug(\\\&quot;Correct answer\\\&quot;);\\n        document.getElementById('smile').src = \\\&quot;Media/smiley.png\\\&quot;;\\n        document.getElementById('text1').value = \\\&quot;正確！\\\&quot;;\\n        \\n        if (!isReplayTrial) {\\n            CorrectResponses++;\\n            \\n            if (CorrectResponses == 2) {\\n                logDebug(\\\&quot;Two correct answers in a row\\\&quot;);\\n                CorrectResponses = 0;\\n                \\n                if (Direction == INCREASING) {\\n                    gotReversal();\\n                    if (trialRecords.length &gt; 0) {\\n                        trialRecords[trialRecords.length-1].isReversal = true;\\n                    }\\n                }\\n                \\n                changeLevel(DECREASING);\\n            }\\n        }\\n        \\n        setTimeout(function() {\\n            document.getElementById(\\\&quot;smile\\\&quot;).src = 'Media/null.gif';\\n            resetPage();\\n        }, 1500);\\n    } else {\\n        logDebug(\\\&quot;Incorrect answer - will replay stimulus\\\&quot;);\\n        document.getElementById('smile').src = \\\&quot;Media/nosmiley.png\\\&quot;;\\n        \\n        var correctAnswerText = CorrectAnswer === 1 ? \\\&quot;第一個音\\\&quot; : \\\&quot;第二個音\\\&quot;;\\n        document.getElementById('text1').value = \\\&quot;錯誤！正確答案是：\\\&quot; + correctAnswerText;\\n        \\n        if (!isReplayTrial) {\\n            CorrectResponses = 0;\\n            \\n            if (Direction == DECREASING) {\\n                gotReversal();\\n                if (trialRecords.length &gt; 0) {\\n                    trialRecords[trialRecords.length-1].isReversal = true;\\n                }\\n            }\\n            \\n            changeLevel(INCREASING);\\n        }\\n        \\n        setTimeout(function() {\\n            document.getElementById(\\\&quot;smile\\\&quot;).src = 'Media/null.gif';\\n            document.getElementById('text1').value = \\\&quot;重播刺激音...\\\&quot;;\\n            \\n            setTimeout(function() {\\n                isReplayTrial = true;\\n                \\n                var xIsStandard = (standardIsFirst &amp;&amp; CorrectAnswer === 1) || \\n                                  (!standardIsFirst &amp;&amp; CorrectAnswer === 2);\\n                playABXSequence(xIsStandard);\\n            }, 1000);\\n        }, 2000);\\n    }\\n}\\n\\nfunction changeLevel(whichWay) {\\n    var oldLevel = currentLevel;\\n    var stepSize = NumberOfReversals &lt; 4 ? 2 : 1;\\n    \\n    if (whichWay == DECREASING) {\\n        currentLevel = Math.min(9, currentLevel + stepSize);\\n    } else {\\n        currentLevel = Math.max(LOWERLIMIT, currentLevel - stepSize);\\n    }\\n    \\n    logDebug(\\\&quot;Difficulty changed from level \\\&quot; + oldLevel + \\\&quot; (\\\&quot; + MODULATION_WINDOWS[oldLevel] + \\\&quot;%, \\\&quot; +\\n             getModulationWindowDuration(oldLevel) + \\\&quot; ms) to level \\\&quot; + \\n             currentLevel + \\\&quot; (\\\&quot; + MODULATION_WINDOWS[currentLevel] + \\\&quot;%, \\\&quot; +\\n             getModulationWindowDuration(currentLevel) + \\\&quot; ms) \\\&quot; +\\n             (whichWay == DECREASING ? \\\&quot;(increasing difficulty)\\\&quot; : \\\&quot;(decreasing difficulty)\\\&quot;));\\n}\\n\\nfunction exportToCSV() {\\n    const headers = [\\n        \\\&quot;Trial Number\\\&quot;, \\n        \\\&quot;Timestamp\\\&quot;, \\n        \\\&quot;Difficulty Level\\\&quot;, \\n        \\\&quot;Modulation Window (%)\\\&quot;,\\n        \\\&quot;Modulation Window (ms)\\\&quot;,\\n        \\\&quot;Modulation Rate (semitones/s)\\\&quot;,\\n        \\\&quot;Slope (semitones/ms)\\\&quot;,\\n        \\\&quot;Standard Position\\\&quot;,\\n        \\\&quot;User Response\\\&quot;, \\n        \\\&quot;Correct Response\\\&quot;, \\n        \\\&quot;Is Correct\\\&quot;, \\n        \\\&quot;Reaction Time (ms)\\\&quot;, \\n        \\\&quot;Is Reversal\\\&quot;,\\n        \\\&quot;Step Direction\\\&quot;\\n    ];\\n    \\n    const csvRows = [];\\n    csvRows.push(headers.join(\\\&quot;,\\\&quot;));\\n    \\n    trialRecords.forEach(function(trial) {\\n        const row = [\\n            trial.trialNumber,\\n            trial.timestamp,\\n            trial.difficultyLevel,\\n            trial.modulationWindowPercent,\\n            trial.modulationWindowDuration,\\n            trial.modulationRate,\\n            trial.slope,\\n            trial.standardPosition,\\n            trial.userResponse,\\n            trial.correctResponse,\\n            trial.isCorrect ? \\\&quot;1\\\&quot; : \\\&quot;0\\\&quot;,\\n            trial.reactionTime,\\n            trial.isReversal ? \\\&quot;1\\\&quot; : \\\&quot;0\\\&quot;,\\n            trial.stepDirection\\n        ];\\n        csvRows.push(row.join(\\\&quot;,\\\&quot;));\\n    });\\n    \\n    csvRows.push(\\\&quot;\\\\nRESULTS SUMMARY - JUST NOTICEABLE DIFFERENCE (JND)\\\&quot;);\\n    csvRows.push(\\\&quot;\\\\nJND Metrics\\\&quot;);\\n    csvRows.push(\\\&quot;Parameter,Value,Unit,Description\\\&quot;);\\n    \\n    const hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;\\n    \\n    csvRows.push(\\\&quot;JND Absolute Difference,\\\&quot; + \\n        (hasData ? jndAbsoluteDifference.toFixed(2) : \\\&quot;N/A\\\&quot;) + \\\&quot;,ms,Detectable difference from standard (smaller = better)\\\&quot;);\\n    \\n    csvRows.push(\\\&quot;JND Percentage Difference,\\\&quot; + \\n        (hasData ? jndPercentDifference.toFixed(2) : \\\&quot;N/A\\\&quot;) + \\\&quot;,%,Percentage difference from standard (smaller = better)\\\&quot;);\\n    \\n    csvRows.push(\\\&quot;JND Ratio (Threshold/Standard),\\\&quot; + \\n        (hasData ? jndRatio.toFixed(4) : \\\&quot;N/A\\\&quot;) + \\\&quot;,ratio,Threshold modulation window / Standard window\\\&quot;);\\n    \\n    csvRows.push(\\\&quot;Weber's Ratio,\\\&quot; + \\n        (hasData ? webersRatio.toFixed(4) : \\\&quot;N/A\\\&quot;) + \\\&quot;,ratio,ΔI / I (smaller = better sensitivity)\\\&quot;);\\n    \\n    csvRows.push(\\\&quot;\\\\nThreshold Parameters\\\&quot;);\\n    csvRows.push(\\\&quot;Parameter,Value,Unit\\\&quot;);\\n    \\n    csvRows.push(\\\&quot;Standard Modulation Window,\\\&quot; + STANDARD_WINDOW + \\\&quot;,ms\\\&quot;);\\n    \\n    csvRows.push(\\\&quot;Threshold Modulation Window,\\\&quot; + \\n        (hasData ? thresholdWindowDuration.toFixed(2) : \\\&quot;N/A\\\&quot;) + \\\&quot;,ms\\\&quot;);\\n    \\n    csvRows.push(\\\&quot;Threshold Window Percentage,\\\&quot; + \\n        (hasData ? thresholdWindowPercent.toFixed(2) : \\\&quot;N/A\\\&quot;) + \\\&quot;,%\\\&quot;);\\n    \\n    csvRows.push(\\\&quot;Threshold Modulation Rate,\\\&quot; + \\n        (hasData ? thresholdModulationRate.toFixed(4) : \\\&quot;N/A\\\&quot;) + \\\&quot;,semitones/s\\\&quot;);\\n    \\n    csvRows.push(\\\&quot;Threshold Slope,\\\&quot; + \\n        (hasData ? thresholdSlope.toFixed(6) : \\\&quot;N/A\\\&quot;) + \\\&quot;,semitones/ms\\\&quot;);\\n    \\n    csvRows.push(\\\&quot;Average Difficulty Level,\\\&quot; + \\n        (hasData ? sentAverage.toFixed(2) : \\\&quot;N/A\\\&quot;) + \\\&quot;,level (1-9)\\\&quot;);\\n    \\n    csvRows.push(\\\&quot;Difficulty Level SD,\\\&quot; + \\n        (hasData ? sentStdev.toFixed(2) : \\\&quot;N/A\\\&quot;) + \\\&quot;,level\\\&quot;);\\n    \\n    const rtStats = calculateReactionTimeStats();\\n    csvRows.push(\\\&quot;\\\\nReaction Time Statistics\\\&quot;);\\n    csvRows.push(\\\&quot;Mean,Median,Standard Deviation\\\&quot;);\\n    csvRows.push(rtStats.mean + \\\&quot;,\\\&quot; + rtStats.median + \\\&quot;,\\\&quot; + rtStats.sd);\\n    \\n    const accuracyStats = calculateAccuracyStats();\\n    csvRows.push(\\\&quot;\\\\nAccuracy Statistics\\\&quot;);\\n    csvRows.push(\\\&quot;Correct Responses,Total Responses,Percentage\\\&quot;);\\n    csvRows.push(accuracyStats.correct + \\\&quot;,\\\&quot; + accuracyStats.total + \\\&quot;,\\\&quot; + accuracyStats.percentage + \\\&quot;%\\\&quot;);\\n    \\n    csvRows.push(\\\&quot;\\\\nExperiment Parameters\\\&quot;);\\n    csvRows.push(\\\&quot;Parameter,Value\\\&quot;);\\n    csvRows.push(\\\&quot;Paradigm,ABX\\\&quot;);\\n    csvRows.push(\\\&quot;Stimulus Type,Dynamic Pitch (Falling Tone)\\\&quot;);\\n    csvRows.push(\\\&quot;Total Stimulus Duration,\\\&quot; + STIMULUS_DURATION + \\\&quot; ms\\\&quot;);\\n    csvRows.push(\\\&quot;Standard Modulation Window,\\\&quot; + STANDARD_WINDOW + \\\&quot; ms\\\&quot;);\\n    csvRows.push(\\\&quot;Pitch Fall Amount,\\\&quot; + PITCH_FALL_SEMITONES + \\\&quot; semitone(s)\\\&quot;);\\n    csvRows.push(\\\&quot;Max Reversals,\\\&quot; + MAXREVERSALS);\\n    csvRows.push(\\\&quot;Min Reversals for Calculation,\\\&quot; + MINIMUMREVERSALS);\\n    csvRows.push(\\\&quot;Max Iterations,\\\&quot; + MAXITERATIONS);\\n    \\n    csvRows.push(\\\&quot;\\\\nDifficulty Level Mapping\\\&quot;);\\n    csvRows.push(\\\&quot;Level,Modulation Window (%),Modulation Window (ms),Difference from Standard (ms),Modulation Rate (semitones/s),Slope (semitones/ms)\\\&quot;);\\n    for (let level = 1; level &lt;= 9; level++) {\\n        const windowPercent = MODULATION_WINDOWS[level];\\n        const windowDuration = getModulationWindowDuration(level);\\n        const diffFromStandard = STANDARD_WINDOW - windowDuration;\\n        const rate = getModulationRate(level);\\n        const slope = getModulationSlope(level);\\n        csvRows.push(level + \\\&quot;,\\\&quot; + windowPercent + \\\&quot;,\\\&quot; + windowDuration.toFixed(2) + \\\&quot;,\\\&quot; + \\n                     diffFromStandard.toFixed(2) + \\\&quot;,\\\&quot; + rate.toFixed(4) + \\\&quot;,\\\&quot; + slope.toFixed(6));\\n    }\\n    \\n    const csvContent = \\\&quot;data:text/csv;charset=utf-8,\\\&quot; + csvRows.join(\\\&quot;\\\\n\\\&quot;);\\n    const encodedUri = encodeURI(csvContent);\\n    const link = document.createElement(\\\&quot;a\\\&quot;);\\n    const timestamp = new Date().toISOString().replace(/[:.]/g, \\\&quot;-\\\&quot;);\\n    link.setAttribute(\\\&quot;href\\\&quot;, encodedUri);\\n    link.setAttribute(\\\&quot;download\\\&quot;, \\\&quot;dynamic_pitch_JND_ABX_data_\\\&quot; + timestamp + \\\&quot;.csv\\\&quot;);\\n    document.body.appendChild(link);\\n    link.click();\\n    document.body.removeChild(link);\\n}\\n\\nfunction window_onload() {\\n    window.name = \\\&quot;EXP\\\&quot;;\\n    NumberOfReversals = 0;\\n    numberOfIterations = 0;\\n    CorrectResponses = 0;\\n    Direction = DECREASING;\\n    currentLevel = 5;\\n    isTestComplete = false;\\n    Reversals = [];\\n    trialRecords = [];\\n    isReplayTrial = false;\\n    \\n    jndAbsoluteDifference = 0;\\n    jndRatio = 0;\\n    jndPercentDifference = 0;\\n    thresholdWindowDuration = 0;\\n    thresholdWindowPercent = 0;\\n    thresholdModulationRate = 0;\\n    thresholdSlope = 0;\\n    webersRatio = 0;\\n\\n    document.getElementById('text1').value = \\\&quot;準備完畢後請點擊\\\\\\\&quot;開始實驗\\\\\\\&quot;\\\&quot;;\\n    document.getElementById('smile').src = \\\&quot;Media/null.gif\\\&quot;;\\n    document.getElementById('start').disabled = false;\\n    document.getElementById('viewResult').disabled = true;\\n    document.getElementById('promptText').style.visibility = 'hidden';\\n    document.getElementById('experimentContainer').style.display = 'block';\\n    document.getElementById('resultsContainer').style.display = 'none';\\n    \\n    updateProgressBar(0);\\n    \\n    logDebug(\\\&quot;Page reset complete\\\&quot;);\\n}\\n\\nwindow.onload = function() {\\n    window_onload();\\n    \\n    var allAudios = document.querySelectorAll('audio');\\n    logDebug(\\\&quot;Preloading \\\&quot; + allAudios.length + \\\&quot; audio files\\\&quot;);\\n    \\n    allAudios.forEach(function(audio) {\\n        audio.load();\\n    });\\n    \\n    document.getElementById('text1').value = \\\&quot;請點擊\\\\\\\&quot;開始實驗\\\\\\\&quot;\\\&quot;;\\n    \\n    window.onerror = function(message, source, lineno, colno, error) {\\n        logDebug(\\\&quot;Global error: \\\&quot; + message + \\\&quot; at \\\&quot; + source + \\\&quot;:\\\&quot; + lineno);\\n        return false;\\n    };\\n    \\n    document.getElementById('showDebug').checked = true;\\n    toggleDebug();\\n};\\n&lt;/script&gt;\\n&lt;/body&gt;\\n&lt;/html&gt;\\n... EOF no more lines ...\\n\&quot;, \&quot;fileSize\&quot;: \&quot;60.31 KB\&quot;, \&quot;isBigFile\&quot;: true, \&quot;totalLines\&quot;: 1694}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668097,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:150,&quot;prompt_tokens&quot;:51372,&quot;total_tokens&quot;:51522,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:51020,&quot;cache_write_tokens&quot;:345},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668097,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668105,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;现在我需要在`calculateResults()`函数的末尾添加自动发送邮件的功能：&quot;},&quot;timestamp&quot;:1762668105,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668105,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668105,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_upejCgFERx6t9em4mZFzUw&quot;,&quot;name&quot;:&quot;replace_in_file&quot;,&quot;display_name&quot;:&quot;编辑文件&quot;,&quot;render_type&quot;:&quot;CodeReplace&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_upejCgFERx6t9em4mZFzUw&quot;,&quot;toolCallName&quot;:&quot;replace_in_file&quot;}" />
                    <option value="{&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_upejCgFERx6t9em4mZFzUw&quot;,&quot;document&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;sub_content&quot;:&quot;ABX_falling_low.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;old_string&quot;:&quot;    logDebug(\&quot;Test complete! Average difficulty level: \&quot; + average.toFixed(2));\n    logDebug(\&quot;Threshold window: \&quot; + thresholdWindowPercent.toFixed(2) + \&quot;% (\&quot; + thresholdWindowDuration.toFixed(2) + \&quot; ms)\&quot;);\n    logDebug(\&quot;JND Absolute Difference: \&quot; + jndAbsoluteDifference.toFixed(2) + \&quot; ms\&quot;);\n    logDebug(\&quot;JND Ratio: \&quot; + jndRatio.toFixed(4));\n    logDebug(\&quot;JND Percent Difference: \&quot; + jndPercentDifference.toFixed(2) + \&quot;%\&quot;);\n    logDebug(\&quot;Weber's Ratio: \&quot; + webersRatio.toFixed(4));\n    \n    document.getElementById('text1').value = \&quot;Test complete! JND: \&quot; + jndAbsoluteDifference.toFixed(1) + \&quot; ms\&quot;;\n}&quot;,&quot;new_string&quot;:&quot;    logDebug(\&quot;Test complete! Average difficulty level: \&quot; + average.toFixed(2));\n    logDebug(\&quot;Threshold window: \&quot; + thresholdWindowPercent.toFixed(2) + \&quot;% (\&quot; + thresholdWindowDuration.toFixed(2) + \&quot; ms)\&quot;);\n    logDebug(\&quot;JND Absolute Difference: \&quot; + jndAbsoluteDifference.toFixed(2) + \&quot; ms\&quot;);\n    logDebug(\&quot;JND Ratio: \&quot; + jndRatio.toFixed(4));\n    logDebug(\&quot;JND Percent Difference: \&quot; + jndPercentDifference.toFixed(2) + \&quot;%\&quot;);\n    logDebug(\&quot;Weber's Ratio: \&quot; + webersRatio.toFixed(4));\n    \n    document.getElementById('text1').value = \&quot;Test complete! JND: \&quot; + jndAbsoluteDifference.toFixed(1) + \&quot; ms\&quot;;\n    \n    // 自动发送实验结果到指定邮箱\n    logDebug(\&quot;Preparing to send experiment results via email...\&quot;);\n    \n    // 延迟1秒后发送邮件，确保所有数据已准备好\n    setTimeout(function() {\n        if (typeof sendCurrentExperimentResults === 'function') {\n            sendCurrentExperimentResults();\n            logDebug(\&quot;Email sending initiated\&quot;);\n        } else {\n            logDebug(\&quot;Warning: Email service not available. Please check if emailService.js is loaded.\&quot;);\n        }\n    }, 1000);\n}&quot;,&quot;apply_mode&quot;:&quot;apply_only&quot;}},&quot;timestamp&quot;:1762668105,&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668109,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_upejCgFERx6t9em4mZFzUw&quot;},&quot;toolCallId&quot;:&quot;tooluse_upejCgFERx6t9em4mZFzUw&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668109,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_upejCgFERx6t9em4mZFzUw&quot;,&quot;result&quot;:{&quot;commit_id&quot;:[&quot;e6d9eaf28bbc9a0b19e49b4672fde05009a11cbc&quot;,&quot;cb39547a33fd2f0043b20cdb18de7bea9f18e6b3&quot;]}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_upejCgFERx6t9em4mZFzUw&quot;,&quot;content&quot;:&quot;*File replaced success*&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668109,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:759,&quot;prompt_tokens&quot;:60535,&quot;total_tokens&quot;:61294,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:51365,&quot;cache_write_tokens&quot;:9163},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668110,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668118,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;完美！现在我需要为其他5个实验HTML文件也添加相同的功能。让我创建一个批量修改的脚本来处理所有文件：&quot;},&quot;timestamp&quot;:1762668118,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668118,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668118,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_z1Z2XbddQ5qXhWb8DLYZXw&quot;,&quot;name&quot;:&quot;read_file&quot;,&quot;display_name&quot;:&quot;读取文件&quot;,&quot;render_type&quot;:&quot;None&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_z1Z2XbddQ5qXhWb8DLYZXw&quot;,&quot;toolCallName&quot;:&quot;read_file&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762668119,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_z1Z2XbddQ5qXhWb8DLYZXw&quot;,&quot;document&quot;:{&quot;sub_content&quot;:&quot;ABX_rising_low.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_low.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_low.html&quot;}},&quot;toolCallId&quot;:&quot;tooluse_z1Z2XbddQ5qXhWb8DLYZXw&quot;,&quot;delta&quot;:&quot;{\&quot;limit\&quot;: 460, \&quot;path\&quot;: \&quot;E:/Projects/Pitch_Training/ABX_rising_low.html\&quot;, \&quot;explanation\&quot;: \&quot;读取另一个实验文件的head部分，准备添加EmailJS引用\&quot;, \&quot;offset\&quot;: 440}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668119,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_z1Z2XbddQ5qXhWb8DLYZXw&quot;},&quot;toolCallId&quot;:&quot;tooluse_z1Z2XbddQ5qXhWb8DLYZXw&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668119,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_z1Z2XbddQ5qXhWb8DLYZXw&quot;,&quot;result&quot;:{}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_z1Z2XbddQ5qXhWb8DLYZXw&quot;,&quot;content&quot;:&quot;{\&quot;content\&quot;: \&quot;... 439 lines before line 440 ...\\n            padding: 15px;\\n            border-radius: 8px;\\n            margin: 20px 0;\\n            text-align: center;\\n        }\\n        .highlight-value {\\n            font-size: 28px;\\n            font-weight: bold;\\n            color: #e74c3c;\\n            margin: 10px 0;\\n        }\\n    &lt;/style&gt;\\n&lt;/head&gt;\\n&lt;body&gt;\\n    &lt;div class=\\\&quot;container\\\&quot;&gt;\\n        &lt;div class=\\\&quot;header\\\&quot;&gt;\\n            &lt;img src=\\\&quot;Media/animation.gif\\\&quot; alt=\\\&quot;Experiment animation\\\&quot;&gt;\\n            &lt;div class=\\\&quot;training-info\\\&quot;&gt;Low Rising Tone Discrimination (ABX)&lt;/div&gt;\\n            &lt;div class=\\\&quot;instruction-text\\\&quot;&gt;請判斷第三個音聽起來更像第一個還是第二個音&lt;/div&gt;\\n        &lt;/div&gt;\\n\\n        &lt;div id=\\\&quot;experimentContainer\\\&quot;&gt;\\n            &lt;div class=\\\&quot;control-button-container\\\&quot;&gt;\\n                &lt;input id=\\\&quot;start\\\&quot; type=\\\&quot;button\\\&quot; value=\\\&quot;開始實驗\\\&quot; onclick=\\\&quot;start_onclick()\\\&quot; class=\\\&quot;control-button\\\&quot;&gt;\\n                &lt;input id=\\\&quot;viewResult\\\&quot; type=\\\&quot;button\\\&quot; value=\\\&quot;查看結果\\\&quot; onclick=\\\&quot;view_onclick()\\\&quot; class=\\\&quot;control-button\\\&quot; disabled&gt;\\n            &lt;/div&gt;\\n\\n            &lt;div class=\\\&quot;prompt-text\\\&quot; id=\\\&quot;promptText\\\&quot;&gt;\\n                第三個音更像...\\n            &lt;/div&gt;\\n            \\n            &lt;div class=\\\&quot;button-container\\\&quot;&gt;\\n                &lt;input id=\\\&quot;firstBtn\\\&quot; type=\\\&quot;button\\\&quot; value=\\\&quot;第一個音\\\&quot; onclick=\\\&quot;processAnswer(1)\\\&quot; disabled \\n                    class=\\\&quot;response-button\\\&quot; style=\\\&quot;background:#FF6666;\\\&quot;&gt;\\n                &lt;input id=\\\&quot;secondBtn\\\&quot; type=\\\&quot;button\\\&quot; value=\\\&quot;第二個音\\\&quot; onclick=\\\&quot;processAnswer(2)\\\&quot; disabled \\n                    class=\\\&quot;response-button\\\&quot; style=\\\&quot;background:#FF6666;\\\&quot;&gt;\\n            &lt;/div&gt;\\n\\n            &lt;div class=\\\&quot;feedback\\\&quot;&gt;\\n                &lt;img id=\\\&quot;smile\\\&quot; src=\\\&quot;Media/null.gif\\\&quot; width=\\\&quot;100\\\&quot; height=\\\&quot;84\\\&quot; alt=\\\&quot;Feedback\\\&quot;&gt;\\n            &lt;/div&gt;\\n            \\n            &lt;div class=\\\&quot;button-container\\\&quot;&gt;\\n                &lt;input id=\\\&quot;text1\\\&quot; class=\\\&quot;status\\\&quot; readonly&gt;\\n            &lt;/div&gt;\\n            \\n            &lt;div class=\\\&quot;progress-bar-container\\\&quot;&gt;\\n                &lt;div class=\\\&quot;progress-bar\\\&quot; id=\\\&quot;progressBar\\\&quot; style=\\\&quot;width: 0%\\\&quot;&gt;&lt;/div&gt;\\n            &lt;/div&gt;\\n            &lt;div class=\\\&quot;progress-label\\\&quot; id=\\\&quot;progressLabel\\\&quot;&gt;Progress: 0%&lt;/div&gt;\\n            \\n            &lt;div class=\\\&quot;debug-info\\\&quot; id=\\\&quot;debugInfo\\\&quot;&gt;\\n                Debug information will be displayed here\\n            &lt;/div&gt;\\n            \\n            &lt;div class=\\\&quot;auxiliary-buttons\\\&quot;&gt;\\n                &lt;label&gt;&lt;input type=\\\&quot;checkbox\\\&quot; id=\\\&quot;showDebug\\\&quot; onclick=\\\&quot;toggleDebug()\\\&quot;&gt; Show Debug Info&lt;/label&gt;\\n                &lt;button onclick=\\\&quot;testAudio()\\\&quot;&gt;Test All Audio&lt;/button&gt;\\n                &lt;button onclick=\\\&quot;showDiagnostics()\\\&quot;&gt;Diagnostics&lt;/button&gt;\\n                &lt;button onclick=\\\&quot;exportToCSV()\\\&quot; id=\\\&quot;exportBtn\\\&quot;&gt;Export Data (CSV)&lt;/button&gt;\\n            &lt;/div&gt;\\n        &lt;/div&gt;\\n        \\n        &lt;div id=\\\&quot;resultsContainer\\\&quot; class=\\\&quot;results-container\\\&quot;&gt;\\n            &lt;h2 class=\\\&quot;result-heading\\\&quot;&gt;Dynamic Pitch Discrimination Test Results (ABX)&lt;/h2&gt;\\n            \\n            &lt;div class=\\\&quot;highlight-box\\\&quot;&gt;\\n                &lt;h3 style=\\\&quot;margin-top: 0;\\\&quot;&gt;Just Noticeable Difference (JND)&lt;/h3&gt;\\n                &lt;div class=\\\&quot;highlight-value\\\&quot; id=\\\&quot;jndValue\\\&quot;&gt;--&lt;/div&gt;\\n                &lt;p style=\\\&quot;margin-bottom: 0; font-size: 14px; color: #666;\\\&quot;&gt;\\n                    This represents the minimum detectable difference in modulation window duration&lt;br&gt;\\n                    &lt;strong&gt;Smaller JND = Better discrimination ability&lt;/strong&gt;\\n                &lt;/p&gt;\\n            &lt;/div&gt;\\n            \\n            &lt;h3&gt;Perceptual Discrimination Thresholds&lt;/h3&gt;\\n            &lt;table class=\\\&quot;result-table\\\&quot;&gt;\\n                &lt;thead&gt;\\n                    &lt;tr&gt;\\n                        &lt;th&gt;Parameter&lt;/th&gt;\\n                        &lt;th&gt;Standard (Reference)&lt;/th&gt;\\n                        &lt;th&gt;Threshold (Your JND)&lt;/th&gt;\\n                        &lt;th&gt;Difference Ratio&lt;/th&gt;\\n                    &lt;/tr&gt;\\n                &lt;/thead&gt;\\n                &lt;tbody id=\\\&quot;resultTableBody\\\&quot;&gt;\\n                &lt;/tbody&gt;\\n            &lt;/table&gt;\\n            \\n            &lt;div class=\\\&quot;result-interpretation\\\&quot; id=\\\&quot;resultInterpretation\\\&quot;&gt;\\n            &lt;/div&gt;\\n            \\n            &lt;h3&gt;Detailed Threshold Metrics&lt;/h3&gt;\\n            &lt;table class=\\\&quot;result-table\\\&quot;&gt;\\n                &lt;thead&gt;\\n                    &lt;tr&gt;\\n                        &lt;th&gt;Metric&lt;/th&gt;\\n                        &lt;th&gt;Value&lt;/th&gt;\\n                        &lt;th&gt;Interpretation&lt;/th&gt;\\n                    &lt;/tr&gt;\\n                &lt;/thead&gt;\\n                &lt;tbody id=\\\&quot;detailedMetricsBody\\\&quot;&gt;\\n                &lt;/tbody&gt;\\n            &lt;/table&gt;\\n            \\n            &lt;h3&gt;Performance Statistics&lt;/h3&gt;\\n            &lt;table class=\\\&quot;result-table\\\&quot;&gt;\\n                &lt;thead&gt;\\n                    &lt;tr&gt;\\n                        &lt;th&gt;Metric&lt;/th&gt;\\n                        &lt;th&gt;Value&lt;/th&gt;\\n                    &lt;/tr&gt;\\n                &lt;/thead&gt;\\n                &lt;tbody id=\\\&quot;performanceStatsBody\\\&quot;&gt;\\n                &lt;/tbody&gt;\\n            &lt;/table&gt;\\n            \\n            &lt;button class=\\\&quot;print-button\\\&quot; onclick=\\\&quot;printResults()\\\&quot;&gt;Print Results&lt;/button&gt;\\n            \\n            &lt;div class=\\\&quot;auxiliary-buttons\\\&quot; style=\\\&quot;margin-top: 20px;\\\&quot;&gt;\\n                &lt;button onclick=\\\&quot;exportToCSV()\\\&quot;&gt;Export Data (CSV)&lt;/button&gt;\\n            &lt;/div&gt;\\n            \\n            &lt;button class=\\\&quot;back-button\\\&quot; onclick=\\\&quot;backToExperiment()\\\&quot;&gt;Back to Experiment&lt;/button&gt;\\n        &lt;/div&gt;\\n        \\n        &lt;div class=\\\&quot;diagnostic-overlay\\\&quot; id=\\\&quot;diagnosticOverlay\\\&quot;&gt;\\n            &lt;div class=\\\&quot;diagnostic-content\\\&quot;&gt;\\n                &lt;span class=\\\&quot;diagnostic-close\\\&quot; onclick=\\\&quot;closeDiagnostics()\\\&quot;&gt;&amp;times;&lt;/span&gt;\\n                &lt;h2 class=\\\&quot;diagnostic-heading\\\&quot;&gt;Experiment Diagnostics&lt;/h2&gt;\\n                \\n                &lt;div class=\\\&quot;diagnostic-section\\\&quot;&gt;\\n                    &lt;h3&gt;Test Status&lt;/h3&gt;\\n                    &lt;table class=\\\&quot;statistics-table\\\&quot;&gt;\\n                        &lt;tr&gt;\\n                            &lt;th&gt;Trials&lt;/th&gt;\\n                            &lt;th&gt;Reversals&lt;/th&gt;\\n                            &lt;th&gt;Status&lt;/th&gt;\\n                        &lt;/tr&gt;\\n                        &lt;tr&gt;\\n                            &lt;td id=\\\&quot;totalTrials\\\&quot;&gt;0&lt;/td&gt;\\n                            &lt;td id=\\\&quot;totalReversals\\\&quot;&gt;0&lt;/td&gt;\\n                            &lt;td id=\\\&quot;testStatus\\\&quot;&gt;Not started&lt;/td&gt;\\n                        &lt;/tr&gt;\\n                    &lt;/table&gt;\\n                &lt;/div&gt;\\n                \\n                &lt;div class=\\\&quot;diagnostic-section\\\&quot;&gt;\\n                    &lt;h3&gt;Audio Files Check&lt;/h3&gt;\\n                    &lt;p&gt;Verifying necessary audio files:&lt;/p&gt;\\n                    &lt;div id=\\\&quot;audioFileStatus\\\&quot; class=\\\&quot;diagnostic-file-status\\\&quot;&gt;\\n                    &lt;/div&gt;\\n                &lt;/div&gt;\\n                \\n                &lt;div class=\\\&quot;diagnostic-section\\\&quot;&gt;\\n                    &lt;h3&gt;Reversal History&lt;/h3&gt;\\n                    &lt;div id=\\\&quot;reversalHistory\\\&quot;&gt;\\n                    &lt;/div&gt;\\n                &lt;/div&gt;\\n                \\n                &lt;div class=\\\&quot;diagnostic-section\\\&quot;&gt;\\n                    &lt;h3&gt;Recommendations&lt;/h3&gt;\\n                    &lt;div id=\\\&quot;diagnosticRecommendations\\\&quot;&gt;\\n                    &lt;/div&gt;\\n                &lt;/div&gt;\\n                \\n                &lt;div class=\\\&quot;diagnostic-actions\\\&quot;&gt;\\n                    &lt;button class=\\\&quot;diagnostic-action-button continue-button\\\&quot; onclick=\\\&quot;closeDiagnostics()\\\&quot;&gt;Close&lt;/button&gt;\\n                &lt;/div&gt;\\n            &lt;/div&gt;\\n        &lt;/div&gt;\\n    &lt;/div&gt;\\n\\n    &lt;audio id=\\\&quot;low_rising_standard\\\&quot; src=\\\&quot;Media/low_rising_standard.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n\\n    &lt;audio id=\\\&quot;low_rising_1\\\&quot; src=\\\&quot;Media/low_rising_1.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_rising_2\\\&quot; src=\\\&quot;Media/low_rising_2.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_rising_3\\\&quot; src=\\\&quot;Media/low_rising_3.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_rising_4\\\&quot; src=\\\&quot;Media/low_rising_4.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_rising_5\\\&quot; src=\\\&quot;Media/low_rising_5.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_rising_6\\\&quot; src=\\\&quot;Media/low_rising_6.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_rising_7\\\&quot; src=\\\&quot;Media/low_rising_7.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_rising_8\\\&quot; src=\\\&quot;Media/low_rising_8.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_rising_9\\\&quot; src=\\\&quot;Media/low_rising_9.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n\\n&lt;script&gt;\\nfunction getLocalTimestamp() {\\n    const now = new Date();\\n    const year = now.getFullYear();\\n    const month = String(now.getMonth() + 1).padStart(2, '0');\\n    const day = String(now.getDate()).padStart(2, '0');\\n    const hours = String(now.getHours()).padStart(2, '0');\\n    const minutes = String(now.getMinutes()).padStart(2, '0');\\n    const seconds = String(now.getSeconds()).padStart(2, '0');\\n    const milliseconds = String(now.getMilliseconds()).padStart(3, '0');\\n    \\n    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;\\n}\\n\\n// Stimulus parameters for dynamic pitch modulation\\nconst STIMULUS_DURATION = 450; // ms, total duration\\nconst STANDARD_WINDOW = 400; // ms, modulation window for standard (100%)\\nconst STANDARD_WINDOW_PERCENT = 100; // percentage\\n\\n// Modulation window percentages for each difficulty level\\nconst MODULATION_WINDOWS = {\\n    1: 20,   // easiest - 20% of standard window (80 ms)\\n    2: 40,   // 160 ms\\n    3: 50,   // 200 ms\\n    4: 60,   // 240 ms\\n    5: 70,   // 280 ms\\n    6: 80,   // 320 ms\\n    7: 90,   // 360 ms\\n    8: 95,   // 380 ms\\n    9: 98    // hardest - 98% of standard window (392 ms)\\n};\\n\\nfunction getModulationWindowDuration(level) {\\n    return (MODULATION_WINDOWS[level] / 100) * STANDARD_WINDOW;\\n}\\n\\nconst PITCH_RISE_SEMITONES = 1.0;\\n\\nfunction getModulationRate(level) {\\n    const windowDuration = getModulationWindowDuration(level);\\n    const windowDurationSec = windowDuration / 1000;\\n    return PITCH_RISE_SEMITONES / windowDurationSec;\\n}\\n\\nfunction getModulationSlope(level) {\\n    const windowDuration = getModulationWindowDuration(level);\\n    return PITCH_RISE_SEMITONES / windowDuration;\\n}\\n\\n// Adaptive threshold experiment constants\\nconst MAXREVERSALS = 10;\\nconst MAXITERATIONS = 50;\\nconst LOWERLIMIT = 1;\\nconst DECREASING = -1;\\nconst INCREASING = 1;\\nconst MINIMUMREVERSALS = 6;\\nconst THRESHOLD_REVERSAL_COUNT = 6;\\n\\n// Experiment state variables\\nvar CorrectAnswer;\\nvar CorrectResponses = 0;\\nvar Direction = DECREASING;\\nvar Reversals = [];\\nvar NumberOfReversals = 0;\\nvar currentLevel = 5;\\nvar numberOfIterations = 0;\\nvar sentAverage = 0.0;\\nvar sentStdev = 0.0;\\nvar isTestComplete = false;\\nvar audioUnlocked = false;\\nvar allFilesPresent = true;\\nvar trialRecords = [];\\nvar stimulusEndTime = 0;\\n\\n// ABX variables\\nvar standardIsFirst;\\nvar comparisonSound;\\nvar standardSound;\\nvar xSound;\\n\\nvar isReplayTrial = false;\\n\\n// Results variables - JND-based\\nvar jndAbsoluteDifference = 0;\\nvar jndRatio = 0;\\nvar jndPercentDifference = 0;\\nvar thresholdWindowDuration = 0;\\nvar thresholdWindowPercent = 0;\\nvar thresholdModulationRate = 0;\\nvar thresholdSlope = 0;\\nvar webersRatio = 0;\\n\\nfunction printResults() {\\n    window.print();\\n}\\n\\nfunction logDebug(message) {\\n    console.log(message);\\n    var debugArea = document.getElementById('debugInfo');\\n    var now = new Date();\\n    var timeStr = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + '.' + now.getMilliseconds();\\n    debugArea.innerHTML += '&lt;p&gt;[' + timeStr + '] ' + message + '&lt;/p&gt;';\\n    debugArea.scrollTop = debugArea.scrollHeight;\\n}\\n\\nfunction toggleDebug() {\\n    var debugArea = document.getElementById('debugInfo');\\n    var checkbox = document.getElementById('showDebug');\\n    debugArea.style.display = checkbox.checked ? 'block' : 'none';\\n}\\n\\nfunction showDiagnostics() {\\n    updateDiagnostics();\\n    document.getElementById('diagnosticOverlay').style.display = 'flex';\\n}\\n\\nfunction closeDiagnostics() {\\n    document.getElementById('diagnosticOverlay').style.display = 'none';\\n}\\n\\nfunction updateDiagnostics() {\\n    document.getElementById('totalTrials').innerText = numberOfIterations;\\n    document.getElementById('totalReversals').innerText = NumberOfReversals;\\n    \\n    let testStatus = getTestStatus();\\n    document.getElementById('testStatus').innerText = testStatus.text;\\n    document.getElementById('testStatus').className = `direction-stats-${testStatus.class}`;\\n    \\n    checkAudioFiles();\\n    \\n    let reversalHistoryHtml = '';\\n    if (Reversals.length === 0) {\\n        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';\\n    } else {\\n        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals.join(', ') + '&lt;/p&gt;';\\n        reversalHistoryHtml += '&lt;p&gt;Corresponding modulation windows: ';\\n        reversalHistoryHtml += Reversals.map(level =&gt; MODULATION_WINDOWS[level] + '% (' + getModulationWindowDuration(level) + ' ms)').join(', ') + '&lt;/p&gt;';\\n    }\\n    \\n    document.getElementById('reversalHistory').innerHTML = reversalHistoryHtml;\\n    \\n    generateDiagnosticRecommendations();\\n}\\n\\nfunction getTestStatus() {\\n    if (isTestComplete) {\\n        return { text: \\\&quot;Complete\\\&quot;, class: \\\&quot;good\\\&quot; };\\n    }\\n    \\n    if (NumberOfReversals &lt; 1) {\\n        return { text: \\\&quot;Not enough data\\\&quot;, class: \\\&quot;bad\\\&quot; };\\n    }\\n    \\n    if (NumberOfReversals &lt; MINIMUMREVERSALS) {\\n        return { text: \\\&quot;Incomplete (\\\&quot; + NumberOfReversals + \\\&quot;/\\\&quot; + MINIMUMREVERSALS + \\\&quot; reversals)\\\&quot;, class: \\\&quot;warning\\\&quot; };\\n    }\\n    \\n    return { text: \\\&quot;In progress\\\&quot;, class: \\\&quot;good\\\&quot; };\\n}\\n\\nfunction checkAudioFiles() {\\n    const requiredFiles = [\\n        \\\&quot;low_rising_standard\\\&quot;,\\n        \\\&quot;low_rising_1\\\&quot;, \\\&quot;low_rising_2\\\&quot;, \\\&quot;low_rising_3\\\&quot;, \\\&quot;low_rising_4\\\&quot;, \\\&quot;low_rising_5\\\&quot;, \\n        \\\&quot;low_rising_6\\\&quot;, \\\&quot;low_rising_7\\\&quot;, \\\&quot;low_rising_8\\\&quot;, \\\&quot;low_rising_9\\\&quot;\\n    ];\\n    \\n    let statusHtml = '';\\n    allFilesPresent = true;\\n    \\n    requiredFiles.forEach(function(fileId) {\\n        const audioElement = document.getElementById(fileId);\\n        const fileFound = audioElement !== null;\\n        \\n        if (!fileFound) {\\n            allFilesPresent = false;\\n        }\\n        \\n        statusHtml += `&lt;div class=\\\&quot;file-status-item ${fileFound ? 'file-found' : 'file-missing'}\\\&quot;&gt;${fileId}: ${fileFound ? 'Found' : 'Missing'}&lt;/div&gt;`;\\n    });\\n    \\n    document.getElementById('audioFileStatus').innerHTML = statusHtml;\\n}\\n\\nfunction generateDiagnosticRecommendations() {\\n    let recommendations = '';\\n    let hasIssues = false;\\n    \\n    if (!allFilesPresent) {\\n        recommendations += '&lt;p&gt;&lt;strong&gt;Critical Issue:&lt;/strong&gt; Some required audio files are missing. Please ensure all files are properly loaded.&lt;/p&gt;';\\n        hasIssues = true;\\n    }\\n    \\n    if (numberOfIterations &gt;= MAXITERATIONS &amp;&amp; NumberOfReversals &lt; MINIMUMREVERSALS) {\\n        recommendations += '&lt;p&gt;&lt;strong&gt;Issue:&lt;/strong&gt; Reached maximum trials but has insufficient reversals. This might indicate audio file issues or participant response patterns.&lt;/p&gt;';\\n        hasIssues = true;\\n    }\\n    \\n    if (!hasIssues) {\\n        recommendations += '&lt;p&gt;&lt;strong&gt;Good:&lt;/strong&gt; No major issues detected with the experiment setup.&lt;/p&gt;';\\n        \\n        if (isTestComplete) {\\n            recommendations += '&lt;p&gt;Test is complete.&lt;/p&gt;';\\n        } else {\\n            recommendations += '&lt;p&gt;Test is still in progress.&lt;/p&gt;';\\n        }\\n    }\\n    \\n    document.getElementById('diagnosticRecommendations').innerHTML = recommendations;\\n}\\n\\nfunction testAudio() {\\n    logDebug(\\\&quot;Starting to test all audio files...\\\&quot;);\\n    var audios = document.querySelectorAll('audio');\\n    \\n    if (!audioUnlocked) {\\n        unlockAudioContext();\\n    }\\n    \\n    var index = 0;\\n    function playNext() {\\n        if (index &gt;= audios.length) {\\n            logDebug(\\\&quot;All audio testing complete!\\\&quot;);\\n            return;\\n        }\\n        \\n        var audio = audios[index];\\n        logDebug(\\\&quot;Testing audio #\\\&quot; + (index + 1) + \\\&quot;: \\\&quot; + audio.id);\\n        \\n        audio.currentTime = 0;\\n        \\n        var playPromise = audio.play();\\n        if (playPromise !== undefined) {\\n            playPromise.then(function() {\\n                logDebug(audio.id + \\\&quot; played successfully\\\&quot;);\\n                \\n                audio.onended = function() {\\n                    logDebug(audio.id + \\\&quot; playback ended\\\&quot;);\\n                    index++;\\n                    setTimeout(playNext, 500);\\n                };\\n            }).catch(function(error) {\\n                logDebug(\\\&quot;Failed to play \\\&quot; + audio.id + \\\&quot;: \\\&quot; + error);\\n                index++;\\n                setTimeout(playNext, 500);\\n            });\\n        }\\n    }\\n    \\n    playNext();\\n}\\n\\nfunction unlockAudioContext() {\\n    logDebug(\\\&quot;Attempting to unlock audio context...\\\&quot;);\\n    \\n    var silentAudio = new Audio();\\n    silentAudio.src = \\\&quot;data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA\\\&quot;;\\n    \\n    var promise = silentAudio.play();\\n    if (promise !== undefined) {\\n        promise.then(function() {\\n            logDebug(\\\&quot;Audio context unlocked successfully\\\&quot;);\\n            silentAudio.remove();\\n            audioUnlocked = true;\\n        }).catch(function(error) {\\n            logDebug(\\\&quot;Failed to unlock audio context: \\\&quot; + error);\\n        });\\n    }\\n    \\n    var allAudios = document.querySelectorAll('audio');\\n    for (var i = 0; i &lt; allAudios.length; i++) {\\n        var audio = allAudios[i];\\n        audio.load();\\n    }\\n    \\n    logDebug(\\\&quot;Preloaded \\\&quot; + allAudios.length + \\\&quot; audio files\\\&quot;);\\n... extra lines ...\\n\&quot;, \&quot;fileSize\&quot;: \&quot;59.99 KB\&quot;, \&quot;isBigFile\&quot;: true, \&quot;totalLines\&quot;: 1687}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668119,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:191,&quot;prompt_tokens&quot;:61426,&quot;total_tokens&quot;:61617,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:60528,&quot;cache_write_tokens&quot;:891},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668119,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668128,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;我将批量修改剩余的5个实验文件。让我逐个处理：&quot;},&quot;timestamp&quot;:1762668128,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668129,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668129,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_D3-g9hBIRJq30asADECJwA&quot;,&quot;name&quot;:&quot;multi_replace&quot;,&quot;display_name&quot;:&quot;编辑文件&quot;,&quot;render_type&quot;:&quot;CodeMultiReplace&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_D3-g9hBIRJq30asADECJwA&quot;,&quot;toolCallName&quot;:&quot;multi_replace&quot;}" />
                    <option value="{&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_D3-g9hBIRJq30asADECJwA&quot;,&quot;document&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_low.html&quot;,&quot;sub_content&quot;:&quot;ABX_rising_low.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_low.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_low.html&quot;,&quot;multi_replace_content&quot;:[{&quot;old_string&quot;:&quot;        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;&quot;,&quot;new_string&quot;:&quot;        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n    \n    &lt;!-- EmailJS Library --&gt;\n    &lt;script type=\&quot;text/javascript\&quot; src=\&quot;https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js\&quot;&gt;&lt;/script&gt;\n    \n    &lt;!-- Email Configuration and Service --&gt;\n    &lt;script src=\&quot;js/emailConfig.js\&quot;&gt;&lt;/script&gt;\n    &lt;script src=\&quot;js/emailService.js\&quot;&gt;&lt;/script&gt;\n&lt;/head&gt;&quot;},{&quot;old_string&quot;:&quot;    logDebug(\&quot;Test complete! Average difficulty level: \&quot; + average.toFixed(2));\n    logDebug(\&quot;Threshold window: \&quot; + thresholdWindowPercent.toFixed(2) + \&quot;% (\&quot; + thresholdWindowDuration.toFixed(2) + \&quot; ms)\&quot;);\n    logDebug(\&quot;JND Absolute Difference: \&quot; + jndAbsoluteDifference.toFixed(2) + \&quot; ms\&quot;);\n    logDebug(\&quot;JND Ratio: \&quot; + jndRatio.toFixed(4));\n    logDebug(\&quot;JND Percent Difference: \&quot; + jndPercentDifference.toFixed(2) + \&quot;%\&quot;);\n    logDebug(\&quot;Weber's Ratio: \&quot; + webersRatio.toFixed(4));\n    \n    document.getElementById('text1').value = \&quot;Test complete! JND: \&quot; + jndAbsoluteDifference.toFixed(1) + \&quot; ms\&quot;;\n}&quot;,&quot;new_string&quot;:&quot;    logDebug(\&quot;Test complete! Average difficulty level: \&quot; + average.toFixed(2));\n    logDebug(\&quot;Threshold window: \&quot; + thresholdWindowPercent.toFixed(2) + \&quot;% (\&quot; + thresholdWindowDuration.toFixed(2) + \&quot; ms)\&quot;);\n    logDebug(\&quot;JND Absolute Difference: \&quot; + jndAbsoluteDifference.toFixed(2) + \&quot; ms\&quot;);\n    logDebug(\&quot;JND Ratio: \&quot; + jndRatio.toFixed(4));\n    logDebug(\&quot;JND Percent Difference: \&quot; + jndPercentDifference.toFixed(2) + \&quot;%\&quot;);\n    logDebug(\&quot;Weber's Ratio: \&quot; + webersRatio.toFixed(4));\n    \n    document.getElementById('text1').value = \&quot;Test complete! JND: \&quot; + jndAbsoluteDifference.toFixed(1) + \&quot; ms\&quot;;\n    \n    // 自动发送实验结果到指定邮箱\n    logDebug(\&quot;Preparing to send experiment results via email...\&quot;);\n    \n    // 延迟1秒后发送邮件，确保所有数据已准备好\n    setTimeout(function() {\n        if (typeof sendCurrentExperimentResults === 'function') {\n            sendCurrentExperimentResults();\n            logDebug(\&quot;Email sending initiated\&quot;);\n        } else {\n            logDebug(\&quot;Warning: Email service not available. Please check if emailService.js is loaded.\&quot;);\n        }\n    }, 1000);\n}&quot;}],&quot;apply_mode&quot;:&quot;apply_only&quot;}},&quot;timestamp&quot;:1762668129,&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668136,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_D3-g9hBIRJq30asADECJwA&quot;},&quot;toolCallId&quot;:&quot;tooluse_D3-g9hBIRJq30asADECJwA&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668136,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_D3-g9hBIRJq30asADECJwA&quot;,&quot;result&quot;:{&quot;commit_id&quot;:[&quot;9199c05b500e2a273afb7dd65701ad050af3a29a&quot;,&quot;b34db95e18f80f0a0c910c5b3541a7cfc118dbef&quot;]}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_D3-g9hBIRJq30asADECJwA&quot;,&quot;content&quot;:&quot;*File replaced success*&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668136,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:1077,&quot;prompt_tokens&quot;:66731,&quot;total_tokens&quot;:67808,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:61419,&quot;cache_write_tokens&quot;:5305},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668136,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668145,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_OTAg77NTQmu1u1VqCP-k6A&quot;,&quot;name&quot;:&quot;multi_replace&quot;,&quot;display_name&quot;:&quot;编辑文件&quot;,&quot;render_type&quot;:&quot;CodeMultiReplace&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_OTAg77NTQmu1u1VqCP-k6A&quot;,&quot;toolCallName&quot;:&quot;multi_replace&quot;}" />
                    <option value="{&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_OTAg77NTQmu1u1VqCP-k6A&quot;,&quot;document&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_high.html&quot;,&quot;sub_content&quot;:&quot;ABX_rising_high.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_high.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_high.html&quot;,&quot;multi_replace_content&quot;:[{&quot;old_string&quot;:&quot;        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;&quot;,&quot;new_string&quot;:&quot;        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n    \n    &lt;!-- EmailJS Library --&gt;\n    &lt;script type=\&quot;text/javascript\&quot; src=\&quot;https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js\&quot;&gt;&lt;/script&gt;\n    \n    &lt;!-- Email Configuration and Service --&gt;\n    &lt;script src=\&quot;js/emailConfig.js\&quot;&gt;&lt;/script&gt;\n    &lt;script src=\&quot;js/emailService.js\&quot;&gt;&lt;/script&gt;\n&lt;/head&gt;&quot;},{&quot;old_string&quot;:&quot;    logDebug(\&quot;Test complete! Average difficulty level: \&quot; + average.toFixed(2));\n    logDebug(\&quot;Threshold window: \&quot; + thresholdWindowPercent.toFixed(2) + \&quot;% (\&quot; + thresholdWindowDuration.toFixed(2) + \&quot; ms)\&quot;);\n    logDebug(\&quot;JND Absolute Difference: \&quot; + jndAbsoluteDifference.toFixed(2) + \&quot; ms\&quot;);\n    logDebug(\&quot;JND Ratio: \&quot; + jndRatio.toFixed(4));\n    logDebug(\&quot;JND Percent Difference: \&quot; + jndPercentDifference.toFixed(2) + \&quot;%\&quot;);\n    logDebug(\&quot;Weber's Ratio: \&quot; + webersRatio.toFixed(4));\n    \n    document.getElementById('text1').value = \&quot;Test complete! JND: \&quot; + jndAbsoluteDifference.toFixed(1) + \&quot; ms\&quot;;\n}&quot;,&quot;new_string&quot;:&quot;    logDebug(\&quot;Test complete! Average difficulty level: \&quot; + average.toFixed(2));\n    logDebug(\&quot;Threshold window: \&quot; + thresholdWindowPercent.toFixed(2) + \&quot;% (\&quot; + thresholdWindowDuration.toFixed(2) + \&quot; ms)\&quot;);\n    logDebug(\&quot;JND Absolute Difference: \&quot; + jndAbsoluteDifference.toFixed(2) + \&quot; ms\&quot;);\n    logDebug(\&quot;JND Ratio: \&quot; + jndRatio.toFixed(4));\n    logDebug(\&quot;JND Percent Difference: \&quot; + jndPercentDifference.toFixed(2) + \&quot;%\&quot;);\n    logDebug(\&quot;Weber's Ratio: \&quot; + webersRatio.toFixed(4));\n    \n    document.getElementById('text1').value = \&quot;Test complete! JND: \&quot; + jndAbsoluteDifference.toFixed(1) + \&quot; ms\&quot;;\n    \n    // 自动发送实验结果到指定邮箱\n    logDebug(\&quot;Preparing to send experiment results via email...\&quot;);\n    \n    // 延迟1秒后发送邮件，确保所有数据已准备好\n    setTimeout(function() {\n        if (typeof sendCurrentExperimentResults === 'function') {\n            sendCurrentExperimentResults();\n            logDebug(\&quot;Email sending initiated\&quot;);\n        } else {\n            logDebug(\&quot;Warning: Email service not available. Please check if emailService.js is loaded.\&quot;);\n        }\n    }, 1000);\n}&quot;}],&quot;apply_mode&quot;:&quot;apply_only&quot;}},&quot;timestamp&quot;:1762668145,&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668149,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_OTAg77NTQmu1u1VqCP-k6A&quot;},&quot;toolCallId&quot;:&quot;tooluse_OTAg77NTQmu1u1VqCP-k6A&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668149,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_OTAg77NTQmu1u1VqCP-k6A&quot;,&quot;result&quot;:{&quot;commit_id&quot;:[&quot;fd3733f7949a7d0c2c55b531a29c31b4fecdad26&quot;,&quot;4b47b6cd92b36ec71ff387cd0958283c30744158&quot;]}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_OTAg77NTQmu1u1VqCP-k6A&quot;,&quot;content&quot;:&quot;*File replaced success*&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668149,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:1139,&quot;prompt_tokens&quot;:68139,&quot;total_tokens&quot;:69278,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:66724,&quot;cache_write_tokens&quot;:1408},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668150,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668158,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_hV_wevzgRQGxAF0Uf2gTPw&quot;,&quot;name&quot;:&quot;multi_replace&quot;,&quot;display_name&quot;:&quot;编辑文件&quot;,&quot;render_type&quot;:&quot;CodeMultiReplace&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_hV_wevzgRQGxAF0Uf2gTPw&quot;,&quot;toolCallName&quot;:&quot;multi_replace&quot;}" />
                    <option value="{&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_hV_wevzgRQGxAF0Uf2gTPw&quot;,&quot;document&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_high.html&quot;,&quot;sub_content&quot;:&quot;ABX_falling_high.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_high.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_high.html&quot;,&quot;multi_replace_content&quot;:[{&quot;old_string&quot;:&quot;        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;&quot;,&quot;new_string&quot;:&quot;        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n    \n    &lt;!-- EmailJS Library --&gt;\n    &lt;script type=\&quot;text/javascript\&quot; src=\&quot;https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js\&quot;&gt;&lt;/script&gt;\n    \n    &lt;!-- Email Configuration and Service --&gt;\n    &lt;script src=\&quot;js/emailConfig.js\&quot;&gt;&lt;/script&gt;\n    &lt;script src=\&quot;js/emailService.js\&quot;&gt;&lt;/script&gt;\n&lt;/head&gt;&quot;},{&quot;old_string&quot;:&quot;    logDebug(\&quot;Test complete! Average difficulty level: \&quot; + average.toFixed(2));\n    logDebug(\&quot;Threshold window: \&quot; + thresholdWindowPercent.toFixed(2) + \&quot;% (\&quot; + thresholdWindowDuration.toFixed(2) + \&quot; ms)\&quot;);\n    logDebug(\&quot;JND Absolute Difference: \&quot; + jndAbsoluteDifference.toFixed(2) + \&quot; ms\&quot;);\n    logDebug(\&quot;JND Ratio: \&quot; + jndRatio.toFixed(4));\n    logDebug(\&quot;JND Percent Difference: \&quot; + jndPercentDifference.toFixed(2) + \&quot;%\&quot;);\n    logDebug(\&quot;Weber's Ratio: \&quot; + webersRatio.toFixed(4));\n    \n    document.getElementById('text1').value = \&quot;Test complete! JND: \&quot; + jndAbsoluteDifference.toFixed(1) + \&quot; ms\&quot;;\n}&quot;,&quot;new_string&quot;:&quot;    logDebug(\&quot;Test complete! Average difficulty level: \&quot; + average.toFixed(2));\n    logDebug(\&quot;Threshold window: \&quot; + thresholdWindowPercent.toFixed(2) + \&quot;% (\&quot; + thresholdWindowDuration.toFixed(2) + \&quot; ms)\&quot;);\n    logDebug(\&quot;JND Absolute Difference: \&quot; + jndAbsoluteDifference.toFixed(2) + \&quot; ms\&quot;);\n    logDebug(\&quot;JND Ratio: \&quot; + jndRatio.toFixed(4));\n    logDebug(\&quot;JND Percent Difference: \&quot; + jndPercentDifference.toFixed(2) + \&quot;%\&quot;);\n    logDebug(\&quot;Weber's Ratio: \&quot; + webersRatio.toFixed(4));\n    \n    document.getElementById('text1').value = \&quot;Test complete! JND: \&quot; + jndAbsoluteDifference.toFixed(1) + \&quot; ms\&quot;;\n    \n    // 自动发送实验结果到指定邮箱\n    logDebug(\&quot;Preparing to send experiment results via email...\&quot;);\n    \n    // 延迟1秒后发送邮件，确保所有数据已准备好\n    setTimeout(function() {\n        if (typeof sendCurrentExperimentResults === 'function') {\n            sendCurrentExperimentResults();\n            logDebug(\&quot;Email sending initiated\&quot;);\n        } else {\n            logDebug(\&quot;Warning: Email service not available. Please check if emailService.js is loaded.\&quot;);\n        }\n    }, 1000);\n}&quot;}],&quot;apply_mode&quot;:&quot;apply_only&quot;}},&quot;timestamp&quot;:1762668158,&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668162,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_hV_wevzgRQGxAF0Uf2gTPw&quot;},&quot;toolCallId&quot;:&quot;tooluse_hV_wevzgRQGxAF0Uf2gTPw&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668162,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_hV_wevzgRQGxAF0Uf2gTPw&quot;,&quot;result&quot;:{&quot;commit_id&quot;:[&quot;323a84df5222bea0809854f5c6f3dd21247a02b9&quot;,&quot;0c4fe542914dbee5a4b5513e0a4cd086a600e09a&quot;]}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_hV_wevzgRQGxAF0Uf2gTPw&quot;,&quot;content&quot;:&quot;*File replaced success*&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668162,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:1139,&quot;prompt_tokens&quot;:69519,&quot;total_tokens&quot;:70658,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:68132,&quot;cache_write_tokens&quot;:1380},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668163,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668172,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;现在处理最后两个level类型的实验文件。这两个文件的`calculateResults`函数有参数，需要特别处理：&quot;},&quot;timestamp&quot;:1762668172,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668172,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668172,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_NvYVLMyFQQauWG0oX5_Pzw&quot;,&quot;name&quot;:&quot;grep_search&quot;,&quot;display_name&quot;:&quot;查找文件&quot;,&quot;render_type&quot;:&quot;ListItems&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_NvYVLMyFQQauWG0oX5_Pzw&quot;,&quot;toolCallName&quot;:&quot;grep_search&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762668172,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_NvYVLMyFQQauWG0oX5_Pzw&quot;,&quot;document&quot;:{&quot;search_directory&quot;:&quot;E:/Projects/Pitch_Training&quot;,&quot;query&quot;:&quot;document.getElementById('text1').value = \&quot;Test complete! JND&quot;,&quot;sub_content&quot;:&quot;document.getElementById('text1').value = \&quot;Test complete! JND&quot;,&quot;sub_content_tip&quot;:&quot;document.getElementById('text1').value = \&quot;Test complete! JND&quot;}},&quot;toolCallId&quot;:&quot;tooluse_NvYVLMyFQQauWG0oX5_Pzw&quot;,&quot;delta&quot;:&quot;{\&quot;useRegex\&quot;: false, \&quot;explanation\&quot;: \&quot;查找ABX_level_low.html中calculateResults函数的结束位置\&quot;, \&quot;searchDirectory\&quot;: \&quot;E:/Projects/Pitch_Training\&quot;, \&quot;query\&quot;: \&quot;document.getElementById('text1').value = \\\&quot;Test complete! JND\&quot;}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668172,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_NvYVLMyFQQauWG0oX5_Pzw&quot;},&quot;toolCallId&quot;:&quot;tooluse_NvYVLMyFQQauWG0oX5_Pzw&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668172,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_NvYVLMyFQQauWG0oX5_Pzw&quot;,&quot;result&quot;:{&quot;items&quot;:[]},&quot;suffix_content&quot;:&quot;未找到结果&quot;,&quot;suffix_content_tip&quot;:&quot;未找到结果&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_NvYVLMyFQQauWG0oX5_Pzw&quot;,&quot;content&quot;:&quot;## Search Results\n\n*No results found for this query.*&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668173,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:188,&quot;prompt_tokens&quot;:70901,&quot;total_tokens&quot;:71089,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:69512,&quot;cache_write_tokens&quot;:1382},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668173,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668178,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_8DwCikpcSkOJatEfDWjLzg&quot;,&quot;name&quot;:&quot;read_file&quot;,&quot;display_name&quot;:&quot;读取文件&quot;,&quot;render_type&quot;:&quot;None&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_8DwCikpcSkOJatEfDWjLzg&quot;,&quot;toolCallName&quot;:&quot;read_file&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762668179,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_8DwCikpcSkOJatEfDWjLzg&quot;,&quot;document&quot;:{&quot;sub_content&quot;:&quot;ABX_level_low.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;}},&quot;toolCallId&quot;:&quot;tooluse_8DwCikpcSkOJatEfDWjLzg&quot;,&quot;delta&quot;:&quot;{\&quot;limit\&quot;: 1100, \&quot;path\&quot;: \&quot;E:/Projects/Pitch_Training/ABX_level_low.html\&quot;, \&quot;explanation\&quot;: \&quot;读取ABX_level_low.html的calculateResults函数，查看其结构\&quot;, \&quot;offset\&quot;: 1022}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668179,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_8DwCikpcSkOJatEfDWjLzg&quot;},&quot;toolCallId&quot;:&quot;tooluse_8DwCikpcSkOJatEfDWjLzg&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668179,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_8DwCikpcSkOJatEfDWjLzg&quot;,&quot;result&quot;:{}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_8DwCikpcSkOJatEfDWjLzg&quot;,&quot;content&quot;:&quot;{\&quot;content\&quot;: \&quot;... 1021 lines before line 1022 ...\\nfunction calculateResults(directionIndex) {\\n    let sum = 0.0, stddevsum = 0.0, average = 0.0, stdev = 0.0, counter = 0;\\n    \\n    const semitoneMap = {\\n        1: 2.0,\\n        2: 1.0,\\n        3: 1/2,\\n        4: 1/6,\\n        5: 1/8,\\n        6: 1/12,\\n        7: 1/15,\\n        8: 1/20,\\n        9: 1/50\\n    };\\n    \\n    for (let i = 0; i &lt; Reversals[directionIndex].length; i++) {\\n        if (Reversals[directionIndex][i] &gt; 0) counter++;\\n    }\\n    \\n    if (counter &lt; MINIMUMREVERSALS) {\\n        logDebug((directionIndex === 0 ? \\\&quot;Higher\\\&quot; : \\\&quot;Lower\\\&quot;) + \\\&quot; direction test has insufficient data\\\&quot;);\\n        alert((directionIndex === 0 ? \\\&quot;Higher\\\&quot; : \\\&quot;Lower\\\&quot;) + \\\&quot; direction test has insufficient data. Please complete the test again.\\\&quot;);\\n        return;\\n    }\\n    \\n    const startIndex = Math.max(0, NumberOfReversals[directionIndex] - THRESHOLD_REVERSAL_COUNT);\\n    counter = 0;\\n    \\n    for (let i = startIndex; i &lt; Reversals[directionIndex].length; i++) {\\n        const level = Reversals[directionIndex][i];\\n        if (level &gt; 0) {\\n            const semitones = semitoneMap[level];\\n            if (semitones !== undefined) {\\n                sum += semitones;\\n                counter++;\\n            }\\n        }\\n    }\\n    \\n    if (counter &gt; 0) {\\n        average = sum / counter;\\n        average = parseFloat(average.toFixed(4));\\n    }\\n    \\n    for (let i = startIndex; i &lt; Reversals[directionIndex].length; i++) {\\n        const level = Reversals[directionIndex][i];\\n        if (level &gt; 0) {\\n            const semitones = semitoneMap[level];\\n            if (semitones !== undefined) {\\n                stddevsum += Math.pow(semitones - average, 2);\\n            }\\n        }\\n    }\\n    \\n    if (counter &gt; 1) {\\n        stdev = Math.sqrt(stddevsum / (counter - 1));\\n        stdev = parseFloat(stdev.toFixed(4));\\n    }\\n    \\n    sentAverage[directionIndex] = average;\\n    sentStdev[directionIndex] = stdev;\\n    \\n    logDebug((directionIndex === 0 ? \\\&quot;Higher\\\&quot; : \\\&quot;Lower\\\&quot;) + \\\&quot; direction test complete! Threshold: \\\&quot; + average.toFixed(4) + \\\&quot; semitones\\\&quot;);\\n    document.getElementById('text1').value = \\n        (directionIndex === 0 ? \\\&quot;Higher\\\&quot; : \\\&quot;Lower\\\&quot;) + \\\&quot; direction test complete! Threshold: \\\&quot; + average.toFixed(4) + \\\&quot; semitones\\\&quot;;\\n}\\n\\nfunction beginIteration() {\\n    isReplayTrial = false;\\n    \\n    if (forceDirection !== null) {\\n        currentStimDirection = forceDirection;\\n        \\n        if (trialsPerDirection[forceDirection] % 5 === 0) {\\n            logDebug(\\\&quot;Releasing forced direction after 5 trials\\\&quot;);\\n            forceDirection = null;\\n        }\\n    } \\n    else if (isTestComplete[0]) {\\n        currentStimDirection = 1;\\n    } \\n    else if (isTestComplete[1]) {\\n        currentStimDirection = 0;\\n    }\\n    else if (Math.abs(trialsPerDirection[0] - trialsPerDirection[1]) &gt; FORCEBALANCETHRESHOLD) {\\n        currentStimDirection = (trialsPerDirection[0] &gt; trialsPerDirection[1]) ? 1 : 0;\\n        logDebug(\\\&quot;Forcing balance: selecting \\\&quot; + (currentStimDirection === 0 ? \\\&quot;higher\\\&quot; : \\\&quot;lower\\\&quot;) + \\\&quot; direction\\\&quot;);\\n    }\\n    else {\\n        currentStimDirection = Math.random() &lt; 0.5 ? 0 : 1;\\n    }\\n    \\n    directionHistory.push(currentStimDirection);\\n    \\n    standardIsFirst = Math.random() &lt; 0.5;\\n    var xIsStandard = Math.random() &lt; 0.5;\\n    \\n    if (xIsStandard) {\\n        CorrectAnswer = standardIsFirst ? 1 : 2;\\n    } else {\\n        CorrectAnswer = standardIsFirst ? 2 : 1;\\n    }\\n    \\n    trialsPerDirection[currentStimDirection]++;\\n    \\n    logDebug(\\\&quot;Starting new iteration #\\\&quot; + numberOfIterations + \\n             \\\&quot;, Direction: \\\&quot; + (currentStimDirection === 0 ? \\\&quot;Higher\\\&quot; : \\\&quot;Lower\\\&quot;) + \\n             \\\&quot;, Standard is \\\&quot; + (standardIsFirst ? \\\&quot;first\\\&quot; : \\\&quot;second\\\&quot;) +\\n             \\\&quot;, X is \\\&quot; + (xIsStandard ? \\\&quot;standard\\\&quot; : \\\&quot;comparison\\\&quot;) +\\n             \\\&quot;, Correct answer: \\\&quot; + (CorrectAnswer === 1 ? \\\&quot;First\\\&quot; : \\\&quot;Second\\\&quot;) +\\n             \\\&quot;, Difficulty level: \\\&quot; + currentLevel[currentStimDirection]);\\n    \\n    setTimeout(function() {\\n        playABXSequence(xIsStandard);\\n    }, 1000);\\n}\\n\\nfunction clearButtonAnimations() {\\n    document.getElementById('firstBtn').classList.remove('button-playing');\\n    document.getElementById('secondBtn').classList.remove('button-playing');\\n}\\n\\nfunction playABXSequence(xIsStandard) {\\n    logDebug(\\\&quot;Playing ABX sequence\\\&quot;);\\n    \\n    clearButtonAnimations();\\n\\n    standardSound = document.getElementById('low_level_standard');\\n\\n    const level = currentLevel[currentStimDirection];\\n    if (currentStimDirection === 0) {\\n        comparisonSound = document.getElementById(\\\&quot;low_level_\\\&quot; + level + \\\&quot;_h\\\&quot;);\\n    } else {\\n        comparisonSound = document.getElementById(\\\&quot;low_level_\\\&quot; + level + \\\&quot;_l\\\&quot;);\\n    }\\n    \\n    xSound = xIsStandard ? standardSound : comparisonSound;\\n    \\n    if (!standardSound || !comparisonSound) {\\n        logDebug(\\\&quot;Error: Cannot find audio elements!\\\&quot;);\\n        document.getElementById('text1').value = \\\&quot;出錯：找不到音頻文件\\\&quot;;\\n        setTimeout(function() {\\n            showDiagnostics();\\n        }, 1000);\\n        return;\\n    }\\n    \\n    var firstSound = standardIsFirst ? standardSound : comparisonSound;\\n    document.getElementById('text1').value = \\\&quot;播放第一個音\\\&quot;;\\n    \\n    document.getElementById('firstBtn').classList.add('button-playing');\\n    \\n    firstSound.currentTime = 0;\\n    var playPromise1 = firstSound.play();\\n    \\n    if (playPromise1 !== undefined) {\\n        playPromise1.then(function() {\\n            logDebug(\\\&quot;First sound (A) played successfully\\\&quot;);\\n            \\n            firstSound.onended = function() {\\n                logDebug(\\\&quot;First sound ended\\\&quot;);\\n                \\n                document.getElementById('firstBtn').classList.remove('button-playing');\\n                \\n                setTimeout(function() {\\n                    var secondSound = standardIsFirst ? comparisonSound : standardSound;\\n                    document.getElementById('text1').value = \\\&quot;播放第二個音\\\&quot;;\\n                    \\n                    document.getElementById('secondBtn').classList.add('button-playing');\\n                    \\n                    secondSound.currentTime = 0;\\n                    var playPromise2 = secondSound.play();\\n                    \\n                    if (playPromise2 !== undefined) {\\n                        playPromise2.then(function() {\\n                            logDebug(\\\&quot;Second sound (B) played successfully\\\&quot;);\\n                            \\n                            secondSound.onended = function() {\\n                                logDebug(\\\&quot;Second sound ended\\\&quot;);\\n                                \\n                                document.getElementById('secondBtn').classList.remove('button-playing');\\n                                \\n                                setTimeout(function() {\\n                                    document.getElementById('text1').value = \\\&quot;播放第三個音\\\&quot;;\\n                                    \\n                                    xSound.currentTime = 0;\\n                                    var playPromise3 = xSound.play();\\n                                    \\n                                    if (playPromise3 !== undefined) {\\n                                        playPromise3.then(function() {\\n                                            logDebug(\\\&quot;Third sound (X) played successfully\\\&quot;);\\n                                            \\n                                            xSound.onended = function() {\\n                                                logDebug(\\\&quot;Third sound ended, enabling response buttons\\\&quot;);\\n                                                \\n                                                stimulusEndTime = performance.now();\\n                                                \\n                                                document.getElementById('text1').value = \\\&quot;請作出選擇\\\&quot;;\\n                                                document.getElementById('promptText').style.visibility = 'visible';\\n                                                \\n                                                document.getElementById('firstBtn').disabled = false;\\n                                                document.getElementById('secondBtn').disabled = false;\\n                                                document.getElementById('firstBtn').style.background = \\\&quot;#66CCFF\\\&quot;;\\n                                                document.getElementById('secondBtn').style.background = \\\&quot;#66CCFF\\\&quot;;\\n                                            };\\n                                        }).catch(function(error) {\\n                                            logDebug(\\\&quot;Failed to play third sound: \\\&quot; + error);\\n                                            document.getElementById('text1').value = \\\&quot;音頻播放錯誤\\\&quot;;\\n                                            clearButtonAnimations();\\n                                            setTimeout(showDiagnostics, 1000);\\n                                        });\\n                                    }\\n                                }, 1000);\\n                            };\\n                        }).catch(function(error) {\\n                            logDebug(\\\&quot;Failed to play second sound: \\\&quot; + error);\\n                            document.getElementById('text1').value = \\\&quot;音頻播放錯誤\\\&quot;;\\n                            clearButtonAnimations();\\n                            setTimeout(showDiagnostics, 1000);\\n                        });\\n                    }\\n                }, 1000);\\n            };\\n        }).catch(function(error) {\\n            logDebug(\\\&quot;Failed to play first sound: \\\&quot; + error);\\n            document.getElementById('text1').value = \\\&quot;音頻播放錯誤，請刷新頁面\\\&quot;;\\n            clearButtonAnimations();\\n            setTimeout(showDiagnostics, 1000);\\n        });\\n    }\\n}\\n\\nfunction start_onclick() {\\n    logDebug(\\\&quot;Starting experiment\\\&quot;);\\n    \\n    if (!audioUnlocked) {\\n        unlockAudioContext();\\n    }\\n    \\n    checkAudioFiles();\\n    if (!allFilesPresent) {\\n        logDebug(\\\&quot;Cannot start experiment: Some audio files are missing\\\&quot;);\\n        document.getElementById('text1').value = \\\&quot;音頻缺失\\\&quot;;\\n        showDiagnostics();\\n        return;\\n    }\\n    \\n    window_onload();\\n    document.getElementById('text1').value = \\\&quot;開始實驗...\\\&quot;;\\n    updateProgressBar(0);\\n    \\n    setTimeout(function() {\\n        beginIteration();\\n        document.getElementById('start').disabled = true;\\n        document.getElementById('viewResult').disabled = true;\\n        document.getElementById('smile').src = \\\&quot;Media/null.gif\\\&quot;;\\n        document.getElementById('promptText').style.visibility = 'hidden';\\n    }, 1000);\\n}\\n\\nfunction gotReversal(dirIndex) {\\n    NumberOfReversals[dirIndex]++;\\n    Reversals[dirIndex][NumberOfReversals[dirIndex] - 1] = currentLevel[dirIndex];\\n    Direction[dirIndex] = -Direction[dirIndex];\\n    logDebug(\\\&quot;Recorded reversal #\\\&quot; + NumberOfReversals[dirIndex] + \\\&quot; at difficulty \\\&quot; + currentLevel[dirIndex]);\\n}\\n\\nfunction mapLevelToSemitone(level) {\\n    const semitoneMap = {\\n        1: 2.0,\\n        2: 1.0,\\n        3: 1/2,\\n        4: 1/6,\\n        5: 1/8,\\n        6: 1/12,\\n        7: 1/15,\\n        8: 1/20,\\n        9: 1/50\\n    };\\n    return semitoneMap[level] || 0;\\n}\\n\\nfunction processAnswer(Response) {\\n    const reactionEndTime = performance.now();\\n    const reactionTime = reactionEndTime - stimulusEndTime;\\n    \\n    logDebug(\\\&quot;User answered: \\\&quot; + (Response === 1 ? \\\&quot;First\\\&quot; : \\\&quot;Second\\\&quot;) + \\n             \\\&quot;, Correct answer: \\\&quot; + (CorrectAnswer === 1 ? \\\&quot;First\\\&quot; : \\\&quot;Second\\\&quot;) +\\n             \\\&quot;, Is replay: \\\&quot; + isReplayTrial);\\n    \\n    document.getElementById('firstBtn').disabled = true;\\n    document.getElementById('secondBtn').disabled = true;\\n    document.getElementById('promptText').style.visibility = 'hidden';\\n    \\n    const isCorrect = (Response === CorrectAnswer);\\n    \\n    if (!isReplayTrial) {\\n        const trialInfo = {\\n            trialNumber: numberOfIterations,\\n            timestamp: getLocalTimestamp(),\\n            direction: currentStimDirection === 0 ? \\\&quot;Higher\\\&quot; : \\\&quot;Lower\\\&quot;,\\n            difficultyLevel: currentLevel[currentStimDirection],\\n            semitoneValue: mapLevelToSemitone(currentLevel[currentStimDirection]),\\n            userResponse: Response === 1 ? \\\&quot;First Tone\\\&quot; : \\\&quot;Second Tone\\\&quot;,\\n            correctResponse: CorrectAnswer === 1 ? \\\&quot;First Tone\\\&quot; : \\\&quot;Second Tone\\\&quot;,\\n            isCorrect: isCorrect,\\n            reactionTime: reactionTime.toFixed(0),\\n            isReversal: false,\\n            stepDirection: Direction[currentStimDirection] === DECREASING ? \\\&quot;Increasing Difficulty\\\&quot; : \\\&quot;Decreasing Difficulty\\\&quot;,\\n            standardPosition: standardIsFirst ? \\\&quot;First\\\&quot; : \\\&quot;Second\\\&quot;\\n        };\\n        \\n        trialRecords.push(trialInfo);\\n    }\\n    \\n    if (isCorrect) {\\n        logDebug(\\\&quot;Correct answer\\\&quot;);\\n        document.getElementById('smile').src = \\\&quot;Media/smiley.png\\\&quot;;\\n        document.getElementById('text1').value = \\\&quot;正確！\\\&quot;;\\n        \\n        if (!isReplayTrial) {\\n            CorrectResponses[currentStimDirection]++;\\n            \\n            if (CorrectResponses[currentStimDirection] == 2) {\\n                logDebug(\\\&quot;Two correct answers in a row\\\&quot;);\\n                CorrectResponses[currentStimDirection] = 0;\\n                \\n                if (Direction[currentStimDirection] == INCREASING) {\\n                    gotReversal(currentStimDirection);\\n                    if (trialRecords.length &gt; 0) {\\n                        trialRecords[trialRecords.length-1].isReversal = true;\\n                    }\\n                }\\n                \\n                changeLevel(DECREASING, currentStimDirection);\\n            }\\n        }\\n        \\n        setTimeout(function() {\\n            document.getElementById(\\\&quot;smile\\\&quot;).src = 'Media/null.gif';\\n            resetPage();\\n        }, 1500);\\n    } else {\\n        logDebug(\\\&quot;Incorrect answer - will replay stimulus\\\&quot;);\\n        document.getElementById('smile').src = \\\&quot;Media/nosmiley.png\\\&quot;;\\n        \\n        var correctAnswerText = CorrectAnswer === 1 ? \\\&quot;第一個音\\\&quot; : \\\&quot;第二個音\\\&quot;;\\n        document.getElementById('text1').value = \\\&quot;錯誤！正確答案是：\\\&quot; + correctAnswerText;\\n        \\n        if (!isReplayTrial) {\\n            CorrectResponses[currentStimDirection] = 0;\\n            \\n            if (Direction[currentStimDirection] == DECREASING) {\\n                gotReversal(currentStimDirection);\\n                if (trialRecords.length &gt; 0) {\\n                    trialRecords[trialRecords.length-1].isReversal = true;\\n                }\\n            }\\n            \\n            changeLevel(INCREASING, currentStimDirection);\\n        }\\n        \\n        setTimeout(function() {\\n            document.getElementById(\\\&quot;smile\\\&quot;).src = 'Media/null.gif';\\n            document.getElementById('text1').value = \\\&quot;重播刺激音...\\\&quot;;\\n            \\n            setTimeout(function() {\\n                isReplayTrial = true;\\n                \\n                var xIsStandard = (standardIsFirst &amp;&amp; CorrectAnswer === 1) || \\n                                  (!standardIsFirst &amp;&amp; CorrectAnswer === 2);\\n                playABXSequence(xIsStandard);\\n            }, 1000);\\n        }, 2000);\\n    }\\n}\\n\\nfunction changeLevel(whichWay, dirIndex) {\\n    var oldLevel = currentLevel[dirIndex];\\n    var stepSize = NumberOfReversals[dirIndex] &lt; 4 ? 2 : 1;\\n    \\n    if (whichWay == DECREASING) {\\n        currentLevel[dirIndex] = Math.min(9, currentLevel[dirIndex] + stepSize);\\n    } else {\\n        currentLevel[dirIndex] = Math.max(LOWERLIMIT, currentLevel[dirIndex] - stepSize);\\n    }\\n    \\n    logDebug(\\\&quot;Difficulty changed from \\\&quot; + oldLevel + \\\&quot; to \\\&quot; + currentLevel[dirIndex] + \\n             (whichWay == DECREASING ? \\\&quot; (increasing difficulty)\\\&quot; : \\\&quot; (decreasing difficulty)\\\&quot;));\\n}\\n\\nfunction getThresholdAssessment(value) {\\n    if (value &lt;= 0.05) return \\\&quot;Exceptional\\\&quot;;\\n    if (value &lt;= 0.1) return \\\&quot;Excellent\\\&quot;;\\n    if (value &lt;= 0.25) return \\\&quot;Good\\\&quot;;\\n    if (value &lt;= 0.5) return \\\&quot;Average\\\&quot;;\\n    if (value &lt;= 1.0) return \\\&quot;Below Average\\\&quot;;\\n    return \\\&quot;Needs Improvement\\\&quot;;\\n}\\n\\nfunction calculateReactionTimeStats() {\\n    let higherRTs = trialRecords.filter(t =&gt; t.direction === \\\&quot;Higher\\\&quot;).map(t =&gt; parseFloat(t.reactionTime));\\n    let lowerRTs = trialRecords.filter(t =&gt; t.direction === \\\&quot;Lower\\\&quot;).map(t =&gt; parseFloat(t.reactionTime));\\n    let allRTs = higherRTs.concat(lowerRTs);\\n    \\n    return {\\n        higher: {\\n            mean: higherRTs.length ? (higherRTs.reduce((a, b) =&gt; a + b, 0) / higherRTs.length).toFixed(0) : \\\&quot;N/A\\\&quot;,\\n            median: higherRTs.length ? calculateMedian(higherRTs).toFixed(0) : \\\&quot;N/A\\\&quot;,\\n            sd: higherRTs.length &gt; 1 ? calculateSD(higherRTs).toFixed(0) : \\\&quot;N/A\\\&quot;\\n        },\\n        lower: {\\n            mean: lowerRTs.length ? (lowerRTs.reduce((a, b) =&gt; a + b, 0) / lowerRTs.length).toFixed(0) : \\\&quot;N/A\\\&quot;,\\n            median: lowerRTs.length ? calculateMedian(lowerRTs).toFixed(0) : \\\&quot;N/A\\\&quot;,\\n            sd: lowerRTs.length &gt; 1 ? calculateSD(lowerRTs).toFixed(0) : \\\&quot;N/A\\\&quot;\\n        },\\n        overall: {\\n            mean: allRTs.length ? (allRTs.reduce((a, b) =&gt; a + b, 0) / allRTs.length).toFixed(0) : \\\&quot;N/A\\\&quot;,\\n            median: allRTs.length ? calculateMedian(allRTs).toFixed(0) : \\\&quot;N/A\\\&quot;,\\n            sd: allRTs.length &gt; 1 ? calculateSD(allRTs).toFixed(0) : \\\&quot;N/A\\\&quot;\\n        }\\n    };\\n}\\n\\nfunction calculateAccuracyStats() {\\n    let higherTrials = trialRecords.filter(t =&gt; t.direction === \\\&quot;Higher\\\&quot;);\\n    let lowerTrials = trialRecords.filter(t =&gt; t.direction === \\\&quot;Lower\\\&quot;);\\n    let allTrials = trialRecords;\\n    \\n    return {\\n        higher: {\\n            correct: higherTrials.filter(t =&gt; t.isCorrect).length,\\n            total: higherTrials.length,\\n            percentage: higherTrials.length ? \\n                (higherTrials.filter(t =&gt; t.isCorrect).length / higherTrials.length * 100).toFixed(1) : \\\&quot;N/A\\\&quot;\\n        },\\n        lower: {\\n            correct: lowerTrials.filter(t =&gt; t.isCorrect).length,\\n            total: lowerTrials.length,\\n            percentage: lowerTrials.length ? \\n                (lowerTrials.filter(t =&gt; t.isCorrect).length / lowerTrials.length * 100).toFixed(1) : \\\&quot;N/A\\\&quot;\\n        },\\n        overall: {\\n            correct: allTrials.filter(t =&gt; t.isCorrect).length,\\n            total: allTrials.length,\\n            percentage: allTrials.length ? \\n                (allTrials.filter(t =&gt; t.isCorrect).length / allTrials.length * 100).toFixed(1) : \\\&quot;N/A\\\&quot;\\n        }\\n    };\\n}\\n\\nfunction calculateMedian(values) {\\n    if (!values.length) return 0;\\n    \\n    const sortedValues = values.slice().sort((a, b) =&gt; a - b);\\n    const mid = Math.floor(sortedValues.length / 2);\\n    \\n    return sortedValues.length % 2 === 0 ? \\n        (sortedValues[mid - 1] + sortedValues[mid]) / 2 : \\n        sortedValues[mid];\\n}\\n\\nfunction calculateSD(values) {\\n    if (values.length &lt;= 1) return 0;\\n    \\n    const mean = values.reduce((a, b) =&gt; a + b, 0) / values.length;\\n    const variance = values.map(x =&gt; Math.pow(x - mean, 2)).reduce((a, b) =&gt; a + b, 0) / (values.length - 1);\\n    \\n    return Math.sqrt(variance);\\n}\\n\\nfunction displayResults() {\\n    logDebug(\\\&quot;Displaying results\\\&quot;);\\n    \\n    let hasHigherData = NumberOfReversals[0] &gt;= MINIMUMREVERSALS;\\n    let hasLowerData = NumberOfReversals[1] &gt;= MINIMUMREVERSALS;\\n    \\n    if (!hasHigherData || !hasLowerData) {\\n        let message = \\\&quot;Warning: \\\&quot;;\\n        if (!hasHigherData) message += \\\&quot;Higher direction has insufficient data. \\\&quot;;\\n        if (!hasLowerData) message += \\\&quot;Lower direction has insufficient data. \\\&quot;;\\n        message += \\\&quot;Results may not be reliable.\\\&quot;;\\n        \\n        if (confirm(message + \\\&quot;\\\\n\\\\nWould you like to retry the experiment?\\\&quot;)) {\\n            window_onload();\\n            return;\\n        }\\n    }\\n    \\n    document.getElementById('experimentContainer').style.display = 'none';\\n    document.getElementById('resultsContainer').style.display = 'block';\\n    \\n    var tableBody = document.getElementById('resultTableBody');\\n    tableBody.innerHTML = '';\\n    \\n    var higherRow = document.createElement('tr');\\n    higherRow.innerHTML = \\n        '&lt;td&gt;Higher Direction&lt;/td&gt;' +\\n        '&lt;td&gt;' + (hasHigherData ? sentAverage[0].toFixed(4) : 'Insufficient data') + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + (hasHigherData ? sentStdev[0].toFixed(4) : '-') + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + (hasHigherData ? getThresholdAssessment(sentAverage[0]) : '-') + '&lt;/td&gt;';\\n    tableBody.appendChild(higherRow);\\n    \\n    var lowerRow = document.createElement('tr');\\n    lowerRow.innerHTML = \\n        '&lt;td&gt;Lower Direction&lt;/td&gt;' +\\n        '&lt;td&gt;' + (hasLowerData ? sentAverage[1].toFixed(4) : 'Insufficient data') + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + (hasLowerData ? sentStdev[1].toFixed(4) : '-') + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + (hasLowerData ? getThresholdAssessment(sentAverage[1]) : '-') + '&lt;/td&gt;';\\n    tableBody.appendChild(lowerRow);\\n    \\n    if (hasHigherData &amp;&amp; hasLowerData) {\\n        var avgThreshold = (sentAverage[0] + sentAverage[1]) / 2;\\n        var combinedVariance = (Math.pow(sentStdev[0], 2) + Math.pow(sentStdev[1], 2)) / 2;\\n        var combinedSD = Math.sqrt(combinedVariance).toFixed(4);\\n        \\n        var avgRow = document.createElement('tr');\\n        avgRow.style.fontWeight = 'bold';\\n        avgRow.innerHTML = \\n            '&lt;td&gt;Average&lt;/td&gt;' +\\n            '&lt;td&gt;' + avgThreshold.toFixed(4) + '&lt;/td&gt;' +\\n            '&lt;td&gt;' + combinedSD + '&lt;/td&gt;' +\\n            '&lt;td&gt;' + getThresholdAssessment(avgThreshold) + '&lt;/td&gt;';\\n        tableBody.appendChild(avgRow);\\n    }\\n    \\n    var interpretation = document.getElementById('resultInterpretation');\\n    let interpretationHtml = '&lt;p&gt;&lt;strong&gt;Threshold Interpretation (ABX Task):&lt;/strong&gt;&lt;/p&gt;';\\n    \\n    if (hasHigherData &amp;&amp; hasLowerData) {\\n        const avgThreshold = (sentAverage[0] + sentAverage[1]) / 2;\\n        interpretationHtml += '&lt;p&gt;Your average pitch discrimination threshold is ' + avgThreshold.toFixed(4) + ' semitones, indicating ' + \\n            getThresholdAssessment(avgThreshold) + ' pitch discrimination ability.&lt;/p&gt;';\\n    } else {\\n        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Complete results not available due to insufficient data.&lt;/p&gt;';\\n        \\n        if (hasHigherData) {\\n            interpretationHtml += '&lt;p&gt;Your higher direction threshold is ' + sentAverage[0].toFixed(4) + \\n                ' semitones, indicating ' + getThresholdAssessment(sentAverage[0]) + ' discrimination ability for higher pitches.&lt;/p&gt;';\\n        }\\n        \\n        if (hasLowerData) {\\n            interpretationHtml += '&lt;p&gt;Your lower direction threshold is ' + sentAverage[1].toFixed(4) + \\n                ' semitones, indicating ' + getThresholdAssessment(sentAverage[1]) + ' discrimination ability for lower pitches.&lt;/p&gt;';\\n        }\\n    }\\n    \\n    interpretationHtml += '&lt;p&gt;&lt;strong&gt;Performance Metrics:&lt;/strong&gt;&lt;/p&gt;';\\n    \\n    const rtStats = calculateReactionTimeStats();\\n    const accuracyStats = calculateAccuracyStats();\\n    \\n    interpretationHtml += '&lt;p&gt;Your average reaction time was ' + rtStats.overall.mean + \\n        ' ms, with ' + accuracyStats.overall.percentage + '% overall accuracy.&lt;/p&gt;';\\n    \\n    interpretation.innerHTML = interpretationHtml;\\n    \\n    var rtTableBody = document.getElementById('rtStatsTableBody');\\n    rtTableBody.innerHTML = '';\\n    \\n    var higherRtRow = document.createElement('tr');\\n    higherRtRow.innerHTML = \\n        '&lt;td&gt;Higher Direction&lt;/td&gt;' +\\n        '&lt;td&gt;' + rtStats.higher.mean + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + rtStats.higher.median + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + rtStats.higher.sd + '&lt;/td&gt;';\\n    rtTableBody.appendChild(higherRtRow);\\n    \\n    var lowerRtRow = document.createElement('tr');\\n    lowerRtRow.innerHTML = \\n        '&lt;td&gt;Lower Direction&lt;/td&gt;' +\\n        '&lt;td&gt;' + rtStats.lower.mean + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + rtStats.lower.median + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + rtStats.lower.sd + '&lt;/td&gt;';\\n    rtTableBody.appendChild(lowerRtRow);\\n    \\n    var overallRtRow = document.createElement('tr');\\n    overallRtRow.style.fontWeight = 'bold';\\n    overallRtRow.innerHTML = \\n        '&lt;td&gt;Overall&lt;/td&gt;' +\\n        '&lt;td&gt;' + rtStats.overall.mean + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + rtStats.overall.median + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + rtStats.overall.sd + '&lt;/td&gt;';\\n    rtTableBody.appendChild(overallRtRow);\\n    \\n    var accuracyTableBody = document.getElementById('accuracyStatsTableBody');\\n    accuracyTableBody.innerHTML = '';\\n    \\n    var higherAccRow = document.createElement('tr');\\n    higherAccRow.innerHTML = \\n        '&lt;td&gt;Higher Direction&lt;/td&gt;' +\\n        '&lt;td&gt;' + accuracyStats.higher.correct + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + accuracyStats.higher.total + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + accuracyStats.higher.percentage + '%&lt;/td&gt;';\\n    accuracyTableBody.appendChild(higherAccRow);\\n    \\n    var lowerAccRow = document.createElement('tr');\\n    lowerAccRow.innerHTML = \\n        '&lt;td&gt;Lower Direction&lt;/td&gt;' +\\n        '&lt;td&gt;' + accuracyStats.lower.correct + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + accuracyStats.lower.total + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + accuracyStats.lower.percentage + '%&lt;/td&gt;';\\n    accuracyTableBody.appendChild(lowerAccRow);\\n    \\n    var overallAccRow = document.createElement('tr');\\n    overallAccRow.style.fontWeight = 'bold';\\n    overallAccRow.innerHTML = \\n        '&lt;td&gt;Overall&lt;/td&gt;' +\\n        '&lt;td&gt;' + accuracyStats.overall.correct + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + accuracyStats.overall.total + '&lt;/td&gt;' +\\n        '&lt;td&gt;' + accuracyStats.overall.percentage + '%&lt;/td&gt;';\\n    accuracyTableBody.appendChild(overallAccRow);\\n    \\n    drawResultChart(hasHigherData, hasLowerData);\\n}\\n\\nfunction drawResultChart(hasHigherData, hasLowerData) {\\n    var chartContainer = document.getElementById('resultChart');\\n    \\n    var chartHTML = '&lt;div style=\\\&quot;display: flex; flex-direction: column; height: 100%;\\\&quot;&gt;';\\n    chartHTML += '&lt;div style=\\\&quot;text-align: center; margin-bottom: 10px;\\\&quot;&gt;&lt;strong&gt;Threshold Comparison&lt;/strong&gt;&lt;/div&gt;';\\n    \\n    chartHTML += '&lt;div style=\\\&quot;display: flex; justify-content: center; margin-bottom: 10px;\\\&quot;&gt;';\\n    chartHTML += '&lt;span style=\\\&quot;margin-right: 20px;\\\&quot;&gt;&lt;span style=\\\&quot;display: inline-block; width: 15px; height: 15px; background-color: #3498db; margin-right: 5px;\\\&quot;&gt;&lt;/span&gt;Higher Direction&lt;/span&gt;';\\n    chartHTML += '&lt;span&gt;&lt;span style=\\\&quot;display: inline-block; width: 15px; height: 15px; background-color: #e74c3c; margin-right: 5px;\\\&quot;&gt;&lt;/span&gt;Lower Direction&lt;/span&gt;';\\n    chartHTML += '&lt;/div&gt;';\\n    \\n    chartHTML += '&lt;div style=\\\&quot;flex: 1; display: flex; align-items: flex-end; border-left: 1px solid #333; border-bottom: 1px solid #333; position: relative;\\\&quot;&gt;';\\n    \\n    let maxValue = 0.5;\\n    if (hasHigherData) maxValue = Math.max(maxValue, sentAverage[0]);\\n    if (hasLowerData) maxValue = Math.max(maxValue, sentAverage[1]);\\n    \\n    if (hasHigherData) {\\n        var higherHeight = (sentAverage[0] / maxValue) * 80;\\n        chartHTML += '&lt;div style=\\\&quot;width: 40px; height: ' + higherHeight + '%; background-color: #3498db; margin: 0 20px; position: relative;\\\&quot;&gt;';\\n        chartHTML += '&lt;div style=\\\&quot;position: absolute; top: -20px; width: 100%; text-align: center;\\\&quot;&gt;' + sentAverage[0].toFixed(4) + '&lt;/div&gt;';\\n        chartHTML += '&lt;/div&gt;';\\n    } else {\\n        chartHTML += '&lt;div style=\\\&quot;width: 40px; height: 5%; background-color: #ccc; margin: 0 20px; position: relative;\\\&quot;&gt;';\\n        chartHTML += '&lt;div style=\\\&quot;position: absolute; top: -20px; width: 100%; text-align: center;\\\&quot;&gt;N/A&lt;/div&gt;';\\n        chartHTML += '&lt;/div&gt;';\\n    }\\n    \\n    if (hasLowerData) {\\n        var lowerHeight = (sentAverage[1] / maxValue) * 80;\\n        chartHTML += '&lt;div style=\\\&quot;width: 40px; height: ' + lowerHeight + '%; background-color: #e74c3c; margin: 0 20px; position: relative;\\\&quot;&gt;';\\n        chartHTML += '&lt;div style=\\\&quot;position: absolute; top: -20px; width: 100%; text-align: center;\\\&quot;&gt;' + sentAverage[1].toFixed(4) + '&lt;/div&gt;';\\n        chartHTML += '&lt;/div&gt;';\\n    } else {\\n        chartHTML += '&lt;div style=\\\&quot;width: 40px; height: 5%; background-color: #ccc; margin: 0 20px; position: relative;\\\&quot;&gt;';\\n        chartHTML += '&lt;div style=\\\&quot;position: absolute; top: -20px; width: 100%; text-align: center;\\\&quot;&gt;N/A&lt;/div&gt;';\\n        chartHTML += '&lt;/div&gt;';\\n    }\\n    \\n    chartHTML += '&lt;div style=\\\&quot;position: absolute; bottom: -25px; left: 20px; width: 40px; text-align: center;\\\&quot;&gt;Higher&lt;/div&gt;';\\n    chartHTML += '&lt;div style=\\\&quot;position: absolute; bottom: -25px; left: 80px; width: 40px; text-align: center;\\\&quot;&gt;Lower&lt;/div&gt;';\\n    chartHTML += '&lt;div style=\\\&quot;position: absolute; left: -35px; top: 20%; transform: rotate(-90deg);\\\&quot;&gt;Threshold (semitones)&lt;/div&gt;';\\n    \\n    chartHTML += '&lt;/div&gt;';\\n    chartHTML += '&lt;/div&gt;';\\n    \\n    chartContainer.innerHTML = chartHTML;\\n}\\n\\nfunction backToExperiment() {\\n    document.getElementById('experimentContainer').style.display = 'block';\\n    document.getElementById('resultsContainer').style.display = 'none';\\n}\\n\\nfunction view_onclick() {\\n    logDebug(\\\&quot;View results button clicked\\\&quot;);\\n    \\n    for (let i = 0; i &lt; 2; i++) {\\n        if (!isTestComplete[i] &amp;&amp; NumberOfReversals[i] &gt;= MINIMUMREVERSALS) {\\n            calculateResults(i);\\n            isTestComplete[i] = true;\\n        }\\n    }\\n    \\n    displayResults();\\n}\\n\\nfunction exportToCSV() {\\n    const headers = [\\n        \\\&quot;Trial Number\\\&quot;, \\n        \\\&quot;Timestamp\\\&quot;, \\n        \\\&quot;Direction\\\&quot;, \\n        \\\&quot;Difficulty Level\\\&quot;, \\n        \\\&quot;Semitone Value\\\&quot;, \\n        \\\&quot;Standard Position\\\&quot;,\\n        \\\&quot;User Response\\\&quot;, \\n        \\\&quot;Correct Response\\\&quot;, \\n        \\\&quot;Is Correct\\\&quot;, \\n        \\\&quot;Reaction Time (ms)\\\&quot;, \\n        \\\&quot;Is Reversal\\\&quot;,\\n        \\\&quot;Step Direction\\\&quot;\\n    ];\\n    \\n    const csvRows = [];\\n    csvRows.push(headers.join(\\\&quot;,\\\&quot;));\\n    \\n    trialRecords.forEach(function(trial) {\\n        const row = [\\n            trial.trialNumber,\\n            trial.timestamp,\\n            trial.direction,\\n            trial.difficultyLevel,\\n            trial.semitoneValue,\\n            trial.standardPosition,\\n            trial.userResponse,\\n            trial.correctResponse,\\n            trial.isCorrect ? \\\&quot;1\\\&quot; : \\\&quot;0\\\&quot;,\\n            trial.reactionTime,\\n            trial.isReversal ? \\\&quot;1\\\&quot; : \\\&quot;0\\\&quot;,\\n            trial.stepDirection\\n        ];\\n        csvRows.push(row.join(\\\&quot;,\\\&quot;));\\n    });\\n    \\n    csvRows.push(\\\&quot;\\\\nRESULTS SUMMARY\\\&quot;);\\n    csvRows.push(\\\&quot;\\\\nThreshold Results (semitones)\\\&quot;);\\n    csvRows.push(\\\&quot;Direction,Threshold,Standard Deviation,Assessment\\\&quot;);\\n    \\n    const hasHigherData = NumberOfReversals[0] &gt;= MINIMUMREVERSALS;\\n    const hasLowerData = NumberOfReversals[1] &gt;= MINIMUMREVERSALS;\\n    \\n    csvRows.push(\\\&quot;Higher,\\\&quot; + \\n        (hasHigherData ? sentAverage[0].toFixed(4) : \\\&quot;Insufficient data\\\&quot;) + \\\&quot;,\\\&quot; + \\n        (hasHigherData ? sentStdev[0].toFixed(4) : \\\&quot;N/A\\\&quot;) + \\\&quot;,\\\&quot; + \\n        (hasHigherData ? getThresholdAssessment(sentAverage[0]) : \\\&quot;N/A\\\&quot;));\\n    \\n    csvRows.push(\\\&quot;Lower,\\\&quot; + \\n        (hasLowerData ? sentAverage[1].toFixed(4) : \\\&quot;Insufficient data\\\&quot;) + \\\&quot;,\\\&quot; + \\n        (hasLowerData ? sentStdev[1].toFixed(4) : \\\&quot;N/A\\\&quot;) + \\\&quot;,\\\&quot; + \\n        (hasLowerData ? getThresholdAssessment(sentAverage[1]) : \\\&quot;N/A\\\&quot;));\\n    \\n    if (hasHigherData &amp;&amp; hasLowerData) {\\n        const avgThreshold = (sentAverage[0] + sentAverage[1]) / 2;\\n        const combinedVariance = (Math.pow(sentStdev[0], 2) + Math.pow(sentStdev[1], 2)) / 2;\\n        const combinedSD = Math.sqrt(combinedVariance).toFixed(4);\\n        \\n        csvRows.push(\\\&quot;Average,\\\&quot; + avgThreshold.toFixed(4) + \\\&quot;,\\\&quot; + combinedSD + \\\&quot;,\\\&quot; + getThresholdAssessment(avgThreshold));\\n    }\\n    \\n    const rtStats = calculateReactionTimeStats();\\n    csvRows.push(\\\&quot;\\\\nReaction Time Statistics (ms)\\\&quot;);\\n    csvRows.push(\\\&quot;Direction,Mean,Median,Standard Deviation\\\&quot;);\\n    csvRows.push(\\\&quot;Higher,\\\&quot; + rtStats.higher.mean + \\\&quot;,\\\&quot; + rtStats.higher.median + \\\&quot;,\\\&quot; + rtStats.higher.sd);\\n    csvRows.push(\\\&quot;Lower,\\\&quot; + rtStats.lower.mean + \\\&quot;,\\\&quot; + rtStats.lower.median + \\\&quot;,\\\&quot; + rtStats.lower.sd);\\n    csvRows.push(\\\&quot;Overall,\\\&quot; + rtStats.overall.mean + \\\&quot;,\\\&quot; + rtStats.overall.median + \\\&quot;,\\\&quot; + rtStats.overall.sd);\\n    \\n    const accuracyStats = calculateAccuracyStats();\\n    csvRows.push(\\\&quot;\\\\nAccuracy Statistics\\\&quot;);\\n    csvRows.push(\\\&quot;Direction,Correct Responses,Total Responses,Percentage\\\&quot;);\\n    csvRows.push(\\\&quot;Higher,\\\&quot; + accuracyStats.higher.correct + \\\&quot;,\\\&quot; + accuracyStats.higher.total + \\\&quot;,\\\&quot; + accuracyStats.higher.percentage + \\\&quot;%\\\&quot;);\\n    csvRows.push(\\\&quot;Lower,\\\&quot; + accuracyStats.lower.correct + \\\&quot;,\\\&quot; + accuracyStats.lower.total + \\\&quot;,\\\&quot; + accuracyStats.lower.percentage + \\\&quot;%\\\&quot;);\\n    csvRows.push(\\\&quot;Overall,\\\&quot; + accuracyStats.overall.correct + \\\&quot;,\\\&quot; + accuracyStats.overall.total + \\\&quot;,\\\&quot; + accuracyStats.overall.percentage + \\\&quot;%\\\&quot;);\\n    \\n    csvRows.push(\\\&quot;\\\\nExperiment Parameters\\\&quot;);\\n    csvRows.push(\\\&quot;Paradigm,ABX\\\&quot;);\\n    csvRows.push(\\\&quot;Max Reversals,\\\&quot; + MAXREVERSALS);\\n    csvRows.push(\\\&quot;Min Reversals for Calculation,\\\&quot; + MINIMUMREVERSALS);\\n    csvRows.push(\\\&quot;Max Iterations,\\\&quot; + MAXITERATIONS);\\n    \\n    const csvContent = \\\&quot;data:text/csv;charset=utf-8,\\\&quot; + csvRows.join(\\\&quot;\\\\n\\\&quot;);\\n    const encodedUri = encodeURI(csvContent);\\n    const link = document.createElement(\\\&quot;a\\\&quot;);\\n    const timestamp = new Date().toISOString().replace(/[:.]/g, \\\&quot;-\\\&quot;);\\n    link.setAttribute(\\\&quot;href\\\&quot;, encodedUri);\\n    link.setAttribute(\\\&quot;download\\\&quot;, \\\&quot;pitch_discrimination_ABX_data_\\\&quot; + timestamp + \\\&quot;.csv\\\&quot;);\\n    document.body.appendChild(link);\\n    link.click();\\n    document.body.removeChild(link);\\n}\\n\\nfunction window_onload() {\\n    window.name = \\\&quot;EXP\\\&quot;;\\n    NumberOfReversals = [0, 0];\\n    numberOfIterations = 0;\\n    CorrectResponses = [0, 0];\\n    Direction = [DECREASING, DECREASING];\\n    currentLevel = [5, 5];\\n    isTestComplete = [false, false];\\n    Reversals = [[], []];\\n    trialsPerDirection = [0, 0];\\n    forceDirection = null;\\n    directionHistory = [];\\n    trialRecords = [];\\n    isReplayTrial = false;\\n\\n    document.getElementById('text1').value = \\\&quot;準備完畢後請點擊\\\\\\\&quot;開始實驗\\\\\\\&quot;\\\&quot;;\\n    document.getElementById('smile').src = \\\&quot;Media/null.gif\\\&quot;;\\n    document.getElementById('start').disabled = false;\\n    document.getElementById('viewResult').disabled = true;\\n    document.getElementById('promptText').style.visibility = 'hidden';\\n    \\n    document.getElementById('experimentContainer').style.display = 'block';\\n    document.getElementById('resultsContainer').style.display = 'none';\\n    \\n    updateProgressBar(0);\\n    \\n    logDebug(\\\&quot;Page reset complete\\\&quot;);\\n}\\n\\nwindow.onload = function() {\\n    window_onload();\\n    \\n    var allAudios = document.querySelectorAll('audio');\\n    logDebug(\\\&quot;Preloading \\\&quot; + allAudios.length + \\\&quot; audio files\\\&quot;);\\n    \\n    allAudios.forEach(function(audio) {\\n        audio.load();\\n    });\\n    \\n    document.getElementById('text1').value = \\\&quot;請點擊\\\\\\\&quot;開始實驗\\\\\\\&quot;\\\&quot;;\\n    \\n    window.onerror = function(message, source, lineno, colno, error) {\\n        logDebug(\\\&quot;Global error: \\\&quot; + message + \\\&quot; at \\\&quot; + source + \\\&quot;:\\\&quot; + lineno);\\n        return false;\\n    };\\n    \\n    document.getElementById('showDebug').checked = true;\\n    toggleDebug();\\n};\\n&lt;/script&gt;\\n&lt;/body&gt;\\n&lt;/html&gt;\\n... EOF no more lines ...\\n\&quot;, \&quot;fileSize\&quot;: \&quot;68.18 KB\&quot;, \&quot;isBigFile\&quot;: true, \&quot;totalLines\&quot;: 1849}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668179,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:142,&quot;prompt_tokens&quot;:71309,&quot;total_tokens&quot;:71451,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:70894,&quot;cache_write_tokens&quot;:408},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668179,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668188,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;我看到level类型的实验文件结构不同，`calculateResults`函数有参数且在`view_onclick`中被调用。我需要在`view_onclick`函数中添加邮件发送功能：&quot;},&quot;timestamp&quot;:1762668188,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668188,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668188,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_MRWTY9ufTKKOTWQ4atfLHA&quot;,&quot;name&quot;:&quot;multi_replace&quot;,&quot;display_name&quot;:&quot;编辑文件&quot;,&quot;render_type&quot;:&quot;CodeMultiReplace&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_MRWTY9ufTKKOTWQ4atfLHA&quot;,&quot;toolCallName&quot;:&quot;multi_replace&quot;}" />
                    <option value="{&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_MRWTY9ufTKKOTWQ4atfLHA&quot;,&quot;document&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;sub_content&quot;:&quot;ABX_level_low.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;multi_replace_content&quot;:[{&quot;old_string&quot;:&quot;        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;&quot;,&quot;new_string&quot;:&quot;        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n    \n    &lt;!-- EmailJS Library --&gt;\n    &lt;script type=\&quot;text/javascript\&quot; src=\&quot;https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js\&quot;&gt;&lt;/script&gt;\n    \n    &lt;!-- Email Configuration and Service --&gt;\n    &lt;script src=\&quot;js/emailConfig.js\&quot;&gt;&lt;/script&gt;\n    &lt;script src=\&quot;js/emailService.js\&quot;&gt;&lt;/script&gt;\n&lt;/head&gt;&quot;},{&quot;old_string&quot;:&quot;function view_onclick() {\n    logDebug(\&quot;View results button clicked\&quot;);\n    \n    for (let i = 0; i &lt; 2; i++) {\n        if (!isTestComplete[i] &amp;&amp; NumberOfReversals[i] &gt;= MINIMUMREVERSALS) {\n            calculateResults(i);\n            isTestComplete[i] = true;\n        }\n    }\n    \n    displayResults();\n}&quot;,&quot;new_string&quot;:&quot;function view_onclick() {\n    logDebug(\&quot;View results button clicked\&quot;);\n    \n    for (let i = 0; i &lt; 2; i++) {\n        if (!isTestComplete[i] &amp;&amp; NumberOfReversals[i] &gt;= MINIMUMREVERSALS) {\n            calculateResults(i);\n            isTestComplete[i] = true;\n        }\n    }\n    \n    displayResults();\n    \n    // 自动发送实验结果到指定邮箱\n    logDebug(\&quot;Preparing to send experiment results via email...\&quot;);\n    \n    // 延迟1秒后发送邮件，确保所有数据已准备好\n    setTimeout(function() {\n        if (typeof sendCurrentExperimentResults === 'function') {\n            sendCurrentExperimentResults();\n            logDebug(\&quot;Email sending initiated\&quot;);\n        } else {\n            logDebug(\&quot;Warning: Email service not available. Please check if emailService.js is loaded.\&quot;);\n        }\n    }, 1000);\n}&quot;}],&quot;apply_mode&quot;:&quot;apply_only&quot;}},&quot;timestamp&quot;:1762668188,&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668195,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_MRWTY9ufTKKOTWQ4atfLHA&quot;},&quot;toolCallId&quot;:&quot;tooluse_MRWTY9ufTKKOTWQ4atfLHA&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668195,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_MRWTY9ufTKKOTWQ4atfLHA&quot;,&quot;error&quot;:{&quot;type&quot;:&quot;text&quot;,&quot;content&quot;:&quot;模型返回的待替换代码块没有找到匹配项&quot;,&quot;level&quot;:&quot;info&quot;}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_MRWTY9ufTKKOTWQ4atfLHA&quot;,&quot;content&quot;:&quot;调用工具失败: 修改文件失败，第1个替换的代码块没有找到匹配项，old_string为：        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n剩余1个代码块未替换。, code: 20006&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668195,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:925,&quot;prompt_tokens&quot;:81938,&quot;total_tokens&quot;:82863,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:71302,&quot;cache_write_tokens&quot;:10629},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668196,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668204,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;让我重新读取文件以获取准确的内容：&quot;},&quot;timestamp&quot;:1762668204,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668205,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668205,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_OMMPF_Q7QEu9UaqWIUnQRg&quot;,&quot;name&quot;:&quot;grep_search&quot;,&quot;display_name&quot;:&quot;查找文件&quot;,&quot;render_type&quot;:&quot;ListItems&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_OMMPF_Q7QEu9UaqWIUnQRg&quot;,&quot;toolCallName&quot;:&quot;grep_search&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762668205,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_OMMPF_Q7QEu9UaqWIUnQRg&quot;,&quot;document&quot;:{&quot;search_directory&quot;:&quot;E:/Projects/Pitch_Training&quot;,&quot;query&quot;:&quot;function view_onclick() {&quot;,&quot;sub_content&quot;:&quot;function view_onclick() {&quot;,&quot;sub_content_tip&quot;:&quot;function view_onclick() {&quot;}},&quot;toolCallId&quot;:&quot;tooluse_OMMPF_Q7QEu9UaqWIUnQRg&quot;,&quot;delta&quot;:&quot;{\&quot;useRegex\&quot;: false, \&quot;explanation\&quot;: \&quot;查找ABX_level_low.html中view_onclick函数的准确内容\&quot;, \&quot;searchDirectory\&quot;: \&quot;E:/Projects/Pitch_Training\&quot;, \&quot;query\&quot;: \&quot;function view_onclick() {\&quot;}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668205,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_OMMPF_Q7QEu9UaqWIUnQRg&quot;},&quot;toolCallId&quot;:&quot;tooluse_OMMPF_Q7QEu9UaqWIUnQRg&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668205,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_OMMPF_Q7QEu9UaqWIUnQRg&quot;,&quot;result&quot;:{&quot;items&quot;:[]},&quot;suffix_content&quot;:&quot;未找到结果&quot;,&quot;suffix_content_tip&quot;:&quot;未找到结果&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_OMMPF_Q7QEu9UaqWIUnQRg&quot;,&quot;content&quot;:&quot;## Search Results\n\n*No results found for this query.*&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668205,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:157,&quot;prompt_tokens&quot;:83200,&quot;total_tokens&quot;:83357,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:81931,&quot;cache_write_tokens&quot;:1262},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668205,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668216,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_MLgFpV0cTs2w5jQJlcjl2Q&quot;,&quot;name&quot;:&quot;grep_search&quot;,&quot;display_name&quot;:&quot;查找文件&quot;,&quot;render_type&quot;:&quot;ListItems&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_MLgFpV0cTs2w5jQJlcjl2Q&quot;,&quot;toolCallName&quot;:&quot;grep_search&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762668216,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_MLgFpV0cTs2w5jQJlcjl2Q&quot;,&quot;document&quot;:{&quot;search_directory&quot;:&quot;E:/Projects/Pitch_Training&quot;,&quot;query&quot;:&quot;view_onclick&quot;,&quot;sub_content&quot;:&quot;view_onclick&quot;,&quot;sub_content_tip&quot;:&quot;view_onclick&quot;}},&quot;toolCallId&quot;:&quot;tooluse_MLgFpV0cTs2w5jQJlcjl2Q&quot;,&quot;delta&quot;:&quot;{\&quot;useRegex\&quot;: false, \&quot;explanation\&quot;: \&quot;查找view_onclick函数\&quot;, \&quot;searchDirectory\&quot;: \&quot;E:/Projects/Pitch_Training\&quot;, \&quot;query\&quot;: \&quot;view_onclick\&quot;}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668216,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_MLgFpV0cTs2w5jQJlcjl2Q&quot;},&quot;toolCallId&quot;:&quot;tooluse_MLgFpV0cTs2w5jQJlcjl2Q&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668216,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_MLgFpV0cTs2w5jQJlcjl2Q&quot;,&quot;result&quot;:{&quot;items&quot;:[{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_level_high.html&quot;,&quot;suffix_content&quot;:&quot;L453,1692&quot;,&quot;suffix_content_tip&quot;:&quot;L453,1692&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_high.html&quot;,&quot;range&quot;:[453,453]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;2AFC_level_low.html&quot;,&quot;suffix_content&quot;:&quot;L439,1781&quot;,&quot;suffix_content_tip&quot;:&quot;L439,1781&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/2AFC/2AFC_level_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/2AFC/2AFC_level_low.html&quot;,&quot;range&quot;:[439,439]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_falling_high.html&quot;,&quot;suffix_content&quot;:&quot;L471,1224&quot;,&quot;suffix_content_tip&quot;:&quot;L471,1224&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_high.html&quot;,&quot;range&quot;:[471,471]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_level_low.html&quot;,&quot;suffix_content&quot;:&quot;L453,1692&quot;,&quot;suffix_content_tip&quot;:&quot;L453,1692&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;range&quot;:[453,453]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_falling_low.html&quot;,&quot;suffix_content&quot;:&quot;L471,1224&quot;,&quot;suffix_content_tip&quot;:&quot;L471,1224&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;range&quot;:[471,471]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_rising_high.html&quot;,&quot;suffix_content&quot;:&quot;L471,1224&quot;,&quot;suffix_content_tip&quot;:&quot;L471,1224&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_high.html&quot;,&quot;range&quot;:[471,471]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;2AFC_level_high.html&quot;,&quot;suffix_content&quot;:&quot;L439,1783&quot;,&quot;suffix_content_tip&quot;:&quot;L439,1783&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/2AFC/2AFC_level_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/2AFC/2AFC_level_high.html&quot;,&quot;range&quot;:[439,439]}},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_rising_low.html&quot;,&quot;suffix_content&quot;:&quot;L471,1224&quot;,&quot;suffix_content_tip&quot;:&quot;L471,1224&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor_v2&quot;,&quot;item_click_value&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_low.html&quot;,&quot;range&quot;:[471,471]}}]},&quot;suffix_content&quot;:&quot;找到8个结果&quot;,&quot;suffix_content_tip&quot;:&quot;找到8个结果&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_MLgFpV0cTs2w5jQJlcjl2Q&quot;,&quot;content&quot;:&quot;## Search Results for: `view_onclick`\n\n**Found 16 matches in 8 files**\n\n### File: E:/Projects/Pitch_Training/ABX_level_high.html\n\n- **Size**: 68.2 KB, **isBigFile**: true\n- **Matches**: 2\n\n```\n453: &lt;input id=\&quot;viewResult\&quot; type=\&quot;button\&quot; value=\&quot;查看結果\&quot; onclick=\&quot;view_onclick()\&quot; class=\&quot;control-button\&quot; disabled&gt;\n1692: function view_onclick() {\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/2AFC/2AFC_level_low.html\n\n- **Size**: 75.8 KB, **isBigFile**: true\n- **Matches**: 2\n\n```\n439: &lt;input id=\&quot;viewResult\&quot; type=\&quot;button\&quot; value=\&quot;View Results\&quot; onclick=\&quot;view_onclick()\&quot; class=\&quot;control-button\&quot; disabled&gt;\n1781: function view_onclick() {\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/ABX_falling_high.html\n\n- **Size**: 60.8 KB, **isBigFile**: true\n- **Matches**: 2\n\n```\n471: &lt;input id=\&quot;viewResult\&quot; type=\&quot;button\&quot; value=\&quot;查看結果\&quot; onclick=\&quot;view_onclick()\&quot; class=\&quot;control-button\&quot; disabled&gt;\n1224: function view_onclick() {\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/ABX_level_low.html\n\n- **Size**: 68.2 KB, **isBigFile**: true\n- **Matches**: 2\n\n```\n453: &lt;input id=\&quot;viewResult\&quot; type=\&quot;button\&quot; value=\&quot;查看結果\&quot; onclick=\&quot;view_onclick()\&quot; class=\&quot;control-button\&quot; disabled&gt;\n1692: function view_onclick() {\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/ABX_falling_low.html\n\n- **Size**: 60.8 KB, **isBigFile**: true\n- **Matches**: 2\n\n```\n471: &lt;input id=\&quot;viewResult\&quot; type=\&quot;button\&quot; value=\&quot;查看結果\&quot; onclick=\&quot;view_onclick()\&quot; class=\&quot;control-button\&quot; disabled&gt;\n1224: function view_onclick() {\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/ABX_rising_high.html\n\n- **Size**: 60.8 KB, **isBigFile**: true\n- **Matches**: 2\n\n```\n471: &lt;input id=\&quot;viewResult\&quot; type=\&quot;button\&quot; value=\&quot;查看結果\&quot; onclick=\&quot;view_onclick()\&quot; class=\&quot;control-button\&quot; disabled&gt;\n1224: function view_onclick() {\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/2AFC/2AFC_level_high.html\n\n- **Size**: 75.9 KB, **isBigFile**: true\n- **Matches**: 2\n\n```\n439: &lt;input id=\&quot;viewResult\&quot; type=\&quot;button\&quot; value=\&quot;View Results\&quot; onclick=\&quot;view_onclick()\&quot; class=\&quot;control-button\&quot; disabled&gt;\n1783: function view_onclick() {\n```\n\n---\n\n### File: E:/Projects/Pitch_Training/ABX_rising_low.html\n\n- **Size**: 60.8 KB, **isBigFile**: true\n- **Matches**: 2\n\n```\n471: &lt;input id=\&quot;viewResult\&quot; type=\&quot;button\&quot; value=\&quot;查看結果\&quot; onclick=\&quot;view_onclick()\&quot; class=\&quot;control-button\&quot; disabled&gt;\n1224: function view_onclick() {\n```\n\n---\n\n&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668216,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:122,&quot;prompt_tokens&quot;:83577,&quot;total_tokens&quot;:83699,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:83193,&quot;cache_write_tokens&quot;:377},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668216,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668228,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_wFeUqaLxSOCGzjde73MbsQ&quot;,&quot;name&quot;:&quot;read_file&quot;,&quot;display_name&quot;:&quot;读取文件&quot;,&quot;render_type&quot;:&quot;None&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_wFeUqaLxSOCGzjde73MbsQ&quot;,&quot;toolCallName&quot;:&quot;read_file&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762668228,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_wFeUqaLxSOCGzjde73MbsQ&quot;,&quot;document&quot;:{&quot;sub_content&quot;:&quot;ABX_level_low.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;}},&quot;toolCallId&quot;:&quot;tooluse_wFeUqaLxSOCGzjde73MbsQ&quot;,&quot;delta&quot;:&quot;{\&quot;limit\&quot;: 1710, \&quot;path\&quot;: \&quot;E:/Projects/Pitch_Training/ABX_level_low.html\&quot;, \&quot;explanation\&quot;: \&quot;读取view_onclick函数的准确内容\&quot;, \&quot;offset\&quot;: 1692}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668228,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_wFeUqaLxSOCGzjde73MbsQ&quot;},&quot;toolCallId&quot;:&quot;tooluse_wFeUqaLxSOCGzjde73MbsQ&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668228,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_wFeUqaLxSOCGzjde73MbsQ&quot;,&quot;result&quot;:{}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_wFeUqaLxSOCGzjde73MbsQ&quot;,&quot;content&quot;:&quot;{\&quot;content\&quot;: \&quot;... 1691 lines before line 1692 ...\\nfunction view_onclick() {\\n    logDebug(\\\&quot;View results button clicked\\\&quot;);\\n    \\n    for (let i = 0; i &lt; 2; i++) {\\n        if (!isTestComplete[i] &amp;&amp; NumberOfReversals[i] &gt;= MINIMUMREVERSALS) {\\n            calculateResults(i);\\n            isTestComplete[i] = true;\\n        }\\n    }\\n    \\n    displayResults();\\n}\\n\\nfunction exportToCSV() {\\n    const headers = [\\n        \\\&quot;Trial Number\\\&quot;, \\n        \\\&quot;Timestamp\\\&quot;, \\n        \\\&quot;Direction\\\&quot;, \\n        \\\&quot;Difficulty Level\\\&quot;, \\n        \\\&quot;Semitone Value\\\&quot;, \\n        \\\&quot;Standard Position\\\&quot;,\\n        \\\&quot;User Response\\\&quot;, \\n        \\\&quot;Correct Response\\\&quot;, \\n        \\\&quot;Is Correct\\\&quot;, \\n        \\\&quot;Reaction Time (ms)\\\&quot;, \\n        \\\&quot;Is Reversal\\\&quot;,\\n        \\\&quot;Step Direction\\\&quot;\\n    ];\\n    \\n    const csvRows = [];\\n    csvRows.push(headers.join(\\\&quot;,\\\&quot;));\\n    \\n    trialRecords.forEach(function(trial) {\\n        const row = [\\n            trial.trialNumber,\\n            trial.timestamp,\\n            trial.direction,\\n            trial.difficultyLevel,\\n            trial.semitoneValue,\\n            trial.standardPosition,\\n            trial.userResponse,\\n            trial.correctResponse,\\n            trial.isCorrect ? \\\&quot;1\\\&quot; : \\\&quot;0\\\&quot;,\\n            trial.reactionTime,\\n            trial.isReversal ? \\\&quot;1\\\&quot; : \\\&quot;0\\\&quot;,\\n            trial.stepDirection\\n        ];\\n        csvRows.push(row.join(\\\&quot;,\\\&quot;));\\n    });\\n    \\n    csvRows.push(\\\&quot;\\\\nRESULTS SUMMARY\\\&quot;);\\n    csvRows.push(\\\&quot;\\\\nThreshold Results (semitones)\\\&quot;);\\n    csvRows.push(\\\&quot;Direction,Threshold,Standard Deviation,Assessment\\\&quot;);\\n    \\n    const hasHigherData = NumberOfReversals[0] &gt;= MINIMUMREVERSALS;\\n    const hasLowerData = NumberOfReversals[1] &gt;= MINIMUMREVERSALS;\\n    \\n    csvRows.push(\\\&quot;Higher,\\\&quot; + \\n        (hasHigherData ? sentAverage[0].toFixed(4) : \\\&quot;Insufficient data\\\&quot;) + \\\&quot;,\\\&quot; + \\n        (hasHigherData ? sentStdev[0].toFixed(4) : \\\&quot;N/A\\\&quot;) + \\\&quot;,\\\&quot; + \\n        (hasHigherData ? getThresholdAssessment(sentAverage[0]) : \\\&quot;N/A\\\&quot;));\\n    \\n    csvRows.push(\\\&quot;Lower,\\\&quot; + \\n        (hasLowerData ? sentAverage[1].toFixed(4) : \\\&quot;Insufficient data\\\&quot;) + \\\&quot;,\\\&quot; + \\n        (hasLowerData ? sentStdev[1].toFixed(4) : \\\&quot;N/A\\\&quot;) + \\\&quot;,\\\&quot; + \\n        (hasLowerData ? getThresholdAssessment(sentAverage[1]) : \\\&quot;N/A\\\&quot;));\\n    \\n    if (hasHigherData &amp;&amp; hasLowerData) {\\n        const avgThreshold = (sentAverage[0] + sentAverage[1]) / 2;\\n        const combinedVariance = (Math.pow(sentStdev[0], 2) + Math.pow(sentStdev[1], 2)) / 2;\\n        const combinedSD = Math.sqrt(combinedVariance).toFixed(4);\\n        \\n        csvRows.push(\\\&quot;Average,\\\&quot; + avgThreshold.toFixed(4) + \\\&quot;,\\\&quot; + combinedSD + \\\&quot;,\\\&quot; + getThresholdAssessment(avgThreshold));\\n    }\\n    \\n    const rtStats = calculateReactionTimeStats();\\n    csvRows.push(\\\&quot;\\\\nReaction Time Statistics (ms)\\\&quot;);\\n    csvRows.push(\\\&quot;Direction,Mean,Median,Standard Deviation\\\&quot;);\\n    csvRows.push(\\\&quot;Higher,\\\&quot; + rtStats.higher.mean + \\\&quot;,\\\&quot; + rtStats.higher.median + \\\&quot;,\\\&quot; + rtStats.higher.sd);\\n    csvRows.push(\\\&quot;Lower,\\\&quot; + rtStats.lower.mean + \\\&quot;,\\\&quot; + rtStats.lower.median + \\\&quot;,\\\&quot; + rtStats.lower.sd);\\n    csvRows.push(\\\&quot;Overall,\\\&quot; + rtStats.overall.mean + \\\&quot;,\\\&quot; + rtStats.overall.median + \\\&quot;,\\\&quot; + rtStats.overall.sd);\\n    \\n    const accuracyStats = calculateAccuracyStats();\\n    csvRows.push(\\\&quot;\\\\nAccuracy Statistics\\\&quot;);\\n    csvRows.push(\\\&quot;Direction,Correct Responses,Total Responses,Percentage\\\&quot;);\\n    csvRows.push(\\\&quot;Higher,\\\&quot; + accuracyStats.higher.correct + \\\&quot;,\\\&quot; + accuracyStats.higher.total + \\\&quot;,\\\&quot; + accuracyStats.higher.percentage + \\\&quot;%\\\&quot;);\\n    csvRows.push(\\\&quot;Lower,\\\&quot; + accuracyStats.lower.correct + \\\&quot;,\\\&quot; + accuracyStats.lower.total + \\\&quot;,\\\&quot; + accuracyStats.lower.percentage + \\\&quot;%\\\&quot;);\\n    csvRows.push(\\\&quot;Overall,\\\&quot; + accuracyStats.overall.correct + \\\&quot;,\\\&quot; + accuracyStats.overall.total + \\\&quot;,\\\&quot; + accuracyStats.overall.percentage + \\\&quot;%\\\&quot;);\\n    \\n    csvRows.push(\\\&quot;\\\\nExperiment Parameters\\\&quot;);\\n    csvRows.push(\\\&quot;Paradigm,ABX\\\&quot;);\\n    csvRows.push(\\\&quot;Max Reversals,\\\&quot; + MAXREVERSALS);\\n    csvRows.push(\\\&quot;Min Reversals for Calculation,\\\&quot; + MINIMUMREVERSALS);\\n    csvRows.push(\\\&quot;Max Iterations,\\\&quot; + MAXITERATIONS);\\n    \\n    const csvContent = \\\&quot;data:text/csv;charset=utf-8,\\\&quot; + csvRows.join(\\\&quot;\\\\n\\\&quot;);\\n    const encodedUri = encodeURI(csvContent);\\n    const link = document.createElement(\\\&quot;a\\\&quot;);\\n    const timestamp = new Date().toISOString().replace(/[:.]/g, \\\&quot;-\\\&quot;);\\n    link.setAttribute(\\\&quot;href\\\&quot;, encodedUri);\\n    link.setAttribute(\\\&quot;download\\\&quot;, \\\&quot;pitch_discrimination_ABX_data_\\\&quot; + timestamp + \\\&quot;.csv\\\&quot;);\\n    document.body.appendChild(link);\\n    link.click();\\n    document.body.removeChild(link);\\n}\\n\\nfunction window_onload() {\\n    window.name = \\\&quot;EXP\\\&quot;;\\n    NumberOfReversals = [0, 0];\\n    numberOfIterations = 0;\\n    CorrectResponses = [0, 0];\\n    Direction = [DECREASING, DECREASING];\\n    currentLevel = [5, 5];\\n    isTestComplete = [false, false];\\n    Reversals = [[], []];\\n    trialsPerDirection = [0, 0];\\n    forceDirection = null;\\n    directionHistory = [];\\n    trialRecords = [];\\n    isReplayTrial = false;\\n\\n    document.getElementById('text1').value = \\\&quot;準備完畢後請點擊\\\\\\\&quot;開始實驗\\\\\\\&quot;\\\&quot;;\\n    document.getElementById('smile').src = \\\&quot;Media/null.gif\\\&quot;;\\n    document.getElementById('start').disabled = false;\\n    document.getElementById('viewResult').disabled = true;\\n    document.getElementById('promptText').style.visibility = 'hidden';\\n    \\n    document.getElementById('experimentContainer').style.display = 'block';\\n    document.getElementById('resultsContainer').style.display = 'none';\\n    \\n    updateProgressBar(0);\\n    \\n    logDebug(\\\&quot;Page reset complete\\\&quot;);\\n}\\n\\nwindow.onload = function() {\\n    window_onload();\\n    \\n    var allAudios = document.querySelectorAll('audio');\\n    logDebug(\\\&quot;Preloading \\\&quot; + allAudios.length + \\\&quot; audio files\\\&quot;);\\n    \\n    allAudios.forEach(function(audio) {\\n        audio.load();\\n    });\\n    \\n    document.getElementById('text1').value = \\\&quot;請點擊\\\\\\\&quot;開始實驗\\\\\\\&quot;\\\&quot;;\\n    \\n    window.onerror = function(message, source, lineno, colno, error) {\\n        logDebug(\\\&quot;Global error: \\\&quot; + message + \\\&quot; at \\\&quot; + source + \\\&quot;:\\\&quot; + lineno);\\n        return false;\\n    };\\n    \\n    document.getElementById('showDebug').checked = true;\\n    toggleDebug();\\n};\\n&lt;/script&gt;\\n&lt;/body&gt;\\n&lt;/html&gt;\\n... EOF no more lines ...\\n\&quot;, \&quot;fileSize\&quot;: \&quot;68.18 KB\&quot;, \&quot;isBigFile\&quot;: true, \&quot;totalLines\&quot;: 1849}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668228,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:133,&quot;prompt_tokens&quot;:84856,&quot;total_tokens&quot;:84989,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:83570,&quot;cache_write_tokens&quot;:1279},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668228,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668241,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;现在我有了准确的内容，让我修改这两个level文件：&quot;},&quot;timestamp&quot;:1762668241,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668241,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668241,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_IumLXTChS_WDcRujEpfXdg&quot;,&quot;name&quot;:&quot;multi_replace&quot;,&quot;display_name&quot;:&quot;编辑文件&quot;,&quot;render_type&quot;:&quot;CodeMultiReplace&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_IumLXTChS_WDcRujEpfXdg&quot;,&quot;toolCallName&quot;:&quot;multi_replace&quot;}" />
                    <option value="{&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_IumLXTChS_WDcRujEpfXdg&quot;,&quot;document&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;sub_content&quot;:&quot;ABX_level_low.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;multi_replace_content&quot;:[{&quot;old_string&quot;:&quot;        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;&quot;,&quot;new_string&quot;:&quot;        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n    \n    &lt;!-- EmailJS Library --&gt;\n    &lt;script type=\&quot;text/javascript\&quot; src=\&quot;https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js\&quot;&gt;&lt;/script&gt;\n    \n    &lt;!-- Email Configuration and Service --&gt;\n    &lt;script src=\&quot;js/emailConfig.js\&quot;&gt;&lt;/script&gt;\n    &lt;script src=\&quot;js/emailService.js\&quot;&gt;&lt;/script&gt;\n&lt;/head&gt;&quot;},{&quot;old_string&quot;:&quot;function view_onclick() {\n    logDebug(\&quot;View results button clicked\&quot;);\n    \n    for (let i = 0; i &lt; 2; i++) {\n        if (!isTestComplete[i] &amp;&amp; NumberOfReversals[i] &gt;= MINIMUMREVERSALS) {\n            calculateResults(i);\n            isTestComplete[i] = true;\n        }\n    }\n    \n    displayResults();\n}&quot;,&quot;new_string&quot;:&quot;function view_onclick() {\n    logDebug(\&quot;View results button clicked\&quot;);\n    \n    for (let i = 0; i &lt; 2; i++) {\n        if (!isTestComplete[i] &amp;&amp; NumberOfReversals[i] &gt;= MINIMUMREVERSALS) {\n            calculateResults(i);\n            isTestComplete[i] = true;\n        }\n    }\n    \n    displayResults();\n    \n    // 自动发送实验结果到指定邮箱\n    logDebug(\&quot;Preparing to send experiment results via email...\&quot;);\n    \n    // 延迟1秒后发送邮件，确保所有数据已准备好\n    setTimeout(function() {\n        if (typeof sendCurrentExperimentResults === 'function') {\n            sendCurrentExperimentResults();\n            logDebug(\&quot;Email sending initiated\&quot;);\n        } else {\n            logDebug(\&quot;Warning: Email service not available. Please check if emailService.js is loaded.\&quot;);\n        }\n    }, 1000);\n}&quot;}],&quot;apply_mode&quot;:&quot;apply_only&quot;}},&quot;timestamp&quot;:1762668241,&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668244,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_IumLXTChS_WDcRujEpfXdg&quot;},&quot;toolCallId&quot;:&quot;tooluse_IumLXTChS_WDcRujEpfXdg&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668244,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_IumLXTChS_WDcRujEpfXdg&quot;,&quot;error&quot;:{&quot;type&quot;:&quot;text&quot;,&quot;content&quot;:&quot;模型返回的待替换代码块没有找到匹配项&quot;,&quot;level&quot;:&quot;info&quot;}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_IumLXTChS_WDcRujEpfXdg&quot;,&quot;content&quot;:&quot;调用工具失败: 修改文件失败，第1个替换的代码块没有找到匹配项，old_string为：        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;\n剩余1个代码块未替换。, code: 20006&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668244,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:888,&quot;prompt_tokens&quot;:87110,&quot;total_tokens&quot;:87998,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:84849,&quot;cache_write_tokens&quot;:2254},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668244,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668253,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;让我分别处理这两个修改：&quot;},&quot;timestamp&quot;:1762668253,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668253,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668253,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_dQMtM292TYCC5R6aAzZ7Qw&quot;,&quot;name&quot;:&quot;replace_in_file&quot;,&quot;display_name&quot;:&quot;编辑文件&quot;,&quot;render_type&quot;:&quot;CodeReplace&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_dQMtM292TYCC5R6aAzZ7Qw&quot;,&quot;toolCallName&quot;:&quot;replace_in_file&quot;}" />
                    <option value="{&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_dQMtM292TYCC5R6aAzZ7Qw&quot;,&quot;document&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;sub_content&quot;:&quot;ABX_level_low.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;old_string&quot;:&quot;        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;&quot;,&quot;new_string&quot;:&quot;        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n    \n    &lt;!-- EmailJS Library --&gt;\n    &lt;script type=\&quot;text/javascript\&quot; src=\&quot;https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js\&quot;&gt;&lt;/script&gt;\n    \n    &lt;!-- Email Configuration and Service --&gt;\n    &lt;script src=\&quot;js/emailConfig.js\&quot;&gt;&lt;/script&gt;\n    &lt;script src=\&quot;js/emailService.js\&quot;&gt;&lt;/script&gt;\n&lt;/head&gt;&quot;,&quot;apply_mode&quot;:&quot;apply_only&quot;}},&quot;timestamp&quot;:1762668253,&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668255,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_dQMtM292TYCC5R6aAzZ7Qw&quot;},&quot;toolCallId&quot;:&quot;tooluse_dQMtM292TYCC5R6aAzZ7Qw&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668255,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_dQMtM292TYCC5R6aAzZ7Qw&quot;,&quot;error&quot;:{&quot;type&quot;:&quot;text&quot;,&quot;content&quot;:&quot;模型返回的待替换代码块没有找到匹配项&quot;,&quot;level&quot;:&quot;info&quot;}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_dQMtM292TYCC5R6aAzZ7Qw&quot;,&quot;content&quot;:&quot;调用工具失败: 修改文件失败，第1个替换的代码块没有找到匹配项，old_string为：        .highlight-value {\n            font-size: 28px;\n            font-weight: bold;\n            color: #e74c3c;\n            margin: 10px 0;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;, code: 20006&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668255,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:360,&quot;prompt_tokens&quot;:88332,&quot;total_tokens&quot;:88692,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:87103,&quot;cache_write_tokens&quot;:1222},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668255,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668264,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;让我重新读取文件的head部分：&quot;},&quot;timestamp&quot;:1762668264,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668264,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668264,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_FBUe6uSkRvGlDBbOkrZZUg&quot;,&quot;name&quot;:&quot;read_file&quot;,&quot;display_name&quot;:&quot;读取文件&quot;,&quot;render_type&quot;:&quot;None&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_FBUe6uSkRvGlDBbOkrZZUg&quot;,&quot;toolCallName&quot;:&quot;read_file&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762668265,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_FBUe6uSkRvGlDBbOkrZZUg&quot;,&quot;document&quot;:{&quot;sub_content&quot;:&quot;ABX_level_low.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;}},&quot;toolCallId&quot;:&quot;tooluse_FBUe6uSkRvGlDBbOkrZZUg&quot;,&quot;delta&quot;:&quot;{\&quot;limit\&quot;: 450, \&quot;path\&quot;: \&quot;E:/Projects/Pitch_Training/ABX_level_low.html\&quot;, \&quot;explanation\&quot;: \&quot;重新读取head部分以获取准确内容\&quot;, \&quot;offset\&quot;: 430}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668265,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_FBUe6uSkRvGlDBbOkrZZUg&quot;},&quot;toolCallId&quot;:&quot;tooluse_FBUe6uSkRvGlDBbOkrZZUg&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668265,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_FBUe6uSkRvGlDBbOkrZZUg&quot;,&quot;result&quot;:{}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_FBUe6uSkRvGlDBbOkrZZUg&quot;,&quot;content&quot;:&quot;{\&quot;content\&quot;: \&quot;... 429 lines before line 430 ...\\n            background-color: #4CAF50;\\n            border-radius: 10px;\\n            transition: width 0.3s ease;\\n        }\\n        .progress-label {\\n            text-align: center;\\n            font-size: 14px;\\n            color: #555;\\n            margin-top: 5px;\\n        }\\n    &lt;/style&gt;\\n&lt;/head&gt;\\n&lt;body&gt;\\n    &lt;div class=\\\&quot;container\\\&quot;&gt;\\n        &lt;div class=\\\&quot;header\\\&quot;&gt;\\n            &lt;img src=\\\&quot;Media/animation.gif\\\&quot; alt=\\\&quot;Experiment animation\\\&quot;&gt;\\n            &lt;div class=\\\&quot;training-info\\\&quot;&gt;Low Register Discrimination (ABX)&lt;/div&gt;\\n            &lt;div class=\\\&quot;instruction-text\\\&quot;&gt;請判斷第三個音聽起來更像第一個還是第二個音&lt;/div&gt;\\n        &lt;/div&gt;\\n\\n        &lt;div id=\\\&quot;experimentContainer\\\&quot;&gt;\\n            &lt;div class=\\\&quot;control-button-container\\\&quot;&gt;\\n                &lt;input id=\\\&quot;start\\\&quot; type=\\\&quot;button\\\&quot; value=\\\&quot;開始實驗\\\&quot; onclick=\\\&quot;start_onclick()\\\&quot; class=\\\&quot;control-button\\\&quot;&gt;\\n                &lt;input id=\\\&quot;viewResult\\\&quot; type=\\\&quot;button\\\&quot; value=\\\&quot;查看結果\\\&quot; onclick=\\\&quot;view_onclick()\\\&quot; class=\\\&quot;control-button\\\&quot; disabled&gt;\\n            &lt;/div&gt;\\n\\n            &lt;div class=\\\&quot;prompt-text\\\&quot; id=\\\&quot;promptText\\\&quot;&gt;\\n                第三個音更像...\\n            &lt;/div&gt;\\n            \\n            &lt;div class=\\\&quot;button-container\\\&quot;&gt;\\n                &lt;input id=\\\&quot;firstBtn\\\&quot; type=\\\&quot;button\\\&quot; value=\\\&quot;第一個音\\\&quot; onclick=\\\&quot;processAnswer(1)\\\&quot; disabled \\n                    class=\\\&quot;response-button\\\&quot; style=\\\&quot;background:#FF6666;\\\&quot;&gt;\\n                &lt;input id=\\\&quot;secondBtn\\\&quot; type=\\\&quot;button\\\&quot; value=\\\&quot;第二個音\\\&quot; onclick=\\\&quot;processAnswer(2)\\\&quot; disabled \\n                    class=\\\&quot;response-button\\\&quot; style=\\\&quot;background:#FF6666;\\\&quot;&gt;\\n            &lt;/div&gt;\\n\\n            &lt;div class=\\\&quot;feedback\\\&quot;&gt;\\n                &lt;img id=\\\&quot;smile\\\&quot; src=\\\&quot;Media/null.gif\\\&quot; width=\\\&quot;100\\\&quot; height=\\\&quot;84\\\&quot; alt=\\\&quot;Feedback\\\&quot;&gt;\\n            &lt;/div&gt;\\n            \\n            &lt;div class=\\\&quot;button-container\\\&quot;&gt;\\n                &lt;input id=\\\&quot;text1\\\&quot; class=\\\&quot;status\\\&quot; readonly&gt;\\n            &lt;/div&gt;\\n            \\n            &lt;div class=\\\&quot;progress-bar-container\\\&quot;&gt;\\n                &lt;div class=\\\&quot;progress-bar\\\&quot; id=\\\&quot;progressBar\\\&quot; style=\\\&quot;width: 0%\\\&quot;&gt;&lt;/div&gt;\\n            &lt;/div&gt;\\n            &lt;div class=\\\&quot;progress-label\\\&quot; id=\\\&quot;progressLabel\\\&quot;&gt;Progress: 0%&lt;/div&gt;\\n            \\n            &lt;div class=\\\&quot;debug-info\\\&quot; id=\\\&quot;debugInfo\\\&quot;&gt;\\n                Debug information will be displayed here\\n            &lt;/div&gt;\\n            \\n            &lt;div class=\\\&quot;auxiliary-buttons\\\&quot;&gt;\\n                &lt;label&gt;&lt;input type=\\\&quot;checkbox\\\&quot; id=\\\&quot;showDebug\\\&quot; onclick=\\\&quot;toggleDebug()\\\&quot;&gt; Show Debug Info&lt;/label&gt;\\n                &lt;button onclick=\\\&quot;testAudio()\\\&quot;&gt;Test All Audio&lt;/button&gt;\\n                &lt;button onclick=\\\&quot;showDiagnostics()\\\&quot;&gt;Diagnostics&lt;/button&gt;\\n                &lt;button onclick=\\\&quot;exportToCSV()\\\&quot; id=\\\&quot;exportBtn\\\&quot;&gt;Export Data (CSV)&lt;/button&gt;\\n            &lt;/div&gt;\\n        &lt;/div&gt;\\n        \\n        &lt;div id=\\\&quot;resultsContainer\\\&quot; class=\\\&quot;results-container\\\&quot;&gt;\\n            &lt;h2 class=\\\&quot;result-heading\\\&quot;&gt;Pitch Discrimination Test Results (ABX)&lt;/h2&gt;\\n            \\n            &lt;table class=\\\&quot;result-table\\\&quot;&gt;\\n                &lt;thead&gt;\\n                    &lt;tr&gt;\\n                        &lt;th&gt;Test Direction&lt;/th&gt;\\n                        &lt;th&gt;Threshold (semitones)&lt;/th&gt;\\n                        &lt;th&gt;Std. Deviation&lt;/th&gt;\\n                        &lt;th&gt;Assessment&lt;/th&gt;\\n                    &lt;/tr&gt;\\n                &lt;/thead&gt;\\n                &lt;tbody id=\\\&quot;resultTableBody\\\&quot;&gt;\\n                &lt;/tbody&gt;\\n            &lt;/table&gt;\\n            \\n            &lt;div class=\\\&quot;result-interpretation\\\&quot; id=\\\&quot;resultInterpretation\\\&quot;&gt;\\n            &lt;/div&gt;\\n            \\n            &lt;h3&gt;Reaction Time Statistics&lt;/h3&gt;\\n            &lt;table class=\\\&quot;result-table\\\&quot; id=\\\&quot;rtStatsTable\\\&quot;&gt;\\n                &lt;thead&gt;\\n                    &lt;tr&gt;\\n                        &lt;th&gt;Direction&lt;/th&gt;\\n                        &lt;th&gt;Mean RT (ms)&lt;/th&gt;\\n                        &lt;th&gt;Median RT (ms)&lt;/th&gt;\\n                        &lt;th&gt;RT Std. Deviation&lt;/th&gt;\\n                    &lt;/tr&gt;\\n                &lt;/thead&gt;\\n                &lt;tbody id=\\\&quot;rtStatsTableBody\\\&quot;&gt;\\n                &lt;/tbody&gt;\\n            &lt;/table&gt;\\n            \\n            &lt;h3&gt;Accuracy Statistics&lt;/h3&gt;\\n            &lt;table class=\\\&quot;result-table\\\&quot; id=\\\&quot;accuracyStatsTable\\\&quot;&gt;\\n                &lt;thead&gt;\\n                    &lt;tr&gt;\\n                        &lt;th&gt;Direction&lt;/th&gt;\\n                        &lt;th&gt;Correct Responses&lt;/th&gt;\\n                        &lt;th&gt;Total Responses&lt;/th&gt;\\n                        &lt;th&gt;Accuracy&lt;/th&gt;\\n                    &lt;/tr&gt;\\n                &lt;/thead&gt;\\n                &lt;tbody id=\\\&quot;accuracyStatsTableBody\\\&quot;&gt;\\n                &lt;/tbody&gt;\\n            &lt;/table&gt;\\n            \\n            &lt;div class=\\\&quot;chart-container\\\&quot; id=\\\&quot;resultChart\\\&quot;&gt;\\n            &lt;/div&gt;\\n            \\n            &lt;button class=\\\&quot;print-button\\\&quot; onclick=\\\&quot;printResults()\\\&quot;&gt;Print Results&lt;/button&gt;\\n            \\n            &lt;div class=\\\&quot;auxiliary-buttons\\\&quot; style=\\\&quot;margin-top: 20px;\\\&quot;&gt;\\n                &lt;button onclick=\\\&quot;exportToCSV()\\\&quot;&gt;Export Data (CSV)&lt;/button&gt;\\n            &lt;/div&gt;\\n            \\n            &lt;button class=\\\&quot;back-button\\\&quot; onclick=\\\&quot;backToExperiment()\\\&quot;&gt;Back to Experiment&lt;/button&gt;\\n        &lt;/div&gt;\\n        \\n        &lt;div class=\\\&quot;diagnostic-overlay\\\&quot; id=\\\&quot;diagnosticOverlay\\\&quot;&gt;\\n            &lt;div class=\\\&quot;diagnostic-content\\\&quot;&gt;\\n                &lt;span class=\\\&quot;diagnostic-close\\\&quot; onclick=\\\&quot;closeDiagnostics()\\\&quot;&gt;&amp;times;&lt;/span&gt;\\n                &lt;h2 class=\\\&quot;diagnostic-heading\\\&quot;&gt;Experiment Diagnostics&lt;/h2&gt;\\n                \\n                &lt;div class=\\\&quot;diagnostic-section\\\&quot;&gt;\\n                    &lt;h3&gt;Test Status&lt;/h3&gt;\\n                    &lt;table class=\\\&quot;statistics-table\\\&quot;&gt;\\n                        &lt;tr&gt;\\n                            &lt;th&gt;Direction&lt;/th&gt;\\n                            &lt;th&gt;Trials&lt;/th&gt;\\n                            &lt;th&gt;Reversals&lt;/th&gt;\\n                            &lt;th&gt;Status&lt;/th&gt;\\n                        &lt;/tr&gt;\\n                        &lt;tr&gt;\\n                            &lt;td&gt;Higher Direction&lt;/td&gt;\\n                            &lt;td id=\\\&quot;higherTrials\\\&quot;&gt;0&lt;/td&gt;\\n                            &lt;td id=\\\&quot;higherReversals\\\&quot;&gt;0&lt;/td&gt;\\n                            &lt;td id=\\\&quot;higherStatus\\\&quot;&gt;Not started&lt;/td&gt;\\n                        &lt;/tr&gt;\\n                        &lt;tr&gt;\\n                            &lt;td&gt;Lower Direction&lt;/td&gt;\\n                            &lt;td id=\\\&quot;lowerTrials\\\&quot;&gt;0&lt;/td&gt;\\n                            &lt;td id=\\\&quot;lowerReversals\\\&quot;&gt;0&lt;/td&gt;\\n                            &lt;td id=\\\&quot;lowerStatus\\\&quot;&gt;Not started&lt;/td&gt;\\n                        &lt;/tr&gt;\\n                    &lt;/table&gt;\\n                &lt;/div&gt;\\n                \\n                &lt;div class=\\\&quot;diagnostic-section\\\&quot;&gt;\\n                    &lt;h3&gt;Audio Files Check&lt;/h3&gt;\\n                    &lt;p&gt;Verifying necessary audio files:&lt;/p&gt;\\n                    &lt;div id=\\\&quot;audioFileStatus\\\&quot; class=\\\&quot;diagnostic-file-status\\\&quot;&gt;\\n                    &lt;/div&gt;\\n                &lt;/div&gt;\\n                \\n                &lt;div class=\\\&quot;diagnostic-section\\\&quot;&gt;\\n                    &lt;h3&gt;Reversal History&lt;/h3&gt;\\n                    &lt;div id=\\\&quot;reversalHistory\\\&quot;&gt;\\n                    &lt;/div&gt;\\n                &lt;/div&gt;\\n                \\n                &lt;div class=\\\&quot;diagnostic-section\\\&quot;&gt;\\n                    &lt;h3&gt;Recommendations&lt;/h3&gt;\\n                    &lt;div id=\\\&quot;diagnosticRecommendations\\\&quot;&gt;\\n                    &lt;/div&gt;\\n                &lt;/div&gt;\\n                \\n                &lt;div class=\\\&quot;diagnostic-actions\\\&quot;&gt;\\n                    &lt;button class=\\\&quot;diagnostic-action-button retry-button\\\&quot; onclick=\\\&quot;retryIncompleteDirection()\\\&quot;&gt;Retry Incomplete Direction&lt;/button&gt;\\n                    &lt;button class=\\\&quot;diagnostic-action-button continue-button\\\&quot; onclick=\\\&quot;closeDiagnostics()\\\&quot;&gt;Close&lt;/button&gt;\\n                &lt;/div&gt;\\n            &lt;/div&gt;\\n        &lt;/div&gt;\\n    &lt;/div&gt;\\n\\n    &lt;audio id=\\\&quot;low_level_standard\\\&quot; src=\\\&quot;Media/low_level_standard.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n\\n    &lt;audio id=\\\&quot;low_level_1_h\\\&quot; src=\\\&quot;Media/low_level_1_h.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_level_2_h\\\&quot; src=\\\&quot;Media/low_level_2_h.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_level_3_h\\\&quot; src=\\\&quot;Media/low_level_3_h.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_level_4_h\\\&quot; src=\\\&quot;Media/low_level_4_h.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_level_5_h\\\&quot; src=\\\&quot;Media/low_level_5_h.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_level_6_h\\\&quot; src=\\\&quot;Media/low_level_6_h.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_level_7_h\\\&quot; src=\\\&quot;Media/low_level_7_h.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_level_8_h\\\&quot; src=\\\&quot;Media/low_level_8_h.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_level_9_h\\\&quot; src=\\\&quot;Media/low_level_9_h.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n\\n    &lt;audio id=\\\&quot;low_level_1_l\\\&quot; src=\\\&quot;Media/low_level_1_l.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_level_2_l\\\&quot; src=\\\&quot;Media/low_level_2_l.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_level_3_l\\\&quot; src=\\\&quot;Media/low_level_3_l.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_level_4_l\\\&quot; src=\\\&quot;Media/low_level_4_l.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_level_5_l\\\&quot; src=\\\&quot;Media/low_level_5_l.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_level_6_l\\\&quot; src=\\\&quot;Media/low_level_6_l.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_level_7_l\\\&quot; src=\\\&quot;Media/low_level_7_l.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_level_8_l\\\&quot; src=\\\&quot;Media/low_level_8_l.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n    &lt;audio id=\\\&quot;low_level_9_l\\\&quot; src=\\\&quot;Media/low_level_9_l.wav\\\&quot; preload=\\\&quot;auto\\\&quot;&gt;&lt;/audio&gt;\\n\\n&lt;script&gt;\\nfunction getLocalTimestamp() {\\n    const now = new Date();\\n    const year = now.getFullYear();\\n    const month = String(now.getMonth() + 1).padStart(2, '0');\\n    const day = String(now.getDate()).padStart(2, '0');\\n    const hours = String(now.getHours()).padStart(2, '0');\\n    const minutes = String(now.getMinutes()).padStart(2, '0');\\n    const seconds = String(now.getSeconds()).padStart(2, '0');\\n    const milliseconds = String(now.getMilliseconds()).padStart(3, '0');\\n    \\n    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;\\n}\\n\\n// Adaptive threshold experiment constants\\nconst MAXREVERSALS = 10;\\nconst MAXITERATIONS = 50;\\nconst LOWERLIMIT = 1;\\nconst DECREASING = -1;\\nconst INCREASING = 1;\\nconst MINIMUMREVERSALS = 6;\\nconst THRESHOLD_REVERSAL_COUNT = 6;\\nconst FORCEBALANCETHRESHOLD = 5;\\n\\n// Experiment state variables\\nvar CorrectAnswer;\\nvar CorrectResponses = [0, 0];\\nvar Direction = [DECREASING, DECREASING];\\nvar Reversals = [[], []];\\nvar NumberOfReversals = [0, 0];\\nvar currentLevel = [5, 5];\\nvar numberOfIterations = 0;\\nvar sentAverage = [0.0, 0.0];\\nvar sentStdev = [0.0, 0.0];\\nvar currentStimDirection;\\nvar isTestComplete = [false, false];\\nvar audioUnlocked = false;\\nvar trialsPerDirection = [0, 0];\\nvar forceDirection = null;\\nvar directionHistory = [];\\nvar allFilesPresent = true;\\nvar trialRecords = [];\\nvar stimulusEndTime = 0;\\n\\n// ABX新增变量\\nvar standardIsFirst;\\nvar comparisonSound;\\nvar standardSound;\\nvar xSound;\\n\\n// 新增：重播标志\\nvar isReplayTrial = false;\\n\\nfunction printResults() {\\n    window.print();\\n}\\n\\nfunction logDebug(message) {\\n    console.log(message);\\n    var debugArea = document.getElementById('debugInfo');\\n    var now = new Date();\\n    var timeStr = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + '.' + now.getMilliseconds();\\n    debugArea.innerHTML += '&lt;p&gt;[' + timeStr + '] ' + message + '&lt;/p&gt;';\\n    debugArea.scrollTop = debugArea.scrollHeight;\\n}\\n\\nfunction toggleDebug() {\\n    var debugArea = document.getElementById('debugInfo');\\n    var checkbox = document.getElementById('showDebug');\\n    debugArea.style.display = checkbox.checked ? 'block' : 'none';\\n}\\n\\nfunction showDiagnostics() {\\n    updateDiagnostics();\\n    document.getElementById('diagnosticOverlay').style.display = 'flex';\\n}\\n\\nfunction closeDiagnostics() {\\n    document.getElementById('diagnosticOverlay').style.display = 'none';\\n}\\n\\nfunction updateDiagnostics() {\\n    document.getElementById('higherTrials').innerText = trialsPerDirection[0];\\n    document.getElementById('lowerTrials').innerText = trialsPerDirection[1];\\n    document.getElementById('higherReversals').innerText = NumberOfReversals[0];\\n    document.getElementById('lowerReversals').innerText = NumberOfReversals[1];\\n    \\n    let higherStatus = getDirectionStatus(0);\\n    let lowerStatus = getDirectionStatus(1);\\n    \\n    document.getElementById('higherStatus').innerText = higherStatus.text;\\n    document.getElementById('higherStatus').className = `direction-stats-${higherStatus.class}`;\\n    document.getElementById('lowerStatus').innerText = lowerStatus.text;\\n    document.getElementById('lowerStatus').className = `direction-stats-${lowerStatus.class}`;\\n    \\n    checkAudioFiles();\\n    \\n    let reversalHistoryHtml = '&lt;h4&gt;Higher Direction&lt;/h4&gt;';\\n    if (Reversals[0].length === 0) {\\n        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';\\n    } else {\\n        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals[0].join(', ') + '&lt;/p&gt;';\\n    }\\n    \\n    reversalHistoryHtml += '&lt;h4&gt;Lower Direction&lt;/h4&gt;';\\n    if (Reversals[1].length === 0) {\\n        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';\\n    } else {\\n        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals[1].join(', ') + '&lt;/p&gt;';\\n    }\\n    \\n    document.getElementById('reversalHistory').innerHTML = reversalHistoryHtml;\\n    \\n    generateDiagnosticRecommendations();\\n}\\n\\nfunction getDirectionStatus(dirIndex) {\\n    if (isTestComplete[dirIndex]) {\\n        return { text: \\\&quot;Complete\\\&quot;, class: \\\&quot;good\\\&quot; };\\n    }\\n    \\n    if (NumberOfReversals[dirIndex] &lt; 1) {\\n        return { text: \\\&quot;Not enough data\\\&quot;, class: \\\&quot;bad\\\&quot; };\\n    }\\n    \\n    if (NumberOfReversals[dirIndex] &lt; MINIMUMREVERSALS) {\\n        return { text: \\\&quot;Incomplete (\\\&quot; + NumberOfReversals[dirIndex] + \\\&quot;/\\\&quot; + MINIMUMREVERSALS + \\\&quot; reversals)\\\&quot;, class: \\\&quot;warning\\\&quot; };\\n    }\\n    \\n    return { text: \\\&quot;In progress\\\&quot;, class: \\\&quot;good\\\&quot; };\\n}\\n\\nfunction checkAudioFiles() {\\n    const requiredFiles = [\\n        \\\&quot;low_level_standard\\\&quot;,\\n        \\\&quot;low_level_1_h\\\&quot;, \\\&quot;low_level_2_h\\\&quot;, \\\&quot;low_level_3_h\\\&quot;, \\\&quot;low_level_4_h\\\&quot;, \\\&quot;low_level_5_h\\\&quot;, \\n        \\\&quot;low_level_6_h\\\&quot;, \\\&quot;low_level_7_h\\\&quot;, \\\&quot;low_level_8_h\\\&quot;, \\\&quot;low_level_9_h\\\&quot;,\\n        \\\&quot;low_level_1_l\\\&quot;, \\\&quot;low_level_2_l\\\&quot;, \\\&quot;low_level_3_l\\\&quot;, \\\&quot;low_level_4_l\\\&quot;, \\\&quot;low_level_5_l\\\&quot;, \\n        \\\&quot;low_level_6_l\\\&quot;, \\\&quot;low_level_7_l\\\&quot;, \\\&quot;low_level_8_l\\\&quot;, \\\&quot;low_level_9_l\\\&quot;\\n    ];\\n    \\n    let statusHtml = '';\\n    allFilesPresent = true;\\n    \\n    requiredFiles.forEach(function(fileId) {\\n        const audioElement = document.getElementById(fileId);\\n        const fileFound = audioElement !== null;\\n        \\n        if (!fileFound) {\\n            allFilesPresent = false;\\n        }\\n        \\n        statusHtml += `&lt;div class=\\\&quot;file-status-item ${fileFound ? 'file-found' : 'file-missing'}\\\&quot;&gt;${fileId}: ${fileFound ? 'Found' : 'Missing'}&lt;/div&gt;`;\\n    });\\n    \\n    document.getElementById('audioFileStatus').innerHTML = statusHtml;\\n}\\n\\nfunction generateDiagnosticRecommendations() {\\n    let recommendations = '';\\n    let hasIssues = false;\\n    \\n    if (!allFilesPresent) {\\n        recommendations += '&lt;p&gt;&lt;strong&gt;Critical Issue:&lt;/strong&gt; Some required audio files are missing. Please ensure all files are properly loaded.&lt;/p&gt;';\\n        hasIssues = true;\\n    }\\n    \\n    const directionDifference = Math.abs(trialsPerDirection[0] - trialsPerDirection[1]);\\n    if (directionDifference &gt; 10 &amp;&amp; !isTestComplete[0] &amp;&amp; !isTestComplete[1]) {\\n        recommendations += '&lt;p&gt;&lt;strong&gt;Warning:&lt;/strong&gt; Trial count is imbalanced between higher and lower directions. Consider restarting experiment.&lt;/p&gt;';\\n        hasIssues = true;\\n    }\\n    \\n    for (let i = 0; i &lt; 2; i++) {\\n        if (trialsPerDirection[i] &gt;= MAXITERATIONS/2 &amp;&amp; NumberOfReversals[i] &lt; MINIMUMREVERSALS) {\\n            recommendations += '&lt;p&gt;&lt;strong&gt;Issue:&lt;/strong&gt; ' + (i === 0 ? 'Higher' : 'Lower') + \\n                ' direction reached maximum trials but has insufficient reversals. This might indicate audio file issues or participant response patterns.&lt;/p&gt;';\\n            hasIssues = true;\\n        }\\n    }\\n    \\n    if (numberOfIterations &gt; 10 &amp;&amp; (trialsPerDirection[0] === 0 || trialsPerDirection[1] === 0)) {\\n        recommendations += '&lt;p&gt;&lt;strong&gt;Warning:&lt;/strong&gt; One direction has not been tested at all. Algorithm may be malfunctioning.&lt;/p&gt;';\\n        hasIssues = true;\\n    }\\n    \\n    if (!hasIssues) {\\n        recommendations += '&lt;p&gt;&lt;strong&gt;Good:&lt;/strong&gt; No major issues detected with the experiment setup.&lt;/p&gt;';\\n        \\n        if (isTestComplete[0] &amp;&amp; isTestComplete[1]) {\\n            recommendations += '&lt;p&gt;Both test directions are complete.&lt;/p&gt;';\\n        } else if (isTestComplete[0]) {\\n            recommendations += '&lt;p&gt;Higher direction test is complete. Lower direction test still needs more data.&lt;/p&gt;';\\n        } else if (isTestComplete[1]) {\\n            recommendations += '&lt;p&gt;Lower direction test is complete. Higher direction test still needs more data.&lt;/p&gt;';\\n        } else {\\n            recommendations += '&lt;p&gt;Both test directions are still in progress.&lt;/p&gt;';\\n        }\\n    }\\n    \\n    document.getElementById('diagnosticRecommendations').innerHTML = recommendations;\\n}\\n\\nfunction retryIncompleteDirection() {\\n    let retryDirection = null;\\n    \\n    if (isTestComplete[0] &amp;&amp; !isTestComplete[1]) {\\n        retryDirection = 1;\\n    } else if (!isTestComplete[0] &amp;&amp; isTestComplete[1]) {\\n        retryDirection = 0;\\n    } else if (!isTestComplete[0] &amp;&amp; !isTestComplete[1]) {\\n        retryDirection = (NumberOfReversals[0] &lt; NumberOfReversals[1]) ? 0 : 1;\\n    } else {\\n        alert(\\\&quot;Both directions are already complete.\\\&quot;);\\n        return;\\n    }\\n    \\n    resetDirection(retryDirection);\\n    forceDirection = retryDirection;\\n    closeDiagnostics();\\n    \\n    if (document.getElementById('start').disabled) {\\n        document.getElementById('text1').value = \\\&quot;Retrying \\\&quot; + (retryDirection === 0 ? \\\&quot;higher\\\&quot; : \\\&quot;lower\\\&quot;) + \\\&quot; direction...\\\&quot;;\\n        beginIteration();\\n    } else {\\n        start_onclick();\\n    }\\n}\\n\\nfunction resetDirection(dirIndex) {\\n    NumberOfReversals[dirIndex] = 0;\\n    CorrectResponses[dirIndex] = 0;\\n    Direction[dirIndex] = DECREASING;\\n    currentLevel[dirIndex] = 5;\\n    isTestComplete[dirIndex] = false;\\n    Reversals[dirIndex] = [];\\n    trialsPerDirection[dirIndex] = 0;\\n    \\n    trialRecords = trialRecords.filter(record =&gt; \\n        record.direction !== (dirIndex === 0 ? \\\&quot;Higher\\\&quot; : \\\&quot;Lower\\\&quot;)\\n    );\\n    \\n    logDebug((dirIndex === 0 ? \\\&quot;Higher\\\&quot; : \\\&quot;Lower\\\&quot;) + \\\&quot; direction reset\\\&quot;);\\n    updateProgressBar();\\n}\\n\\nfunction testAudio() {\\n    logDebug(\\\&quot;Starting to test all audio files...\\\&quot;);\\n    var audios = document.querySelectorAll('audio');\\n    \\n    if (!audioUnlocked) {\\n        unlockAudioContext();\\n... extra lines ...\\n\&quot;, \&quot;fileSize\&quot;: \&quot;68.18 KB\&quot;, \&quot;isBigFile\&quot;: true, \&quot;totalLines\&quot;: 1849}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668265,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:147,&quot;prompt_tokens&quot;:89027,&quot;total_tokens&quot;:89174,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:88325,&quot;cache_write_tokens&quot;:695},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668265,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668275,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;现在我看到了准确的内容。让我修改这两个level文件：&quot;},&quot;timestamp&quot;:1762668275,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668275,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668275,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_nvdpSRXjS2-IHm_nWf5OmQ&quot;,&quot;name&quot;:&quot;multi_replace&quot;,&quot;display_name&quot;:&quot;编辑文件&quot;,&quot;render_type&quot;:&quot;CodeMultiReplace&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_nvdpSRXjS2-IHm_nWf5OmQ&quot;,&quot;toolCallName&quot;:&quot;multi_replace&quot;}" />
                    <option value="{&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_nvdpSRXjS2-IHm_nWf5OmQ&quot;,&quot;document&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;sub_content&quot;:&quot;ABX_level_low.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;multi_replace_content&quot;:[{&quot;old_string&quot;:&quot;        .progress-label {\n            text-align: center;\n            font-size: 14px;\n            color: #555;\n            margin-top: 5px;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;&quot;,&quot;new_string&quot;:&quot;        .progress-label {\n            text-align: center;\n            font-size: 14px;\n            color: #555;\n            margin-top: 5px;\n        }\n    &lt;/style&gt;\n    \n    &lt;!-- EmailJS Library --&gt;\n    &lt;script type=\&quot;text/javascript\&quot; src=\&quot;https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js\&quot;&gt;&lt;/script&gt;\n    \n    &lt;!-- Email Configuration and Service --&gt;\n    &lt;script src=\&quot;js/emailConfig.js\&quot;&gt;&lt;/script&gt;\n    &lt;script src=\&quot;js/emailService.js\&quot;&gt;&lt;/script&gt;\n&lt;/head&gt;&quot;},{&quot;old_string&quot;:&quot;function view_onclick() {\n    logDebug(\&quot;View results button clicked\&quot;);\n    \n    for (let i = 0; i &lt; 2; i++) {\n        if (!isTestComplete[i] &amp;&amp; NumberOfReversals[i] &gt;= MINIMUMREVERSALS) {\n            calculateResults(i);\n            isTestComplete[i] = true;\n        }\n    }\n    \n    displayResults();\n}&quot;,&quot;new_string&quot;:&quot;function view_onclick() {\n    logDebug(\&quot;View results button clicked\&quot;);\n    \n    for (let i = 0; i &lt; 2; i++) {\n        if (!isTestComplete[i] &amp;&amp; NumberOfReversals[i] &gt;= MINIMUMREVERSALS) {\n            calculateResults(i);\n            isTestComplete[i] = true;\n        }\n    }\n    \n    displayResults();\n    \n    // 自动发送实验结果到指定邮箱\n    logDebug(\&quot;Preparing to send experiment results via email...\&quot;);\n    \n    // 延迟1秒后发送邮件，确保所有数据已准备好\n    setTimeout(function() {\n        if (typeof sendCurrentExperimentResults === 'function') {\n            sendCurrentExperimentResults();\n            logDebug(\&quot;Email sending initiated\&quot;);\n        } else {\n            logDebug(\&quot;Warning: Email service not available. Please check if emailService.js is loaded.\&quot;);\n        }\n    }, 1000);\n}&quot;}],&quot;apply_mode&quot;:&quot;apply_only&quot;}},&quot;timestamp&quot;:1762668275,&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668281,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_nvdpSRXjS2-IHm_nWf5OmQ&quot;},&quot;toolCallId&quot;:&quot;tooluse_nvdpSRXjS2-IHm_nWf5OmQ&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668281,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_nvdpSRXjS2-IHm_nWf5OmQ&quot;,&quot;result&quot;:{&quot;commit_id&quot;:[&quot;e180deb5c7d627ffce73169303a715b8a3565562&quot;,&quot;22f3aecadbbc39d42c6df8bc9cb07cb210e58164&quot;]}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_nvdpSRXjS2-IHm_nWf5OmQ&quot;,&quot;content&quot;:&quot;*File replaced success*&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668281,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:881,&quot;prompt_tokens&quot;:94782,&quot;total_tokens&quot;:95663,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:89020,&quot;cache_write_tokens&quot;:5755},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668282,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668292,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;太好了！现在处理最后一个文件ABX_level_high.html：&quot;},&quot;timestamp&quot;:1762668292,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668292,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668292,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_vSQyjNkSR36-DWH75Vly3g&quot;,&quot;name&quot;:&quot;multi_replace&quot;,&quot;display_name&quot;:&quot;编辑文件&quot;,&quot;render_type&quot;:&quot;CodeMultiReplace&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_vSQyjNkSR36-DWH75Vly3g&quot;,&quot;toolCallName&quot;:&quot;multi_replace&quot;}" />
                    <option value="{&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_vSQyjNkSR36-DWH75Vly3g&quot;,&quot;document&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_high.html&quot;,&quot;sub_content&quot;:&quot;ABX_level_high.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_high.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_high.html&quot;,&quot;multi_replace_content&quot;:[{&quot;old_string&quot;:&quot;        .progress-label {\n            text-align: center;\n            font-size: 14px;\n            color: #555;\n            margin-top: 5px;\n        }\n    &lt;/style&gt;\n&lt;/head&gt;&quot;,&quot;new_string&quot;:&quot;        .progress-label {\n            text-align: center;\n            font-size: 14px;\n            color: #555;\n            margin-top: 5px;\n        }\n    &lt;/style&gt;\n    \n    &lt;!-- EmailJS Library --&gt;\n    &lt;script type=\&quot;text/javascript\&quot; src=\&quot;https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js\&quot;&gt;&lt;/script&gt;\n    \n    &lt;!-- Email Configuration and Service --&gt;\n    &lt;script src=\&quot;js/emailConfig.js\&quot;&gt;&lt;/script&gt;\n    &lt;script src=\&quot;js/emailService.js\&quot;&gt;&lt;/script&gt;\n&lt;/head&gt;&quot;},{&quot;old_string&quot;:&quot;function view_onclick() {\n    logDebug(\&quot;View results button clicked\&quot;);\n    \n    for (let i = 0; i &lt; 2; i++) {\n        if (!isTestComplete[i] &amp;&amp; NumberOfReversals[i] &gt;= MINIMUMREVERSALS) {\n            calculateResults(i);\n            isTestComplete[i] = true;\n        }\n    }\n    \n    displayResults();\n}&quot;,&quot;new_string&quot;:&quot;function view_onclick() {\n    logDebug(\&quot;View results button clicked\&quot;);\n    \n    for (let i = 0; i &lt; 2; i++) {\n        if (!isTestComplete[i] &amp;&amp; NumberOfReversals[i] &gt;= MINIMUMREVERSALS) {\n            calculateResults(i);\n            isTestComplete[i] = true;\n        }\n    }\n    \n    displayResults();\n    \n    // 自动发送实验结果到指定邮箱\n    logDebug(\&quot;Preparing to send experiment results via email...\&quot;);\n    \n    // 延迟1秒后发送邮件，确保所有数据已准备好\n    setTimeout(function() {\n        if (typeof sendCurrentExperimentResults === 'function') {\n            sendCurrentExperimentResults();\n            logDebug(\&quot;Email sending initiated\&quot;);\n        } else {\n            logDebug(\&quot;Warning: Email service not available. Please check if emailService.js is loaded.\&quot;);\n        }\n    }, 1000);\n}&quot;}],&quot;apply_mode&quot;:&quot;apply_only&quot;}},&quot;timestamp&quot;:1762668292,&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668295,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_vSQyjNkSR36-DWH75Vly3g&quot;},&quot;toolCallId&quot;:&quot;tooluse_vSQyjNkSR36-DWH75Vly3g&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668296,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_vSQyjNkSR36-DWH75Vly3g&quot;,&quot;result&quot;:{&quot;commit_id&quot;:[&quot;3a3a752466abbf1a62020a714128006fb3ee6def&quot;,&quot;fa48b9b24a884f67d9112487972a5765d84fbcec&quot;]}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_vSQyjNkSR36-DWH75Vly3g&quot;,&quot;content&quot;:&quot;*File replaced success*&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668296,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:881,&quot;prompt_tokens&quot;:95903,&quot;total_tokens&quot;:96784,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:94775,&quot;cache_write_tokens&quot;:1121},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668296,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668311,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;完美！现在让我创建一个README文档来说明如何配置和使用这个邮件发送功能：&quot;},&quot;timestamp&quot;:1762668311,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668311,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668311,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_avzKp4QNQEyM-uZu9fng6A&quot;,&quot;name&quot;:&quot;edit_file&quot;,&quot;display_name&quot;:&quot;编辑文件&quot;,&quot;render_type&quot;:&quot;CodeApply&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_avzKp4QNQEyM-uZu9fng6A&quot;,&quot;toolCallName&quot;:&quot;edit_file&quot;}" />
                    <option value="{&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_avzKp4QNQEyM-uZu9fng6A&quot;,&quot;document&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/EMAIL_SETUP_README.md&quot;,&quot;sub_content&quot;:&quot;EMAIL_SETUP_README.md&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/EMAIL_SETUP_README.md&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/EMAIL_SETUP_README.md&quot;,&quot;apply_content&quot;:&quot;# 实验结果邮件发送功能使用说明\n\n## 功能概述\n\n本系统已集成EmailJS服务，可在实验完成后自动将实验结果（CSV格式）作为附件发送到指定邮箱。\n\n## 配置步骤\n\n### 1. 注册EmailJS账户\n\n1. 访问 [EmailJS官网](https://www.emailjs.com/)\n2. 点击\&quot;Sign Up\&quot;注册免费账户（每月200封邮件额度）\n3. 验证邮箱并登录\n\n### 2. 添加邮件服务\n\n1. 登录后，进入左侧菜单的 **\&quot;Email Services\&quot;**\n2. 点击 **\&quot;Add New Service\&quot;**\n3. 选择您的邮件提供商（推荐Gmail或Outlook）\n4. 按照提示连接您的邮箱账户\n5. 记录生成的 **Service ID**（例如：`service_abc123`）\n\n### 3. 创建邮件模板\n\n1. 进入左侧菜单的 **\&quot;Email Templates\&quot;**\n2. 点击 **\&quot;Create New Template\&quot;**\n3. 设置模板内容：\n\n#### 邮件主题（Subject）：\n```\n实验结果 - {{experiment_type}} - {{completion_date}}\n```\n\n#### 邮件正文（Content）：\n```\n您好，\n\n以下是实验结果的详细信息：\n\n实验类型：{{experiment_type}}\n完成时间：{{completion_date}}\n总试验次数：{{total_trials}}\n总反转次数：{{total_reversals}}\nJND 值：{{jnd_value}}\n准确率：{{accuracy}}\n平均反应时间：{{mean_rt}}\n\n结果摘要：\n{{results_summary}}\n\n详细数据请查看附件 CSV 文件。\n\n此邮件由实验系统自动发送。\n```\n\n#### 附件设置：\n在模板编辑器中添加附件字段：\n- **附件名称变量**：`{{attachment_name}}`\n- **附件内容变量**：`{{attachment_content}}`\n- **附件类型**：`text/csv`\n\n4. 保存模板并记录 **Template ID**（例如：`template_xyz789`）\n\n### 4. 获取Public Key\n\n1. 进入左侧菜单的 **\&quot;Account\&quot;** → **\&quot;General\&quot;**\n2. 找到 **\&quot;Public Key\&quot;** 并复制（例如：`user_abcdefg123456`）\n\n### 5. 配置项目\n\n打开项目中的 `js/emailConfig.js` 文件，填入您的配置信息：\n\n```javascript\nconst EMAIL_CONFIG = {\n    // 从EmailJS控制台获取的Service ID\n    serviceId: 'service_abc123',\n    \n    // 从EmailJS控制台获取的Template ID\n    templateId: 'template_xyz789',\n    \n    // 从EmailJS控制台获取的Public Key\n    publicKey: 'user_abcdefg123456',\n    \n    // 接收实验结果的邮箱地址\n    recipientEmail: 'your-email@example.com'\n};\n```\n\n## 使用方法\n\n配置完成后，系统会在以下情况自动发送邮件：\n\n1. **实验完成时**：当实验达到足够的反转次数并计算出结果后\n2. **查看结果时**：点击\&quot;查看结果\&quot;按钮时\n\n### 发送内容\n\n邮件将包含：\n- **邮件正文**：实验的关键指标摘要\n- **CSV附件**：完整的试验数据和统计结果\n\n### 发送状态\n\n- 发送成功：会弹出提示\&quot;实验结果已成功发送到指定邮箱！\&quot;\n- 发送失败：会显示错误信息，请检查网络连接或EmailJS配置\n\n## 文件结构\n\n```\nE:/Projects/Pitch_Training/\n├── js/\n│   ├── emailConfig.js      # 邮件配置文件（需要您填写）\n│   └── emailService.js     # 邮件服务封装（无需修改）\n├── ABX_falling_low.html    # 已集成邮件功能\n├── ABX_falling_high.html   # 已集成邮件功能\n├── ABX_rising_low.html     # 已集成邮件功能\n├── ABX_rising_high.html    # 已集成邮件功能\n├── ABX_level_low.html      # 已集成邮件功能\n├── ABX_level_high.html     # 已集成邮件功能\n└── EMAIL_SETUP_README.md   # 本说明文档\n```\n\n## 常见问题\n\n### Q1: 邮件发送失败怎么办？\n\n**A:** 请检查：\n1. 网络连接是否正常\n2. `emailConfig.js` 中的配置是否正确\n3. EmailJS账户是否还有发送额度\n4. 浏览器控制台是否有错误信息\n\n### Q2: 如何测试邮件功能？\n\n**A:** \n1. 打开浏览器开发者工具（F12）\n2. 查看Console标签页\n3. 完成实验后，查看是否有\&quot;Email sending initiated\&quot;和\&quot;Email sent successfully\&quot;的日志\n\n### Q3: 可以更改收件人邮箱吗？\n\n**A:** 可以，修改 `js/emailConfig.js` 中的 `recipientEmail` 字段即可。\n\n### Q4: 邮件发送是否需要用户确认？\n\n**A:** 不需要。系统会在实验完成后自动发送，无需用户操作。\n\n### Q5: CSV附件包含哪些内容？\n\n**A:** CSV文件包含：\n- 每次试验的详细记录（反应时间、正确性等）\n- JND计算结果\n- 统计摘要（准确率、平均反应时间等）\n- 实验参数\n\n### Q6: 免费版EmailJS有什么限制？\n\n**A:** \n- 每月200封邮件\n- 每封邮件最大50KB\n- 基本的邮件模板功能\n\n对于大多数实验需求，免费版已经足够。\n\n## 技术支持\n\n如有问题，请检查：\n1. 浏览器控制台的错误信息\n2. EmailJS控制台的发送日志\n3. 邮件服务提供商的垃圾邮件文件夹\n\n## 安全提示\n\n- **不要**将 `emailConfig.js` 中的配置信息提交到公开的代码仓库\n- EmailJS的Public Key可以暴露在前端，但建议设置域名白名单限制\n- 定期检查EmailJS账户的使用情况\n\n## 更新日志\n\n- **2025-11-09**: 初始版本，集成EmailJS邮件发送功能\n  - 支持6个实验HTML文件\n  - 自动发送CSV附件\n  - 固定收件人邮箱\n  - 无需用户确认\n\n---\n\n**祝您使用愉快！** \n&quot;,&quot;instruction&quot;:&quot;创建一个详细的README文档，说明如何配置和使用EmailJS邮件发送功能&quot;,&quot;apply_mode&quot;:&quot;apply_only&quot;}},&quot;timestamp&quot;:1762668311,&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668330,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_avzKp4QNQEyM-uZu9fng6A&quot;},&quot;toolCallId&quot;:&quot;tooluse_avzKp4QNQEyM-uZu9fng6A&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668330,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_avzKp4QNQEyM-uZu9fng6A&quot;,&quot;result&quot;:{&quot;commit_id&quot;:[&quot;9ec3e088f9c9d3631b423485bdcd24e478db1ea9&quot;,&quot;ce4219770d488ca976bb5b90ee09accfacfc4184&quot;]}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_avzKp4QNQEyM-uZu9fng6A&quot;,&quot;content&quot;:&quot;&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668330,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:2195,&quot;prompt_tokens&quot;:97022,&quot;total_tokens&quot;:99217,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:95896,&quot;cache_write_tokens&quot;:1119},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668331,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668342,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;完美！现在让我创建一个简单的测试页面，方便您测试邮件功能：&quot;},&quot;timestamp&quot;:1762668342,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668342,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668342,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_27Q11qLpTQ64CPzmK_ihpg&quot;,&quot;name&quot;:&quot;edit_file&quot;,&quot;display_name&quot;:&quot;编辑文件&quot;,&quot;render_type&quot;:&quot;CodeApply&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_27Q11qLpTQ64CPzmK_ihpg&quot;,&quot;toolCallName&quot;:&quot;edit_file&quot;}" />
                    <option value="{&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_27Q11qLpTQ64CPzmK_ihpg&quot;,&quot;document&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/test_email.html&quot;,&quot;sub_content&quot;:&quot;test_email.html&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/test_email.html&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/test_email.html&quot;,&quot;apply_content&quot;:&quot;&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;EmailJS 测试页面&lt;/title&gt;\n    &lt;meta charset=\&quot;UTF-8\&quot;&gt;\n    &lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1.0\&quot;&gt;\n    &lt;style&gt;\n        body {\n            font-family: Arial, sans-serif;\n            max-width: 800px;\n            margin: 50px auto;\n            padding: 20px;\n            background-color: #f5f5f5;\n        }\n        .container {\n            background-color: white;\n            padding: 30px;\n            border-radius: 10px;\n            box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n        }\n        h1 {\n            color: #333;\n            text-align: center;\n        }\n        .config-section {\n            margin: 20px 0;\n            padding: 15px;\n            background-color: #f9f9f9;\n            border-left: 4px solid #4CAF50;\n        }\n        .config-item {\n            margin: 10px 0;\n        }\n        .config-item label {\n            display: inline-block;\n            width: 150px;\n            font-weight: bold;\n        }\n        .config-item span {\n            color: #666;\n        }\n        .button-container {\n            text-align: center;\n            margin: 30px 0;\n        }\n        button {\n            padding: 15px 30px;\n            font-size: 16px;\n            background-color: #4CAF50;\n            color: white;\n            border: none;\n            border-radius: 5px;\n            cursor: pointer;\n            margin: 0 10px;\n        }\n        button:hover {\n            background-color: #45a049;\n        }\n        button:disabled {\n            background-color: #cccccc;\n            cursor: not-allowed;\n        }\n        .status {\n            margin: 20px 0;\n            padding: 15px;\n            border-radius: 5px;\n            display: none;\n        }\n        .status.success {\n            background-color: #d4edda;\n            border: 1px solid #c3e6cb;\n            color: #155724;\n        }\n        .status.error {\n            background-color: #f8d7da;\n            border: 1px solid #f5c6cb;\n            color: #721c24;\n        }\n        .status.info {\n            background-color: #d1ecf1;\n            border: 1px solid #bee5eb;\n            color: #0c5460;\n        }\n        .log-container {\n            margin: 20px 0;\n            padding: 15px;\n            background-color: #f4f4f4;\n            border: 1px solid #ddd;\n            border-radius: 5px;\n            max-height: 300px;\n            overflow-y: auto;\n            font-family: 'Courier New', monospace;\n            font-size: 12px;\n        }\n        .log-entry {\n            margin: 5px 0;\n            padding: 3px 0;\n        }\n        .log-entry.success {\n            color: #28a745;\n        }\n        .log-entry.error {\n            color: #dc3545;\n        }\n        .log-entry.info {\n            color: #17a2b8;\n        }\n    &lt;/style&gt;\n    \n    &lt;!-- EmailJS Library --&gt;\n    &lt;script type=\&quot;text/javascript\&quot; src=\&quot;https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js\&quot;&gt;&lt;/script&gt;\n    \n    &lt;!-- Email Configuration and Service --&gt;\n    &lt;script src=\&quot;js/emailConfig.js\&quot;&gt;&lt;/script&gt;\n    &lt;script src=\&quot;js/emailService.js\&quot;&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div class=\&quot;container\&quot;&gt;\n        &lt;h1&gt; EmailJS 邮件发送测试&lt;/h1&gt;\n        \n        &lt;div class=\&quot;config-section\&quot;&gt;\n            &lt;h3&gt;当前配置&lt;/h3&gt;\n            &lt;div class=\&quot;config-item\&quot;&gt;\n                &lt;label&gt;Service ID:&lt;/label&gt;\n                &lt;span id=\&quot;serviceId\&quot;&gt;未配置&lt;/span&gt;\n            &lt;/div&gt;\n            &lt;div class=\&quot;config-item\&quot;&gt;\n                &lt;label&gt;Template ID:&lt;/label&gt;\n                &lt;span id=\&quot;templateId\&quot;&gt;未配置&lt;/span&gt;\n            &lt;/div&gt;\n            &lt;div class=\&quot;config-item\&quot;&gt;\n                &lt;label&gt;Public Key:&lt;/label&gt;\n                &lt;span id=\&quot;publicKey\&quot;&gt;未配置&lt;/span&gt;\n            &lt;/div&gt;\n            &lt;div class=\&quot;config-item\&quot;&gt;\n                &lt;label&gt;收件人邮箱:&lt;/label&gt;\n                &lt;span id=\&quot;recipientEmail\&quot;&gt;未配置&lt;/span&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n        \n        &lt;div class=\&quot;button-container\&quot;&gt;\n            &lt;button onclick=\&quot;testEmailService()\&quot; id=\&quot;testBtn\&quot;&gt;发送测试邮件&lt;/button&gt;\n            &lt;button onclick=\&quot;clearLog()\&quot;&gt;清空日志&lt;/button&gt;\n        &lt;/div&gt;\n        \n        &lt;div id=\&quot;statusMessage\&quot; class=\&quot;status\&quot;&gt;&lt;/div&gt;\n        \n        &lt;div class=\&quot;log-container\&quot; id=\&quot;logContainer\&quot;&gt;\n            &lt;div class=\&quot;log-entry info\&quot;&gt;等待测试...&lt;/div&gt;\n        &lt;/div&gt;\n        \n        &lt;div style=\&quot;margin-top: 30px; padding: 15px; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 5px;\&quot;&gt;\n            &lt;h4 style=\&quot;margin-top: 0;\&quot;&gt;⚠️ 注意事项&lt;/h4&gt;\n            &lt;ul&gt;\n                &lt;li&gt;请确保已在 &lt;code&gt;js/emailConfig.js&lt;/code&gt; 中配置了正确的EmailJS参数&lt;/li&gt;\n                &lt;li&gt;测试邮件将发送到配置文件中指定的收件人邮箱&lt;/li&gt;\n                &lt;li&gt;请检查垃圾邮件文件夹&lt;/li&gt;\n                &lt;li&gt;免费版EmailJS每月限制200封邮件&lt;/li&gt;\n            &lt;/ul&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;script&gt;\n        // 显示当前配置\n        window.onload = function() {\n            if (typeof EMAIL_CONFIG !== 'undefined') {\n                document.getElementById('serviceId').textContent = EMAIL_CONFIG.serviceId || '未配置';\n                document.getElementById('templateId').textContent = EMAIL_CONFIG.templateId || '未配置';\n                document.getElementById('publicKey').textContent = EMAIL_CONFIG.publicKey || '未配置';\n                document.getElementById('recipientEmail').textContent = EMAIL_CONFIG.recipientEmail || '未配置';\n                \n                // 检查配置是否完整\n                if (EMAIL_CONFIG.serviceId.includes('YOUR_') || \n                    EMAIL_CONFIG.templateId.includes('YOUR_') || \n                    EMAIL_CONFIG.publicKey.includes('YOUR_')) {\n                    showStatus('请先在 js/emailConfig.js 中配置EmailJS参数！', 'error');\n                    document.getElementById('testBtn').disabled = true;\n                } else {\n                    addLog('配置加载成功', 'success');\n                }\n            } else {\n                showStatus('无法加载配置文件！请检查 js/emailConfig.js 是否存在。', 'error');\n                document.getElementById('testBtn').disabled = true;\n            }\n        };\n        \n        function addLog(message, type = 'info') {\n            const logContainer = document.getElementById('logContainer');\n            const timestamp = new Date().toLocaleTimeString('zh-CN');\n            const logEntry = document.createElement('div');\n            logEntry.className = 'log-entry ' + type;\n            logEntry.textContent = `[${timestamp}] ${message}`;\n            logContainer.appendChild(logEntry);\n            logContainer.scrollTop = logContainer.scrollHeight;\n        }\n        \n        function clearLog() {\n            document.getElementById('logContainer').innerHTML = '&lt;div class=\&quot;log-entry info\&quot;&gt;日志已清空&lt;/div&gt;';\n        }\n        \n        function showStatus(message, type) {\n            const statusDiv = document.getElementById('statusMessage');\n            statusDiv.textContent = message;\n            statusDiv.className = 'status ' + type;\n            statusDiv.style.display = 'block';\n            \n            setTimeout(() =&gt; {\n                statusDiv.style.display = 'none';\n            }, 5000);\n        }\n        \n        function testEmailService() {\n            addLog('开始发送测试邮件...', 'info');\n            document.getElementById('testBtn').disabled = true;\n            \n            // 创建模拟的实验数据\n            const mockTrialRecords = [\n                {\n                    trialNumber: 1,\n                    timestamp: new Date().toISOString(),\n                    difficultyLevel: 5,\n                    modulationWindowPercent: 70,\n                    modulationWindowDuration: '280.00',\n                    modulationRate: '3.5714',\n                    slope: '0.003571',\n                    userResponse: 'First Tone',\n                    correctResponse: 'First Tone',\n                    isCorrect: true,\n                    reactionTime: '1250',\n                    isReversal: false,\n                    stepDirection: 'Increasing Difficulty',\n                    standardPosition: 'First'\n                },\n                {\n                    trialNumber: 2,\n                    timestamp: new Date().toISOString(),\n                    difficultyLevel: 6,\n                    modulationWindowPercent: 80,\n                    modulationWindowDuration: '320.00',\n                    modulationRate: '3.1250',\n                    slope: '0.003125',\n                    userResponse: 'Second Tone',\n                    correctResponse: 'First Tone',\n                    isCorrect: false,\n                    reactionTime: '1580',\n                    isReversal: true,\n                    stepDirection: 'Decreasing Difficulty',\n                    standardPosition: 'Second'\n                }\n            ];\n            \n            const mockResults = {\n                jndAbsoluteDifference: 45.50,\n                jndPercentDifference: 11.38,\n                jndRatio: 0.8863,\n                webersRatio: 0.1138,\n                thresholdWindowDuration: 354.50,\n                thresholdWindowPercent: 88.63\n            };\n            \n            const mockExperimentInfo = {\n                type: 'EmailJS Test - Pitch Training',\n                completionDate: new Date().toLocaleString('zh-CN'),\n                totalTrials: 2,\n                totalReversals: 1,\n                accuracy: '50.0% (1/2)',\n                meanRT: '1415 ms'\n            };\n            \n            addLog('准备测试数据...', 'info');\n            addLog(`收件人: ${EMAIL_CONFIG.recipientEmail}`, 'info');\n            \n            // 调用邮件发送函数\n            sendExperimentResults({\n                trialRecords: mockTrialRecords,\n                results: mockResults,\n                experimentInfo: mockExperimentInfo,\n                onSuccess: function(response) {\n                    addLog('✅ 邮件发送成功！', 'success');\n                    addLog(`状态码: ${response.status}`, 'success');\n                    addLog(`响应: ${response.text}`, 'success');\n                    showStatus('测试邮件发送成功！请检查收件箱。', 'success');\n                    document.getElementById('testBtn').disabled = false;\n                },\n                onError: function(error) {\n                    addLog('❌ 邮件发送失败！', 'error');\n                    addLog(`错误信息: ${error.message || error}`, 'error');\n                    showStatus('邮件发送失败：' + (error.message || error), 'error');\n                    document.getElementById('testBtn').disabled = false;\n                }\n            });\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n&quot;,&quot;instruction&quot;:&quot;创建一个EmailJS测试页面，方便用户测试邮件发送功能是否正常工作&quot;,&quot;apply_mode&quot;:&quot;apply_only&quot;}},&quot;timestamp&quot;:1762668342,&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668367,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_27Q11qLpTQ64CPzmK_ihpg&quot;},&quot;toolCallId&quot;:&quot;tooluse_27Q11qLpTQ64CPzmK_ihpg&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668367,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_27Q11qLpTQ64CPzmK_ihpg&quot;,&quot;result&quot;:{&quot;commit_id&quot;:[&quot;b8eb97b1ce5a3d215d0f6b6f510ea3850b734250&quot;,&quot;c9719aef9dac9de1a23cb8962542356268411ff8&quot;]}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_27Q11qLpTQ64CPzmK_ihpg&quot;,&quot;content&quot;:&quot;&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668367,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:3237,&quot;prompt_tokens&quot;:99368,&quot;total_tokens&quot;:102605,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:97015,&quot;cache_write_tokens&quot;:2346},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668367,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668377,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;完美！现在让我创建一个快速开始指南：&quot;},&quot;timestamp&quot;:1762668377,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668377,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668377,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_E8rhDxzUSx2-dF7L2ug9kg&quot;,&quot;name&quot;:&quot;edit_file&quot;,&quot;display_name&quot;:&quot;编辑文件&quot;,&quot;render_type&quot;:&quot;CodeApply&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_E8rhDxzUSx2-dF7L2ug9kg&quot;,&quot;toolCallName&quot;:&quot;edit_file&quot;}" />
                    <option value="{&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_E8rhDxzUSx2-dF7L2ug9kg&quot;,&quot;document&quot;:{&quot;file_path&quot;:&quot;E:/Projects/Pitch_Training/QUICK_START.md&quot;,&quot;sub_content&quot;:&quot;QUICK_START.md&quot;,&quot;sub_content_event&quot;:&quot;open_editor&quot;,&quot;sub_content_event_value&quot;:&quot;E:/Projects/Pitch_Training/QUICK_START.md&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/QUICK_START.md&quot;,&quot;apply_content&quot;:&quot;# 邮件发送功能 - 快速开始指南\n\n##  5分钟快速配置\n\n### 步骤1：注册EmailJS（2分钟）\n1. 访问 https://www.emailjs.com/\n2. 点击\&quot;Sign Up\&quot;注册免费账户\n3. 验证邮箱\n\n### 步骤2：配置EmailJS（2分钟）\n1. **添加邮件服务**\n   - 进入\&quot;Email Services\&quot; → \&quot;Add New Service\&quot;\n   - 选择Gmail或Outlook\n   - 连接您的邮箱\n   - 复制生成的 **Service ID**\n\n2. **创建邮件模板**\n   - 进入\&quot;Email Templates\&quot; → \&quot;Create New Template\&quot;\n   - 复制以下内容到模板：\n\n**主题：**\n```\n实验结果 - {{experiment_type}} - {{completion_date}}\n```\n\n**正文：**\n```\n您好，\n\n实验类型：{{experiment_type}}\n完成时间：{{completion_date}}\nJND 值：{{jnd_value}}\n准确率：{{accuracy}}\n\n详细数据请查看附件。\n```\n\n   - 添加附件字段：`{{attachment_name}}` 和 `{{attachment_content}}`\n   - 保存并复制 **Template ID**\n\n3. **获取Public Key**\n   - 进入\&quot;Account\&quot; → \&quot;General\&quot;\n   - 复制 **Public Key**\n\n### 步骤3：配置项目（1分钟）\n打开 `js/emailConfig.js`，填入您的信息：\n\n```javascript\nconst EMAIL_CONFIG = {\n    serviceId: '您的Service ID',\n    templateId: '您的Template ID',\n    publicKey: '您的Public Key',\n    recipientEmail: '接收邮件的邮箱地址'\n};\n```\n\n### 步骤4：测试（1分钟）\n1. 在浏览器中打开 `test_email.html`\n2. 点击\&quot;发送测试邮件\&quot;按钮\n3. 检查收件箱（可能在垃圾邮件文件夹）\n\n## ✅ 完成！\n\n现在运行任何实验，完成后会自动发送结果到指定邮箱。\n\n##  示例配置\n\n```javascript\nconst EMAIL_CONFIG = {\n    serviceId: 'service_abc123',\n    templateId: 'template_xyz789',\n    publicKey: 'user_abcdefg123456',\n    recipientEmail: 'researcher@university.edu'\n};\n```\n\n##  故障排除\n\n**问题：邮件发送失败**\n- 检查网络连接\n- 确认配置信息正确\n- 查看浏览器控制台错误信息\n\n**问题：收不到邮件**\n- 检查垃圾邮件文件夹\n- 确认收件人邮箱地址正确\n- 登录EmailJS查看发送日志\n\n##  更多信息\n\n详细说明请查看 `EMAIL_SETUP_README.md`\n\n---\n\n**需要帮助？** 查看EmailJS官方文档：https://www.emailjs.com/docs/\n&quot;,&quot;instruction&quot;:&quot;创建一个快速开始指南，帮助用户快速配置邮件功能&quot;,&quot;apply_mode&quot;:&quot;apply_only&quot;}},&quot;timestamp&quot;:1762668377,&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668385,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_E8rhDxzUSx2-dF7L2ug9kg&quot;},&quot;toolCallId&quot;:&quot;tooluse_E8rhDxzUSx2-dF7L2ug9kg&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668386,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_E8rhDxzUSx2-dF7L2ug9kg&quot;,&quot;result&quot;:{&quot;commit_id&quot;:[&quot;034bd9b714c1ea0e813b9719ec009ff7a7f45ce0&quot;,&quot;af18f3bbbbdc478e855531232781f0193db47757&quot;]}},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_E8rhDxzUSx2-dF7L2ug9kg&quot;,&quot;content&quot;:&quot;&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668386,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:1038,&quot;prompt_tokens&quot;:102757,&quot;total_tokens&quot;:103795,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:99361,&quot;cache_write_tokens&quot;:3389},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668386,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668399,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;完美！现在让我验证一下所有文件是否都已正确创建和修改：&quot;},&quot;timestamp&quot;:1762668399,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668400,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668400,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_J8Ia68AzRpGn_ioTOQlFjQ&quot;,&quot;name&quot;:&quot;list_dir&quot;,&quot;display_name&quot;:&quot;查找目录&quot;,&quot;render_type&quot;:&quot;ListItems&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_J8Ia68AzRpGn_ioTOQlFjQ&quot;,&quot;toolCallName&quot;:&quot;list_dir&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762668400,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_J8Ia68AzRpGn_ioTOQlFjQ&quot;,&quot;document&quot;:{&quot;path&quot;:&quot;E:/Projects/Pitch_Training&quot;,&quot;sub_content&quot;:&quot;Pitch_Training&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training&quot;}},&quot;toolCallId&quot;:&quot;tooluse_J8Ia68AzRpGn_ioTOQlFjQ&quot;,&quot;delta&quot;:&quot;{\&quot;explanation\&quot;: \&quot;验证js文件夹和新创建的文件是否存在\&quot;, \&quot;path\&quot;: \&quot;E:/Projects/Pitch_Training\&quot;}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668400,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_J8Ia68AzRpGn_ioTOQlFjQ&quot;},&quot;toolCallId&quot;:&quot;tooluse_J8Ia68AzRpGn_ioTOQlFjQ&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668400,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_J8Ia68AzRpGn_ioTOQlFjQ&quot;,&quot;result&quot;:{&quot;items&quot;:[{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;.gitattributes&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/.gitattributes&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/.gitattributes&quot;,&quot;suffix_content&quot;:&quot;280 Byte&quot;},{&quot;item_type&quot;:&quot;directory&quot;,&quot;content&quot;:&quot;2AFC/&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_falling_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_high.html&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_high.html&quot;,&quot;suffix_content&quot;:&quot;60.85 KB&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_falling_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_falling_low.html&quot;,&quot;suffix_content&quot;:&quot;60.82 KB&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_level_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_high.html&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_high.html&quot;,&quot;suffix_content&quot;:&quot;69.05 KB&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_level_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_level_low.html&quot;,&quot;suffix_content&quot;:&quot;68.98 KB&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_rising_high.html&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_high.html&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_high.html&quot;,&quot;suffix_content&quot;:&quot;60.83 KB&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;ABX_rising_low.html&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_low.html&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/ABX_rising_low.html&quot;,&quot;suffix_content&quot;:&quot;60.79 KB&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;EMAIL_SETUP_README.md&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/EMAIL_SETUP_README.md&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/EMAIL_SETUP_README.md&quot;,&quot;suffix_content&quot;:&quot;5.21 KB&quot;},{&quot;item_type&quot;:&quot;directory&quot;,&quot;content&quot;:&quot;Media/&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;QUICK_START.md&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/QUICK_START.md&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/QUICK_START.md&quot;,&quot;suffix_content&quot;:&quot;2.24 KB&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;index.html&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/index.html&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/index.html&quot;,&quot;suffix_content&quot;:&quot;12.26 KB&quot;},{&quot;item_type&quot;:&quot;directory&quot;,&quot;content&quot;:&quot;js/&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;test_email.html&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/test_email.html&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/test_email.html&quot;,&quot;suffix_content&quot;:&quot;10.88 KB&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;training materials memo.docx&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/training materials memo.docx&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/training materials memo.docx&quot;,&quot;suffix_content&quot;:&quot;1016.61 KB&quot;}]},&quot;suffix_content&quot;:&quot;找到15个结果&quot;,&quot;suffix_content_tip&quot;:&quot;找到15个结果&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_J8Ia68AzRpGn_ioTOQlFjQ&quot;,&quot;content&quot;:&quot;[{\&quot;file\&quot;: \&quot;.gitattributes\&quot;, \&quot;fileSize\&quot;: \&quot;280 Byte\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: false}, {\&quot;file\&quot;: \&quot;2AFC/\&quot;, \&quot;fileType\&quot;: \&quot;directory\&quot;, \&quot;subItemCnt\&quot;: 17}, {\&quot;file\&quot;: \&quot;ABX_falling_high.html\&quot;, \&quot;fileSize\&quot;: \&quot;60.85 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: true}, {\&quot;file\&quot;: \&quot;ABX_falling_low.html\&quot;, \&quot;fileSize\&quot;: \&quot;60.82 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: true}, {\&quot;file\&quot;: \&quot;ABX_level_high.html\&quot;, \&quot;fileSize\&quot;: \&quot;69.05 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: true}, {\&quot;file\&quot;: \&quot;ABX_level_low.html\&quot;, \&quot;fileSize\&quot;: \&quot;68.98 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: true}, {\&quot;file\&quot;: \&quot;ABX_rising_high.html\&quot;, \&quot;fileSize\&quot;: \&quot;60.83 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: true}, {\&quot;file\&quot;: \&quot;ABX_rising_low.html\&quot;, \&quot;fileSize\&quot;: \&quot;60.79 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: true}, {\&quot;file\&quot;: \&quot;EMAIL_SETUP_README.md\&quot;, \&quot;fileSize\&quot;: \&quot;5.21 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: false}, {\&quot;file\&quot;: \&quot;Media/\&quot;, \&quot;fileType\&quot;: \&quot;directory\&quot;, \&quot;subItemCnt\&quot;: 17}, {\&quot;file\&quot;: \&quot;QUICK_START.md\&quot;, \&quot;fileSize\&quot;: \&quot;2.24 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: false}, {\&quot;file\&quot;: \&quot;index.html\&quot;, \&quot;fileSize\&quot;: \&quot;12.26 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: false}, {\&quot;file\&quot;: \&quot;js/\&quot;, \&quot;fileType\&quot;: \&quot;directory\&quot;, \&quot;subItemCnt\&quot;: 17}, {\&quot;file\&quot;: \&quot;test_email.html\&quot;, \&quot;fileSize\&quot;: \&quot;10.88 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: false}, {\&quot;file\&quot;: \&quot;training materials memo.docx\&quot;, \&quot;fileSize\&quot;: \&quot;1016.61 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: true}]&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668400,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:122,&quot;prompt_tokens&quot;:103943,&quot;total_tokens&quot;:104065,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:102750,&quot;cache_write_tokens&quot;:1186},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668400,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_START&quot;,&quot;timestamp&quot;:1762668414,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_2oLg9vupQtOOo-sSbUOQJw&quot;,&quot;name&quot;:&quot;list_dir&quot;,&quot;display_name&quot;:&quot;查找目录&quot;,&quot;render_type&quot;:&quot;ListItems&quot;,&quot;default_show&quot;:false,&quot;need_result&quot;:true},&quot;toolCallId&quot;:&quot;tooluse_2oLg9vupQtOOo-sSbUOQJw&quot;,&quot;toolCallName&quot;:&quot;list_dir&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_ARGS&quot;,&quot;timestamp&quot;:1762668414,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_2oLg9vupQtOOo-sSbUOQJw&quot;,&quot;document&quot;:{&quot;path&quot;:&quot;E:/Projects/Pitch_Training/js&quot;,&quot;sub_content&quot;:&quot;js&quot;,&quot;sub_content_tip&quot;:&quot;E:/Projects/Pitch_Training/js&quot;}},&quot;toolCallId&quot;:&quot;tooluse_2oLg9vupQtOOo-sSbUOQJw&quot;,&quot;delta&quot;:&quot;{\&quot;explanation\&quot;: \&quot;检查js文件夹中的文件\&quot;, \&quot;path\&quot;: \&quot;E:/Projects/Pitch_Training/js\&quot;}&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_END&quot;,&quot;timestamp&quot;:1762668414,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_2oLg9vupQtOOo-sSbUOQJw&quot;},&quot;toolCallId&quot;:&quot;tooluse_2oLg9vupQtOOo-sSbUOQJw&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TOOL_CALL_RESULT&quot;,&quot;timestamp&quot;:1762668414,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;tool_call_id&quot;:&quot;tooluse_2oLg9vupQtOOo-sSbUOQJw&quot;,&quot;result&quot;:{&quot;items&quot;:[{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;emailConfig.js&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/js/emailConfig.js&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/js/emailConfig.js&quot;,&quot;suffix_content&quot;:&quot;2.21 KB&quot;},{&quot;item_type&quot;:&quot;file&quot;,&quot;content&quot;:&quot;emailService.js&quot;,&quot;item_click_event&quot;:&quot;open_editor&quot;,&quot;item_click_value&quot;:&quot;E:/Projects/Pitch_Training/js/emailService.js&quot;,&quot;content_tip&quot;:&quot;E:/Projects/Pitch_Training/js/emailService.js&quot;,&quot;suffix_content&quot;:&quot;10.79 KB&quot;}]},&quot;suffix_content&quot;:&quot;找到2个结果&quot;,&quot;suffix_content_tip&quot;:&quot;找到2个结果&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;toolCallId&quot;:&quot;tooluse_2oLg9vupQtOOo-sSbUOQJw&quot;,&quot;content&quot;:&quot;[{\&quot;file\&quot;: \&quot;emailConfig.js\&quot;, \&quot;fileSize\&quot;: \&quot;2.21 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: false}, {\&quot;file\&quot;: \&quot;emailService.js\&quot;, \&quot;fileSize\&quot;: \&quot;10.79 KB\&quot;, \&quot;fileType\&quot;: \&quot;file\&quot;, \&quot;isBigFile\&quot;: false}]&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668414,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:89,&quot;prompt_tokens&quot;:104750,&quot;total_tokens&quot;:104839,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:103936,&quot;cache_write_tokens&quot;:807},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_STARTED&quot;,&quot;timestamp&quot;:1762668415,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_START&quot;,&quot;timestamp&quot;:1762668433,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;role&quot;:&quot;assistant&quot;}" />
                    <option value="{&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;content&quot;:&quot;太好了！所有文件都已成功创建。现在让我创建一个总结文档：\n\n## ✅ 完成！邮件发送功能已成功集成\n\n我已经为您的实验系统成功集成了EmailJS邮件发送功能。以下是完成的工作：\n\n###  创建的文件\n\n1. **`js/emailService.js`** (10.79 KB)\n   - 封装的邮件服务模块\n   - 支持自动生成CSV内容\n   - 将CSV转换为Base64附件\n   - 提供完整的错误处理\n\n2. **`js/emailConfig.js`** (2.21 KB)\n   - EmailJS配置文件\n   - 包含详细的设置说明\n   - 需要您填写EmailJS参数\n\n3. **`test_email.html`** (10.88 KB)\n   - 邮件功能测试页面\n   - 可视化配置检查\n   - 实时日志显示\n\n4. **`EMAIL_SETUP_README.md`** (5.21 KB)\n   - 详细的配置和使用说明\n   - 常见问题解答\n   - 故障排除指南\n\n5. **`QUICK_START.md`** (2.24 KB)\n   - 5分钟快速配置指南\n   - 简化的步骤说明\n\n###  修改的文件\n\n已为以下6个实验HTML文件添加了邮件发送功能：\n\n1. ✅ **ABX_falling_low.html** (60.82 KB)\n2. ✅ **ABX_falling_high.html** (60.85 KB)\n3. ✅ **ABX_rising_low.html** (60.79 KB)\n4. ✅ **ABX_rising_high.html** (60.83 KB)\n5. ✅ **ABX_level_low.html** (68.98 KB)\n6. ✅ **ABX_level_high.html** (69.05 KB)\n\n每个文件都已添加：\n- EmailJS库引用\n- 邮件配置和服务脚本引用\n- 实验完成后自动发送邮件的代码\n\n###  功能特点\n\n✅ **自动发送** - 实验完成后自动发送，无需用户确认  \n✅ **CSV附件** - 完整的实验数据作为CSV附件  \n✅ **固定收件人** - 发送到配置文件中指定的邮箱  \n✅ **详细摘要** - 邮件正文包含关键指标摘要  \n✅ **错误处理** - 完善的错误提示和日志记录  \n✅ **可复用** - 所有实验文件共享同一个邮件服务模块  \n\n###  下一步操作\n\n1. **配置EmailJS**（必需）\n   - 按照 `QUICK_START.md` 的步骤注册和配置EmailJS\n   - 在 `js/emailConfig.js` 中填写您的配置信息\n\n2. **测试功能**（推荐）\n   - 在浏览器中打开 `test_email.html`\n   - 点击\&quot;发送测试邮件\&quot;按钮\n   - 检查收件箱确认邮件接收\n\n3. **运行实验**\n   - 打开任意实验HTML文件\n   - 完成实验\n   - 系统会自动发送结果到指定邮箱\n\n###  邮件内容示例\n\n**邮件主题：**\n```\n实验结果 - Low Falling Tone Discrimination (ABX) - 2025-11-09 13:59:23\n```\n\n**邮件正文：**\n```\n您好，\n\n以下是实验结果的详细信息：\n\n实验类型：Low Falling Tone Discrimination (ABX)\n完成时间：2025-11-09 13:59:23\n总试验次数：25\n总反转次数：8\nJND 值：45.50 ms\n准确率：84.0% (21/25)\n平均反应时间：1250 ms\n\n结果摘要：\nJND: 45.50 ms\nJND Percentage: 11.38%\nAccuracy: 84.0% (21/25)\nMean RT: 1250 ms\n\n详细数据请查看附件 CSV 文件。\n\n此邮件由实验系统自动发送。\n```\n\n**附件：**\n- `experiment_results_Low_Falling_Tone_2025-11-09T13-59-23.csv`\n\n###  安全提示\n\n- EmailJS的Public Key可以暴露在前端代码中\n- 建议在EmailJS控制台设置域名白名单\n- 不要将配置文件提交到公开的代码仓库\n- 定期检查EmailJS账户的使用情况\n\n###  使用提示\n\n- **免费版限制**：每月200封邮件\n- **发送时机**：实验完成并计算出结果后自动发送\n- **网络要求**：需要互联网连接\n- **浏览器兼容**：支持所有现代浏览器\n\n###  文档说明\n\n- **快速开始**：查看 `QUICK_START.md`\n- **详细说明**：查看 `EMAIL_SETUP_README.md`\n- **测试工具**：使用 `test_email.html`\n\n---\n\n**祝您使用愉快！如有任何问题，请参考文档或查看浏览器控制台的日志信息。** &quot;},&quot;timestamp&quot;:1762668433,&quot;type&quot;:&quot;TEXT_MESSAGE_CONTENT&quot;}" />
                    <option value="{&quot;type&quot;:&quot;TEXT_MESSAGE_END&quot;,&quot;timestamp&quot;:1762668440,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;messageId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                    <option value="{&quot;type&quot;:&quot;STEP_FINISHED&quot;,&quot;timestamp&quot;:1762668441,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;step_name&quot;:&quot;call_llm&quot;,&quot;token_usage&quot;:{&quot;completion_tokens&quot;:1567,&quot;prompt_tokens&quot;:105072,&quot;total_tokens&quot;:106639,&quot;completion_tokens_details&quot;:{&quot;accepted_prediction_tokens&quot;:null,&quot;audio_tokens&quot;:null,&quot;reasoning_tokens&quot;:0,&quot;rejected_prediction_tokens&quot;:null},&quot;prompt_tokens_details&quot;:{&quot;audio_tokens&quot;:null,&quot;cached_tokens&quot;:104743,&quot;cache_write_tokens&quot;:322},&quot;cache_creation_input_tokens&quot;:0,&quot;cache_read_input_tokens&quot;:0}},&quot;stepName&quot;:&quot;call_llm&quot;}" />
                    <option value="{&quot;type&quot;:&quot;RUN_FINISHED&quot;,&quot;timestamp&quot;:1762668441,&quot;rawEvent&quot;:{&quot;message_id&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;,&quot;conversation_id&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;},&quot;threadId&quot;:&quot;019a672a3a327cbb89ed4d8625aa320a&quot;,&quot;runId&quot;:&quot;019a6732969a7fb6ab788be3ee9cfce5&quot;}" />
                  </list>
                </option>
                <option name="answer" value="" />
                <option name="chatMode" value="AGENT" />
                <option name="chatResource" value="user" />
                <option name="codeReferences">
                  <list>
                    <CodeReferencesBean>
                      <option name="content" value="" />
                      <option name="filename" value="ABX_falling_high.html" />
                      <option name="language" value="HTML" />
                      <option name="range">
                        <CommitRange>
                          <option name="dontDisplayRange" value="true" />
                          <option name="dontSelectByRange" value="true" />
                          <option name="end">
                            <Position />
                          </option>
                          <option name="start">
                            <Position />
                          </option>
                        </CommitRange>
                      </option>
                      <option name="type" value="full_file" />
                      <option name="url" value="file:///E:/Projects/Pitch_Training/ABX_falling_high.html" />
                    </CodeReferencesBean>
                    <CodeReferencesBean>
                      <option name="content" value="" />
                      <option name="filename" value="ABX_rising_low.html" />
                      <option name="language" value="HTML" />
                      <option name="range">
                        <CommitRange>
                          <option name="dontDisplayRange" value="true" />
                          <option name="dontSelectByRange" value="true" />
                          <option name="end">
                            <Position />
                          </option>
                          <option name="start">
                            <Position />
                          </option>
                        </CommitRange>
                      </option>
                      <option name="type" value="full_file" />
                      <option name="url" value="file:///E:/Projects/Pitch_Training/ABX_rising_low.html" />
                    </CodeReferencesBean>
                    <CodeReferencesBean>
                      <option name="content" value="" />
                      <option name="filename" value="ABX_level_high.html" />
                      <option name="language" value="HTML" />
                      <option name="range">
                        <CommitRange>
                          <option name="dontDisplayRange" value="true" />
                          <option name="dontSelectByRange" value="true" />
                          <option name="end">
                            <Position />
                          </option>
                          <option name="start">
                            <Position />
                          </option>
                        </CommitRange>
                      </option>
                      <option name="type" value="full_file" />
                      <option name="url" value="file:///E:/Projects/Pitch_Training/ABX_level_high.html" />
                    </CodeReferencesBean>
                    <CodeReferencesBean>
                      <option name="content" value="" />
                      <option name="filename" value="ABX_falling_low.html" />
                      <option name="language" value="HTML" />
                      <option name="range">
                        <CommitRange>
                          <option name="dontDisplayRange" value="true" />
                          <option name="dontSelectByRange" value="true" />
                          <option name="end">
                            <Position />
                          </option>
                          <option name="start">
                            <Position />
                          </option>
                        </CommitRange>
                      </option>
                      <option name="type" value="full_file" />
                      <option name="url" value="file:///E:/Projects/Pitch_Training/ABX_falling_low.html" />
                    </CodeReferencesBean>
                    <CodeReferencesBean>
                      <option name="content" value="" />
                      <option name="filename" value="ABX_level_low.html" />
                      <option name="language" value="HTML" />
                      <option name="range">
                        <CommitRange>
                          <option name="dontDisplayRange" value="true" />
                          <option name="dontSelectByRange" value="true" />
                          <option name="end">
                            <Position />
                          </option>
                          <option name="start">
                            <Position />
                          </option>
                        </CommitRange>
                      </option>
                      <option name="type" value="full_file" />
                      <option name="url" value="file:///E:/Projects/Pitch_Training/ABX_level_low.html" />
                    </CodeReferencesBean>
                    <CodeReferencesBean>
                      <option name="content" value="" />
                      <option name="filename" value="ABX_rising_high.html" />
                      <option name="language" value="HTML" />
                      <option name="range">
                        <CommitRange>
                          <option name="dontDisplayRange" value="true" />
                          <option name="dontSelectByRange" value="true" />
                          <option name="end">
                            <Position />
                          </option>
                          <option name="start">
                            <Position />
                          </option>
                        </CommitRange>
                      </option>
                      <option name="type" value="full_file" />
                      <option name="url" value="file:///E:/Projects/Pitch_Training/ABX_rising_high.html" />
                    </CodeReferencesBean>
                  </list>
                </option>
                <option name="command" value="normal" />
                <option name="commitId">
                  <list>
                    <option value="478a7f4413208062924812a3658503bacc325f9e" />
                    <option value="8b856a7bbf4cc14f96cd8c413fb83be1b57ca0d1" />
                    <option value="9a663e2febf34afa4e851d4a45fa9bea92e16aa3" />
                    <option value="9d1df328cbcbbec1e052f220957664d550cf944e" />
                    <option value="3c1661908f746182e0f679f4dc1c4e8799c21e1c" />
                    <option value="42362690be99de72b2b50da6acf163fc92215403" />
                    <option value="e6d9eaf28bbc9a0b19e49b4672fde05009a11cbc" />
                    <option value="cb39547a33fd2f0043b20cdb18de7bea9f18e6b3" />
                    <option value="9199c05b500e2a273afb7dd65701ad050af3a29a" />
                    <option value="b34db95e18f80f0a0c910c5b3541a7cfc118dbef" />
                    <option value="fd3733f7949a7d0c2c55b531a29c31b4fecdad26" />
                    <option value="4b47b6cd92b36ec71ff387cd0958283c30744158" />
                    <option value="323a84df5222bea0809854f5c6f3dd21247a02b9" />
                    <option value="0c4fe542914dbee5a4b5513e0a4cd086a600e09a" />
                    <option value="e180deb5c7d627ffce73169303a715b8a3565562" />
                    <option value="22f3aecadbbc39d42c6df8bc9cb07cb210e58164" />
                    <option value="3a3a752466abbf1a62020a714128006fb3ee6def" />
                    <option value="fa48b9b24a884f67d9112487972a5765d84fbcec" />
                    <option value="9ec3e088f9c9d3631b423485bdcd24e478db1ea9" />
                    <option value="ce4219770d488ca976bb5b90ee09accfacfc4184" />
                    <option value="b8eb97b1ce5a3d215d0f6b6f510ea3850b734250" />
                    <option value="c9719aef9dac9de1a23cb8962542356268411ff8" />
                    <option value="034bd9b714c1ea0e813b9719ec009ff7a7f45ce0" />
                    <option value="af18f3bbbbdc478e855531232781f0193db47757" />
                  </list>
                </option>
                <option name="conversationId" value="019a672a3a327cbb89ed4d8625aa320a" />
                <option name="historyDocumentMap">
                  <map>
                    <entry key="file:///E:/Projects/Pitch_Training/ABX_falling_high.html" value="&lt;!DOCTYPE html&gt;&#10;&lt;html&gt;&#10;&lt;head&gt;&#10;    &lt;title&gt;PLOYU-Peng's Lab: Pitch Sensitivity Training&lt;/title&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;style&gt;&#10;        body {&#10;            font-family: Arial, sans-serif;&#10;            margin: 20px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .container {&#10;            max-width: 800px;&#10;            margin: 0 auto;&#10;            padding: 20px;&#10;            background-color: white;&#10;            border-radius: 10px;&#10;            box-shadow: 0 0 10px rgba(0,0,0,0.1);&#10;            display: flex;&#10;            flex-direction: column;&#10;            align-items: center;&#10;        }&#10;        .header {&#10;            text-align: center;&#10;            margin-bottom: 40px;&#10;            width: 100%;&#10;        }&#10;        .training-info {&#10;            font-size: 16px;&#10;            color: #555;&#10;            margin-top: 10px;&#10;            margin-bottom: 5px;&#10;            text-align: center;&#10;        }&#10;        .instruction-text {&#10;            font-size: 14px;&#10;            color: #777;&#10;            margin-bottom: 15px;&#10;            text-align: center;&#10;            font-style: italic;&#10;        }&#10;        .button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .prompt-text {&#10;            text-align: center;&#10;            font-size: 20px;&#10;            margin-bottom: 25px;&#10;            margin-top: 30px;&#10;            font-weight: bold;&#10;        }&#10;        .response-button {&#10;            width: 160px;&#10;            height: 160px;&#10;            font-size: 26px;&#10;            margin: 0 40px;&#10;            border-radius: 15px;&#10;            border: none;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.1);&#10;            transition: all 0.3s ease;&#10;        }&#10;        .response-button:hover:enabled {&#10;            transform: translateY(-3px);&#10;            box-shadow: 0 6px 12px rgba(0,0,0,0.15);&#10;        }&#10;        .response-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .button-playing {&#10;            animation: pulse 1s ease-in-out infinite;&#10;            box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            transform: scale(1.05);&#10;        }&#10;        @keyframes pulse {&#10;            0%, 100% {&#10;                box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            }&#10;            50% {&#10;                box-shadow: 0 0 30px rgba(102, 204, 255, 1);&#10;            }&#10;        }&#10;        .control-button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            gap: 30px;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .control-button {&#10;            padding: 14px 28px;&#10;            font-size: 18px;&#10;            border-radius: 8px;&#10;            border: none;&#10;            background-color: #4CAF50;&#10;            color: white;&#10;            cursor: pointer;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .control-button:hover:enabled {&#10;            background-color: #3e8e41;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .control-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .control-button:disabled {&#10;            background-color: #cccccc;&#10;            cursor: not-allowed;&#10;            box-shadow: none;&#10;        }&#10;        .feedback {&#10;            text-align: center;&#10;            height: 100px;&#10;            margin: 30px 0;&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;        }&#10;        .status {&#10;            width: 350px;&#10;            height: 68px;&#10;            text-align: center;&#10;            font-size: 18px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            margin: 0 auto;&#10;            padding: 10px;&#10;            background-color: #f9f9f9;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.05);&#10;        }&#10;        .debug-info {&#10;            font-size: 12px;&#10;            color: #777;&#10;            margin-top: 30px;&#10;            text-align: left;&#10;            display: none;&#10;            max-height: 300px;&#10;            overflow-y: auto;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            padding: 15px;&#10;            width: 100%;&#10;        }&#10;        .results-container {&#10;            display: none;&#10;            margin-top: 30px;&#10;            padding: 20px;&#10;            background-color: #f0f8ff;&#10;            border-radius: 8px;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.1);&#10;            width: 100%;&#10;        }&#10;        .result-heading {&#10;            text-align: center;&#10;            margin-bottom: 20px;&#10;            color: #2c3e50;&#10;        }&#10;        .result-table {&#10;            width: 100%;&#10;            border-collapse: collapse;&#10;            margin-bottom: 20px;&#10;        }&#10;        .result-table th, .result-table td {&#10;            padding: 12px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .result-table th {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .result-table tr:nth-child(even) {&#10;            background-color: #f2f2f2;&#10;        }&#10;        .result-interpretation {&#10;            background-color: #e8f4f8;&#10;            padding: 15px;&#10;            border-radius: 5px;&#10;            margin-bottom: 20px;&#10;        }&#10;        .back-button {&#10;            display: block;&#10;            margin: 0 auto;&#10;            padding: 14px 28px;&#10;            background-color: #3498db;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .back-button:hover {&#10;            background-color: #2980b9;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .back-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        .chart-container {&#10;            height: 300px;&#10;            margin: 20px 0;&#10;            background-color: white;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;            padding: 10px;&#10;        }&#10;        .auxiliary-buttons {&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            margin-top: 30px;&#10;            gap: 20px;&#10;            flex-wrap: wrap;&#10;        }&#10;        .auxiliary-buttons button {&#10;            padding: 10px 15px;&#10;            border-radius: 5px;&#10;            border: 1px solid #ddd;&#10;            background-color: #f0f0f0;&#10;            cursor: pointer;&#10;            transition: all 0.2s ease;&#10;        }&#10;        .auxiliary-buttons button:hover {&#10;            background-color: #e0e0e0;&#10;        }&#10;        .diagnostic-overlay {&#10;            position: fixed;&#10;            top: 0;&#10;            left: 0;&#10;            width: 100%;&#10;            height: 100%;&#10;            background-color: rgba(0, 0, 0, 0.8);&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            z-index: 1000;&#10;            display: none;&#10;        }&#10;        .diagnostic-content {&#10;            width: 80%;&#10;            max-width: 700px;&#10;            max-height: 80%;&#10;            overflow-y: auto;&#10;            background-color: white;&#10;            padding: 20px;&#10;            border-radius: 8px;&#10;            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);&#10;        }&#10;        .diagnostic-heading {&#10;            text-align: center;&#10;            color: #e74c3c;&#10;            margin-bottom: 20px;&#10;            font-size: 24px;&#10;        }&#10;        .diagnostic-close {&#10;            float: right;&#10;            font-size: 20px;&#10;            cursor: pointer;&#10;            color: #777;&#10;        }&#10;        .diagnostic-close:hover {&#10;            color: #333;&#10;        }&#10;        .diagnostic-section {&#10;            margin-bottom: 15px;&#10;            padding: 10px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;        }&#10;        .diagnostic-actions {&#10;            text-align: center;&#10;            margin-top: 20px;&#10;        }&#10;        .diagnostic-action-button {&#10;            padding: 10px 20px;&#10;            margin: 0 10px;&#10;            border: none;&#10;            border-radius: 5px;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;        }&#10;        .retry-button {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .retry-button:hover {&#10;            background-color: #2980b9;&#10;        }&#10;        .continue-button {&#10;            background-color: #2ecc71;&#10;            color: white;&#10;        }&#10;        .continue-button:hover {&#10;            background-color: #27ae60;&#10;        }&#10;        .diagnostic-file-status {&#10;            display: flex;&#10;            flex-wrap: wrap;&#10;            gap: 10px;&#10;        }&#10;        .file-status-item {&#10;            font-size: 12px;&#10;            padding: 5px 10px;&#10;            border-radius: 3px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .file-found {&#10;            color: #27ae60;&#10;            border-left: 3px solid #27ae60;&#10;        }&#10;        .file-missing {&#10;            color: #e74c3c;&#10;            border-left: 3px solid #e74c3c;&#10;        }&#10;        .statistics-table {&#10;            width: 100%;&#10;            margin: 10px 0;&#10;            border-collapse: collapse;&#10;        }&#10;        .statistics-table th, .statistics-table td {&#10;            padding: 8px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .statistics-table th {&#10;            background-color: #f0f0f0;&#10;        }&#10;        .direction-stats-good {&#10;            color: #27ae60;&#10;        }&#10;        .direction-stats-warning {&#10;            color: #f39c12;&#10;        }&#10;        .direction-stats-bad {&#10;            color: #e74c3c;&#10;        }&#10;        @media (max-width: 600px) {&#10;            .response-button {&#10;                width: 130px;&#10;                height: 130px;&#10;                font-size: 22px;&#10;                margin: 0 20px;&#10;            }&#10;            .control-button {&#10;                padding: 12px 20px;&#10;            }&#10;        }&#10;        .print-button {&#10;            padding: 14px 28px;&#10;            margin: 20px auto;&#10;            background-color: #9b59b6;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;            display: block;&#10;        }&#10;        .print-button:hover {&#10;            background-color: #8e44ad;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .print-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        @media print {&#10;            body {&#10;                background-color: white;&#10;                margin: 0;&#10;                padding: 0;&#10;            }&#10;            .container {&#10;                max-width: 100%;&#10;                box-shadow: none;&#10;                padding: 10px;&#10;            }&#10;            .back-button, .print-button, .auxiliary-buttons {&#10;                display: none;&#10;            }&#10;            .results-container {&#10;                display: block !important;&#10;                box-shadow: none;&#10;                background-color: white;&#10;                padding: 0;&#10;            }&#10;            .chart-container {&#10;                border: 1px solid #ddd;&#10;                background-color: white;&#10;            }&#10;            .result-table th {&#10;                background-color: #f0f0f0 !important;&#10;                color: black !important;&#10;            }&#10;            .result-interpretation {&#10;                background-color: white;&#10;                border: 1px solid #ddd;&#10;            }&#10;            * {&#10;                -webkit-print-color-adjust: exact !important;&#10;                print-color-adjust: exact !important;&#10;            }&#10;        }&#10;        .progress-bar-container {&#10;            width: 100%;&#10;            height: 20px;&#10;            background-color: #e0e0e0;&#10;            border-radius: 10px;&#10;            margin: 10px 0;&#10;            overflow: hidden;&#10;        }&#10;        .progress-bar {&#10;            height: 100%;&#10;            background-color: #4CAF50;&#10;            border-radius: 10px;&#10;            transition: width 0.3s ease;&#10;        }&#10;        .progress-label {&#10;            text-align: center;&#10;            font-size: 14px;&#10;            color: #555;&#10;            margin-top: 5px;&#10;        }&#10;        .highlight-box {&#10;            background-color: #fffacd;&#10;            border: 2px solid #ffd700;&#10;            padding: 15px;&#10;            border-radius: 8px;&#10;            margin: 20px 0;&#10;            text-align: center;&#10;        }&#10;        .highlight-value {&#10;            font-size: 28px;&#10;            font-weight: bold;&#10;            color: #e74c3c;&#10;            margin: 10px 0;&#10;        }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;div class=&quot;container&quot;&gt;&#10;        &lt;div class=&quot;header&quot;&gt;&#10;            &lt;img src=&quot;Media/animation.gif&quot; alt=&quot;Experiment animation&quot;&gt;&#10;            &lt;div class=&quot;training-info&quot;&gt;High Falling Tone Discrimination (ABX)&lt;/div&gt;&#10;            &lt;div class=&quot;instruction-text&quot;&gt;請判斷第三個音聽起來更像第一個還是第二個音&lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div id=&quot;experimentContainer&quot;&gt;&#10;            &lt;div class=&quot;control-button-container&quot;&gt;&#10;                &lt;input id=&quot;start&quot; type=&quot;button&quot; value=&quot;開始實驗&quot; onclick=&quot;start_onclick()&quot; class=&quot;control-button&quot;&gt;&#10;                &lt;input id=&quot;viewResult&quot; type=&quot;button&quot; value=&quot;查看結果&quot; onclick=&quot;view_onclick()&quot; class=&quot;control-button&quot; disabled&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;prompt-text&quot; id=&quot;promptText&quot;&gt;&#10;                第三個音更像...&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;firstBtn&quot; type=&quot;button&quot; value=&quot;第一個音&quot; onclick=&quot;processAnswer(1)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;                &lt;input id=&quot;secondBtn&quot; type=&quot;button&quot; value=&quot;第二個音&quot; onclick=&quot;processAnswer(2)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;feedback&quot;&gt;&#10;                &lt;img id=&quot;smile&quot; src=&quot;Media/null.gif&quot; width=&quot;100&quot; height=&quot;84&quot; alt=&quot;Feedback&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;text1&quot; class=&quot;status&quot; readonly&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;progress-bar-container&quot;&gt;&#10;                &lt;div class=&quot;progress-bar&quot; id=&quot;progressBar&quot; style=&quot;width: 0%&quot;&gt;&lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;progress-label&quot; id=&quot;progressLabel&quot;&gt;Progress: 0%&lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;debug-info&quot; id=&quot;debugInfo&quot;&gt;&#10;                Debug information will be displayed here&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot;&gt;&#10;                &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;showDebug&quot; onclick=&quot;toggleDebug()&quot;&gt; Show Debug Info&lt;/label&gt;&#10;                &lt;button onclick=&quot;testAudio()&quot;&gt;Test All Audio&lt;/button&gt;&#10;                &lt;button onclick=&quot;showDiagnostics()&quot;&gt;Diagnostics&lt;/button&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot; id=&quot;exportBtn&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div id=&quot;resultsContainer&quot; class=&quot;results-container&quot;&gt;&#10;            &lt;h2 class=&quot;result-heading&quot;&gt;Dynamic Pitch Discrimination Test Results (ABX)&lt;/h2&gt;&#10;            &#10;            &lt;div class=&quot;highlight-box&quot;&gt;&#10;                &lt;h3 style=&quot;margin-top: 0;&quot;&gt;Just Noticeable Difference (JND)&lt;/h3&gt;&#10;                &lt;div class=&quot;highlight-value&quot; id=&quot;jndValue&quot;&gt;--&lt;/div&gt;&#10;                &lt;p style=&quot;margin-bottom: 0; font-size: 14px; color: #666;&quot;&gt;&#10;                    This represents the minimum detectable difference in modulation window duration&lt;br&gt;&#10;                    &lt;strong&gt;Smaller JND = Better discrimination ability&lt;/strong&gt;&#10;                &lt;/p&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Perceptual Discrimination Thresholds&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Parameter&lt;/th&gt;&#10;                        &lt;th&gt;Standard (Reference)&lt;/th&gt;&#10;                        &lt;th&gt;Threshold (Your JND)&lt;/th&gt;&#10;                        &lt;th&gt;Difference Ratio&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;resultTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;div class=&quot;result-interpretation&quot; id=&quot;resultInterpretation&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Detailed Threshold Metrics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Metric&lt;/th&gt;&#10;                        &lt;th&gt;Value&lt;/th&gt;&#10;                        &lt;th&gt;Interpretation&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;detailedMetricsBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;h3&gt;Performance Statistics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Metric&lt;/th&gt;&#10;                        &lt;th&gt;Value&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;performanceStatsBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;button class=&quot;print-button&quot; onclick=&quot;printResults()&quot;&gt;Print Results&lt;/button&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot; style=&quot;margin-top: 20px;&quot;&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;button class=&quot;back-button&quot; onclick=&quot;backToExperiment()&quot;&gt;Back to Experiment&lt;/button&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div class=&quot;diagnostic-overlay&quot; id=&quot;diagnosticOverlay&quot;&gt;&#10;            &lt;div class=&quot;diagnostic-content&quot;&gt;&#10;                &lt;span class=&quot;diagnostic-close&quot; onclick=&quot;closeDiagnostics()&quot;&gt;&amp;times;&lt;/span&gt;&#10;                &lt;h2 class=&quot;diagnostic-heading&quot;&gt;Experiment Diagnostics&lt;/h2&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Test Status&lt;/h3&gt;&#10;                    &lt;table class=&quot;statistics-table&quot;&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;th&gt;Trials&lt;/th&gt;&#10;                            &lt;th&gt;Reversals&lt;/th&gt;&#10;                            &lt;th&gt;Status&lt;/th&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td id=&quot;totalTrials&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;totalReversals&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;testStatus&quot;&gt;Not started&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                    &lt;/table&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Audio Files Check&lt;/h3&gt;&#10;                    &lt;p&gt;Verifying necessary audio files:&lt;/p&gt;&#10;                    &lt;div id=&quot;audioFileStatus&quot; class=&quot;diagnostic-file-status&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Reversal History&lt;/h3&gt;&#10;                    &lt;div id=&quot;reversalHistory&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Recommendations&lt;/h3&gt;&#10;                    &lt;div id=&quot;diagnosticRecommendations&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-actions&quot;&gt;&#10;                    &lt;button class=&quot;diagnostic-action-button continue-button&quot; onclick=&quot;closeDiagnostics()&quot;&gt;Close&lt;/button&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;audio id=&quot;high_falling_standard&quot; src=&quot;Media/high_falling_standard.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;    &lt;audio id=&quot;high_falling_1&quot; src=&quot;Media/high_falling_1.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_falling_2&quot; src=&quot;Media/high_falling_2.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_falling_3&quot; src=&quot;Media/high_falling_3.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_falling_4&quot; src=&quot;Media/high_falling_4.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_falling_5&quot; src=&quot;Media/high_falling_5.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_falling_6&quot; src=&quot;Media/high_falling_6.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_falling_7&quot; src=&quot;Media/high_falling_7.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_falling_8&quot; src=&quot;Media/high_falling_8.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_falling_9&quot; src=&quot;Media/high_falling_9.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;&lt;script&gt;&#10;function getLocalTimestamp() {&#10;    const now = new Date();&#10;    const year = now.getFullYear();&#10;    const month = String(now.getMonth() + 1).padStart(2, '0');&#10;    const day = String(now.getDate()).padStart(2, '0');&#10;    const hours = String(now.getHours()).padStart(2, '0');&#10;    const minutes = String(now.getMinutes()).padStart(2, '0');&#10;    const seconds = String(now.getSeconds()).padStart(2, '0');&#10;    const milliseconds = String(now.getMilliseconds()).padStart(3, '0');&#10;    &#10;    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;&#10;}&#10;&#10;// Stimulus parameters for dynamic pitch modulation&#10;const STIMULUS_DURATION = 450; // ms, total duration&#10;const STANDARD_WINDOW = 400; // ms, modulation window for standard (100%)&#10;const STANDARD_WINDOW_PERCENT = 100; // percentage&#10;&#10;// Modulation window percentages for each difficulty level&#10;const MODULATION_WINDOWS = {&#10;    1: 20,   // easiest - 20% of standard window (80 ms)&#10;    2: 40,   // 160 ms&#10;    3: 50,   // 200 ms&#10;    4: 60,   // 240 ms&#10;    5: 70,   // 280 ms&#10;    6: 80,   // 320 ms&#10;    7: 90,   // 360 ms&#10;    8: 95,   // 380 ms&#10;    9: 98    // hardest - 98% of standard window (392 ms)&#10;};&#10;&#10;function getModulationWindowDuration(level) {&#10;    return (MODULATION_WINDOWS[level] / 100) * STANDARD_WINDOW;&#10;}&#10;&#10;const PITCH_FALL_SEMITONES = 1.0;&#10;&#10;function getModulationRate(level) {&#10;    const windowDuration = getModulationWindowDuration(level);&#10;    const windowDurationSec = windowDuration / 1000;&#10;    return PITCH_FALL_SEMITONES / windowDurationSec;&#10;}&#10;&#10;function getModulationSlope(level) {&#10;    const windowDuration = getModulationWindowDuration(level);&#10;    return PITCH_FALL_SEMITONES / windowDuration;&#10;}&#10;&#10;// Adaptive threshold experiment constants&#10;const MAXREVERSALS = 10;&#10;const MAXITERATIONS = 50;&#10;const LOWERLIMIT = 1;&#10;const DECREASING = -1;&#10;const INCREASING = 1;&#10;const MINIMUMREVERSALS = 6;&#10;const THRESHOLD_REVERSAL_COUNT = 6;&#10;&#10;// Experiment state variables&#10;var CorrectAnswer;&#10;var CorrectResponses = 0;&#10;var Direction = DECREASING;&#10;var Reversals = [];&#10;var NumberOfReversals = 0;&#10;var currentLevel = 5;&#10;var numberOfIterations = 0;&#10;var sentAverage = 0.0;&#10;var sentStdev = 0.0;&#10;var isTestComplete = false;&#10;var audioUnlocked = false;&#10;var allFilesPresent = true;&#10;var trialRecords = [];&#10;var stimulusEndTime = 0;&#10;&#10;// ABX variables&#10;var standardIsFirst;&#10;var comparisonSound;&#10;var standardSound;&#10;var xSound;&#10;&#10;var isReplayTrial = false;&#10;&#10;// Results variables - JND-based&#10;var jndAbsoluteDifference = 0;&#10;var jndRatio = 0;&#10;var jndPercentDifference = 0;&#10;var thresholdWindowDuration = 0;&#10;var thresholdWindowPercent = 0;&#10;var thresholdModulationRate = 0;&#10;var thresholdSlope = 0;&#10;var webersRatio = 0;&#10;&#10;function printResults() {&#10;    window.print();&#10;}&#10;&#10;function logDebug(message) {&#10;    console.log(message);&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var now = new Date();&#10;    var timeStr = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + '.' + now.getMilliseconds();&#10;    debugArea.innerHTML += '&lt;p&gt;[' + timeStr + '] ' + message + '&lt;/p&gt;';&#10;    debugArea.scrollTop = debugArea.scrollHeight;&#10;}&#10;&#10;function toggleDebug() {&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var checkbox = document.getElementById('showDebug');&#10;    debugArea.style.display = checkbox.checked ? 'block' : 'none';&#10;}&#10;&#10;function showDiagnostics() {&#10;    updateDiagnostics();&#10;    document.getElementById('diagnosticOverlay').style.display = 'flex';&#10;}&#10;&#10;function closeDiagnostics() {&#10;    document.getElementById('diagnosticOverlay').style.display = 'none';&#10;}&#10;&#10;function updateDiagnostics() {&#10;    document.getElementById('totalTrials').innerText = numberOfIterations;&#10;    document.getElementById('totalReversals').innerText = NumberOfReversals;&#10;    &#10;    let testStatus = getTestStatus();&#10;    document.getElementById('testStatus').innerText = testStatus.text;&#10;    document.getElementById('testStatus').className = `direction-stats-${testStatus.class}`;&#10;    &#10;    checkAudioFiles();&#10;    &#10;    let reversalHistoryHtml = '';&#10;    if (Reversals.length === 0) {&#10;        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';&#10;    } else {&#10;        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals.join(', ') + '&lt;/p&gt;';&#10;        reversalHistoryHtml += '&lt;p&gt;Corresponding modulation windows: ';&#10;        reversalHistoryHtml += Reversals.map(level =&gt; MODULATION_WINDOWS[level] + '% (' + getModulationWindowDuration(level) + ' ms)').join(', ') + '&lt;/p&gt;';&#10;    }&#10;    &#10;    document.getElementById('reversalHistory').innerHTML = reversalHistoryHtml;&#10;    &#10;    generateDiagnosticRecommendations();&#10;}&#10;&#10;function getTestStatus() {&#10;    if (isTestComplete) {&#10;        return { text: &quot;Complete&quot;, class: &quot;good&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals &lt; 1) {&#10;        return { text: &quot;Not enough data&quot;, class: &quot;bad&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals &lt; MINIMUMREVERSALS) {&#10;        return { text: &quot;Incomplete (&quot; + NumberOfReversals + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals)&quot;, class: &quot;warning&quot; };&#10;    }&#10;    &#10;    return { text: &quot;In progress&quot;, class: &quot;good&quot; };&#10;}&#10;&#10;function checkAudioFiles() {&#10;    const requiredFiles = [&#10;        &quot;high_falling_standard&quot;,&#10;        &quot;high_falling_1&quot;, &quot;high_falling_2&quot;, &quot;high_falling_3&quot;, &quot;high_falling_4&quot;, &quot;high_falling_5&quot;, &#10;        &quot;high_falling_6&quot;, &quot;high_falling_7&quot;, &quot;high_falling_8&quot;, &quot;high_falling_9&quot;&#10;    ];&#10;    &#10;    let statusHtml = '';&#10;    allFilesPresent = true;&#10;    &#10;    requiredFiles.forEach(function(fileId) {&#10;        const audioElement = document.getElementById(fileId);&#10;        const fileFound = audioElement !== null;&#10;        &#10;        if (!fileFound) {&#10;            allFilesPresent = false;&#10;        }&#10;        &#10;        statusHtml += `&lt;div class=&quot;file-status-item ${fileFound ? 'file-found' : 'file-missing'}&quot;&gt;${fileId}: ${fileFound ? 'Found' : 'Missing'}&lt;/div&gt;`;&#10;    });&#10;    &#10;    document.getElementById('audioFileStatus').innerHTML = statusHtml;&#10;}&#10;&#10;function generateDiagnosticRecommendations() {&#10;    let recommendations = '';&#10;    let hasIssues = false;&#10;    &#10;    if (!allFilesPresent) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Critical Issue:&lt;/strong&gt; Some required audio files are missing. Please ensure all files are properly loaded.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (numberOfIterations &gt;= MAXITERATIONS &amp;&amp; NumberOfReversals &lt; MINIMUMREVERSALS) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Issue:&lt;/strong&gt; Reached maximum trials but has insufficient reversals. This might indicate audio file issues or participant response patterns.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (!hasIssues) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Good:&lt;/strong&gt; No major issues detected with the experiment setup.&lt;/p&gt;';&#10;        &#10;        if (isTestComplete) {&#10;            recommendations += '&lt;p&gt;Test is complete.&lt;/p&gt;';&#10;        } else {&#10;            recommendations += '&lt;p&gt;Test is still in progress.&lt;/p&gt;';&#10;        }&#10;    }&#10;    &#10;    document.getElementById('diagnosticRecommendations').innerHTML = recommendations;&#10;}&#10;&#10;function testAudio() {&#10;    logDebug(&quot;Starting to test all audio files...&quot;);&#10;    var audios = document.querySelectorAll('audio');&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    var index = 0;&#10;    function playNext() {&#10;        if (index &gt;= audios.length) {&#10;            logDebug(&quot;All audio testing complete!&quot;);&#10;            return;&#10;        }&#10;        &#10;        var audio = audios[index];&#10;        logDebug(&quot;Testing audio #&quot; + (index + 1) + &quot;: &quot; + audio.id);&#10;        &#10;        audio.currentTime = 0;&#10;        &#10;        var playPromise = audio.play();&#10;        if (playPromise !== undefined) {&#10;            playPromise.then(function() {&#10;                logDebug(audio.id + &quot; played successfully&quot;);&#10;                &#10;                audio.onended = function() {&#10;                    logDebug(audio.id + &quot; playback ended&quot;);&#10;                    index++;&#10;                    setTimeout(playNext, 500);&#10;                };&#10;            }).catch(function(error) {&#10;                logDebug(&quot;Failed to play &quot; + audio.id + &quot;: &quot; + error);&#10;                index++;&#10;                setTimeout(playNext, 500);&#10;            });&#10;        }&#10;    }&#10;    &#10;    playNext();&#10;}&#10;&#10;function unlockAudioContext() {&#10;    logDebug(&quot;Attempting to unlock audio context...&quot;);&#10;    &#10;    var silentAudio = new Audio();&#10;    silentAudio.src = &quot;data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA&quot;;&#10;    &#10;    var promise = silentAudio.play();&#10;    if (promise !== undefined) {&#10;        promise.then(function() {&#10;            logDebug(&quot;Audio context unlocked successfully&quot;);&#10;            silentAudio.remove();&#10;            audioUnlocked = true;&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to unlock audio context: &quot; + error);&#10;        });&#10;    }&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    for (var i = 0; i &lt; allAudios.length; i++) {&#10;        var audio = allAudios[i];&#10;        audio.load();&#10;    }&#10;    &#10;    logDebug(&quot;Preloaded &quot; + allAudios.length + &quot; audio files&quot;);&#10;}&#10;&#10;function resetPage() {&#10;    numberOfIterations++;&#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('firstBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('secondBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    if (isTestComplete) {&#10;        document.getElementById('start').disabled = false;&#10;        document.getElementById('viewResult').disabled = false;&#10;        document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;        updateProgressBar(100);&#10;        return;&#10;    }&#10;    &#10;    if ((numberOfIterations &gt;= MAXITERATIONS) || (NumberOfReversals &gt;= MAXREVERSALS)) {&#10;        if (NumberOfReversals &gt;= MINIMUMREVERSALS) {&#10;            calculateResults();&#10;            isTestComplete = true;&#10;            document.getElementById('start').disabled = false;&#10;            document.getElementById('viewResult').disabled = false;&#10;            document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;            updateProgressBar(100);&#10;        } else {&#10;            logDebug(&quot;Reached max iterations but has only &quot; + NumberOfReversals + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals. Showing diagnostics.&quot;);&#10;            document.getElementById('text1').value = &quot;Insufficient data. Check diagnostics.&quot;;&#10;            setTimeout(function() {&#10;                showDiagnostics();&#10;            }, 500);&#10;            return;&#10;        }&#10;    } else {&#10;        updateProgressBar();&#10;        beginIteration();&#10;    }&#10;}&#10;&#10;function updateProgressBar(forcePercent) {&#10;    if (typeof forcePercent === 'number') {&#10;        document.getElementById('progressBar').style.width = forcePercent + '%';&#10;        document.getElementById('progressLabel').textContent = 'Progress: ' + forcePercent + '%';&#10;        return;&#10;    }&#10;    &#10;    const maxValue = Math.max(MAXREVERSALS, MAXITERATIONS);&#10;    const currentValue = isTestComplete ? maxValue : Math.max(NumberOfReversals, numberOfIterations);&#10;    const totalPercent = Math.min(100 * (currentValue / maxValue), 100);&#10;    &#10;    document.getElementById('progressBar').style.width = totalPercent + '%';&#10;    document.getElementById('progressLabel').textContent = 'Progress: ' + Math.round(totalPercent) + '%';&#10;}&#10;&#10;function calculateResults() {&#10;    let sum = 0.0, stddevsum = 0.0, average = 0.0, stdev = 0.0, counter = 0;&#10;    &#10;    for (let i = 0; i &lt; Reversals.length; i++) {&#10;        if (Reversals[i] &gt; 0) counter++;&#10;    }&#10;    &#10;    if (counter &lt; MINIMUMREVERSALS) {&#10;        logDebug(&quot;Test has insufficient data&quot;);&#10;        alert(&quot;Test has insufficient data. Please complete the test again.&quot;);&#10;        return;&#10;    }&#10;    &#10;    const startIndex = Math.max(0, NumberOfReversals - THRESHOLD_REVERSAL_COUNT);&#10;    counter = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0) {&#10;            sum += level;&#10;            counter++;&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 0) {&#10;        average = sum / counter;&#10;        average = parseFloat(average.toFixed(2));&#10;    }&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0) {&#10;            stddevsum += Math.pow(level - average, 2);&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 1) {&#10;        stdev = Math.sqrt(stddevsum / (counter - 1));&#10;        stdev = parseFloat(stdev.toFixed(2));&#10;    }&#10;    &#10;    sentAverage = average;&#10;    sentStdev = stdev;&#10;    &#10;    thresholdWindowPercent = calculateAverageWindowPercent(startIndex);&#10;    thresholdWindowDuration = (thresholdWindowPercent / 100) * STANDARD_WINDOW;&#10;    thresholdModulationRate = PITCH_FALL_SEMITONES / (thresholdWindowDuration / 1000);&#10;    thresholdSlope = PITCH_FALL_SEMITONES / thresholdWindowDuration;&#10;&#10;    jndAbsoluteDifference = STANDARD_WINDOW - thresholdWindowDuration;&#10;    jndRatio = thresholdWindowDuration / STANDARD_WINDOW;&#10;    jndPercentDifference = 100 - thresholdWindowPercent;&#10;    webersRatio = jndAbsoluteDifference / STANDARD_WINDOW;&#10;    &#10;    logDebug(&quot;Test complete! Average difficulty level: &quot; + average.toFixed(2));&#10;    logDebug(&quot;Threshold window: &quot; + thresholdWindowPercent.toFixed(2) + &quot;% (&quot; + thresholdWindowDuration.toFixed(2) + &quot; ms)&quot;);&#10;    logDebug(&quot;JND Absolute Difference: &quot; + jndAbsoluteDifference.toFixed(2) + &quot; ms&quot;);&#10;    logDebug(&quot;JND Ratio: &quot; + jndRatio.toFixed(4));&#10;    logDebug(&quot;JND Percent Difference: &quot; + jndPercentDifference.toFixed(2) + &quot;%&quot;);&#10;    logDebug(&quot;Weber's Ratio: &quot; + webersRatio.toFixed(4));&#10;    &#10;    document.getElementById('text1').value = &quot;Test complete! JND: &quot; + jndAbsoluteDifference.toFixed(1) + &quot; ms&quot;;&#10;}&#10;&#10;function calculateAverageWindowPercent(startIndex) {&#10;    let sum = 0;&#10;    let count = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0 &amp;&amp; MODULATION_WINDOWS[level] !== undefined) {&#10;            sum += MODULATION_WINDOWS[level];&#10;            count++;&#10;        }&#10;    }&#10;    &#10;    return count &gt; 0 ? sum / count : 0;&#10;}&#10;&#10;function calculateReactionTimeStats() {&#10;    let allRTs = trialRecords.map(t =&gt; parseFloat(t.reactionTime));&#10;    &#10;    return {&#10;        mean: allRTs.length ? (allRTs.reduce((a, b) =&gt; a + b, 0) / allRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;        median: allRTs.length ? calculateMedian(allRTs).toFixed(0) : &quot;N/A&quot;,&#10;        sd: allRTs.length &gt; 1 ? calculateSD(allRTs).toFixed(0) : &quot;N/A&quot;&#10;    };&#10;}&#10;&#10;function calculateAccuracyStats() {&#10;    let allTrials = trialRecords;&#10;    &#10;    return {&#10;        correct: allTrials.filter(t =&gt; t.isCorrect).length,&#10;        total: allTrials.length,&#10;        percentage: allTrials.length ? &#10;            (allTrials.filter(t =&gt; t.isCorrect).length / allTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;    };&#10;}&#10;&#10;function calculateMedian(values) {&#10;    if (!values.length) return 0;&#10;    &#10;    const sortedValues = values.slice().sort((a, b) =&gt; a - b);&#10;    const mid = Math.floor(sortedValues.length / 2);&#10;    &#10;    return sortedValues.length % 2 === 0 ? &#10;        (sortedValues[mid - 1] + sortedValues[mid]) / 2 : &#10;        sortedValues[mid];&#10;}&#10;&#10;function calculateSD(values) {&#10;    if (values.length &lt;= 1) return 0;&#10;    &#10;    const mean = values.reduce((a, b) =&gt; a + b, 0) / values.length;&#10;    const variance = values.map(x =&gt; Math.pow(x - mean, 2)).reduce((a, b) =&gt; a + b, 0) / (values.length - 1);&#10;    &#10;    return Math.sqrt(variance);&#10;}&#10;&#10;function displayResults() {&#10;    logDebug(&quot;Displaying results&quot;);&#10;    &#10;    let hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;&#10;    &#10;    if (!hasData) {&#10;        let message = &quot;Warning: Insufficient data. Results may not be reliable.&quot;;&#10;        &#10;        if (confirm(message + &quot;\n\nWould you like to retry the experiment?&quot;)) {&#10;            window_onload();&#10;            return;&#10;        }&#10;    }&#10;    &#10;    document.getElementById('experimentContainer').style.display = 'none';&#10;    document.getElementById('resultsContainer').style.display = 'block';&#10;    &#10;    if (hasData) {&#10;        document.getElementById('jndValue').innerHTML = &#10;            jndAbsoluteDifference.toFixed(2) + ' ms&lt;br&gt;' +&#10;            '&lt;span style=&quot;font-size: 18px;&quot;&gt;(' + jndPercentDifference.toFixed(2) + '% difference from standard)&lt;/span&gt;';&#10;    } else {&#10;        document.getElementById('jndValue').textContent = 'Insufficient Data';&#10;    }&#10;    &#10;    var tableBody = document.getElementById('resultTableBody');&#10;    tableBody.innerHTML = '';&#10;    &#10;    var windowRow = document.createElement('tr');&#10;    windowRow.innerHTML = &#10;        '&lt;td&gt;Modulation Window Duration&lt;/td&gt;' +&#10;        '&lt;td&gt;' + STANDARD_WINDOW + ' ms (100%)&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? thresholdWindowDuration.toFixed(2) + ' ms (' + thresholdWindowPercent.toFixed(2) + '%)' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? jndRatio.toFixed(4) + ' : 1&lt;br&gt;(Threshold/Standard)' : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(windowRow);&#10;    &#10;    var diffRow = document.createElement('tr');&#10;    diffRow.innerHTML = &#10;        '&lt;td&gt;Absolute Difference (JND)&lt;/td&gt;' +&#10;        '&lt;td&gt;0 ms (reference)&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? jndAbsoluteDifference.toFixed(2) + ' ms' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? 'Weber Ratio: ' + webersRatio.toFixed(4) : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(diffRow);&#10;    &#10;    var rateStandard = PITCH_FALL_SEMITONES / (STANDARD_WINDOW / 1000);&#10;    var rateRow = document.createElement('tr');&#10;    rateRow.innerHTML = &#10;        '&lt;td&gt;Modulation Rate&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rateStandard.toFixed(4) + ' semitones/s&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? thresholdModulationRate.toFixed(4) + ' semitones/s' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? (thresholdModulationRate / rateStandard).toFixed(4) + ' : 1' : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(rateRow);&#10;    &#10;    var interpretation = document.getElementById('resultInterpretation');&#10;    let interpretationHtml = '&lt;h3 style=&quot;margin-top: 0;&quot;&gt;Performance Interpretation&lt;/h3&gt;';&#10;    &#10;    if (hasData) {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Your Just Noticeable Difference (JND):&lt;/strong&gt;&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;You can reliably detect a difference when the modulation window changes by &lt;strong&gt;' + &#10;            jndAbsoluteDifference.toFixed(2) + ' ms&lt;/strong&gt; (or &lt;strong&gt;' + jndPercentDifference.toFixed(2) + &#10;            '%&lt;/strong&gt; of the standard 400 ms window).&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;In other words, you can discriminate between:&lt;/p&gt;';&#10;        interpretationHtml += '&lt;ul&gt;';&#10;        interpretationHtml += '&lt;li&gt;Standard stimulus: 400 ms modulation window&lt;/li&gt;';&#10;        interpretationHtml += '&lt;li&gt;Your threshold: ' + thresholdWindowDuration.toFixed(2) + ' ms modulation window&lt;/li&gt;';&#10;        interpretationHtml += '&lt;li&gt;Difference: ' + jndAbsoluteDifference.toFixed(2) + ' ms&lt;/li&gt;';&#10;        interpretationHtml += '&lt;/ul&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Weber\'s Ratio:&lt;/strong&gt; ' + webersRatio.toFixed(4) + &#10;            ' (smaller Weber\'s ratio = better discrimination sensitivity)&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;&lt;em&gt;Note: A &lt;strong&gt;smaller JND&lt;/strong&gt; indicates &lt;strong&gt;better sensitivity&lt;/strong&gt; to dynamic pitch changes, ' +&#10;            'as it means you can detect smaller differences between stimuli.&lt;/em&gt;&lt;/p&gt;';&#10;    } else {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Complete results not available due to insufficient data.&lt;/p&gt;';&#10;    }&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    const accuracyStats = calculateAccuracyStats();&#10;    &#10;    interpretationHtml += '&lt;p&gt;&lt;strong&gt;Overall Performance:&lt;/strong&gt; ' + accuracyStats.percentage + &#10;        '% accuracy with average reaction time of ' + rtStats.mean + ' ms across ' + &#10;        accuracyStats.total + ' trials.&lt;/p&gt;';&#10;    &#10;    interpretation.innerHTML = interpretationHtml;&#10;    &#10;    var detailedBody = document.getElementById('detailedMetricsBody');&#10;    detailedBody.innerHTML = '';&#10;    &#10;    var metrics = [&#10;        { name: 'Average Difficulty Level', value: hasData ? sentAverage.toFixed(2) : 'N/A', interp: hasData ? 'SD: ' + sentStdev.toFixed(2) : 'N/A' },&#10;        { name: 'Threshold Slope', value: hasData ? thresholdSlope.toFixed(6) + ' semitones/ms' : 'N/A', interp: hasData ? 'Rate of pitch change' : 'N/A' },&#10;        { name: 'Number of Reversals', value: NumberOfReversals, interp: 'Minimum required: ' + MINIMUMREVERSALS },&#10;        { name: 'Total Trials', value: numberOfIterations, interp: 'Maximum allowed: ' + MAXITERATIONS }&#10;    ];&#10;    &#10;    metrics.forEach(function(metric) {&#10;        var row = document.createElement('tr');&#10;        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;&lt;td&gt;' + metric.interp + '&lt;/td&gt;';&#10;        detailedBody.appendChild(row);&#10;    });&#10;    &#10;    var perfBody = document.getElementById('performanceStatsBody');&#10;    perfBody.innerHTML = '';&#10;    &#10;    var perfMetrics = [&#10;        { name: 'Total Trials', value: accuracyStats.total },&#10;        { name: 'Correct Responses', value: accuracyStats.correct },&#10;        { name: 'Overall Accuracy', value: accuracyStats.percentage + '%' },&#10;        { name: 'Mean Reaction Time', value: rtStats.mean + ' ms' },&#10;        { name: 'Median Reaction Time', value: rtStats.median + ' ms' },&#10;        { name: 'RT Standard Deviation', value: rtStats.sd + ' ms' }&#10;    ];&#10;    &#10;    perfMetrics.forEach(function(metric) {&#10;        var row = document.createElement('tr');&#10;        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;';&#10;        perfBody.appendChild(row);&#10;    });&#10;}&#10;&#10;function backToExperiment() {&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;}&#10;&#10;function view_onclick() {&#10;    logDebug(&quot;View results button clicked&quot;);&#10;    &#10;    if (!isTestComplete &amp;&amp; NumberOfReversals &gt;= MINIMUMREVERSALS) {&#10;        calculateResults();&#10;        isTestComplete = true;&#10;    }&#10;    &#10;    displayResults();&#10;}&#10;&#10;function beginIteration() {&#10;    isReplayTrial = false;&#10;    &#10;    standardIsFirst = Math.random() &lt; 0.5;&#10;    var xIsStandard = Math.random() &lt; 0.5;&#10;    &#10;    if (xIsStandard) {&#10;        CorrectAnswer = standardIsFirst ? 1 : 2;&#10;    } else {&#10;        CorrectAnswer = standardIsFirst ? 2 : 1;&#10;    }&#10;    &#10;    logDebug(&quot;Starting new iteration #&quot; + numberOfIterations + &#10;             &quot;, Standard is &quot; + (standardIsFirst ? &quot;first&quot; : &quot;second&quot;) +&#10;             &quot;, X is &quot; + (xIsStandard ? &quot;standard&quot; : &quot;comparison&quot;) +&#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Difficulty level: &quot; + currentLevel +&#10;             &quot;, Modulation window: &quot; + MODULATION_WINDOWS[currentLevel] + &quot;% (&quot; + &#10;             getModulationWindowDuration(currentLevel) + &quot; ms)&quot;);&#10;    &#10;    setTimeout(function() {&#10;        playABXSequence(xIsStandard);&#10;    }, 1000);&#10;}&#10;&#10;function clearButtonAnimations() {&#10;    document.getElementById('firstBtn').classList.remove('button-playing');&#10;    document.getElementById('secondBtn').classList.remove('button-playing');&#10;}&#10;&#10;function playABXSequence(xIsStandard) {&#10;    logDebug(&quot;Playing ABX sequence&quot;);&#10;    &#10;    clearButtonAnimations();&#10;&#10;    standardSound = document.getElementById('high_falling_standard');&#10;    comparisonSound = document.getElementById(&quot;high_falling_&quot; + currentLevel);&#10;&#10;    xSound = xIsStandard ? standardSound : comparisonSound;&#10;    &#10;    if (!standardSound || !comparisonSound) {&#10;        logDebug(&quot;Error: Cannot find audio elements!&quot;);&#10;        document.getElementById('text1').value = &quot;出錯：找不到音頻文件&quot;;&#10;        setTimeout(function() {&#10;            showDiagnostics();&#10;        }, 1000);&#10;        return;&#10;    }&#10;    &#10;    var firstSound = standardIsFirst ? standardSound : comparisonSound;&#10;    document.getElementById('text1').value = &quot;播放第一個音&quot;;&#10;    &#10;    document.getElementById('firstBtn').classList.add('button-playing');&#10;    &#10;    firstSound.currentTime = 0;&#10;    var playPromise1 = firstSound.play();&#10;    &#10;    if (playPromise1 !== undefined) {&#10;        playPromise1.then(function() {&#10;            logDebug(&quot;First sound (A) played successfully&quot;);&#10;            &#10;            firstSound.onended = function() {&#10;                logDebug(&quot;First sound ended&quot;);&#10;                &#10;                document.getElementById('firstBtn').classList.remove('button-playing');&#10;                &#10;                setTimeout(function() {&#10;                    var secondSound = standardIsFirst ? comparisonSound : standardSound;&#10;                    document.getElementById('text1').value = &quot;播放第二個音&quot;;&#10;                    &#10;                    document.getElementById('secondBtn').classList.add('button-playing');&#10;                    &#10;                    secondSound.currentTime = 0;&#10;                    var playPromise2 = secondSound.play();&#10;                    &#10;                    if (playPromise2 !== undefined) {&#10;                        playPromise2.then(function() {&#10;                            logDebug(&quot;Second sound (B) played successfully&quot;);&#10;                            &#10;                            secondSound.onended = function() {&#10;                                logDebug(&quot;Second sound ended&quot;);&#10;                                &#10;                                document.getElementById('secondBtn').classList.remove('button-playing');&#10;                                &#10;                                setTimeout(function() {&#10;                                    document.getElementById('text1').value = &quot;播放第三個音&quot;;&#10;                                    &#10;                                    xSound.currentTime = 0;&#10;                                    var playPromise3 = xSound.play();&#10;                                    &#10;                                    if (playPromise3 !== undefined) {&#10;                                        playPromise3.then(function() {&#10;                                            logDebug(&quot;Third sound (X) played successfully&quot;);&#10;                                            &#10;                                            xSound.onended = function() {&#10;                                                logDebug(&quot;Third sound ended, enabling response buttons&quot;);&#10;                                                &#10;                                                stimulusEndTime = performance.now();&#10;                                                &#10;                                                document.getElementById('text1').value = &quot;請作出選擇&quot;;&#10;                                                document.getElementById('promptText').style.visibility = 'visible';&#10;                                                &#10;                                                document.getElementById('firstBtn').disabled = false;&#10;                                                document.getElementById('secondBtn').disabled = false;&#10;                                                document.getElementById('firstBtn').style.background = &quot;#66CCFF&quot;;&#10;                                                document.getElementById('secondBtn').style.background = &quot;#66CCFF&quot;;&#10;                                            };&#10;                                        }).catch(function(error) {&#10;                                            logDebug(&quot;Failed to play third sound: &quot; + error);&#10;                                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                                            clearButtonAnimations();&#10;                                            setTimeout(showDiagnostics, 1000);&#10;                                        });&#10;                                    }&#10;                                }, 1000);&#10;                            };&#10;                        }).catch(function(error) {&#10;                            logDebug(&quot;Failed to play second sound: &quot; + error);&#10;                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                            clearButtonAnimations();&#10;                            setTimeout(showDiagnostics, 1000);&#10;                        });&#10;                    }&#10;                }, 1000);&#10;            };&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to play first sound: &quot; + error);&#10;            document.getElementById('text1').value = &quot;音頻播放錯誤，請刷新頁面&quot;;&#10;            clearButtonAnimations();&#10;            setTimeout(showDiagnostics, 1000);&#10;        });&#10;    }&#10;}&#10;&#10;function start_onclick() {&#10;    logDebug(&quot;Starting experiment&quot;);&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    checkAudioFiles();&#10;    if (!allFilesPresent) {&#10;        logDebug(&quot;Cannot start experiment: Some audio files are missing&quot;);&#10;        document.getElementById('text1').value = &quot;音頻缺失&quot;;&#10;        showDiagnostics();&#10;        return;&#10;    }&#10;    &#10;    window_onload();&#10;    document.getElementById('text1').value = &quot;開始實驗...&quot;;&#10;    updateProgressBar(0);&#10;    &#10;    setTimeout(function() {&#10;        beginIteration();&#10;        document.getElementById('start').disabled = true;&#10;        document.getElementById('viewResult').disabled = true;&#10;        document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;        document.getElementById('promptText').style.visibility = 'hidden';&#10;    }, 1000);&#10;}&#10;&#10;function gotReversal() {&#10;    NumberOfReversals++;&#10;    Reversals[NumberOfReversals - 1] = currentLevel;&#10;    Direction = -Direction;&#10;    logDebug(&quot;Recorded reversal #&quot; + NumberOfReversals + &quot; at difficulty &quot; + currentLevel + &#10;             &quot; (window: &quot; + MODULATION_WINDOWS[currentLevel] + &quot;%, &quot; + &#10;             getModulationWindowDuration(currentLevel) + &quot; ms)&quot;);&#10;}&#10;&#10;function processAnswer(Response) {&#10;    const reactionEndTime = performance.now();&#10;    const reactionTime = reactionEndTime - stimulusEndTime;&#10;    &#10;    logDebug(&quot;User answered: &quot; + (Response === 1 ? &quot;First&quot; : &quot;Second&quot;) + &#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Is replay: &quot; + isReplayTrial);&#10;    &#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    const isCorrect = (Response === CorrectAnswer);&#10;    &#10;    if (!isReplayTrial) {&#10;        const windowPercent = MODULATION_WINDOWS[currentLevel];&#10;        const windowDuration = getModulationWindowDuration(currentLevel);&#10;        const modulationRate = getModulationRate(currentLevel);&#10;        const slope = getModulationSlope(currentLevel);&#10;        &#10;        const trialInfo = {&#10;            trialNumber: numberOfIterations,&#10;            timestamp: getLocalTimestamp(),&#10;            difficultyLevel: currentLevel,&#10;            modulationWindowPercent: windowPercent,&#10;            modulationWindowDuration: windowDuration.toFixed(2),&#10;            modulationRate: modulationRate.toFixed(4),&#10;            slope: slope.toFixed(6),&#10;            userResponse: Response === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            correctResponse: CorrectAnswer === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            isCorrect: isCorrect,&#10;            reactionTime: reactionTime.toFixed(0),&#10;            isReversal: false,&#10;            stepDirection: Direction === DECREASING ? &quot;Increasing Difficulty&quot; : &quot;Decreasing Difficulty&quot;,&#10;            standardPosition: standardIsFirst ? &quot;First&quot; : &quot;Second&quot;&#10;        };&#10;        &#10;        trialRecords.push(trialInfo);&#10;    }&#10;    &#10;    if (isCorrect) {&#10;        logDebug(&quot;Correct answer&quot;);&#10;        document.getElementById('smile').src = &quot;Media/smiley.png&quot;;&#10;        document.getElementById('text1').value = &quot;正確！&quot;;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses++;&#10;            &#10;            if (CorrectResponses == 2) {&#10;                logDebug(&quot;Two correct answers in a row&quot;);&#10;                CorrectResponses = 0;&#10;                &#10;                if (Direction == INCREASING) {&#10;                    gotReversal();&#10;                    if (trialRecords.length &gt; 0) {&#10;                        trialRecords[trialRecords.length-1].isReversal = true;&#10;                    }&#10;                }&#10;                &#10;                changeLevel(DECREASING);&#10;            }&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            resetPage();&#10;        }, 1500);&#10;    } else {&#10;        logDebug(&quot;Incorrect answer - will replay stimulus&quot;);&#10;        document.getElementById('smile').src = &quot;Media/nosmiley.png&quot;;&#10;        &#10;        var correctAnswerText = CorrectAnswer === 1 ? &quot;第一個音&quot; : &quot;第二個音&quot;;&#10;        document.getElementById('text1').value = &quot;錯誤！正確答案是：&quot; + correctAnswerText;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses = 0;&#10;            &#10;            if (Direction == DECREASING) {&#10;                gotReversal();&#10;                if (trialRecords.length &gt; 0) {&#10;                    trialRecords[trialRecords.length-1].isReversal = true;&#10;                }&#10;            }&#10;            &#10;            changeLevel(INCREASING);&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            document.getElementById('text1').value = &quot;重播刺激音...&quot;;&#10;            &#10;            setTimeout(function() {&#10;                isReplayTrial = true;&#10;                &#10;                var xIsStandard = (standardIsFirst &amp;&amp; CorrectAnswer === 1) || &#10;                                  (!standardIsFirst &amp;&amp; CorrectAnswer === 2);&#10;                playABXSequence(xIsStandard);&#10;            }, 1000);&#10;        }, 2000);&#10;    }&#10;}&#10;&#10;function changeLevel(whichWay) {&#10;    var oldLevel = currentLevel;&#10;    var stepSize = NumberOfReversals &lt; 4 ? 2 : 1;&#10;    &#10;    if (whichWay == DECREASING) {&#10;        currentLevel = Math.min(9, currentLevel + stepSize);&#10;    } else {&#10;        currentLevel = Math.max(LOWERLIMIT, currentLevel - stepSize);&#10;    }&#10;    &#10;    logDebug(&quot;Difficulty changed from level &quot; + oldLevel + &quot; (&quot; + MODULATION_WINDOWS[oldLevel] + &quot;%, &quot; +&#10;             getModulationWindowDuration(oldLevel) + &quot; ms) to level &quot; + &#10;             currentLevel + &quot; (&quot; + MODULATION_WINDOWS[currentLevel] + &quot;%, &quot; +&#10;             getModulationWindowDuration(currentLevel) + &quot; ms) &quot; +&#10;             (whichWay == DECREASING ? &quot;(increasing difficulty)&quot; : &quot;(decreasing difficulty)&quot;));&#10;}&#10;&#10;function exportToCSV() {&#10;    const headers = [&#10;        &quot;Trial Number&quot;, &#10;        &quot;Timestamp&quot;, &#10;        &quot;Difficulty Level&quot;, &#10;        &quot;Modulation Window (%)&quot;,&#10;        &quot;Modulation Window (ms)&quot;,&#10;        &quot;Modulation Rate (semitones/s)&quot;,&#10;        &quot;Slope (semitones/ms)&quot;,&#10;        &quot;Standard Position&quot;,&#10;        &quot;User Response&quot;, &#10;        &quot;Correct Response&quot;, &#10;        &quot;Is Correct&quot;, &#10;        &quot;Reaction Time (ms)&quot;, &#10;        &quot;Is Reversal&quot;,&#10;        &quot;Step Direction&quot;&#10;    ];&#10;    &#10;    const csvRows = [];&#10;    csvRows.push(headers.join(&quot;,&quot;));&#10;    &#10;    trialRecords.forEach(function(trial) {&#10;        const row = [&#10;            trial.trialNumber,&#10;            trial.timestamp,&#10;            trial.difficultyLevel,&#10;            trial.modulationWindowPercent,&#10;            trial.modulationWindowDuration,&#10;            trial.modulationRate,&#10;            trial.slope,&#10;            trial.standardPosition,&#10;            trial.userResponse,&#10;            trial.correctResponse,&#10;            trial.isCorrect ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.reactionTime,&#10;            trial.isReversal ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.stepDirection&#10;        ];&#10;        csvRows.push(row.join(&quot;,&quot;));&#10;    });&#10;    &#10;    csvRows.push(&quot;\nRESULTS SUMMARY - JUST NOTICEABLE DIFFERENCE (JND)&quot;);&#10;    csvRows.push(&quot;\nJND Metrics&quot;);&#10;    csvRows.push(&quot;Parameter,Value,Unit,Description&quot;);&#10;    &#10;    const hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;&#10;    &#10;    csvRows.push(&quot;JND Absolute Difference,&quot; + &#10;        (hasData ? jndAbsoluteDifference.toFixed(2) : &quot;N/A&quot;) + &quot;,ms,Detectable difference from standard (smaller = better)&quot;);&#10;    &#10;    csvRows.push(&quot;JND Percentage Difference,&quot; + &#10;        (hasData ? jndPercentDifference.toFixed(2) : &quot;N/A&quot;) + &quot;,%,Percentage difference from standard (smaller = better)&quot;);&#10;    &#10;    csvRows.push(&quot;JND Ratio (Threshold/Standard),&quot; + &#10;        (hasData ? jndRatio.toFixed(4) : &quot;N/A&quot;) + &quot;,ratio,Threshold modulation window / Standard window&quot;);&#10;    &#10;    csvRows.push(&quot;Weber's Ratio,&quot; + &#10;        (hasData ? webersRatio.toFixed(4) : &quot;N/A&quot;) + &quot;,ratio,ΔI / I (smaller = better sensitivity)&quot;);&#10;    &#10;    csvRows.push(&quot;\nThreshold Parameters&quot;);&#10;    csvRows.push(&quot;Parameter,Value,Unit&quot;);&#10;    &#10;    csvRows.push(&quot;Standard Modulation Window,&quot; + STANDARD_WINDOW + &quot;,ms&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Modulation Window,&quot; + &#10;        (hasData ? thresholdWindowDuration.toFixed(2) : &quot;N/A&quot;) + &quot;,ms&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Window Percentage,&quot; + &#10;        (hasData ? thresholdWindowPercent.toFixed(2) : &quot;N/A&quot;) + &quot;,%&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Modulation Rate,&quot; + &#10;        (hasData ? thresholdModulationRate.toFixed(4) : &quot;N/A&quot;) + &quot;,semitones/s&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Slope,&quot; + &#10;        (hasData ? thresholdSlope.toFixed(6) : &quot;N/A&quot;) + &quot;,semitones/ms&quot;);&#10;    &#10;    csvRows.push(&quot;Average Difficulty Level,&quot; + &#10;        (hasData ? sentAverage.toFixed(2) : &quot;N/A&quot;) + &quot;,level (1-9)&quot;);&#10;    &#10;    csvRows.push(&quot;Difficulty Level SD,&quot; + &#10;        (hasData ? sentStdev.toFixed(2) : &quot;N/A&quot;) + &quot;,level&quot;);&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    csvRows.push(&quot;\nReaction Time Statistics&quot;);&#10;    csvRows.push(&quot;Mean,Median,Standard Deviation&quot;);&#10;    csvRows.push(rtStats.mean + &quot;,&quot; + rtStats.median + &quot;,&quot; + rtStats.sd);&#10;    &#10;    const accuracyStats = calculateAccuracyStats();&#10;    csvRows.push(&quot;\nAccuracy Statistics&quot;);&#10;    csvRows.push(&quot;Correct Responses,Total Responses,Percentage&quot;);&#10;    csvRows.push(accuracyStats.correct + &quot;,&quot; + accuracyStats.total + &quot;,&quot; + accuracyStats.percentage + &quot;%&quot;);&#10;    &#10;    csvRows.push(&quot;\nExperiment Parameters&quot;);&#10;    csvRows.push(&quot;Parameter,Value&quot;);&#10;    csvRows.push(&quot;Paradigm,ABX&quot;);&#10;    csvRows.push(&quot;Stimulus Type,Dynamic Pitch (Falling Tone)&quot;);&#10;    csvRows.push(&quot;Total Stimulus Duration,&quot; + STIMULUS_DURATION + &quot; ms&quot;);&#10;    csvRows.push(&quot;Standard Modulation Window,&quot; + STANDARD_WINDOW + &quot; ms&quot;);&#10;    csvRows.push(&quot;Pitch Fall Amount,&quot; + PITCH_FALL_SEMITONES + &quot; semitone(s)&quot;);&#10;    csvRows.push(&quot;Max Reversals,&quot; + MAXREVERSALS);&#10;    csvRows.push(&quot;Min Reversals for Calculation,&quot; + MINIMUMREVERSALS);&#10;    csvRows.push(&quot;Max Iterations,&quot; + MAXITERATIONS);&#10;    &#10;    csvRows.push(&quot;\nDifficulty Level Mapping&quot;);&#10;    csvRows.push(&quot;Level,Modulation Window (%),Modulation Window (ms),Difference from Standard (ms),Modulation Rate (semitones/s),Slope (semitones/ms)&quot;);&#10;    for (let level = 1; level &lt;= 9; level++) {&#10;        const windowPercent = MODULATION_WINDOWS[level];&#10;        const windowDuration = getModulationWindowDuration(level);&#10;        const diffFromStandard = STANDARD_WINDOW - windowDuration;&#10;        const rate = getModulationRate(level);&#10;        const slope = getModulationSlope(level);&#10;        csvRows.push(level + &quot;,&quot; + windowPercent + &quot;,&quot; + windowDuration.toFixed(2) + &quot;,&quot; + &#10;                     diffFromStandard.toFixed(2) + &quot;,&quot; + rate.toFixed(4) + &quot;,&quot; + slope.toFixed(6));&#10;    }&#10;    &#10;    const csvContent = &quot;data:text/csv;charset=utf-8,&quot; + csvRows.join(&quot;\n&quot;);&#10;    const encodedUri = encodeURI(csvContent);&#10;    const link = document.createElement(&quot;a&quot;);&#10;    const timestamp = new Date().toISOString().replace(/[:.]/g, &quot;-&quot;);&#10;    link.setAttribute(&quot;href&quot;, encodedUri);&#10;    link.setAttribute(&quot;download&quot;, &quot;dynamic_pitch_JND_ABX_data_&quot; + timestamp + &quot;.csv&quot;);&#10;    document.body.appendChild(link);&#10;    link.click();&#10;    document.body.removeChild(link);&#10;}&#10;&#10;function window_onload() {&#10;    window.name = &quot;EXP&quot;;&#10;    NumberOfReversals = 0;&#10;    numberOfIterations = 0;&#10;    CorrectResponses = 0;&#10;    Direction = DECREASING;&#10;    currentLevel = 5;&#10;    isTestComplete = false;&#10;    Reversals = [];&#10;    trialRecords = [];&#10;    isReplayTrial = false;&#10;    &#10;    jndAbsoluteDifference = 0;&#10;    jndRatio = 0;&#10;    jndPercentDifference = 0;&#10;    thresholdWindowDuration = 0;&#10;    thresholdWindowPercent = 0;&#10;    thresholdModulationRate = 0;&#10;    thresholdSlope = 0;&#10;    webersRatio = 0;&#10;&#10;    document.getElementById('text1').value = &quot;準備完畢後請點擊\&quot;開始實驗\&quot;&quot;;&#10;    document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;    document.getElementById('start').disabled = false;&#10;    document.getElementById('viewResult').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;    &#10;    updateProgressBar(0);&#10;    &#10;    logDebug(&quot;Page reset complete&quot;);&#10;}&#10;&#10;window.onload = function() {&#10;    window_onload();&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    logDebug(&quot;Preloading &quot; + allAudios.length + &quot; audio files&quot;);&#10;    &#10;    allAudios.forEach(function(audio) {&#10;        audio.load();&#10;    });&#10;    &#10;    document.getElementById('text1').value = &quot;請點擊\&quot;開始實驗\&quot;&quot;;&#10;    &#10;    window.onerror = function(message, source, lineno, colno, error) {&#10;        logDebug(&quot;Global error: &quot; + message + &quot; at &quot; + source + &quot;:&quot; + lineno);&#10;        return false;&#10;    };&#10;    &#10;    document.getElementById('showDebug').checked = true;&#10;    toggleDebug();&#10;};&#10;&lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
                    <entry key="file:///E:/Projects/Pitch_Training/ABX_falling_low.html" value="&lt;!DOCTYPE html&gt;&#10;&lt;html&gt;&#10;&lt;head&gt;&#10;    &lt;title&gt;PLOYU-Peng's Lab: Pitch Sensitivity Training&lt;/title&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;style&gt;&#10;        body {&#10;            font-family: Arial, sans-serif;&#10;            margin: 20px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .container {&#10;            max-width: 800px;&#10;            margin: 0 auto;&#10;            padding: 20px;&#10;            background-color: white;&#10;            border-radius: 10px;&#10;            box-shadow: 0 0 10px rgba(0,0,0,0.1);&#10;            display: flex;&#10;            flex-direction: column;&#10;            align-items: center;&#10;        }&#10;        .header {&#10;            text-align: center;&#10;            margin-bottom: 40px;&#10;            width: 100%;&#10;        }&#10;        .training-info {&#10;            font-size: 16px;&#10;            color: #555;&#10;            margin-top: 10px;&#10;            margin-bottom: 5px;&#10;            text-align: center;&#10;        }&#10;        .instruction-text {&#10;            font-size: 14px;&#10;            color: #777;&#10;            margin-bottom: 15px;&#10;            text-align: center;&#10;            font-style: italic;&#10;        }&#10;        .button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .prompt-text {&#10;            text-align: center;&#10;            font-size: 20px;&#10;            margin-bottom: 25px;&#10;            margin-top: 30px;&#10;            font-weight: bold;&#10;        }&#10;        .response-button {&#10;            width: 160px;&#10;            height: 160px;&#10;            font-size: 26px;&#10;            margin: 0 40px;&#10;            border-radius: 15px;&#10;            border: none;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.1);&#10;            transition: all 0.3s ease;&#10;        }&#10;        .response-button:hover:enabled {&#10;            transform: translateY(-3px);&#10;            box-shadow: 0 6px 12px rgba(0,0,0,0.15);&#10;        }&#10;        .response-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .button-playing {&#10;            animation: pulse 1s ease-in-out infinite;&#10;            box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            transform: scale(1.05);&#10;        }&#10;        @keyframes pulse {&#10;            0%, 100% {&#10;                box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            }&#10;            50% {&#10;                box-shadow: 0 0 30px rgba(102, 204, 255, 1);&#10;            }&#10;        }&#10;        .control-button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            gap: 30px;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .control-button {&#10;            padding: 14px 28px;&#10;            font-size: 18px;&#10;            border-radius: 8px;&#10;            border: none;&#10;            background-color: #4CAF50;&#10;            color: white;&#10;            cursor: pointer;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .control-button:hover:enabled {&#10;            background-color: #3e8e41;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .control-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .control-button:disabled {&#10;            background-color: #cccccc;&#10;            cursor: not-allowed;&#10;            box-shadow: none;&#10;        }&#10;        .feedback {&#10;            text-align: center;&#10;            height: 100px;&#10;            margin: 30px 0;&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;        }&#10;        .status {&#10;            width: 350px;&#10;            height: 68px;&#10;            text-align: center;&#10;            font-size: 18px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            margin: 0 auto;&#10;            padding: 10px;&#10;            background-color: #f9f9f9;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.05);&#10;        }&#10;        .debug-info {&#10;            font-size: 12px;&#10;            color: #777;&#10;            margin-top: 30px;&#10;            text-align: left;&#10;            display: none;&#10;            max-height: 300px;&#10;            overflow-y: auto;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            padding: 15px;&#10;            width: 100%;&#10;        }&#10;        .results-container {&#10;            display: none;&#10;            margin-top: 30px;&#10;            padding: 20px;&#10;            background-color: #f0f8ff;&#10;            border-radius: 8px;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.1);&#10;            width: 100%;&#10;        }&#10;        .result-heading {&#10;            text-align: center;&#10;            margin-bottom: 20px;&#10;            color: #2c3e50;&#10;        }&#10;        .result-table {&#10;            width: 100%;&#10;            border-collapse: collapse;&#10;            margin-bottom: 20px;&#10;        }&#10;        .result-table th, .result-table td {&#10;            padding: 12px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .result-table th {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .result-table tr:nth-child(even) {&#10;            background-color: #f2f2f2;&#10;        }&#10;        .result-interpretation {&#10;            background-color: #e8f4f8;&#10;            padding: 15px;&#10;            border-radius: 5px;&#10;            margin-bottom: 20px;&#10;        }&#10;        .back-button {&#10;            display: block;&#10;            margin: 0 auto;&#10;            padding: 14px 28px;&#10;            background-color: #3498db;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .back-button:hover {&#10;            background-color: #2980b9;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .back-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        .chart-container {&#10;            height: 300px;&#10;            margin: 20px 0;&#10;            background-color: white;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;            padding: 10px;&#10;        }&#10;        .auxiliary-buttons {&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            margin-top: 30px;&#10;            gap: 20px;&#10;            flex-wrap: wrap;&#10;        }&#10;        .auxiliary-buttons button {&#10;            padding: 10px 15px;&#10;            border-radius: 5px;&#10;            border: 1px solid #ddd;&#10;            background-color: #f0f0f0;&#10;            cursor: pointer;&#10;            transition: all 0.2s ease;&#10;        }&#10;        .auxiliary-buttons button:hover {&#10;            background-color: #e0e0e0;&#10;        }&#10;        .diagnostic-overlay {&#10;            position: fixed;&#10;            top: 0;&#10;            left: 0;&#10;            width: 100%;&#10;            height: 100%;&#10;            background-color: rgba(0, 0, 0, 0.8);&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            z-index: 1000;&#10;            display: none;&#10;        }&#10;        .diagnostic-content {&#10;            width: 80%;&#10;            max-width: 700px;&#10;            max-height: 80%;&#10;            overflow-y: auto;&#10;            background-color: white;&#10;            padding: 20px;&#10;            border-radius: 8px;&#10;            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);&#10;        }&#10;        .diagnostic-heading {&#10;            text-align: center;&#10;            color: #e74c3c;&#10;            margin-bottom: 20px;&#10;            font-size: 24px;&#10;        }&#10;        .diagnostic-close {&#10;            float: right;&#10;            font-size: 20px;&#10;            cursor: pointer;&#10;            color: #777;&#10;        }&#10;        .diagnostic-close:hover {&#10;            color: #333;&#10;        }&#10;        .diagnostic-section {&#10;            margin-bottom: 15px;&#10;            padding: 10px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;        }&#10;        .diagnostic-actions {&#10;            text-align: center;&#10;            margin-top: 20px;&#10;        }&#10;        .diagnostic-action-button {&#10;            padding: 10px 20px;&#10;            margin: 0 10px;&#10;            border: none;&#10;            border-radius: 5px;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;        }&#10;        .retry-button {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .retry-button:hover {&#10;            background-color: #2980b9;&#10;        }&#10;        .continue-button {&#10;            background-color: #2ecc71;&#10;            color: white;&#10;        }&#10;        .continue-button:hover {&#10;            background-color: #27ae60;&#10;        }&#10;        .diagnostic-file-status {&#10;            display: flex;&#10;            flex-wrap: wrap;&#10;            gap: 10px;&#10;        }&#10;        .file-status-item {&#10;            font-size: 12px;&#10;            padding: 5px 10px;&#10;            border-radius: 3px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .file-found {&#10;            color: #27ae60;&#10;            border-left: 3px solid #27ae60;&#10;        }&#10;        .file-missing {&#10;            color: #e74c3c;&#10;            border-left: 3px solid #e74c3c;&#10;        }&#10;        .statistics-table {&#10;            width: 100%;&#10;            margin: 10px 0;&#10;            border-collapse: collapse;&#10;        }&#10;        .statistics-table th, .statistics-table td {&#10;            padding: 8px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .statistics-table th {&#10;            background-color: #f0f0f0;&#10;        }&#10;        .direction-stats-good {&#10;            color: #27ae60;&#10;        }&#10;        .direction-stats-warning {&#10;            color: #f39c12;&#10;        }&#10;        .direction-stats-bad {&#10;            color: #e74c3c;&#10;        }&#10;        @media (max-width: 600px) {&#10;            .response-button {&#10;                width: 130px;&#10;                height: 130px;&#10;                font-size: 22px;&#10;                margin: 0 20px;&#10;            }&#10;            .control-button {&#10;                padding: 12px 20px;&#10;            }&#10;        }&#10;        .print-button {&#10;            padding: 14px 28px;&#10;            margin: 20px auto;&#10;            background-color: #9b59b6;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;            display: block;&#10;        }&#10;        .print-button:hover {&#10;            background-color: #8e44ad;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .print-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        @media print {&#10;            body {&#10;                background-color: white;&#10;                margin: 0;&#10;                padding: 0;&#10;            }&#10;            .container {&#10;                max-width: 100%;&#10;                box-shadow: none;&#10;                padding: 10px;&#10;            }&#10;            .back-button, .print-button, .auxiliary-buttons {&#10;                display: none;&#10;            }&#10;            .results-container {&#10;                display: block !important;&#10;                box-shadow: none;&#10;                background-color: white;&#10;                padding: 0;&#10;            }&#10;            .chart-container {&#10;                border: 1px solid #ddd;&#10;                background-color: white;&#10;            }&#10;            .result-table th {&#10;                background-color: #f0f0f0 !important;&#10;                color: black !important;&#10;            }&#10;            .result-interpretation {&#10;                background-color: white;&#10;                border: 1px solid #ddd;&#10;            }&#10;            * {&#10;                -webkit-print-color-adjust: exact !important;&#10;                print-color-adjust: exact !important;&#10;            }&#10;        }&#10;        .progress-bar-container {&#10;            width: 100%;&#10;            height: 20px;&#10;            background-color: #e0e0e0;&#10;            border-radius: 10px;&#10;            margin: 10px 0;&#10;            overflow: hidden;&#10;        }&#10;        .progress-bar {&#10;            height: 100%;&#10;            background-color: #4CAF50;&#10;            border-radius: 10px;&#10;            transition: width 0.3s ease;&#10;        }&#10;        .progress-label {&#10;            text-align: center;&#10;            font-size: 14px;&#10;            color: #555;&#10;            margin-top: 5px;&#10;        }&#10;        .highlight-box {&#10;            background-color: #fffacd;&#10;            border: 2px solid #ffd700;&#10;            padding: 15px;&#10;            border-radius: 8px;&#10;            margin: 20px 0;&#10;            text-align: center;&#10;        }&#10;        .highlight-value {&#10;            font-size: 28px;&#10;            font-weight: bold;&#10;            color: #e74c3c;&#10;            margin: 10px 0;&#10;        }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;div class=&quot;container&quot;&gt;&#10;        &lt;div class=&quot;header&quot;&gt;&#10;            &lt;img src=&quot;Media/animation.gif&quot; alt=&quot;Experiment animation&quot;&gt;&#10;            &lt;div class=&quot;training-info&quot;&gt;Low Falling Tone Discrimination (ABX)&lt;/div&gt;&#10;            &lt;div class=&quot;instruction-text&quot;&gt;請判斷第三個音聽起來更像第一個還是第二個音&lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div id=&quot;experimentContainer&quot;&gt;&#10;            &lt;div class=&quot;control-button-container&quot;&gt;&#10;                &lt;input id=&quot;start&quot; type=&quot;button&quot; value=&quot;開始實驗&quot; onclick=&quot;start_onclick()&quot; class=&quot;control-button&quot;&gt;&#10;                &lt;input id=&quot;viewResult&quot; type=&quot;button&quot; value=&quot;查看結果&quot; onclick=&quot;view_onclick()&quot; class=&quot;control-button&quot; disabled&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;prompt-text&quot; id=&quot;promptText&quot;&gt;&#10;                第三個音更像...&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;firstBtn&quot; type=&quot;button&quot; value=&quot;第一個音&quot; onclick=&quot;processAnswer(1)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;                &lt;input id=&quot;secondBtn&quot; type=&quot;button&quot; value=&quot;第二個音&quot; onclick=&quot;processAnswer(2)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;feedback&quot;&gt;&#10;                &lt;img id=&quot;smile&quot; src=&quot;Media/null.gif&quot; width=&quot;100&quot; height=&quot;84&quot; alt=&quot;Feedback&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;text1&quot; class=&quot;status&quot; readonly&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;progress-bar-container&quot;&gt;&#10;                &lt;div class=&quot;progress-bar&quot; id=&quot;progressBar&quot; style=&quot;width: 0%&quot;&gt;&lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;progress-label&quot; id=&quot;progressLabel&quot;&gt;Progress: 0%&lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;debug-info&quot; id=&quot;debugInfo&quot;&gt;&#10;                Debug information will be displayed here&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot;&gt;&#10;                &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;showDebug&quot; onclick=&quot;toggleDebug()&quot;&gt; Show Debug Info&lt;/label&gt;&#10;                &lt;button onclick=&quot;testAudio()&quot;&gt;Test All Audio&lt;/button&gt;&#10;                &lt;button onclick=&quot;showDiagnostics()&quot;&gt;Diagnostics&lt;/button&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot; id=&quot;exportBtn&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div id=&quot;resultsContainer&quot; class=&quot;results-container&quot;&gt;&#10;            &lt;h2 class=&quot;result-heading&quot;&gt;Dynamic Pitch Discrimination Test Results (ABX)&lt;/h2&gt;&#10;            &#10;            &lt;div class=&quot;highlight-box&quot;&gt;&#10;                &lt;h3 style=&quot;margin-top: 0;&quot;&gt;Just Noticeable Difference (JND)&lt;/h3&gt;&#10;                &lt;div class=&quot;highlight-value&quot; id=&quot;jndValue&quot;&gt;--&lt;/div&gt;&#10;                &lt;p style=&quot;margin-bottom: 0; font-size: 14px; color: #666;&quot;&gt;&#10;                    This represents the minimum detectable difference in modulation window duration&lt;br&gt;&#10;                    &lt;strong&gt;Smaller JND = Better discrimination ability&lt;/strong&gt;&#10;                &lt;/p&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Perceptual Discrimination Thresholds&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Parameter&lt;/th&gt;&#10;                        &lt;th&gt;Standard (Reference)&lt;/th&gt;&#10;                        &lt;th&gt;Threshold (Your JND)&lt;/th&gt;&#10;                        &lt;th&gt;Difference Ratio&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;resultTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;div class=&quot;result-interpretation&quot; id=&quot;resultInterpretation&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Detailed Threshold Metrics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Metric&lt;/th&gt;&#10;                        &lt;th&gt;Value&lt;/th&gt;&#10;                        &lt;th&gt;Interpretation&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;detailedMetricsBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;h3&gt;Performance Statistics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Metric&lt;/th&gt;&#10;                        &lt;th&gt;Value&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;performanceStatsBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;button class=&quot;print-button&quot; onclick=&quot;printResults()&quot;&gt;Print Results&lt;/button&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot; style=&quot;margin-top: 20px;&quot;&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;button class=&quot;back-button&quot; onclick=&quot;backToExperiment()&quot;&gt;Back to Experiment&lt;/button&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div class=&quot;diagnostic-overlay&quot; id=&quot;diagnosticOverlay&quot;&gt;&#10;            &lt;div class=&quot;diagnostic-content&quot;&gt;&#10;                &lt;span class=&quot;diagnostic-close&quot; onclick=&quot;closeDiagnostics()&quot;&gt;&amp;times;&lt;/span&gt;&#10;                &lt;h2 class=&quot;diagnostic-heading&quot;&gt;Experiment Diagnostics&lt;/h2&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Test Status&lt;/h3&gt;&#10;                    &lt;table class=&quot;statistics-table&quot;&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;th&gt;Trials&lt;/th&gt;&#10;                            &lt;th&gt;Reversals&lt;/th&gt;&#10;                            &lt;th&gt;Status&lt;/th&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td id=&quot;totalTrials&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;totalReversals&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;testStatus&quot;&gt;Not started&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                    &lt;/table&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Audio Files Check&lt;/h3&gt;&#10;                    &lt;p&gt;Verifying necessary audio files:&lt;/p&gt;&#10;                    &lt;div id=&quot;audioFileStatus&quot; class=&quot;diagnostic-file-status&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Reversal History&lt;/h3&gt;&#10;                    &lt;div id=&quot;reversalHistory&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Recommendations&lt;/h3&gt;&#10;                    &lt;div id=&quot;diagnosticRecommendations&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-actions&quot;&gt;&#10;                    &lt;button class=&quot;diagnostic-action-button continue-button&quot; onclick=&quot;closeDiagnostics()&quot;&gt;Close&lt;/button&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;audio id=&quot;low_falling_standard&quot; src=&quot;Media/low_falling_standard.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;    &lt;audio id=&quot;low_falling_1&quot; src=&quot;Media/low_falling_1.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_falling_2&quot; src=&quot;Media/low_falling_2.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_falling_3&quot; src=&quot;Media/low_falling_3.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_falling_4&quot; src=&quot;Media/low_falling_4.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_falling_5&quot; src=&quot;Media/low_falling_5.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_falling_6&quot; src=&quot;Media/low_falling_6.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_falling_7&quot; src=&quot;Media/low_falling_7.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_falling_8&quot; src=&quot;Media/low_falling_8.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_falling_9&quot; src=&quot;Media/low_falling_9.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;&lt;script&gt;&#10;function getLocalTimestamp() {&#10;    const now = new Date();&#10;    const year = now.getFullYear();&#10;    const month = String(now.getMonth() + 1).padStart(2, '0');&#10;    const day = String(now.getDate()).padStart(2, '0');&#10;    const hours = String(now.getHours()).padStart(2, '0');&#10;    const minutes = String(now.getMinutes()).padStart(2, '0');&#10;    const seconds = String(now.getSeconds()).padStart(2, '0');&#10;    const milliseconds = String(now.getMilliseconds()).padStart(3, '0');&#10;    &#10;    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;&#10;}&#10;&#10;// Stimulus parameters for dynamic pitch modulation&#10;const STIMULUS_DURATION = 450; // ms, total duration&#10;const STANDARD_WINDOW = 400; // ms, modulation window for standard (100%)&#10;const STANDARD_WINDOW_PERCENT = 100; // percentage&#10;&#10;// Modulation window percentages for each difficulty level&#10;const MODULATION_WINDOWS = {&#10;    1: 20,   // easiest - 20% of standard window (80 ms)&#10;    2: 40,   // 160 ms&#10;    3: 50,   // 200 ms&#10;    4: 60,   // 240 ms&#10;    5: 70,   // 280 ms&#10;    6: 80,   // 320 ms&#10;    7: 90,   // 360 ms&#10;    8: 95,   // 380 ms&#10;    9: 98    // hardest - 98% of standard window (392 ms)&#10;};&#10;&#10;function getModulationWindowDuration(level) {&#10;    return (MODULATION_WINDOWS[level] / 100) * STANDARD_WINDOW;&#10;}&#10;&#10;const PITCH_FALL_SEMITONES = 1.0;&#10;&#10;function getModulationRate(level) {&#10;    const windowDuration = getModulationWindowDuration(level);&#10;    const windowDurationSec = windowDuration / 1000;&#10;    return PITCH_FALL_SEMITONES / windowDurationSec;&#10;}&#10;&#10;function getModulationSlope(level) {&#10;    const windowDuration = getModulationWindowDuration(level);&#10;    return PITCH_FALL_SEMITONES / windowDuration;&#10;}&#10;&#10;// Adaptive threshold experiment constants&#10;const MAXREVERSALS = 10;&#10;const MAXITERATIONS = 50;&#10;const LOWERLIMIT = 1;&#10;const DECREASING = -1;&#10;const INCREASING = 1;&#10;const MINIMUMREVERSALS = 6;&#10;const THRESHOLD_REVERSAL_COUNT = 6;&#10;&#10;// Experiment state variables&#10;var CorrectAnswer;&#10;var CorrectResponses = 0;&#10;var Direction = DECREASING;&#10;var Reversals = [];&#10;var NumberOfReversals = 0;&#10;var currentLevel = 5;&#10;var numberOfIterations = 0;&#10;var sentAverage = 0.0;&#10;var sentStdev = 0.0;&#10;var isTestComplete = false;&#10;var audioUnlocked = false;&#10;var allFilesPresent = true;&#10;var trialRecords = [];&#10;var stimulusEndTime = 0;&#10;&#10;// ABX variables&#10;var standardIsFirst;&#10;var comparisonSound;&#10;var standardSound;&#10;var xSound;&#10;&#10;var isReplayTrial = false;&#10;&#10;// Results variables - JND-based&#10;var jndAbsoluteDifference = 0;&#10;var jndRatio = 0;&#10;var jndPercentDifference = 0;&#10;var thresholdWindowDuration = 0;&#10;var thresholdWindowPercent = 0;&#10;var thresholdModulationRate = 0;&#10;var thresholdSlope = 0;&#10;var webersRatio = 0;&#10;&#10;function printResults() {&#10;    window.print();&#10;}&#10;&#10;function logDebug(message) {&#10;    console.log(message);&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var now = new Date();&#10;    var timeStr = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + '.' + now.getMilliseconds();&#10;    debugArea.innerHTML += '&lt;p&gt;[' + timeStr + '] ' + message + '&lt;/p&gt;';&#10;    debugArea.scrollTop = debugArea.scrollHeight;&#10;}&#10;&#10;function toggleDebug() {&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var checkbox = document.getElementById('showDebug');&#10;    debugArea.style.display = checkbox.checked ? 'block' : 'none';&#10;}&#10;&#10;function showDiagnostics() {&#10;    updateDiagnostics();&#10;    document.getElementById('diagnosticOverlay').style.display = 'flex';&#10;}&#10;&#10;function closeDiagnostics() {&#10;    document.getElementById('diagnosticOverlay').style.display = 'none';&#10;}&#10;&#10;function updateDiagnostics() {&#10;    document.getElementById('totalTrials').innerText = numberOfIterations;&#10;    document.getElementById('totalReversals').innerText = NumberOfReversals;&#10;    &#10;    let testStatus = getTestStatus();&#10;    document.getElementById('testStatus').innerText = testStatus.text;&#10;    document.getElementById('testStatus').className = `direction-stats-${testStatus.class}`;&#10;    &#10;    checkAudioFiles();&#10;    &#10;    let reversalHistoryHtml = '';&#10;    if (Reversals.length === 0) {&#10;        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';&#10;    } else {&#10;        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals.join(', ') + '&lt;/p&gt;';&#10;        reversalHistoryHtml += '&lt;p&gt;Corresponding modulation windows: ';&#10;        reversalHistoryHtml += Reversals.map(level =&gt; MODULATION_WINDOWS[level] + '% (' + getModulationWindowDuration(level) + ' ms)').join(', ') + '&lt;/p&gt;';&#10;    }&#10;    &#10;    document.getElementById('reversalHistory').innerHTML = reversalHistoryHtml;&#10;    &#10;    generateDiagnosticRecommendations();&#10;}&#10;&#10;function getTestStatus() {&#10;    if (isTestComplete) {&#10;        return { text: &quot;Complete&quot;, class: &quot;good&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals &lt; 1) {&#10;        return { text: &quot;Not enough data&quot;, class: &quot;bad&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals &lt; MINIMUMREVERSALS) {&#10;        return { text: &quot;Incomplete (&quot; + NumberOfReversals + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals)&quot;, class: &quot;warning&quot; };&#10;    }&#10;    &#10;    return { text: &quot;In progress&quot;, class: &quot;good&quot; };&#10;}&#10;&#10;function checkAudioFiles() {&#10;    const requiredFiles = [&#10;        &quot;low_falling_standard&quot;,&#10;        &quot;low_falling_1&quot;, &quot;low_falling_2&quot;, &quot;low_falling_3&quot;, &quot;low_falling_4&quot;, &quot;low_falling_5&quot;, &#10;        &quot;low_falling_6&quot;, &quot;low_falling_7&quot;, &quot;low_falling_8&quot;, &quot;low_falling_9&quot;&#10;    ];&#10;    &#10;    let statusHtml = '';&#10;    allFilesPresent = true;&#10;    &#10;    requiredFiles.forEach(function(fileId) {&#10;        const audioElement = document.getElementById(fileId);&#10;        const fileFound = audioElement !== null;&#10;        &#10;        if (!fileFound) {&#10;            allFilesPresent = false;&#10;        }&#10;        &#10;        statusHtml += `&lt;div class=&quot;file-status-item ${fileFound ? 'file-found' : 'file-missing'}&quot;&gt;${fileId}: ${fileFound ? 'Found' : 'Missing'}&lt;/div&gt;`;&#10;    });&#10;    &#10;    document.getElementById('audioFileStatus').innerHTML = statusHtml;&#10;}&#10;&#10;function generateDiagnosticRecommendations() {&#10;    let recommendations = '';&#10;    let hasIssues = false;&#10;    &#10;    if (!allFilesPresent) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Critical Issue:&lt;/strong&gt; Some required audio files are missing. Please ensure all files are properly loaded.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (numberOfIterations &gt;= MAXITERATIONS &amp;&amp; NumberOfReversals &lt; MINIMUMREVERSALS) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Issue:&lt;/strong&gt; Reached maximum trials but has insufficient reversals. This might indicate audio file issues or participant response patterns.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (!hasIssues) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Good:&lt;/strong&gt; No major issues detected with the experiment setup.&lt;/p&gt;';&#10;        &#10;        if (isTestComplete) {&#10;            recommendations += '&lt;p&gt;Test is complete.&lt;/p&gt;';&#10;        } else {&#10;            recommendations += '&lt;p&gt;Test is still in progress.&lt;/p&gt;';&#10;        }&#10;    }&#10;    &#10;    document.getElementById('diagnosticRecommendations').innerHTML = recommendations;&#10;}&#10;&#10;function testAudio() {&#10;    logDebug(&quot;Starting to test all audio files...&quot;);&#10;    var audios = document.querySelectorAll('audio');&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    var index = 0;&#10;    function playNext() {&#10;        if (index &gt;= audios.length) {&#10;            logDebug(&quot;All audio testing complete!&quot;);&#10;            return;&#10;        }&#10;        &#10;        var audio = audios[index];&#10;        logDebug(&quot;Testing audio #&quot; + (index + 1) + &quot;: &quot; + audio.id);&#10;        &#10;        audio.currentTime = 0;&#10;        &#10;        var playPromise = audio.play();&#10;        if (playPromise !== undefined) {&#10;            playPromise.then(function() {&#10;                logDebug(audio.id + &quot; played successfully&quot;);&#10;                &#10;                audio.onended = function() {&#10;                    logDebug(audio.id + &quot; playback ended&quot;);&#10;                    index++;&#10;                    setTimeout(playNext, 500);&#10;                };&#10;            }).catch(function(error) {&#10;                logDebug(&quot;Failed to play &quot; + audio.id + &quot;: &quot; + error);&#10;                index++;&#10;                setTimeout(playNext, 500);&#10;            });&#10;        }&#10;    }&#10;    &#10;    playNext();&#10;}&#10;&#10;function unlockAudioContext() {&#10;    logDebug(&quot;Attempting to unlock audio context...&quot;);&#10;    &#10;    var silentAudio = new Audio();&#10;    silentAudio.src = &quot;data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA&quot;;&#10;    &#10;    var promise = silentAudio.play();&#10;    if (promise !== undefined) {&#10;        promise.then(function() {&#10;            logDebug(&quot;Audio context unlocked successfully&quot;);&#10;            silentAudio.remove();&#10;            audioUnlocked = true;&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to unlock audio context: &quot; + error);&#10;        });&#10;    }&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    for (var i = 0; i &lt; allAudios.length; i++) {&#10;        var audio = allAudios[i];&#10;        audio.load();&#10;    }&#10;    &#10;    logDebug(&quot;Preloaded &quot; + allAudios.length + &quot; audio files&quot;);&#10;}&#10;&#10;function resetPage() {&#10;    numberOfIterations++;&#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('firstBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('secondBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    if (isTestComplete) {&#10;        document.getElementById('start').disabled = false;&#10;        document.getElementById('viewResult').disabled = false;&#10;        document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;        updateProgressBar(100);&#10;        return;&#10;    }&#10;    &#10;    if ((numberOfIterations &gt;= MAXITERATIONS) || (NumberOfReversals &gt;= MAXREVERSALS)) {&#10;        if (NumberOfReversals &gt;= MINIMUMREVERSALS) {&#10;            calculateResults();&#10;            isTestComplete = true;&#10;            document.getElementById('start').disabled = false;&#10;            document.getElementById('viewResult').disabled = false;&#10;            document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;            updateProgressBar(100);&#10;        } else {&#10;            logDebug(&quot;Reached max iterations but has only &quot; + NumberOfReversals + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals. Showing diagnostics.&quot;);&#10;            document.getElementById('text1').value = &quot;Insufficient data. Check diagnostics.&quot;;&#10;            setTimeout(function() {&#10;                showDiagnostics();&#10;            }, 500);&#10;            return;&#10;        }&#10;    } else {&#10;        updateProgressBar();&#10;        beginIteration();&#10;    }&#10;}&#10;&#10;function updateProgressBar(forcePercent) {&#10;    if (typeof forcePercent === 'number') {&#10;        document.getElementById('progressBar').style.width = forcePercent + '%';&#10;        document.getElementById('progressLabel').textContent = 'Progress: ' + forcePercent + '%';&#10;        return;&#10;    }&#10;    &#10;    const maxValue = Math.max(MAXREVERSALS, MAXITERATIONS);&#10;    const currentValue = isTestComplete ? maxValue : Math.max(NumberOfReversals, numberOfIterations);&#10;    const totalPercent = Math.min(100 * (currentValue / maxValue), 100);&#10;    &#10;    document.getElementById('progressBar').style.width = totalPercent + '%';&#10;    document.getElementById('progressLabel').textContent = 'Progress: ' + Math.round(totalPercent) + '%';&#10;}&#10;&#10;function calculateResults() {&#10;    let sum = 0.0, stddevsum = 0.0, average = 0.0, stdev = 0.0, counter = 0;&#10;    &#10;    for (let i = 0; i &lt; Reversals.length; i++) {&#10;        if (Reversals[i] &gt; 0) counter++;&#10;    }&#10;    &#10;    if (counter &lt; MINIMUMREVERSALS) {&#10;        logDebug(&quot;Test has insufficient data&quot;);&#10;        alert(&quot;Test has insufficient data. Please complete the test again.&quot;);&#10;        return;&#10;    }&#10;    &#10;    const startIndex = Math.max(0, NumberOfReversals - THRESHOLD_REVERSAL_COUNT);&#10;    counter = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0) {&#10;            sum += level;&#10;            counter++;&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 0) {&#10;        average = sum / counter;&#10;        average = parseFloat(average.toFixed(2));&#10;    }&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0) {&#10;            stddevsum += Math.pow(level - average, 2);&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 1) {&#10;        stdev = Math.sqrt(stddevsum / (counter - 1));&#10;        stdev = parseFloat(stdev.toFixed(2));&#10;    }&#10;    &#10;    sentAverage = average;&#10;    sentStdev = stdev;&#10;    &#10;    thresholdWindowPercent = calculateAverageWindowPercent(startIndex);&#10;    thresholdWindowDuration = (thresholdWindowPercent / 100) * STANDARD_WINDOW;&#10;    thresholdModulationRate = PITCH_FALL_SEMITONES / (thresholdWindowDuration / 1000);&#10;    thresholdSlope = PITCH_FALL_SEMITONES / thresholdWindowDuration;&#10;&#10;    jndAbsoluteDifference = STANDARD_WINDOW - thresholdWindowDuration;&#10;    jndRatio = thresholdWindowDuration / STANDARD_WINDOW;&#10;    jndPercentDifference = 100 - thresholdWindowPercent;&#10;    webersRatio = jndAbsoluteDifference / STANDARD_WINDOW;&#10;    &#10;    logDebug(&quot;Test complete! Average difficulty level: &quot; + average.toFixed(2));&#10;    logDebug(&quot;Threshold window: &quot; + thresholdWindowPercent.toFixed(2) + &quot;% (&quot; + thresholdWindowDuration.toFixed(2) + &quot; ms)&quot;);&#10;    logDebug(&quot;JND Absolute Difference: &quot; + jndAbsoluteDifference.toFixed(2) + &quot; ms&quot;);&#10;    logDebug(&quot;JND Ratio: &quot; + jndRatio.toFixed(4));&#10;    logDebug(&quot;JND Percent Difference: &quot; + jndPercentDifference.toFixed(2) + &quot;%&quot;);&#10;    logDebug(&quot;Weber's Ratio: &quot; + webersRatio.toFixed(4));&#10;    &#10;    document.getElementById('text1').value = &quot;Test complete! JND: &quot; + jndAbsoluteDifference.toFixed(1) + &quot; ms&quot;;&#10;}&#10;&#10;function calculateAverageWindowPercent(startIndex) {&#10;    let sum = 0;&#10;    let count = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0 &amp;&amp; MODULATION_WINDOWS[level] !== undefined) {&#10;            sum += MODULATION_WINDOWS[level];&#10;            count++;&#10;        }&#10;    }&#10;    &#10;    return count &gt; 0 ? sum / count : 0;&#10;}&#10;&#10;function calculateReactionTimeStats() {&#10;    let allRTs = trialRecords.map(t =&gt; parseFloat(t.reactionTime));&#10;    &#10;    return {&#10;        mean: allRTs.length ? (allRTs.reduce((a, b) =&gt; a + b, 0) / allRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;        median: allRTs.length ? calculateMedian(allRTs).toFixed(0) : &quot;N/A&quot;,&#10;        sd: allRTs.length &gt; 1 ? calculateSD(allRTs).toFixed(0) : &quot;N/A&quot;&#10;    };&#10;}&#10;&#10;function calculateAccuracyStats() {&#10;    let allTrials = trialRecords;&#10;    &#10;    return {&#10;        correct: allTrials.filter(t =&gt; t.isCorrect).length,&#10;        total: allTrials.length,&#10;        percentage: allTrials.length ? &#10;            (allTrials.filter(t =&gt; t.isCorrect).length / allTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;    };&#10;}&#10;&#10;function calculateMedian(values) {&#10;    if (!values.length) return 0;&#10;    &#10;    const sortedValues = values.slice().sort((a, b) =&gt; a - b);&#10;    const mid = Math.floor(sortedValues.length / 2);&#10;    &#10;    return sortedValues.length % 2 === 0 ? &#10;        (sortedValues[mid - 1] + sortedValues[mid]) / 2 : &#10;        sortedValues[mid];&#10;}&#10;&#10;function calculateSD(values) {&#10;    if (values.length &lt;= 1) return 0;&#10;    &#10;    const mean = values.reduce((a, b) =&gt; a + b, 0) / values.length;&#10;    const variance = values.map(x =&gt; Math.pow(x - mean, 2)).reduce((a, b) =&gt; a + b, 0) / (values.length - 1);&#10;    &#10;    return Math.sqrt(variance);&#10;}&#10;&#10;function displayResults() {&#10;    logDebug(&quot;Displaying results&quot;);&#10;    &#10;    let hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;&#10;    &#10;    if (!hasData) {&#10;        let message = &quot;Warning: Insufficient data. Results may not be reliable.&quot;;&#10;        &#10;        if (confirm(message + &quot;\n\nWould you like to retry the experiment?&quot;)) {&#10;            window_onload();&#10;            return;&#10;        }&#10;    }&#10;    &#10;    document.getElementById('experimentContainer').style.display = 'none';&#10;    document.getElementById('resultsContainer').style.display = 'block';&#10;    &#10;    if (hasData) {&#10;        document.getElementById('jndValue').innerHTML = &#10;            jndAbsoluteDifference.toFixed(2) + ' ms&lt;br&gt;' +&#10;            '&lt;span style=&quot;font-size: 18px;&quot;&gt;(' + jndPercentDifference.toFixed(2) + '% difference from standard)&lt;/span&gt;';&#10;    } else {&#10;        document.getElementById('jndValue').textContent = 'Insufficient Data';&#10;    }&#10;    &#10;    var tableBody = document.getElementById('resultTableBody');&#10;    tableBody.innerHTML = '';&#10;    &#10;    var windowRow = document.createElement('tr');&#10;    windowRow.innerHTML = &#10;        '&lt;td&gt;Modulation Window Duration&lt;/td&gt;' +&#10;        '&lt;td&gt;' + STANDARD_WINDOW + ' ms (100%)&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? thresholdWindowDuration.toFixed(2) + ' ms (' + thresholdWindowPercent.toFixed(2) + '%)' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? jndRatio.toFixed(4) + ' : 1&lt;br&gt;(Threshold/Standard)' : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(windowRow);&#10;    &#10;    var diffRow = document.createElement('tr');&#10;    diffRow.innerHTML = &#10;        '&lt;td&gt;Absolute Difference (JND)&lt;/td&gt;' +&#10;        '&lt;td&gt;0 ms (reference)&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? jndAbsoluteDifference.toFixed(2) + ' ms' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? 'Weber Ratio: ' + webersRatio.toFixed(4) : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(diffRow);&#10;    &#10;    var rateStandard = PITCH_FALL_SEMITONES / (STANDARD_WINDOW / 1000);&#10;    var rateRow = document.createElement('tr');&#10;    rateRow.innerHTML = &#10;        '&lt;td&gt;Modulation Rate&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rateStandard.toFixed(4) + ' semitones/s&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? thresholdModulationRate.toFixed(4) + ' semitones/s' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? (thresholdModulationRate / rateStandard).toFixed(4) + ' : 1' : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(rateRow);&#10;    &#10;    var interpretation = document.getElementById('resultInterpretation');&#10;    let interpretationHtml = '&lt;h3 style=&quot;margin-top: 0;&quot;&gt;Performance Interpretation&lt;/h3&gt;';&#10;    &#10;    if (hasData) {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Your Just Noticeable Difference (JND):&lt;/strong&gt;&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;You can reliably detect a difference when the modulation window changes by &lt;strong&gt;' + &#10;            jndAbsoluteDifference.toFixed(2) + ' ms&lt;/strong&gt; (or &lt;strong&gt;' + jndPercentDifference.toFixed(2) + &#10;            '%&lt;/strong&gt; of the standard 400 ms window).&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;In other words, you can discriminate between:&lt;/p&gt;';&#10;        interpretationHtml += '&lt;ul&gt;';&#10;        interpretationHtml += '&lt;li&gt;Standard stimulus: 400 ms modulation window&lt;/li&gt;';&#10;        interpretationHtml += '&lt;li&gt;Your threshold: ' + thresholdWindowDuration.toFixed(2) + ' ms modulation window&lt;/li&gt;';&#10;        interpretationHtml += '&lt;li&gt;Difference: ' + jndAbsoluteDifference.toFixed(2) + ' ms&lt;/li&gt;';&#10;        interpretationHtml += '&lt;/ul&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Weber\'s Ratio:&lt;/strong&gt; ' + webersRatio.toFixed(4) + &#10;            ' (smaller Weber\'s ratio = better discrimination sensitivity)&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;&lt;em&gt;Note: A &lt;strong&gt;smaller JND&lt;/strong&gt; indicates &lt;strong&gt;better sensitivity&lt;/strong&gt; to dynamic pitch changes, ' +&#10;            'as it means you can detect smaller differences between stimuli.&lt;/em&gt;&lt;/p&gt;';&#10;    } else {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Complete results not available due to insufficient data.&lt;/p&gt;';&#10;    }&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    const accuracyStats = calculateAccuracyStats();&#10;    &#10;    interpretationHtml += '&lt;p&gt;&lt;strong&gt;Overall Performance:&lt;/strong&gt; ' + accuracyStats.percentage + &#10;        '% accuracy with average reaction time of ' + rtStats.mean + ' ms across ' + &#10;        accuracyStats.total + ' trials.&lt;/p&gt;';&#10;    &#10;    interpretation.innerHTML = interpretationHtml;&#10;    &#10;    var detailedBody = document.getElementById('detailedMetricsBody');&#10;    detailedBody.innerHTML = '';&#10;    &#10;    var metrics = [&#10;        { name: 'Average Difficulty Level', value: hasData ? sentAverage.toFixed(2) : 'N/A', interp: hasData ? 'SD: ' + sentStdev.toFixed(2) : 'N/A' },&#10;        { name: 'Threshold Slope', value: hasData ? thresholdSlope.toFixed(6) + ' semitones/ms' : 'N/A', interp: hasData ? 'Rate of pitch change' : 'N/A' },&#10;        { name: 'Number of Reversals', value: NumberOfReversals, interp: 'Minimum required: ' + MINIMUMREVERSALS },&#10;        { name: 'Total Trials', value: numberOfIterations, interp: 'Maximum allowed: ' + MAXITERATIONS }&#10;    ];&#10;    &#10;    metrics.forEach(function(metric) {&#10;        var row = document.createElement('tr');&#10;        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;&lt;td&gt;' + metric.interp + '&lt;/td&gt;';&#10;        detailedBody.appendChild(row);&#10;    });&#10;    &#10;    var perfBody = document.getElementById('performanceStatsBody');&#10;    perfBody.innerHTML = '';&#10;    &#10;    var perfMetrics = [&#10;        { name: 'Total Trials', value: accuracyStats.total },&#10;        { name: 'Correct Responses', value: accuracyStats.correct },&#10;        { name: 'Overall Accuracy', value: accuracyStats.percentage + '%' },&#10;        { name: 'Mean Reaction Time', value: rtStats.mean + ' ms' },&#10;        { name: 'Median Reaction Time', value: rtStats.median + ' ms' },&#10;        { name: 'RT Standard Deviation', value: rtStats.sd + ' ms' }&#10;    ];&#10;    &#10;    perfMetrics.forEach(function(metric) {&#10;        var row = document.createElement('tr');&#10;        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;';&#10;        perfBody.appendChild(row);&#10;    });&#10;}&#10;&#10;function backToExperiment() {&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;}&#10;&#10;function view_onclick() {&#10;    logDebug(&quot;View results button clicked&quot;);&#10;    &#10;    if (!isTestComplete &amp;&amp; NumberOfReversals &gt;= MINIMUMREVERSALS) {&#10;        calculateResults();&#10;        isTestComplete = true;&#10;    }&#10;    &#10;    displayResults();&#10;}&#10;&#10;function beginIteration() {&#10;    isReplayTrial = false;&#10;    &#10;    standardIsFirst = Math.random() &lt; 0.5;&#10;    var xIsStandard = Math.random() &lt; 0.5;&#10;    &#10;    if (xIsStandard) {&#10;        CorrectAnswer = standardIsFirst ? 1 : 2;&#10;    } else {&#10;        CorrectAnswer = standardIsFirst ? 2 : 1;&#10;    }&#10;    &#10;    logDebug(&quot;Starting new iteration #&quot; + numberOfIterations + &#10;             &quot;, Standard is &quot; + (standardIsFirst ? &quot;first&quot; : &quot;second&quot;) +&#10;             &quot;, X is &quot; + (xIsStandard ? &quot;standard&quot; : &quot;comparison&quot;) +&#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Difficulty level: &quot; + currentLevel +&#10;             &quot;, Modulation window: &quot; + MODULATION_WINDOWS[currentLevel] + &quot;% (&quot; + &#10;             getModulationWindowDuration(currentLevel) + &quot; ms)&quot;);&#10;    &#10;    setTimeout(function() {&#10;        playABXSequence(xIsStandard);&#10;    }, 1000);&#10;}&#10;&#10;function clearButtonAnimations() {&#10;    document.getElementById('firstBtn').classList.remove('button-playing');&#10;    document.getElementById('secondBtn').classList.remove('button-playing');&#10;}&#10;&#10;function playABXSequence(xIsStandard) {&#10;    logDebug(&quot;Playing ABX sequence&quot;);&#10;    &#10;    clearButtonAnimations();&#10;&#10;    standardSound = document.getElementById('low_falling_standard');&#10;    comparisonSound = document.getElementById(&quot;low_falling_&quot; + currentLevel);&#10;&#10;    xSound = xIsStandard ? standardSound : comparisonSound;&#10;    &#10;    if (!standardSound || !comparisonSound) {&#10;        logDebug(&quot;Error: Cannot find audio elements!&quot;);&#10;        document.getElementById('text1').value = &quot;出錯：找不到音頻文件&quot;;&#10;        setTimeout(function() {&#10;            showDiagnostics();&#10;        }, 1000);&#10;        return;&#10;    }&#10;    &#10;    var firstSound = standardIsFirst ? standardSound : comparisonSound;&#10;    document.getElementById('text1').value = &quot;播放第一個音&quot;;&#10;    &#10;    document.getElementById('firstBtn').classList.add('button-playing');&#10;    &#10;    firstSound.currentTime = 0;&#10;    var playPromise1 = firstSound.play();&#10;    &#10;    if (playPromise1 !== undefined) {&#10;        playPromise1.then(function() {&#10;            logDebug(&quot;First sound (A) played successfully&quot;);&#10;            &#10;            firstSound.onended = function() {&#10;                logDebug(&quot;First sound ended&quot;);&#10;                &#10;                document.getElementById('firstBtn').classList.remove('button-playing');&#10;                &#10;                setTimeout(function() {&#10;                    var secondSound = standardIsFirst ? comparisonSound : standardSound;&#10;                    document.getElementById('text1').value = &quot;播放第二個音&quot;;&#10;                    &#10;                    document.getElementById('secondBtn').classList.add('button-playing');&#10;                    &#10;                    secondSound.currentTime = 0;&#10;                    var playPromise2 = secondSound.play();&#10;                    &#10;                    if (playPromise2 !== undefined) {&#10;                        playPromise2.then(function() {&#10;                            logDebug(&quot;Second sound (B) played successfully&quot;);&#10;                            &#10;                            secondSound.onended = function() {&#10;                                logDebug(&quot;Second sound ended&quot;);&#10;                                &#10;                                document.getElementById('secondBtn').classList.remove('button-playing');&#10;                                &#10;                                setTimeout(function() {&#10;                                    document.getElementById('text1').value = &quot;播放第三個音&quot;;&#10;                                    &#10;                                    xSound.currentTime = 0;&#10;                                    var playPromise3 = xSound.play();&#10;                                    &#10;                                    if (playPromise3 !== undefined) {&#10;                                        playPromise3.then(function() {&#10;                                            logDebug(&quot;Third sound (X) played successfully&quot;);&#10;                                            &#10;                                            xSound.onended = function() {&#10;                                                logDebug(&quot;Third sound ended, enabling response buttons&quot;);&#10;                                                &#10;                                                stimulusEndTime = performance.now();&#10;                                                &#10;                                                document.getElementById('text1').value = &quot;請作出選擇&quot;;&#10;                                                document.getElementById('promptText').style.visibility = 'visible';&#10;                                                &#10;                                                document.getElementById('firstBtn').disabled = false;&#10;                                                document.getElementById('secondBtn').disabled = false;&#10;                                                document.getElementById('firstBtn').style.background = &quot;#66CCFF&quot;;&#10;                                                document.getElementById('secondBtn').style.background = &quot;#66CCFF&quot;;&#10;                                            };&#10;                                        }).catch(function(error) {&#10;                                            logDebug(&quot;Failed to play third sound: &quot; + error);&#10;                                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                                            clearButtonAnimations();&#10;                                            setTimeout(showDiagnostics, 1000);&#10;                                        });&#10;                                    }&#10;                                }, 1000);&#10;                            };&#10;                        }).catch(function(error) {&#10;                            logDebug(&quot;Failed to play second sound: &quot; + error);&#10;                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                            clearButtonAnimations();&#10;                            setTimeout(showDiagnostics, 1000);&#10;                        });&#10;                    }&#10;                }, 1000);&#10;            };&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to play first sound: &quot; + error);&#10;            document.getElementById('text1').value = &quot;音頻播放錯誤，請刷新頁面&quot;;&#10;            clearButtonAnimations();&#10;            setTimeout(showDiagnostics, 1000);&#10;        });&#10;    }&#10;}&#10;&#10;function start_onclick() {&#10;    logDebug(&quot;Starting experiment&quot;);&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    checkAudioFiles();&#10;    if (!allFilesPresent) {&#10;        logDebug(&quot;Cannot start experiment: Some audio files are missing&quot;);&#10;        document.getElementById('text1').value = &quot;音頻缺失&quot;;&#10;        showDiagnostics();&#10;        return;&#10;    }&#10;    &#10;    window_onload();&#10;    document.getElementById('text1').value = &quot;開始實驗...&quot;;&#10;    updateProgressBar(0);&#10;    &#10;    setTimeout(function() {&#10;        beginIteration();&#10;        document.getElementById('start').disabled = true;&#10;        document.getElementById('viewResult').disabled = true;&#10;        document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;        document.getElementById('promptText').style.visibility = 'hidden';&#10;    }, 1000);&#10;}&#10;&#10;function gotReversal() {&#10;    NumberOfReversals++;&#10;    Reversals[NumberOfReversals - 1] = currentLevel;&#10;    Direction = -Direction;&#10;    logDebug(&quot;Recorded reversal #&quot; + NumberOfReversals + &quot; at difficulty &quot; + currentLevel + &#10;             &quot; (window: &quot; + MODULATION_WINDOWS[currentLevel] + &quot;%, &quot; + &#10;             getModulationWindowDuration(currentLevel) + &quot; ms)&quot;);&#10;}&#10;&#10;function processAnswer(Response) {&#10;    const reactionEndTime = performance.now();&#10;    const reactionTime = reactionEndTime - stimulusEndTime;&#10;    &#10;    logDebug(&quot;User answered: &quot; + (Response === 1 ? &quot;First&quot; : &quot;Second&quot;) + &#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Is replay: &quot; + isReplayTrial);&#10;    &#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    const isCorrect = (Response === CorrectAnswer);&#10;    &#10;    if (!isReplayTrial) {&#10;        const windowPercent = MODULATION_WINDOWS[currentLevel];&#10;        const windowDuration = getModulationWindowDuration(currentLevel);&#10;        const modulationRate = getModulationRate(currentLevel);&#10;        const slope = getModulationSlope(currentLevel);&#10;        &#10;        const trialInfo = {&#10;            trialNumber: numberOfIterations,&#10;            timestamp: getLocalTimestamp(),&#10;            difficultyLevel: currentLevel,&#10;            modulationWindowPercent: windowPercent,&#10;            modulationWindowDuration: windowDuration.toFixed(2),&#10;            modulationRate: modulationRate.toFixed(4),&#10;            slope: slope.toFixed(6),&#10;            userResponse: Response === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            correctResponse: CorrectAnswer === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            isCorrect: isCorrect,&#10;            reactionTime: reactionTime.toFixed(0),&#10;            isReversal: false,&#10;            stepDirection: Direction === DECREASING ? &quot;Increasing Difficulty&quot; : &quot;Decreasing Difficulty&quot;,&#10;            standardPosition: standardIsFirst ? &quot;First&quot; : &quot;Second&quot;&#10;        };&#10;        &#10;        trialRecords.push(trialInfo);&#10;    }&#10;    &#10;    if (isCorrect) {&#10;        logDebug(&quot;Correct answer&quot;);&#10;        document.getElementById('smile').src = &quot;Media/smiley.png&quot;;&#10;        document.getElementById('text1').value = &quot;正確！&quot;;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses++;&#10;            &#10;            if (CorrectResponses == 2) {&#10;                logDebug(&quot;Two correct answers in a row&quot;);&#10;                CorrectResponses = 0;&#10;                &#10;                if (Direction == INCREASING) {&#10;                    gotReversal();&#10;                    if (trialRecords.length &gt; 0) {&#10;                        trialRecords[trialRecords.length-1].isReversal = true;&#10;                    }&#10;                }&#10;                &#10;                changeLevel(DECREASING);&#10;            }&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            resetPage();&#10;        }, 1500);&#10;    } else {&#10;        logDebug(&quot;Incorrect answer - will replay stimulus&quot;);&#10;        document.getElementById('smile').src = &quot;Media/nosmiley.png&quot;;&#10;        &#10;        var correctAnswerText = CorrectAnswer === 1 ? &quot;第一個音&quot; : &quot;第二個音&quot;;&#10;        document.getElementById('text1').value = &quot;錯誤！正確答案是：&quot; + correctAnswerText;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses = 0;&#10;            &#10;            if (Direction == DECREASING) {&#10;                gotReversal();&#10;                if (trialRecords.length &gt; 0) {&#10;                    trialRecords[trialRecords.length-1].isReversal = true;&#10;                }&#10;            }&#10;            &#10;            changeLevel(INCREASING);&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            document.getElementById('text1').value = &quot;重播刺激音...&quot;;&#10;            &#10;            setTimeout(function() {&#10;                isReplayTrial = true;&#10;                &#10;                var xIsStandard = (standardIsFirst &amp;&amp; CorrectAnswer === 1) || &#10;                                  (!standardIsFirst &amp;&amp; CorrectAnswer === 2);&#10;                playABXSequence(xIsStandard);&#10;            }, 1000);&#10;        }, 2000);&#10;    }&#10;}&#10;&#10;function changeLevel(whichWay) {&#10;    var oldLevel = currentLevel;&#10;    var stepSize = NumberOfReversals &lt; 4 ? 2 : 1;&#10;    &#10;    if (whichWay == DECREASING) {&#10;        currentLevel = Math.min(9, currentLevel + stepSize);&#10;    } else {&#10;        currentLevel = Math.max(LOWERLIMIT, currentLevel - stepSize);&#10;    }&#10;    &#10;    logDebug(&quot;Difficulty changed from level &quot; + oldLevel + &quot; (&quot; + MODULATION_WINDOWS[oldLevel] + &quot;%, &quot; +&#10;             getModulationWindowDuration(oldLevel) + &quot; ms) to level &quot; + &#10;             currentLevel + &quot; (&quot; + MODULATION_WINDOWS[currentLevel] + &quot;%, &quot; +&#10;             getModulationWindowDuration(currentLevel) + &quot; ms) &quot; +&#10;             (whichWay == DECREASING ? &quot;(increasing difficulty)&quot; : &quot;(decreasing difficulty)&quot;));&#10;}&#10;&#10;function exportToCSV() {&#10;    const headers = [&#10;        &quot;Trial Number&quot;, &#10;        &quot;Timestamp&quot;, &#10;        &quot;Difficulty Level&quot;, &#10;        &quot;Modulation Window (%)&quot;,&#10;        &quot;Modulation Window (ms)&quot;,&#10;        &quot;Modulation Rate (semitones/s)&quot;,&#10;        &quot;Slope (semitones/ms)&quot;,&#10;        &quot;Standard Position&quot;,&#10;        &quot;User Response&quot;, &#10;        &quot;Correct Response&quot;, &#10;        &quot;Is Correct&quot;, &#10;        &quot;Reaction Time (ms)&quot;, &#10;        &quot;Is Reversal&quot;,&#10;        &quot;Step Direction&quot;&#10;    ];&#10;    &#10;    const csvRows = [];&#10;    csvRows.push(headers.join(&quot;,&quot;));&#10;    &#10;    trialRecords.forEach(function(trial) {&#10;        const row = [&#10;            trial.trialNumber,&#10;            trial.timestamp,&#10;            trial.difficultyLevel,&#10;            trial.modulationWindowPercent,&#10;            trial.modulationWindowDuration,&#10;            trial.modulationRate,&#10;            trial.slope,&#10;            trial.standardPosition,&#10;            trial.userResponse,&#10;            trial.correctResponse,&#10;            trial.isCorrect ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.reactionTime,&#10;            trial.isReversal ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.stepDirection&#10;        ];&#10;        csvRows.push(row.join(&quot;,&quot;));&#10;    });&#10;    &#10;    csvRows.push(&quot;\nRESULTS SUMMARY - JUST NOTICEABLE DIFFERENCE (JND)&quot;);&#10;    csvRows.push(&quot;\nJND Metrics&quot;);&#10;    csvRows.push(&quot;Parameter,Value,Unit,Description&quot;);&#10;    &#10;    const hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;&#10;    &#10;    csvRows.push(&quot;JND Absolute Difference,&quot; + &#10;        (hasData ? jndAbsoluteDifference.toFixed(2) : &quot;N/A&quot;) + &quot;,ms,Detectable difference from standard (smaller = better)&quot;);&#10;    &#10;    csvRows.push(&quot;JND Percentage Difference,&quot; + &#10;        (hasData ? jndPercentDifference.toFixed(2) : &quot;N/A&quot;) + &quot;,%,Percentage difference from standard (smaller = better)&quot;);&#10;    &#10;    csvRows.push(&quot;JND Ratio (Threshold/Standard),&quot; + &#10;        (hasData ? jndRatio.toFixed(4) : &quot;N/A&quot;) + &quot;,ratio,Threshold modulation window / Standard window&quot;);&#10;    &#10;    csvRows.push(&quot;Weber's Ratio,&quot; + &#10;        (hasData ? webersRatio.toFixed(4) : &quot;N/A&quot;) + &quot;,ratio,ΔI / I (smaller = better sensitivity)&quot;);&#10;    &#10;    csvRows.push(&quot;\nThreshold Parameters&quot;);&#10;    csvRows.push(&quot;Parameter,Value,Unit&quot;);&#10;    &#10;    csvRows.push(&quot;Standard Modulation Window,&quot; + STANDARD_WINDOW + &quot;,ms&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Modulation Window,&quot; + &#10;        (hasData ? thresholdWindowDuration.toFixed(2) : &quot;N/A&quot;) + &quot;,ms&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Window Percentage,&quot; + &#10;        (hasData ? thresholdWindowPercent.toFixed(2) : &quot;N/A&quot;) + &quot;,%&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Modulation Rate,&quot; + &#10;        (hasData ? thresholdModulationRate.toFixed(4) : &quot;N/A&quot;) + &quot;,semitones/s&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Slope,&quot; + &#10;        (hasData ? thresholdSlope.toFixed(6) : &quot;N/A&quot;) + &quot;,semitones/ms&quot;);&#10;    &#10;    csvRows.push(&quot;Average Difficulty Level,&quot; + &#10;        (hasData ? sentAverage.toFixed(2) : &quot;N/A&quot;) + &quot;,level (1-9)&quot;);&#10;    &#10;    csvRows.push(&quot;Difficulty Level SD,&quot; + &#10;        (hasData ? sentStdev.toFixed(2) : &quot;N/A&quot;) + &quot;,level&quot;);&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    csvRows.push(&quot;\nReaction Time Statistics&quot;);&#10;    csvRows.push(&quot;Mean,Median,Standard Deviation&quot;);&#10;    csvRows.push(rtStats.mean + &quot;,&quot; + rtStats.median + &quot;,&quot; + rtStats.sd);&#10;    &#10;    const accuracyStats = calculateAccuracyStats();&#10;    csvRows.push(&quot;\nAccuracy Statistics&quot;);&#10;    csvRows.push(&quot;Correct Responses,Total Responses,Percentage&quot;);&#10;    csvRows.push(accuracyStats.correct + &quot;,&quot; + accuracyStats.total + &quot;,&quot; + accuracyStats.percentage + &quot;%&quot;);&#10;    &#10;    csvRows.push(&quot;\nExperiment Parameters&quot;);&#10;    csvRows.push(&quot;Parameter,Value&quot;);&#10;    csvRows.push(&quot;Paradigm,ABX&quot;);&#10;    csvRows.push(&quot;Stimulus Type,Dynamic Pitch (Falling Tone)&quot;);&#10;    csvRows.push(&quot;Total Stimulus Duration,&quot; + STIMULUS_DURATION + &quot; ms&quot;);&#10;    csvRows.push(&quot;Standard Modulation Window,&quot; + STANDARD_WINDOW + &quot; ms&quot;);&#10;    csvRows.push(&quot;Pitch Fall Amount,&quot; + PITCH_FALL_SEMITONES + &quot; semitone(s)&quot;);&#10;    csvRows.push(&quot;Max Reversals,&quot; + MAXREVERSALS);&#10;    csvRows.push(&quot;Min Reversals for Calculation,&quot; + MINIMUMREVERSALS);&#10;    csvRows.push(&quot;Max Iterations,&quot; + MAXITERATIONS);&#10;    &#10;    csvRows.push(&quot;\nDifficulty Level Mapping&quot;);&#10;    csvRows.push(&quot;Level,Modulation Window (%),Modulation Window (ms),Difference from Standard (ms),Modulation Rate (semitones/s),Slope (semitones/ms)&quot;);&#10;    for (let level = 1; level &lt;= 9; level++) {&#10;        const windowPercent = MODULATION_WINDOWS[level];&#10;        const windowDuration = getModulationWindowDuration(level);&#10;        const diffFromStandard = STANDARD_WINDOW - windowDuration;&#10;        const rate = getModulationRate(level);&#10;        const slope = getModulationSlope(level);&#10;        csvRows.push(level + &quot;,&quot; + windowPercent + &quot;,&quot; + windowDuration.toFixed(2) + &quot;,&quot; + &#10;                     diffFromStandard.toFixed(2) + &quot;,&quot; + rate.toFixed(4) + &quot;,&quot; + slope.toFixed(6));&#10;    }&#10;    &#10;    const csvContent = &quot;data:text/csv;charset=utf-8,&quot; + csvRows.join(&quot;\n&quot;);&#10;    const encodedUri = encodeURI(csvContent);&#10;    const link = document.createElement(&quot;a&quot;);&#10;    const timestamp = new Date().toISOString().replace(/[:.]/g, &quot;-&quot;);&#10;    link.setAttribute(&quot;href&quot;, encodedUri);&#10;    link.setAttribute(&quot;download&quot;, &quot;dynamic_pitch_JND_ABX_data_&quot; + timestamp + &quot;.csv&quot;);&#10;    document.body.appendChild(link);&#10;    link.click();&#10;    document.body.removeChild(link);&#10;}&#10;&#10;function window_onload() {&#10;    window.name = &quot;EXP&quot;;&#10;    NumberOfReversals = 0;&#10;    numberOfIterations = 0;&#10;    CorrectResponses = 0;&#10;    Direction = DECREASING;&#10;    currentLevel = 5;&#10;    isTestComplete = false;&#10;    Reversals = [];&#10;    trialRecords = [];&#10;    isReplayTrial = false;&#10;    &#10;    jndAbsoluteDifference = 0;&#10;    jndRatio = 0;&#10;    jndPercentDifference = 0;&#10;    thresholdWindowDuration = 0;&#10;    thresholdWindowPercent = 0;&#10;    thresholdModulationRate = 0;&#10;    thresholdSlope = 0;&#10;    webersRatio = 0;&#10;&#10;    document.getElementById('text1').value = &quot;準備完畢後請點擊\&quot;開始實驗\&quot;&quot;;&#10;    document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;    document.getElementById('start').disabled = false;&#10;    document.getElementById('viewResult').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;    &#10;    updateProgressBar(0);&#10;    &#10;    logDebug(&quot;Page reset complete&quot;);&#10;}&#10;&#10;window.onload = function() {&#10;    window_onload();&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    logDebug(&quot;Preloading &quot; + allAudios.length + &quot; audio files&quot;);&#10;    &#10;    allAudios.forEach(function(audio) {&#10;        audio.load();&#10;    });&#10;    &#10;    document.getElementById('text1').value = &quot;請點擊\&quot;開始實驗\&quot;&quot;;&#10;    &#10;    window.onerror = function(message, source, lineno, colno, error) {&#10;        logDebug(&quot;Global error: &quot; + message + &quot; at &quot; + source + &quot;:&quot; + lineno);&#10;        return false;&#10;    };&#10;    &#10;    document.getElementById('showDebug').checked = true;&#10;    toggleDebug();&#10;};&#10;&lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
                    <entry key="file:///E:/Projects/Pitch_Training/ABX_level_high.html" value="&lt;!DOCTYPE html&gt;&#10;&lt;html&gt;&#10;&lt;head&gt;&#10;    &lt;title&gt;PLOYU-Peng's Lab: Pitch Sensitivity Training&lt;/title&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;style&gt;&#10;        body {&#10;            font-family: Arial, sans-serif;&#10;            margin: 20px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .container {&#10;            max-width: 800px;&#10;            margin: 0 auto;&#10;            padding: 20px;&#10;            background-color: white;&#10;            border-radius: 10px;&#10;            box-shadow: 0 0 10px rgba(0,0,0,0.1);&#10;            display: flex;&#10;            flex-direction: column;&#10;            align-items: center;&#10;        }&#10;        .header {&#10;            text-align: center;&#10;            margin-bottom: 40px;&#10;            width: 100%;&#10;        }&#10;        .training-info {&#10;            font-size: 16px;&#10;            color: #555;&#10;            margin-top: 10px;&#10;            margin-bottom: 5px;&#10;            text-align: center;&#10;        }&#10;        .instruction-text {&#10;            font-size: 14px;&#10;            color: #777;&#10;            margin-bottom: 15px;&#10;            text-align: center;&#10;            font-style: italic;&#10;        }&#10;        .button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .prompt-text {&#10;            text-align: center;&#10;            font-size: 20px;&#10;            margin-bottom: 25px;&#10;            margin-top: 30px;&#10;            font-weight: bold;&#10;        }&#10;        .response-button {&#10;            width: 160px;&#10;            height: 160px;&#10;            font-size: 26px;&#10;            margin: 0 40px;&#10;            border-radius: 15px;&#10;            border: none;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.1);&#10;            transition: all 0.3s ease;&#10;        }&#10;        .response-button:hover:enabled {&#10;            transform: translateY(-3px);&#10;            box-shadow: 0 6px 12px rgba(0,0,0,0.15);&#10;        }&#10;        .response-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .button-playing {&#10;            animation: pulse 1s ease-in-out infinite;&#10;            box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            transform: scale(1.05);&#10;        }&#10;        @keyframes pulse {&#10;            0%, 100% {&#10;                box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            }&#10;            50% {&#10;                box-shadow: 0 0 30px rgba(102, 204, 255, 1);&#10;            }&#10;        }&#10;        .control-button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            gap: 30px;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .control-button {&#10;            padding: 14px 28px;&#10;            font-size: 18px;&#10;            border-radius: 8px;&#10;            border: none;&#10;            background-color: #4CAF50;&#10;            color: white;&#10;            cursor: pointer;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .control-button:hover:enabled {&#10;            background-color: #3e8e41;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .control-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .control-button:disabled {&#10;            background-color: #cccccc;&#10;            cursor: not-allowed;&#10;            box-shadow: none;&#10;        }&#10;        .feedback {&#10;            text-align: center;&#10;            height: 100px;&#10;            margin: 30px 0;&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;        }&#10;        .status {&#10;            width: 350px;&#10;            height: 68px;&#10;            text-align: center;&#10;            font-size: 18px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            margin: 0 auto;&#10;            padding: 10px;&#10;            background-color: #f9f9f9;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.05);&#10;        }&#10;        .debug-info {&#10;            font-size: 12px;&#10;            color: #777;&#10;            margin-top: 30px;&#10;            text-align: left;&#10;            display: none;&#10;            max-height: 300px;&#10;            overflow-y: auto;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            padding: 15px;&#10;            width: 100%;&#10;        }&#10;        .results-container {&#10;            display: none;&#10;            margin-top: 30px;&#10;            padding: 20px;&#10;            background-color: #f0f8ff;&#10;            border-radius: 8px;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.1);&#10;            width: 100%;&#10;        }&#10;        .result-heading {&#10;            text-align: center;&#10;            margin-bottom: 20px;&#10;            color: #2c3e50;&#10;        }&#10;        .result-table {&#10;            width: 100%;&#10;            border-collapse: collapse;&#10;            margin-bottom: 20px;&#10;        }&#10;        .result-table th, .result-table td {&#10;            padding: 12px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .result-table th {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .result-table tr:nth-child(even) {&#10;            background-color: #f2f2f2;&#10;        }&#10;        .result-interpretation {&#10;            background-color: #e8f4f8;&#10;            padding: 15px;&#10;            border-radius: 5px;&#10;            margin-bottom: 20px;&#10;        }&#10;        .back-button {&#10;            display: block;&#10;            margin: 0 auto;&#10;            padding: 14px 28px;&#10;            background-color: #3498db;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .back-button:hover {&#10;            background-color: #2980b9;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .back-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        .chart-container {&#10;            height: 300px;&#10;            margin: 20px 0;&#10;            background-color: white;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;            padding: 10px;&#10;        }&#10;        .auxiliary-buttons {&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            margin-top: 30px;&#10;            gap: 20px;&#10;            flex-wrap: wrap;&#10;        }&#10;        .auxiliary-buttons button {&#10;            padding: 10px 15px;&#10;            border-radius: 5px;&#10;            border: 1px solid #ddd;&#10;            background-color: #f0f0f0;&#10;            cursor: pointer;&#10;            transition: all 0.2s ease;&#10;        }&#10;        .auxiliary-buttons button:hover {&#10;            background-color: #e0e0e0;&#10;        }&#10;        .diagnostic-overlay {&#10;            position: fixed;&#10;            top: 0;&#10;            left: 0;&#10;            width: 100%;&#10;            height: 100%;&#10;            background-color: rgba(0, 0, 0, 0.8);&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            z-index: 1000;&#10;            display: none;&#10;        }&#10;        .diagnostic-content {&#10;            width: 80%;&#10;            max-width: 700px;&#10;            max-height: 80%;&#10;            overflow-y: auto;&#10;            background-color: white;&#10;            padding: 20px;&#10;            border-radius: 8px;&#10;            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);&#10;        }&#10;        .diagnostic-heading {&#10;            text-align: center;&#10;            color: #e74c3c;&#10;            margin-bottom: 20px;&#10;            font-size: 24px;&#10;        }&#10;        .diagnostic-close {&#10;            float: right;&#10;            font-size: 20px;&#10;            cursor: pointer;&#10;            color: #777;&#10;        }&#10;        .diagnostic-close:hover {&#10;            color: #333;&#10;        }&#10;        .diagnostic-section {&#10;            margin-bottom: 15px;&#10;            padding: 10px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;        }&#10;        .diagnostic-actions {&#10;            text-align: center;&#10;            margin-top: 20px;&#10;        }&#10;        .diagnostic-action-button {&#10;            padding: 10px 20px;&#10;            margin: 0 10px;&#10;            border: none;&#10;            border-radius: 5px;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;        }&#10;        .retry-button {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .retry-button:hover {&#10;            background-color: #2980b9;&#10;        }&#10;        .continue-button {&#10;            background-color: #2ecc71;&#10;            color: white;&#10;        }&#10;        .continue-button:hover {&#10;            background-color: #27ae60;&#10;        }&#10;        .diagnostic-file-check {&#10;            margin: 20px 0;&#10;        }&#10;        .diagnostic-file-status {&#10;            display: flex;&#10;            flex-wrap: wrap;&#10;            gap: 10px;&#10;        }&#10;        .file-status-item {&#10;            font-size: 12px;&#10;            padding: 5px 10px;&#10;            border-radius: 3px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .file-found {&#10;            color: #27ae60;&#10;            border-left: 3px solid #27ae60;&#10;        }&#10;        .file-missing {&#10;            color: #e74c3c;&#10;            border-left: 3px solid #e74c3c;&#10;        }&#10;        .statistics-table {&#10;            width: 100%;&#10;            margin: 10px 0;&#10;            border-collapse: collapse;&#10;        }&#10;        .statistics-table th, .statistics-table td {&#10;            padding: 8px;&#10;            text-align:center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .statistics-table th {&#10;            background-color: #f0f0f0;&#10;        }&#10;        .direction-stats-good {&#10;            color: #27ae60;&#10;        }&#10;        .direction-stats-warning {&#10;            color: #f39c12;&#10;        }&#10;        .direction-stats-bad {&#10;            color: #e74c3c;&#10;        }&#10;        @media (max-width: 600px) {&#10;            .response-button {&#10;                width: 130px;&#10;                height: 130px;&#10;                font-size: 22px;&#10;                margin: 0 20px;&#10;            }&#10;            .control-button {&#10;                padding: 12px 20px;&#10;            }&#10;        }&#10;        .print-button {&#10;            padding: 14px 28px;&#10;            margin: 20px auto;&#10;            background-color: #9b59b6;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;            display: block;&#10;        }&#10;        .print-button:hover {&#10;            background-color: #8e44ad;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .print-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        @media print {&#10;            body {&#10;                background-color: white;&#10;                margin: 0;&#10;                padding: 0;&#10;            }&#10;            .container {&#10;                max-width: 100%;&#10;                box-shadow: none;&#10;                padding: 10px;&#10;            }&#10;            .back-button, .print-button, .auxiliary-buttons {&#10;                display: none;&#10;            }&#10;            .results-container {&#10;                display: block !important;&#10;                box-shadow: none;&#10;                background-color: white;&#10;                padding: 0;&#10;            }&#10;            .chart-container {&#10;                border: 1px solid #ddd;&#10;                background-color: white;&#10;            }&#10;            .result-table th {&#10;                background-color: #f0f0f0 !important;&#10;                color: black !important;&#10;            }&#10;            .result-interpretation {&#10;                background-color: white;&#10;                border: 1px solid #ddd;&#10;            }&#10;            * {&#10;                -webkit-print-color-adjust: exact !important;&#10;                print-color-adjust: exact !important;&#10;            }&#10;        }&#10;        .progress-bar-container {&#10;            width: 100%;&#10;            height: 20px;&#10;            background-color: #e0e0e0;&#10;            border-radius: 10px;&#10;            margin: 10px 0;&#10;            overflow: hidden;&#10;        }&#10;        .progress-bar {&#10;            height: 100%;&#10;            background-color: #4CAF50;&#10;            border-radius: 10px;&#10;            transition: width 0.3s ease;&#10;        }&#10;        .progress-label {&#10;            text-align: center;&#10;            font-size: 14px;&#10;            color: #555;&#10;            margin-top: 5px;&#10;        }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;div class=&quot;container&quot;&gt;&#10;        &lt;div class=&quot;header&quot;&gt;&#10;            &lt;img src=&quot;Media/animation.gif&quot; alt=&quot;Experiment animation&quot;&gt;&#10;            &lt;div class=&quot;training-info&quot;&gt;High Register Discrimination (ABX)&lt;/div&gt;&#10;            &lt;div class=&quot;instruction-text&quot;&gt;請判斷第三個音聽起來更像第一個還是第二個音&lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div id=&quot;experimentContainer&quot;&gt;&#10;            &lt;div class=&quot;control-button-container&quot;&gt;&#10;                &lt;input id=&quot;start&quot; type=&quot;button&quot; value=&quot;開始實驗&quot; onclick=&quot;start_onclick()&quot; class=&quot;control-button&quot;&gt;&#10;                &lt;input id=&quot;viewResult&quot; type=&quot;button&quot; value=&quot;查看結果&quot; onclick=&quot;view_onclick()&quot; class=&quot;control-button&quot; disabled&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;prompt-text&quot; id=&quot;promptText&quot;&gt;&#10;                第三個音更像...&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;firstBtn&quot; type=&quot;button&quot; value=&quot;第一個音&quot; onclick=&quot;processAnswer(1)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;                &lt;input id=&quot;secondBtn&quot; type=&quot;button&quot; value=&quot;第二個音&quot; onclick=&quot;processAnswer(2)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;feedback&quot;&gt;&#10;                &lt;img id=&quot;smile&quot; src=&quot;Media/null.gif&quot; width=&quot;100&quot; height=&quot;84&quot; alt=&quot;Feedback&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;text1&quot; class=&quot;status&quot; readonly&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;progress-bar-container&quot;&gt;&#10;                &lt;div class=&quot;progress-bar&quot; id=&quot;progressBar&quot; style=&quot;width: 0%&quot;&gt;&lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;progress-label&quot; id=&quot;progressLabel&quot;&gt;Progress: 0%&lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;debug-info&quot; id=&quot;debugInfo&quot;&gt;&#10;                Debug information will be displayed here&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot;&gt;&#10;                &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;showDebug&quot; onclick=&quot;toggleDebug()&quot;&gt; Show Debug Info&lt;/label&gt;&#10;                &lt;button onclick=&quot;testAudio()&quot;&gt;Test All Audio&lt;/button&gt;&#10;                &lt;button onclick=&quot;showDiagnostics()&quot;&gt;Diagnostics&lt;/button&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot; id=&quot;exportBtn&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div id=&quot;resultsContainer&quot; class=&quot;results-container&quot;&gt;&#10;            &lt;h2 class=&quot;result-heading&quot;&gt;Pitch Discrimination Test Results (ABX)&lt;/h2&gt;&#10;            &#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Test Direction&lt;/th&gt;&#10;                        &lt;th&gt;Threshold (semitones)&lt;/th&gt;&#10;                        &lt;th&gt;Std. Deviation&lt;/th&gt;&#10;                        &lt;th&gt;Assessment&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;resultTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;div class=&quot;result-interpretation&quot; id=&quot;resultInterpretation&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Reaction Time Statistics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot; id=&quot;rtStatsTable&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Direction&lt;/th&gt;&#10;                        &lt;th&gt;Mean RT (ms)&lt;/th&gt;&#10;                        &lt;th&gt;Median RT (ms)&lt;/th&gt;&#10;                        &lt;th&gt;RT Std. Deviation&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;rtStatsTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;h3&gt;Accuracy Statistics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot; id=&quot;accuracyStatsTable&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Direction&lt;/th&gt;&#10;                        &lt;th&gt;Correct Responses&lt;/th&gt;&#10;                        &lt;th&gt;Total Responses&lt;/th&gt;&#10;                        &lt;th&gt;Accuracy&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;accuracyStatsTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;div class=&quot;chart-container&quot; id=&quot;resultChart&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;button class=&quot;print-button&quot; onclick=&quot;printResults()&quot;&gt;Print Results&lt;/button&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot; style=&quot;margin-top: 20px;&quot;&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;button class=&quot;back-button&quot; onclick=&quot;backToExperiment()&quot;&gt;Back to Experiment&lt;/button&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div class=&quot;diagnostic-overlay&quot; id=&quot;diagnosticOverlay&quot;&gt;&#10;            &lt;div class=&quot;diagnostic-content&quot;&gt;&#10;                &lt;span class=&quot;diagnostic-close&quot; onclick=&quot;closeDiagnostics()&quot;&gt;&amp;times;&lt;/span&gt;&#10;                &lt;h2 class=&quot;diagnostic-heading&quot;&gt;Experiment Diagnostics&lt;/h2&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Test Status&lt;/h3&gt;&#10;                    &lt;table class=&quot;statistics-table&quot;&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;th&gt;Direction&lt;/th&gt;&#10;                            &lt;th&gt;Trials&lt;/th&gt;&#10;                            &lt;th&gt;Reversals&lt;/th&gt;&#10;                            &lt;th&gt;Status&lt;/th&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td&gt;Higher Direction&lt;/td&gt;&#10;                            &lt;td id=&quot;higherTrials&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;higherReversals&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;higherStatus&quot;&gt;Not started&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td&gt;Lower Direction&lt;/td&gt;&#10;                            &lt;td id=&quot;lowerTrials&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;lowerReversals&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;lowerStatus&quot;&gt;Not started&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                    &lt;/table&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Audio Files Check&lt;/h3&gt;&#10;                    &lt;p&gt;Verifying necessary audio files:&lt;/p&gt;&#10;                    &lt;div id=&quot;audioFileStatus&quot; class=&quot;diagnostic-file-status&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Reversal History&lt;/h3&gt;&#10;                    &lt;div id=&quot;reversalHistory&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Recommendations&lt;/h3&gt;&#10;                    &lt;div id=&quot;diagnosticRecommendations&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-actions&quot;&gt;&#10;                    &lt;button class=&quot;diagnostic-action-button retry-button&quot; onclick=&quot;retryIncompleteDirection()&quot;&gt;Retry Incomplete Direction&lt;/button&gt;&#10;                    &lt;button class=&quot;diagnostic-action-button continue-button&quot; onclick=&quot;closeDiagnostics()&quot;&gt;Close&lt;/button&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;audio id=&quot;high_level_standard&quot; src=&quot;Media/high_level_standard.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;    &lt;audio id=&quot;high_level_1_h&quot; src=&quot;Media/high_level_1_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_2_h&quot; src=&quot;Media/high_level_2_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_3_h&quot; src=&quot;Media/high_level_3_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_4_h&quot; src=&quot;Media/high_level_4_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_5_h&quot; src=&quot;Media/high_level_5_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_6_h&quot; src=&quot;Media/high_level_6_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_7_h&quot; src=&quot;Media/high_level_7_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_8_h&quot; src=&quot;Media/high_level_8_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_9_h&quot; src=&quot;Media/high_level_9_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;    &lt;audio id=&quot;high_level_1_l&quot; src=&quot;Media/high_level_1_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_2_l&quot; src=&quot;Media/high_level_2_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_3_l&quot; src=&quot;Media/high_level_3_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_4_l&quot; src=&quot;Media/high_level_4_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_5_l&quot; src=&quot;Media/high_level_5_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_6_l&quot; src=&quot;Media/high_level_6_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_7_l&quot; src=&quot;Media/high_level_7_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_8_l&quot; src=&quot;Media/high_level_8_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_level_9_l&quot; src=&quot;Media/high_level_9_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;&lt;script&gt;&#10;function getLocalTimestamp() {&#10;    const now = new Date();&#10;    const year = now.getFullYear();&#10;    const month = String(now.getMonth() + 1).padStart(2, '0');&#10;    const day = String(now.getDate()).padStart(2, '0');&#10;    const hours = String(now.getHours()).padStart(2, '0');&#10;    const minutes = String(now.getMinutes()).padStart(2, '0');&#10;    const seconds = String(now.getSeconds()).padStart(2, '0');&#10;    const milliseconds = String(now.getMilliseconds()).padStart(3, '0');&#10;    &#10;    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;&#10;}&#10;&#10;// Adaptive threshold experiment constants&#10;const MAXREVERSALS = 10;&#10;const MAXITERATIONS = 50;&#10;const LOWERLIMIT = 1;&#10;const DECREASING = -1;&#10;const INCREASING = 1;&#10;const MINIMUMREVERSALS = 6;&#10;const THRESHOLD_REVERSAL_COUNT = 6;&#10;const FORCEBALANCETHRESHOLD = 5;&#10;&#10;// Experiment state variables&#10;var CorrectAnswer;&#10;var CorrectResponses = [0, 0];&#10;var Direction = [DECREASING, DECREASING];&#10;var Reversals = [[], []];&#10;var NumberOfReversals = [0, 0];&#10;var currentLevel = [5, 5];&#10;var numberOfIterations = 0;&#10;var sentAverage = [0.0, 0.0];&#10;var sentStdev = [0.0, 0.0];&#10;var currentStimDirection;&#10;var isTestComplete = [false, false];&#10;var audioUnlocked = false;&#10;var trialsPerDirection = [0, 0];&#10;var forceDirection = null;&#10;var directionHistory = [];&#10;var allFilesPresent = true;&#10;var trialRecords = [];&#10;var stimulusEndTime = 0;&#10;&#10;// ABX新增变量&#10;var standardIsFirst;&#10;var comparisonSound;&#10;var standardSound;&#10;var xSound;&#10;&#10;// 新增：重播标志&#10;var isReplayTrial = false;&#10;&#10;function printResults() {&#10;    window.print();&#10;}&#10;&#10;function logDebug(message) {&#10;    console.log(message);&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var now = new Date();&#10;    var timeStr = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + '.' + now.getMilliseconds();&#10;    debugArea.innerHTML += '&lt;p&gt;[' + timeStr + '] ' + message + '&lt;/p&gt;';&#10;    debugArea.scrollTop = debugArea.scrollHeight;&#10;}&#10;&#10;function toggleDebug() {&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var checkbox = document.getElementById('showDebug');&#10;    debugArea.style.display = checkbox.checked ? 'block' : 'none';&#10;}&#10;&#10;function showDiagnostics() {&#10;    updateDiagnostics();&#10;    document.getElementById('diagnosticOverlay').style.display = 'flex';&#10;}&#10;&#10;function closeDiagnostics() {&#10;    document.getElementById('diagnosticOverlay').style.display = 'none';&#10;}&#10;&#10;function updateDiagnostics() {&#10;    document.getElementById('higherTrials').innerText = trialsPerDirection[0];&#10;    document.getElementById('lowerTrials').innerText = trialsPerDirection[1];&#10;    document.getElementById('higherReversals').innerText = NumberOfReversals[0];&#10;    document.getElementById('lowerReversals').innerText = NumberOfReversals[1];&#10;    &#10;    let higherStatus = getDirectionStatus(0);&#10;    let lowerStatus = getDirectionStatus(1);&#10;    &#10;    document.getElementById('higherStatus').innerText = higherStatus.text;&#10;    document.getElementById('higherStatus').className = `direction-stats-${higherStatus.class}`;&#10;    document.getElementById('lowerStatus').innerText = lowerStatus.text;&#10;    document.getElementById('lowerStatus').className = `direction-stats-${lowerStatus.class}`;&#10;    &#10;    checkAudioFiles();&#10;    &#10;    let reversalHistoryHtml = '&lt;h4&gt;Higher Direction&lt;/h4&gt;';&#10;    if (Reversals[0].length === 0) {&#10;        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';&#10;    } else {&#10;        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals[0].join(', ') + '&lt;/p&gt;';&#10;    }&#10;    &#10;    reversalHistoryHtml += '&lt;h4&gt;Lower Direction&lt;/h4&gt;';&#10;    if (Reversals[1].length === 0) {&#10;        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';&#10;    } else {&#10;        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals[1].join(', ') + '&lt;/p&gt;';&#10;    }&#10;    &#10;    document.getElementById('reversalHistory').innerHTML = reversalHistoryHtml;&#10;    &#10;    generateDiagnosticRecommendations();&#10;}&#10;&#10;function getDirectionStatus(dirIndex) {&#10;    if (isTestComplete[dirIndex]) {&#10;        return { text: &quot;Complete&quot;, class: &quot;good&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals[dirIndex] &lt; 1) {&#10;        return { text: &quot;Not enough data&quot;, class: &quot;bad&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals[dirIndex] &lt; MINIMUMREVERSALS) {&#10;        return { text: &quot;Incomplete (&quot; + NumberOfReversals[dirIndex] + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals)&quot;, class: &quot;warning&quot; };&#10;    }&#10;    &#10;    return { text: &quot;In progress&quot;, class: &quot;good&quot; };&#10;}&#10;&#10;function checkAudioFiles() {&#10;    const requiredFiles = [&#10;        &quot;high_level_standard&quot;,&#10;        &quot;high_level_1_h&quot;, &quot;high_level_2_h&quot;, &quot;high_level_3_h&quot;, &quot;high_level_4_h&quot;, &quot;high_level_5_h&quot;, &#10;        &quot;high_level_6_h&quot;, &quot;high_level_7_h&quot;, &quot;high_level_8_h&quot;, &quot;high_level_9_h&quot;,&#10;        &quot;high_level_1_l&quot;, &quot;high_level_2_l&quot;, &quot;high_level_3_l&quot;, &quot;high_level_4_l&quot;, &quot;high_level_5_l&quot;, &#10;        &quot;high_level_6_l&quot;, &quot;high_level_7_l&quot;, &quot;high_level_8_l&quot;, &quot;high_level_9_l&quot;&#10;    ];&#10;    &#10;    let statusHtml = '';&#10;    allFilesPresent = true;&#10;    &#10;    requiredFiles.forEach(function(fileId) {&#10;        const audioElement = document.getElementById(fileId);&#10;        const fileFound = audioElement !== null;&#10;        &#10;        if (!fileFound) {&#10;            allFilesPresent = false;&#10;        }&#10;        &#10;        statusHtml += `&lt;div class=&quot;file-status-item ${fileFound ? 'file-found' : 'file-missing'}&quot;&gt;${fileId}: ${fileFound ? 'Found' : 'Missing'}&lt;/div&gt;`;&#10;    });&#10;    &#10;    document.getElementById('audioFileStatus').innerHTML = statusHtml;&#10;}&#10;&#10;function generateDiagnosticRecommendations() {&#10;    let recommendations = '';&#10;    let hasIssues = false;&#10;    &#10;    if (!allFilesPresent) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Critical Issue:&lt;/strong&gt; Some required audio files are missing. Please ensure all files are properly loaded.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    const directionDifference = Math.abs(trialsPerDirection[0] - trialsPerDirection[1]);&#10;    if (directionDifference &gt; 10 &amp;&amp; !isTestComplete[0] &amp;&amp; !isTestComplete[1]) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Warning:&lt;/strong&gt; Trial count is imbalanced between higher and lower directions. Consider restarting experiment.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    for (let i = 0; i &lt; 2; i++) {&#10;        if (trialsPerDirection[i] &gt;= MAXITERATIONS/2 &amp;&amp; NumberOfReversals[i] &lt; MINIMUMREVERSALS) {&#10;            recommendations += '&lt;p&gt;&lt;strong&gt;Issue:&lt;/strong&gt; ' + (i === 0 ? 'Higher' : 'Lower') + &#10;                ' direction reached maximum trials but has insufficient reversals. This might indicate audio file issues or participant response patterns.&lt;/p&gt;';&#10;            hasIssues = true;&#10;        }&#10;    }&#10;    &#10;    if (numberOfIterations &gt; 10 &amp;&amp; (trialsPerDirection[0] === 0 || trialsPerDirection[1] === 0)) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Warning:&lt;/strong&gt; One direction has not been tested at all. Algorithm may be malfunctioning.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (!hasIssues) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Good:&lt;/strong&gt; No major issues detected with the experiment setup.&lt;/p&gt;';&#10;        &#10;        if (isTestComplete[0] &amp;&amp; isTestComplete[1]) {&#10;            recommendations += '&lt;p&gt;Both test directions are complete.&lt;/p&gt;';&#10;        } else if (isTestComplete[0]) {&#10;            recommendations += '&lt;p&gt;Higher direction test is complete. Lower direction test still needs more data.&lt;/p&gt;';&#10;        } else if (isTestComplete[1]) {&#10;            recommendations += '&lt;p&gt;Lower direction test is complete. Higher direction test still needs more data.&lt;/p&gt;';&#10;        } else {&#10;            recommendations += '&lt;p&gt;Both test directions are still in progress.&lt;/p&gt;';&#10;        }&#10;    }&#10;    &#10;    document.getElementById('diagnosticRecommendations').innerHTML = recommendations;&#10;}&#10;&#10;function retryIncompleteDirection() {&#10;    let retryDirection = null;&#10;    &#10;    if (isTestComplete[0] &amp;&amp; !isTestComplete[1]) {&#10;        retryDirection = 1;&#10;    } else if (!isTestComplete[0] &amp;&amp; isTestComplete[1]) {&#10;        retryDirection = 0;&#10;    } else if (!isTestComplete[0] &amp;&amp; !isTestComplete[1]) {&#10;        retryDirection = (NumberOfReversals[0] &lt; NumberOfReversals[1]) ? 0 : 1;&#10;    } else {&#10;        alert(&quot;Both directions are already complete.&quot;);&#10;        return;&#10;    }&#10;    &#10;    resetDirection(retryDirection);&#10;    forceDirection = retryDirection;&#10;    closeDiagnostics();&#10;    &#10;    if (document.getElementById('start').disabled) {&#10;        document.getElementById('text1').value = &quot;Retrying &quot; + (retryDirection === 0 ? &quot;higher&quot; : &quot;lower&quot;) + &quot; direction...&quot;;&#10;        beginIteration();&#10;    } else {&#10;        start_onclick();&#10;    }&#10;}&#10;&#10;function resetDirection(dirIndex) {&#10;    NumberOfReversals[dirIndex] = 0;&#10;    CorrectResponses[dirIndex] = 0;&#10;    Direction[dirIndex] = DECREASING;&#10;    currentLevel[dirIndex] = 5;&#10;    isTestComplete[dirIndex] = false;&#10;    Reversals[dirIndex] = [];&#10;    trialsPerDirection[dirIndex] = 0;&#10;    &#10;    trialRecords = trialRecords.filter(record =&gt; &#10;        record.direction !== (dirIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;)&#10;    );&#10;    &#10;    logDebug((dirIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction reset&quot;);&#10;    updateProgressBar();&#10;}&#10;&#10;function testAudio() {&#10;    logDebug(&quot;Starting to test all audio files...&quot;);&#10;    var audios = document.querySelectorAll('audio');&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    var index = 0;&#10;    function playNext() {&#10;        if (index &gt;= audios.length) {&#10;            logDebug(&quot;All audio testing complete!&quot;);&#10;            return;&#10;        }&#10;        &#10;        var audio = audios[index];&#10;        logDebug(&quot;Testing audio #&quot; + (index + 1) + &quot;: &quot; + audio.id);&#10;        &#10;        audio.currentTime = 0;&#10;        &#10;        var playPromise = audio.play();&#10;        if (playPromise !== undefined) {&#10;            playPromise.then(function() {&#10;                logDebug(audio.id + &quot; played successfully&quot;);&#10;                &#10;                audio.onended = function() {&#10;                    logDebug(audio.id + &quot; playback ended&quot;);&#10;                    index++;&#10;                    setTimeout(playNext, 500);&#10;                };&#10;            }).catch(function(error) {&#10;                logDebug(&quot;Failed to play &quot; + audio.id + &quot;: &quot; + error);&#10;                index++;&#10;                setTimeout(playNext, 500);&#10;            });&#10;        }&#10;    }&#10;    &#10;    playNext();&#10;}&#10;&#10;function unlockAudioContext() {&#10;    logDebug(&quot;Attempting to unlock audio context...&quot;);&#10;    &#10;    var silentAudio = new Audio();&#10;    silentAudio.src = &quot;data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA&quot;;&#10;    &#10;    var promise = silentAudio.play();&#10;    if (promise !== undefined) {&#10;        promise.then(function() {&#10;            logDebug(&quot;Audio context unlocked successfully&quot;);&#10;            silentAudio.remove();&#10;            audioUnlocked = true;&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to unlock audio context: &quot; + error);&#10;        });&#10;    }&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    for (var i = 0; i &lt; allAudios.length; i++) {&#10;        var audio = allAudios[i];&#10;        audio.load();&#10;    }&#10;    &#10;    logDebug(&quot;Preloaded &quot; + allAudios.length + &quot; audio files&quot;);&#10;}&#10;&#10;function resetPage() {&#10;    numberOfIterations++;&#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('firstBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('secondBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    if (isTestComplete[0] &amp;&amp; isTestComplete[1]) {&#10;        document.getElementById('start').disabled = false;&#10;        document.getElementById('viewResult').disabled = false;&#10;        document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;        updateProgressBar(100);&#10;        return;&#10;    }&#10;    &#10;    if ((trialsPerDirection[currentStimDirection] &gt;= MAXITERATIONS/2) || &#10;        (NumberOfReversals[currentStimDirection] &gt;= MAXREVERSALS)) {&#10;        &#10;        if (NumberOfReversals[currentStimDirection] &gt;= MINIMUMREVERSALS) {&#10;            calculateResults(currentStimDirection);&#10;            isTestComplete[currentStimDirection] = true;&#10;        } else {&#10;            logDebug(&#10;                (currentStimDirection === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &#10;                &quot; direction reached max iterations but has only &quot; + &#10;                NumberOfReversals[currentStimDirection] + &quot;/&quot; + MINIMUMREVERSALS + &#10;                &quot; reversals. Showing diagnostics.&quot;&#10;            );&#10;            &#10;            document.getElementById('text1').value = &#10;                (currentStimDirection === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &#10;                &quot; direction has insufficient data. Check diagnostics.&quot;;&#10;            &#10;            setTimeout(function() {&#10;                showDiagnostics();&#10;            }, 500);&#10;            return;&#10;        }&#10;        &#10;        updateProgressBar();&#10;        &#10;        if (!isTestComplete[0] || !isTestComplete[1]) {&#10;            document.getElementById('text1').value = &quot;實驗繼續中...&quot;;&#10;            setTimeout(function() {&#10;                beginIteration();&#10;            }, 2000);&#10;        } else {&#10;            document.getElementById('start').disabled = false;&#10;            document.getElementById('viewResult').disabled = false;&#10;            document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;            updateProgressBar(100);&#10;        }&#10;    } else {&#10;        updateProgressBar();&#10;        beginIteration();&#10;    }&#10;}&#10;&#10;function updateProgressBar(forcePercent) {&#10;    if (typeof forcePercent === 'number') {&#10;        document.getElementById('progressBar').style.width = forcePercent + '%';&#10;        document.getElementById('progressLabel').textContent = 'Progress: ' + forcePercent + '%';&#10;        return;&#10;    }&#10;    &#10;    const higherDirMax = Math.max(MAXREVERSALS, MAXITERATIONS/2);&#10;    const higherDirValue = isTestComplete[0] ? higherDirMax : Math.max(NumberOfReversals[0], trialsPerDirection[0]);&#10;    const higherDirPercent = Math.min(50 * (higherDirValue / higherDirMax), 50);&#10;    &#10;    const lowerDirMax = Math.max(MAXREVERSALS, MAXITERATIONS/2);&#10;    const lowerDirValue = isTestComplete[1] ? lowerDirMax : Math.max(NumberOfReversals[1], trialsPerDirection[1]);&#10;    const lowerDirPercent = Math.min(50 * (lowerDirValue / lowerDirMax), 50);&#10;    &#10;    const totalPercent = higherDirPercent + lowerDirPercent;&#10;    &#10;    document.getElementById('progressBar').style.width = totalPercent + '%';&#10;    document.getElementById('progressLabel').textContent = 'Progress: ' + Math.round(totalPercent) + '%';&#10;}&#10;&#10;function calculateResults(directionIndex) {&#10;    let sum = 0.0, stddevsum = 0.0, average = 0.0, stdev = 0.0, counter = 0;&#10;    &#10;    const semitoneMap = {&#10;        1: 2.0,&#10;        2: 1.0,&#10;        3: 1/2,&#10;        4: 1/6,&#10;        5: 1/8,&#10;        6: 1/12,&#10;        7: 1/15,&#10;        8: 1/20,&#10;        9: 1/50&#10;    };&#10;    &#10;    for (let i = 0; i &lt; Reversals[directionIndex].length; i++) {&#10;        if (Reversals[directionIndex][i] &gt; 0) counter++;&#10;    }&#10;    &#10;    if (counter &lt; MINIMUMREVERSALS) {&#10;        logDebug((directionIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction test has insufficient data&quot;);&#10;        alert((directionIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction test has insufficient data. Please complete the test again.&quot;);&#10;        return;&#10;    }&#10;    &#10;    const startIndex = Math.max(0, NumberOfReversals[directionIndex] - THRESHOLD_REVERSAL_COUNT);&#10;    counter = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals[directionIndex].length; i++) {&#10;        const level = Reversals[directionIndex][i];&#10;        if (level &gt; 0) {&#10;            const semitones = semitoneMap[level];&#10;            if (semitones !== undefined) {&#10;                sum += semitones;&#10;                counter++;&#10;            }&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 0) {&#10;        average = sum / counter;&#10;        average = parseFloat(average.toFixed(4));&#10;    }&#10;    &#10;    for (let i = startIndex; i &lt; Reversals[directionIndex].length; i++) {&#10;        const level = Reversals[directionIndex][i];&#10;        if (level &gt; 0) {&#10;            const semitones = semitoneMap[level];&#10;            if (semitones !== undefined) {&#10;                stddevsum += Math.pow(semitones - average, 2);&#10;            }&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 1) {&#10;        stdev = Math.sqrt(stddevsum / (counter - 1));&#10;        stdev = parseFloat(stdev.toFixed(4));&#10;    }&#10;    &#10;    sentAverage[directionIndex] = average;&#10;    sentStdev[directionIndex] = stdev;&#10;    &#10;    logDebug((directionIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction test complete! Threshold: &quot; + average.toFixed(4) + &quot; semitones&quot;);&#10;    document.getElementById('text1').value = &#10;        (directionIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction test complete! Threshold: &quot; + average.toFixed(4) + &quot; semitones&quot;;&#10;}&#10;&#10;function beginIteration() {&#10;    isReplayTrial = false;&#10;    &#10;    if (forceDirection !== null) {&#10;        currentStimDirection = forceDirection;&#10;        &#10;        if (trialsPerDirection[forceDirection] % 5 === 0) {&#10;            logDebug(&quot;Releasing forced direction after 5 trials&quot;);&#10;            forceDirection = null;&#10;        }&#10;    } &#10;    else if (isTestComplete[0]) {&#10;        currentStimDirection = 1;&#10;    } &#10;    else if (isTestComplete[1]) {&#10;        currentStimDirection = 0;&#10;    }&#10;    else if (Math.abs(trialsPerDirection[0] - trialsPerDirection[1]) &gt; FORCEBALANCETHRESHOLD) {&#10;        currentStimDirection = (trialsPerDirection[0] &gt; trialsPerDirection[1]) ? 1 : 0;&#10;        logDebug(&quot;Forcing balance: selecting &quot; + (currentStimDirection === 0 ? &quot;higher&quot; : &quot;lower&quot;) + &quot; direction&quot;);&#10;    }&#10;    else {&#10;        currentStimDirection = Math.random() &lt; 0.5 ? 0 : 1;&#10;    }&#10;    &#10;    directionHistory.push(currentStimDirection);&#10;    &#10;    standardIsFirst = Math.random() &lt; 0.5;&#10;    var xIsStandard = Math.random() &lt; 0.5;&#10;    &#10;    if (xIsStandard) {&#10;        CorrectAnswer = standardIsFirst ? 1 : 2;&#10;    } else {&#10;        CorrectAnswer = standardIsFirst ? 2 : 1;&#10;    }&#10;    &#10;    trialsPerDirection[currentStimDirection]++;&#10;    &#10;    logDebug(&quot;Starting new iteration #&quot; + numberOfIterations + &#10;             &quot;, Direction: &quot; + (currentStimDirection === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &#10;             &quot;, Standard is &quot; + (standardIsFirst ? &quot;first&quot; : &quot;second&quot;) +&#10;             &quot;, X is &quot; + (xIsStandard ? &quot;standard&quot; : &quot;comparison&quot;) +&#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Difficulty level: &quot; + currentLevel[currentStimDirection]);&#10;    &#10;    setTimeout(function() {&#10;        playABXSequence(xIsStandard);&#10;    }, 1000);&#10;}&#10;&#10;function clearButtonAnimations() {&#10;    document.getElementById('firstBtn').classList.remove('button-playing');&#10;    document.getElementById('secondBtn').classList.remove('button-playing');&#10;}&#10;&#10;function playABXSequence(xIsStandard) {&#10;    logDebug(&quot;Playing ABX sequence&quot;);&#10;    &#10;    clearButtonAnimations();&#10;    &#10;    standardSound = document.getElementById('high_level_standard');&#10;    &#10;    const level = currentLevel[currentStimDirection];&#10;    if (currentStimDirection === 0) {&#10;        comparisonSound = document.getElementById(&quot;high_level_&quot; + level + &quot;_h&quot;);&#10;    } else {&#10;        comparisonSound = document.getElementById(&quot;high_level_&quot; + level + &quot;_l&quot;);&#10;    }&#10;    &#10;    xSound = xIsStandard ? standardSound : comparisonSound;&#10;    &#10;    if (!standardSound || !comparisonSound) {&#10;        logDebug(&quot;Error: Cannot find audio elements!&quot;);&#10;        document.getElementById('text1').value = &quot;出錯：找不到音頻文件&quot;;&#10;        setTimeout(function() {&#10;            showDiagnostics();&#10;        }, 1000);&#10;        return;&#10;    }&#10;    &#10;    var firstSound = standardIsFirst ? standardSound : comparisonSound;&#10;    document.getElementById('text1').value = &quot;播放第一個音&quot;;&#10;    &#10;    document.getElementById('firstBtn').classList.add('button-playing');&#10;    &#10;    firstSound.currentTime = 0;&#10;    var playPromise1 = firstSound.play();&#10;    &#10;    if (playPromise1 !== undefined) {&#10;        playPromise1.then(function() {&#10;            logDebug(&quot;First sound (A) played successfully&quot;);&#10;            &#10;            firstSound.onended = function() {&#10;                logDebug(&quot;First sound ended&quot;);&#10;                &#10;                document.getElementById('firstBtn').classList.remove('button-playing');&#10;                &#10;                setTimeout(function() {&#10;                    var secondSound = standardIsFirst ? comparisonSound : standardSound;&#10;                    document.getElementById('text1').value = &quot;播放第二個音&quot;;&#10;                    &#10;                    document.getElementById('secondBtn').classList.add('button-playing');&#10;                    &#10;                    secondSound.currentTime = 0;&#10;                    var playPromise2 = secondSound.play();&#10;                    &#10;                    if (playPromise2 !== undefined) {&#10;                        playPromise2.then(function() {&#10;                            logDebug(&quot;Second sound (B) played successfully&quot;);&#10;                            &#10;                            secondSound.onended = function() {&#10;                                logDebug(&quot;Second sound ended&quot;);&#10;                                &#10;                                document.getElementById('secondBtn').classList.remove('button-playing');&#10;                                &#10;                                setTimeout(function() {&#10;                                    document.getElementById('text1').value = &quot;播放第三個音&quot;;&#10;                                    &#10;                                    xSound.currentTime = 0;&#10;                                    var playPromise3 = xSound.play();&#10;                                    &#10;                                    if (playPromise3 !== undefined) {&#10;                                        playPromise3.then(function() {&#10;                                            logDebug(&quot;Third sound (X) played successfully&quot;);&#10;                                            &#10;                                            xSound.onended = function() {&#10;                                                logDebug(&quot;Third sound ended, enabling response buttons&quot;);&#10;                                                &#10;                                                stimulusEndTime = performance.now();&#10;                                                &#10;                                                document.getElementById('text1').value = &quot;請作出選擇&quot;;&#10;                                                document.getElementById('promptText').style.visibility = 'visible';&#10;                                                &#10;                                                document.getElementById('firstBtn').disabled = false;&#10;                                                document.getElementById('secondBtn').disabled = false;&#10;                                                document.getElementById('firstBtn').style.background = &quot;#66CCFF&quot;;&#10;                                                document.getElementById('secondBtn').style.background = &quot;#66CCFF&quot;;&#10;                                            };&#10;                                        }).catch(function(error) {&#10;                                            logDebug(&quot;Failed to play third sound: &quot; + error);&#10;                                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                                            clearButtonAnimations();&#10;                                            setTimeout(showDiagnostics, 1000);&#10;                                        });&#10;                                    }&#10;                                }, 1000);&#10;                            };&#10;                        }).catch(function(error) {&#10;                            logDebug(&quot;Failed to play second sound: &quot; + error);&#10;                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                            clearButtonAnimations();&#10;                            setTimeout(showDiagnostics, 1000);&#10;                        });&#10;                    }&#10;                }, 1000);&#10;            };&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to play first sound: &quot; + error);&#10;            document.getElementById('text1').value = &quot;音頻播放錯誤，請刷新頁面&quot;;&#10;            clearButtonAnimations();&#10;            setTimeout(showDiagnostics, 1000);&#10;        });&#10;    }&#10;}&#10;&#10;function start_onclick() {&#10;    logDebug(&quot;Starting experiment&quot;);&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    checkAudioFiles();&#10;    if (!allFilesPresent) {&#10;        logDebug(&quot;Cannot start experiment: Some audio files are missing&quot;);&#10;        document.getElementById('text1').value = &quot;音頻缺失&quot;;&#10;        showDiagnostics();&#10;        return;&#10;    }&#10;    &#10;    window_onload();&#10;    document.getElementById('text1').value = &quot;開始實驗...&quot;;&#10;    updateProgressBar(0);&#10;    &#10;    setTimeout(function() {&#10;        beginIteration();&#10;        document.getElementById('start').disabled = true;&#10;        document.getElementById('viewResult').disabled = true;&#10;        document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;        document.getElementById('promptText').style.visibility = 'hidden';&#10;    }, 1000);&#10;}&#10;&#10;function gotReversal(dirIndex) {&#10;    NumberOfReversals[dirIndex]++;&#10;    Reversals[dirIndex][NumberOfReversals[dirIndex] - 1] = currentLevel[dirIndex];&#10;    Direction[dirIndex] = -Direction[dirIndex];&#10;    logDebug(&quot;Recorded reversal #&quot; + NumberOfReversals[dirIndex] + &quot; at difficulty &quot; + currentLevel[dirIndex]);&#10;}&#10;&#10;function mapLevelToSemitone(level) {&#10;    const semitoneMap = {&#10;        1: 2.0,&#10;        2: 1.0,&#10;        3: 1/2,&#10;        4: 1/6,&#10;        5: 1/8,&#10;        6: 1/12,&#10;        7: 1/15,&#10;        8: 1/20,&#10;        9: 1/50&#10;    };&#10;    return semitoneMap[level] || 0;&#10;}&#10;&#10;function processAnswer(Response) {&#10;    const reactionEndTime = performance.now();&#10;    const reactionTime = reactionEndTime - stimulusEndTime;&#10;    &#10;    logDebug(&quot;User answered: &quot; + (Response === 1 ? &quot;First&quot; : &quot;Second&quot;) + &#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Is replay: &quot; + isReplayTrial);&#10;    &#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    const isCorrect = (Response === CorrectAnswer);&#10;    &#10;    if (!isReplayTrial) {&#10;        const trialInfo = {&#10;            trialNumber: numberOfIterations,&#10;            timestamp: getLocalTimestamp(),&#10;            direction: currentStimDirection === 0 ? &quot;Higher&quot; : &quot;Lower&quot;,&#10;            difficultyLevel: currentLevel[currentStimDirection],&#10;            semitoneValue: mapLevelToSemitone(currentLevel[currentStimDirection]),&#10;            userResponse: Response === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            correctResponse: CorrectAnswer === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            isCorrect: isCorrect,&#10;            reactionTime: reactionTime.toFixed(0),&#10;            isReversal: false,&#10;            stepDirection: Direction[currentStimDirection] === DECREASING ? &quot;Increasing Difficulty&quot; : &quot;Decreasing Difficulty&quot;,&#10;            standardPosition: standardIsFirst ? &quot;First&quot; : &quot;Second&quot;&#10;        };&#10;        &#10;        trialRecords.push(trialInfo);&#10;    }&#10;    &#10;    if (isCorrect) {&#10;        logDebug(&quot;Correct answer&quot;);&#10;        document.getElementById('smile').src = &quot;Media/smiley.png&quot;;&#10;        document.getElementById('text1').value = &quot;正確！&quot;;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses[currentStimDirection]++;&#10;            &#10;            if (CorrectResponses[currentStimDirection] == 2) {&#10;                logDebug(&quot;Two correct answers in a row&quot;);&#10;                CorrectResponses[currentStimDirection] = 0;&#10;                &#10;                if (Direction[currentStimDirection] == INCREASING) {&#10;                    gotReversal(currentStimDirection);&#10;                    if (trialRecords.length &gt; 0) {&#10;                        trialRecords[trialRecords.length-1].isReversal = true;&#10;                    }&#10;                }&#10;                &#10;                changeLevel(DECREASING, currentStimDirection);&#10;            }&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            resetPage();&#10;        }, 1500);&#10;    } else {&#10;        logDebug(&quot;Incorrect answer - will replay stimulus&quot;);&#10;        document.getElementById('smile').src = &quot;Media/nosmiley.png&quot;;&#10;        &#10;        var correctAnswerText = CorrectAnswer === 1 ? &quot;第一個音&quot; : &quot;第二個音&quot;;&#10;        document.getElementById('text1').value = &quot;錯誤！正確答案是：&quot; + correctAnswerText;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses[currentStimDirection] = 0;&#10;            &#10;            if (Direction[currentStimDirection] == DECREASING) {&#10;                gotReversal(currentStimDirection);&#10;                if (trialRecords.length &gt; 0) {&#10;                    trialRecords[trialRecords.length-1].isReversal = true;&#10;                }&#10;            }&#10;            &#10;            changeLevel(INCREASING, currentStimDirection);&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            document.getElementById('text1').value = &quot;重播刺激音...&quot;;&#10;            &#10;            setTimeout(function() {&#10;                isReplayTrial = true;&#10;                &#10;                var xIsStandard = (standardIsFirst &amp;&amp; CorrectAnswer === 1) || &#10;                                  (!standardIsFirst &amp;&amp; CorrectAnswer === 2);&#10;                playABXSequence(xIsStandard);&#10;            }, 1000);&#10;        }, 2000);&#10;    }&#10;}&#10;&#10;function changeLevel(whichWay, dirIndex) {&#10;    var oldLevel = currentLevel[dirIndex];&#10;    var stepSize = NumberOfReversals[dirIndex] &lt; 4 ? 2 : 1;&#10;    &#10;    if (whichWay == DECREASING) {&#10;        currentLevel[dirIndex] = Math.min(9, currentLevel[dirIndex] + stepSize);&#10;    } else {&#10;        currentLevel[dirIndex] = Math.max(LOWERLIMIT, currentLevel[dirIndex] - stepSize);&#10;    }&#10;    &#10;    logDebug(&quot;Difficulty changed from &quot; + oldLevel + &quot; to &quot; + currentLevel[dirIndex] + &#10;             (whichWay == DECREASING ? &quot; (increasing difficulty)&quot; : &quot; (decreasing difficulty)&quot;));&#10;}&#10;&#10;function getThresholdAssessment(value) {&#10;    if (value &lt;= 0.05) return &quot;Exceptional&quot;;&#10;    if (value &lt;= 0.1) return &quot;Excellent&quot;;&#10;    if (value &lt;= 0.25) return &quot;Good&quot;;&#10;    if (value &lt;= 0.5) return &quot;Average&quot;;&#10;    if (value &lt;= 1.0) return &quot;Below Average&quot;;&#10;    return &quot;Needs Improvement&quot;;&#10;}&#10;&#10;function calculateReactionTimeStats() {&#10;    let higherRTs = trialRecords.filter(t =&gt; t.direction === &quot;Higher&quot;).map(t =&gt; parseFloat(t.reactionTime));&#10;    let lowerRTs = trialRecords.filter(t =&gt; t.direction === &quot;Lower&quot;).map(t =&gt; parseFloat(t.reactionTime));&#10;    let allRTs = higherRTs.concat(lowerRTs);&#10;    &#10;    return {&#10;        higher: {&#10;            mean: higherRTs.length ? (higherRTs.reduce((a, b) =&gt; a + b, 0) / higherRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;            median: higherRTs.length ? calculateMedian(higherRTs).toFixed(0) : &quot;N/A&quot;,&#10;            sd: higherRTs.length &gt; 1 ? calculateSD(higherRTs).toFixed(0) : &quot;N/A&quot;&#10;        },&#10;        lower: {&#10;            mean: lowerRTs.length ? (lowerRTs.reduce((a, b) =&gt; a + b, 0) / lowerRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;            median: lowerRTs.length ? calculateMedian(lowerRTs).toFixed(0) : &quot;N/A&quot;,&#10;            sd: lowerRTs.length &gt; 1 ? calculateSD(lowerRTs).toFixed(0) : &quot;N/A&quot;&#10;        },&#10;        overall: {&#10;            mean: allRTs.length ? (allRTs.reduce((a, b) =&gt; a + b, 0) / allRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;            median: allRTs.length ? calculateMedian(allRTs).toFixed(0) : &quot;N/A&quot;,&#10;            sd: allRTs.length &gt; 1 ? calculateSD(allRTs).toFixed(0) : &quot;N/A&quot;&#10;        }&#10;    };&#10;}&#10;&#10;function calculateAccuracyStats() {&#10;    let higherTrials = trialRecords.filter(t =&gt; t.direction === &quot;Higher&quot;);&#10;    let lowerTrials = trialRecords.filter(t =&gt; t.direction === &quot;Lower&quot;);&#10;    let allTrials = trialRecords;&#10;    &#10;    return {&#10;        higher: {&#10;            correct: higherTrials.filter(t =&gt; t.isCorrect).length,&#10;            total: higherTrials.length,&#10;            percentage: higherTrials.length ? &#10;                (higherTrials.filter(t =&gt; t.isCorrect).length / higherTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;        },&#10;        lower: {&#10;            correct: lowerTrials.filter(t =&gt; t.isCorrect).length,&#10;            total: lowerTrials.length,&#10;            percentage: lowerTrials.length ? &#10;                (lowerTrials.filter(t =&gt; t.isCorrect).length / lowerTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;        },&#10;        overall: {&#10;            correct: allTrials.filter(t =&gt; t.isCorrect).length,&#10;            total: allTrials.length,&#10;            percentage: allTrials.length ? &#10;                (allTrials.filter(t =&gt; t.isCorrect).length / allTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;        }&#10;    };&#10;}&#10;&#10;function calculateMedian(values) {&#10;    if (!values.length) return 0;&#10;    &#10;    const sortedValues = values.slice().sort((a, b) =&gt; a - b);&#10;    const mid = Math.floor(sortedValues.length / 2);&#10;    &#10;    return sortedValues.length % 2 === 0 ? &#10;        (sortedValues[mid - 1] + sortedValues[mid]) / 2 : &#10;        sortedValues[mid];&#10;}&#10;&#10;function calculateSD(values) {&#10;    if (values.length &lt;= 1) return 0;&#10;    &#10;    const mean = values.reduce((a, b) =&gt; a + b, 0) / values.length;&#10;    const variance = values.map(x =&gt; Math.pow(x - mean, 2)).reduce((a, b) =&gt; a + b, 0) / (values.length - 1);&#10;    &#10;    return Math.sqrt(variance);&#10;}&#10;&#10;function displayResults() {&#10;    logDebug(&quot;Displaying results&quot;);&#10;    &#10;    let hasHigherData = NumberOfReversals[0] &gt;= MINIMUMREVERSALS;&#10;    let hasLowerData = NumberOfReversals[1] &gt;= MINIMUMREVERSALS;&#10;    &#10;    if (!hasHigherData || !hasLowerData) {&#10;        let message = &quot;Warning: &quot;;&#10;        if (!hasHigherData) message += &quot;Higher direction has insufficient data. &quot;;&#10;        if (!hasLowerData) message += &quot;Lower direction has insufficient data. &quot;;&#10;        message += &quot;Results may not be reliable.&quot;;&#10;        &#10;        if (confirm(message + &quot;\n\nWould you like to retry the experiment?&quot;)) {&#10;            window_onload();&#10;            return;&#10;        }&#10;    }&#10;    &#10;    document.getElementById('experimentContainer').style.display = 'none';&#10;    document.getElementById('resultsContainer').style.display = 'block';&#10;    &#10;    var tableBody = document.getElementById('resultTableBody');&#10;    tableBody.innerHTML = '';&#10;    &#10;    var higherRow = document.createElement('tr');&#10;    higherRow.innerHTML = &#10;        '&lt;td&gt;Higher Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasHigherData ? sentAverage[0].toFixed(4) : 'Insufficient data') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasHigherData ? sentStdev[0].toFixed(4) : '-') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasHigherData ? getThresholdAssessment(sentAverage[0]) : '-') + '&lt;/td&gt;';&#10;    tableBody.appendChild(higherRow);&#10;    &#10;    var lowerRow = document.createElement('tr');&#10;    lowerRow.innerHTML = &#10;        '&lt;td&gt;Lower Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasLowerData ? sentAverage[1].toFixed(4) : 'Insufficient data') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasLowerData ? sentStdev[1].toFixed(4) : '-') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasLowerData ? getThresholdAssessment(sentAverage[1]) : '-') + '&lt;/td&gt;';&#10;    tableBody.appendChild(lowerRow);&#10;    &#10;    if (hasHigherData &amp;&amp; hasLowerData) {&#10;        var avgThreshold = (sentAverage[0] + sentAverage[1]) / 2;&#10;        var combinedVariance = (Math.pow(sentStdev[0], 2) + Math.pow(sentStdev[1], 2)) / 2;&#10;        var combinedSD = Math.sqrt(combinedVariance).toFixed(4);&#10;        &#10;        var avgRow = document.createElement('tr');&#10;        avgRow.style.fontWeight = 'bold';&#10;        avgRow.innerHTML = &#10;            '&lt;td&gt;Average&lt;/td&gt;' +&#10;            '&lt;td&gt;' + avgThreshold.toFixed(4) + '&lt;/td&gt;' +&#10;            '&lt;td&gt;' + combinedSD + '&lt;/td&gt;' +&#10;            '&lt;td&gt;' + getThresholdAssessment(avgThreshold) + '&lt;/td&gt;';&#10;        tableBody.appendChild(avgRow);&#10;    }&#10;    &#10;    var interpretation = document.getElementById('resultInterpretation');&#10;    let interpretationHtml = '&lt;p&gt;&lt;strong&gt;Threshold Interpretation (ABX Task):&lt;/strong&gt;&lt;/p&gt;';&#10;    &#10;    if (hasHigherData &amp;&amp; hasLowerData) {&#10;        const avgThreshold = (sentAverage[0] + sentAverage[1]) / 2;&#10;        interpretationHtml += '&lt;p&gt;Your average pitch discrimination threshold is ' + avgThreshold.toFixed(4) + ' semitones, indicating ' + &#10;            getThresholdAssessment(avgThreshold) + ' pitch discrimination ability.&lt;/p&gt;';&#10;    } else {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Complete results not available due to insufficient data.&lt;/p&gt;';&#10;        &#10;        if (hasHigherData) {&#10;            interpretationHtml += '&lt;p&gt;Your higher direction threshold is ' + sentAverage[0].toFixed(4) + &#10;                ' semitones, indicating ' + getThresholdAssessment(sentAverage[0]) + ' discrimination ability for higher pitches.&lt;/p&gt;';&#10;        }&#10;        &#10;        if (hasLowerData) {&#10;            interpretationHtml += '&lt;p&gt;Your lower direction threshold is ' + sentAverage[1].toFixed(4) + &#10;                ' semitones, indicating ' + getThresholdAssessment(sentAverage[1]) + ' discrimination ability for lower pitches.&lt;/p&gt;';&#10;        }&#10;    }&#10;    &#10;    interpretationHtml += '&lt;p&gt;&lt;strong&gt;Performance Metrics:&lt;/strong&gt;&lt;/p&gt;';&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    const accuracyStats = calculateAccuracyStats();&#10;    &#10;    interpretationHtml += '&lt;p&gt;Your average reaction time was ' + rtStats.overall.mean + &#10;        ' ms, with ' + accuracyStats.overall.percentage + '% overall accuracy.&lt;/p&gt;';&#10;    &#10;    interpretation.innerHTML = interpretationHtml;&#10;    &#10;    var rtTableBody = document.getElementById('rtStatsTableBody');&#10;    rtTableBody.innerHTML = '';&#10;    &#10;    var higherRtRow = document.createElement('tr');&#10;    higherRtRow.innerHTML = &#10;        '&lt;td&gt;Higher Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.higher.mean + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.higher.median + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.higher.sd + '&lt;/td&gt;';&#10;    rtTableBody.appendChild(higherRtRow);&#10;    &#10;    var lowerRtRow = document.createElement('tr');&#10;    lowerRtRow.innerHTML = &#10;        '&lt;td&gt;Lower Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.lower.mean + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.lower.median + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.lower.sd + '&lt;/td&gt;';&#10;    rtTableBody.appendChild(lowerRtRow);&#10;    &#10;    var overallRtRow = document.createElement('tr');&#10;    overallRtRow.style.fontWeight = 'bold';&#10;    overallRtRow.innerHTML = &#10;        '&lt;td&gt;Overall&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.overall.mean + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.overall.median + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.overall.sd + '&lt;/td&gt;';&#10;    rtTableBody.appendChild(overallRtRow);&#10;    &#10;    var accuracyTableBody = document.getElementById('accuracyStatsTableBody');&#10;    accuracyTableBody.innerHTML = '';&#10;    &#10;    var higherAccRow = document.createElement('tr');&#10;    higherAccRow.innerHTML = &#10;        '&lt;td&gt;Higher Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.higher.correct + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.higher.total + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.higher.percentage + '%&lt;/td&gt;';&#10;    accuracyTableBody.appendChild(higherAccRow);&#10;    &#10;    var lowerAccRow = document.createElement('tr');&#10;    lowerAccRow.innerHTML = &#10;        '&lt;td&gt;Lower Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.lower.correct + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.lower.total + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.lower.percentage + '%&lt;/td&gt;';&#10;    accuracyTableBody.appendChild(lowerAccRow);&#10;    &#10;    var overallAccRow = document.createElement('tr');&#10;    overallAccRow.style.fontWeight = 'bold';&#10;    overallAccRow.innerHTML = &#10;        '&lt;td&gt;Overall&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.overall.correct + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.overall.total + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.overall.percentage + '%&lt;/td&gt;';&#10;    accuracyTableBody.appendChild(overallAccRow);&#10;    &#10;    drawResultChart(hasHigherData, hasLowerData);&#10;}&#10;&#10;function drawResultChart(hasHigherData, hasLowerData) {&#10;    var chartContainer = document.getElementById('resultChart');&#10;    &#10;    var chartHTML = '&lt;div style=&quot;display: flex; flex-direction: column; height: 100%;&quot;&gt;';&#10;    chartHTML += '&lt;div style=&quot;text-align: center; margin-bottom: 10px;&quot;&gt;&lt;strong&gt;Threshold Comparison&lt;/strong&gt;&lt;/div&gt;';&#10;    &#10;    chartHTML += '&lt;div style=&quot;display: flex; justify-content: center; margin-bottom: 10px;&quot;&gt;';&#10;    chartHTML += '&lt;span style=&quot;margin-right: 20px;&quot;&gt;&lt;span style=&quot;display: inline-block; width: 15px; height: 15px; background-color: #3498db; margin-right: 5px;&quot;&gt;&lt;/span&gt;Higher Direction&lt;/span&gt;';&#10;    chartHTML += '&lt;span&gt;&lt;span style=&quot;display: inline-block; width: 15px; height: 15px; background-color: #e74c3c; margin-right: 5px;&quot;&gt;&lt;/span&gt;Lower Direction&lt;/span&gt;';&#10;    chartHTML += '&lt;/div&gt;';&#10;    &#10;    chartHTML += '&lt;div style=&quot;flex: 1; display: flex; align-items: flex-end; border-left: 1px solid #333; border-bottom: 1px solid #333; position: relative;&quot;&gt;';&#10;    &#10;    let maxValue = 0.5;&#10;    if (hasHigherData) maxValue = Math.max(maxValue, sentAverage[0]);&#10;    if (hasLowerData) maxValue = Math.max(maxValue, sentAverage[1]);&#10;    &#10;    if (hasHigherData) {&#10;        var higherHeight = (sentAverage[0] / maxValue) * 80;&#10;        chartHTML += '&lt;div style=&quot;width: 40px; height: ' + higherHeight + '%; background-color: #3498db; margin: 0 20px; position: relative;&quot;&gt;';&#10;        chartHTML += '&lt;div style=&quot;position: absolute; top: -20px; width: 100%; text-align: center;&quot;&gt;' + sentAverage[0].toFixed(4) + '&lt;/div&gt;';&#10;        chartHTML += '&lt;/div&gt;';&#10;    } else {&#10;        chartHTML += '&lt;div style=&quot;width: 40px; height: 5%; background-color: #ccc; margin: 0 20px; position: relative;&quot;&gt;';&#10;        chartHTML += '&lt;div style=&quot;position: absolute; top: -20px; width: 100%; text-align: center;&quot;&gt;N/A&lt;/div&gt;';&#10;        chartHTML += '&lt;/div&gt;';&#10;    }&#10;    &#10;    if (hasLowerData) {&#10;        var lowerHeight = (sentAverage[1] / maxValue) * 80;&#10;        chartHTML += '&lt;div style=&quot;width: 40px; height: ' + lowerHeight + '%; background-color: #e74c3c; margin: 0 20px; position: relative;&quot;&gt;';&#10;        chartHTML += '&lt;div style=&quot;position: absolute; top: -20px; width: 100%; text-align: center;&quot;&gt;' + sentAverage[1].toFixed(4) + '&lt;/div&gt;';&#10;        chartHTML += '&lt;/div&gt;';&#10;    } else {&#10;        chartHTML += '&lt;div style=&quot;width: 40px; height: 5%; background-color: #ccc; margin: 0 20px; position: relative;&quot;&gt;';&#10;        chartHTML += '&lt;div style=&quot;position: absolute; top: -20px; width: 100%; text-align: center;&quot;&gt;N/A&lt;/div&gt;';&#10;        chartHTML += '&lt;/div&gt;';&#10;    }&#10;    &#10;    chartHTML += '&lt;div style=&quot;position: absolute; bottom: -25px; left: 20px; width: 40px; text-align: center;&quot;&gt;Higher&lt;/div&gt;';&#10;    chartHTML += '&lt;div style=&quot;position: absolute; bottom: -25px; left: 80px; width: 40px; text-align: center;&quot;&gt;Lower&lt;/div&gt;';&#10;    chartHTML += '&lt;div style=&quot;position: absolute; left: -35px; top: 20%; transform: rotate(-90deg);&quot;&gt;Threshold (semitones)&lt;/div&gt;';&#10;    &#10;    chartHTML += '&lt;/div&gt;';&#10;    chartHTML += '&lt;/div&gt;';&#10;    &#10;    chartContainer.innerHTML = chartHTML;&#10;}&#10;&#10;function backToExperiment() {&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;}&#10;&#10;function view_onclick() {&#10;    logDebug(&quot;View results button clicked&quot;);&#10;    &#10;    for (let i = 0; i &lt; 2; i++) {&#10;        if (!isTestComplete[i] &amp;&amp; NumberOfReversals[i] &gt;= MINIMUMREVERSALS) {&#10;            calculateResults(i);&#10;            isTestComplete[i] = true;&#10;        }&#10;    }&#10;    &#10;    displayResults();&#10;}&#10;&#10;function exportToCSV() {&#10;    const headers = [&#10;        &quot;Trial Number&quot;, &#10;        &quot;Timestamp&quot;, &#10;        &quot;Direction&quot;, &#10;        &quot;Difficulty Level&quot;, &#10;        &quot;Semitone Value&quot;, &#10;        &quot;Standard Position&quot;,&#10;        &quot;User Response&quot;, &#10;        &quot;Correct Response&quot;, &#10;        &quot;Is Correct&quot;, &#10;        &quot;Reaction Time (ms)&quot;, &#10;        &quot;Is Reversal&quot;,&#10;        &quot;Step Direction&quot;&#10;    ];&#10;    &#10;    const csvRows = [];&#10;    csvRows.push(headers.join(&quot;,&quot;));&#10;    &#10;    trialRecords.forEach(function(trial) {&#10;        const row = [&#10;            trial.trialNumber,&#10;            trial.timestamp,&#10;            trial.direction,&#10;            trial.difficultyLevel,&#10;            trial.semitoneValue,&#10;            trial.standardPosition,&#10;            trial.userResponse,&#10;            trial.correctResponse,&#10;            trial.isCorrect ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.reactionTime,&#10;            trial.isReversal ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.stepDirection&#10;        ];&#10;        csvRows.push(row.join(&quot;,&quot;));&#10;    });&#10;    &#10;    csvRows.push(&quot;\nRESULTS SUMMARY&quot;);&#10;    csvRows.push(&quot;\nThreshold Results (semitones)&quot;);&#10;    csvRows.push(&quot;Direction,Threshold,Standard Deviation,Assessment&quot;);&#10;    &#10;    const hasHigherData = NumberOfReversals[0] &gt;= MINIMUMREVERSALS;&#10;    const hasLowerData = NumberOfReversals[1] &gt;= MINIMUMREVERSALS;&#10;    &#10;    csvRows.push(&quot;Higher,&quot; + &#10;        (hasHigherData ? sentAverage[0].toFixed(4) : &quot;Insufficient data&quot;) + &quot;,&quot; + &#10;        (hasHigherData ? sentStdev[0].toFixed(4) : &quot;N/A&quot;) + &quot;,&quot; + &#10;        (hasHigherData ? getThresholdAssessment(sentAverage[0]) : &quot;N/A&quot;));&#10;    &#10;    csvRows.push(&quot;Lower,&quot; + &#10;        (hasLowerData ? sentAverage[1].toFixed(4) : &quot;Insufficient data&quot;) + &quot;,&quot; + &#10;        (hasLowerData ? sentStdev[1].toFixed(4) : &quot;N/A&quot;) + &quot;,&quot; + &#10;        (hasLowerData ? getThresholdAssessment(sentAverage[1]) : &quot;N/A&quot;));&#10;    &#10;    if (hasHigherData &amp;&amp; hasLowerData) {&#10;        const avgThreshold = (sentAverage[0] + sentAverage[1]) / 2;&#10;        const combinedVariance = (Math.pow(sentStdev[0], 2) + Math.pow(sentStdev[1], 2)) / 2;&#10;        const combinedSD = Math.sqrt(combinedVariance).toFixed(4);&#10;        &#10;        csvRows.push(&quot;Average,&quot; + avgThreshold.toFixed(4) + &quot;,&quot; + combinedSD + &quot;,&quot; + getThresholdAssessment(avgThreshold));&#10;    }&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    csvRows.push(&quot;\nReaction Time Statistics (ms)&quot;);&#10;    csvRows.push(&quot;Direction,Mean,Median,Standard Deviation&quot;);&#10;    csvRows.push(&quot;Higher,&quot; + rtStats.higher.mean + &quot;,&quot; + rtStats.higher.median + &quot;,&quot; + rtStats.higher.sd);&#10;    csvRows.push(&quot;Lower,&quot; + rtStats.lower.mean + &quot;,&quot; + rtStats.lower.median + &quot;,&quot; + rtStats.lower.sd);&#10;    csvRows.push(&quot;Overall,&quot; + rtStats.overall.mean + &quot;,&quot; + rtStats.overall.median + &quot;,&quot; + rtStats.overall.sd);&#10;    &#10;    const accuracyStats = calculateAccuracyStats();&#10;    csvRows.push(&quot;\nAccuracy Statistics&quot;);&#10;    csvRows.push(&quot;Direction,Correct Responses,Total Responses,Percentage&quot;);&#10;    csvRows.push(&quot;Higher,&quot; + accuracyStats.higher.correct + &quot;,&quot; + accuracyStats.higher.total + &quot;,&quot; + accuracyStats.higher.percentage + &quot;%&quot;);&#10;    csvRows.push(&quot;Lower,&quot; + accuracyStats.lower.correct + &quot;,&quot; + accuracyStats.lower.total + &quot;,&quot; + accuracyStats.lower.percentage + &quot;%&quot;);&#10;    csvRows.push(&quot;Overall,&quot; + accuracyStats.overall.correct + &quot;,&quot; + accuracyStats.overall.total + &quot;,&quot; + accuracyStats.overall.percentage + &quot;%&quot;);&#10;    &#10;    csvRows.push(&quot;\nExperiment Parameters&quot;);&#10;    csvRows.push(&quot;Paradigm,ABX&quot;);&#10;    csvRows.push(&quot;Max Reversals,&quot; + MAXREVERSALS);&#10;    csvRows.push(&quot;Min Reversals for Calculation,&quot; + MINIMUMREVERSALS);&#10;    csvRows.push(&quot;Max Iterations,&quot; + MAXITERATIONS);&#10;    &#10;    const csvContent = &quot;data:text/csv;charset=utf-8,&quot; + csvRows.join(&quot;\n&quot;);&#10;    const encodedUri = encodeURI(csvContent);&#10;    const link = document.createElement(&quot;a&quot;);&#10;    const timestamp = new Date().toISOString().replace(/[:.]/g, &quot;-&quot;);&#10;    link.setAttribute(&quot;href&quot;, encodedUri);&#10;    link.setAttribute(&quot;download&quot;, &quot;pitch_discrimination_ABX_data_&quot; + timestamp + &quot;.csv&quot;);&#10;    document.body.appendChild(link);&#10;    link.click();&#10;    document.body.removeChild(link);&#10;}&#10;&#10;function window_onload() {&#10;    window.name = &quot;EXP&quot;;&#10;    NumberOfReversals = [0, 0];&#10;    numberOfIterations = 0;&#10;    CorrectResponses = [0, 0];&#10;    Direction = [DECREASING, DECREASING];&#10;    currentLevel = [5, 5];&#10;    isTestComplete = [false, false];&#10;    Reversals = [[], []];&#10;    trialsPerDirection = [0, 0];&#10;    forceDirection = null;&#10;    directionHistory = [];&#10;    trialRecords = [];&#10;    isReplayTrial = false;&#10;&#10;    document.getElementById('text1').value = &quot;準備完畢後請點擊\&quot;開始實驗\&quot;&quot;;&#10;    document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;    document.getElementById('start').disabled = false;&#10;    document.getElementById('viewResult').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;    &#10;    updateProgressBar(0);&#10;    &#10;    logDebug(&quot;Page reset complete&quot;);&#10;}&#10;&#10;window.onload = function() {&#10;    window_onload();&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    logDebug(&quot;Preloading &quot; + allAudios.length + &quot; audio files&quot;);&#10;    &#10;    allAudios.forEach(function(audio) {&#10;        audio.load();&#10;    });&#10;    &#10;    document.getElementById('text1').value = &quot;請點擊\&quot;開始實驗\&quot;&quot;;&#10;    &#10;    window.onerror = function(message, source, lineno, colno, error) {&#10;        logDebug(&quot;Global error: &quot; + message + &quot; at &quot; + source + &quot;:&quot; + lineno);&#10;        return false;&#10;    };&#10;    &#10;    document.getElementById('showDebug').checked = true;&#10;    toggleDebug();&#10;};&#10;&lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
                    <entry key="file:///E:/Projects/Pitch_Training/ABX_level_low.html" value="&lt;!DOCTYPE html&gt;&#10;&lt;html&gt;&#10;&lt;head&gt;&#10;    &lt;title&gt;PLOYU-Peng's Lab: Pitch Sensitivity Training&lt;/title&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;style&gt;&#10;        body {&#10;            font-family: Arial, sans-serif;&#10;            margin: 20px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .container {&#10;            max-width: 800px;&#10;            margin: 0 auto;&#10;            padding: 20px;&#10;            background-color: white;&#10;            border-radius: 10px;&#10;            box-shadow: 0 0 10px rgba(0,0,0,0.1);&#10;            display: flex;&#10;            flex-direction: column;&#10;            align-items: center;&#10;        }&#10;        .header {&#10;            text-align: center;&#10;            margin-bottom: 40px;&#10;            width: 100%;&#10;        }&#10;        .training-info {&#10;            font-size: 16px;&#10;            color: #555;&#10;            margin-top: 10px;&#10;            margin-bottom: 5px;&#10;            text-align: center;&#10;        }&#10;        .instruction-text {&#10;            font-size: 14px;&#10;            color: #777;&#10;            margin-bottom: 15px;&#10;            text-align: center;&#10;            font-style: italic;&#10;        }&#10;        .button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .prompt-text {&#10;            text-align: center;&#10;            font-size: 20px;&#10;            margin-bottom: 25px;&#10;            margin-top: 30px;&#10;            font-weight: bold;&#10;        }&#10;        .response-button {&#10;            width: 160px;&#10;            height: 160px;&#10;            font-size: 26px;&#10;            margin: 0 40px;&#10;            border-radius: 15px;&#10;            border: none;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.1);&#10;            transition: all 0.3s ease;&#10;        }&#10;        .response-button:hover:enabled {&#10;            transform: translateY(-3px);&#10;            box-shadow: 0 6px 12px rgba(0,0,0,0.15);&#10;        }&#10;        .response-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .button-playing {&#10;            animation: pulse 1s ease-in-out infinite;&#10;            box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            transform: scale(1.05);&#10;        }&#10;        @keyframes pulse {&#10;            0%, 100% {&#10;                box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            }&#10;            50% {&#10;                box-shadow: 0 0 30px rgba(102, 204, 255, 1);&#10;            }&#10;        }&#10;        .control-button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            gap: 30px;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .control-button {&#10;            padding: 14px 28px;&#10;            font-size: 18px;&#10;            border-radius: 8px;&#10;            border: none;&#10;            background-color: #4CAF50;&#10;            color: white;&#10;            cursor: pointer;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .control-button:hover:enabled {&#10;            background-color: #3e8e41;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .control-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .control-button:disabled {&#10;            background-color: #cccccc;&#10;            cursor: not-allowed;&#10;            box-shadow: none;&#10;        }&#10;        .feedback {&#10;            text-align: center;&#10;            height: 100px;&#10;            margin: 30px 0;&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;        }&#10;        .status {&#10;            width: 350px;&#10;            height: 68px;&#10;            text-align: center;&#10;            font-size: 18px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            margin: 0 auto;&#10;            padding: 10px;&#10;            background-color: #f9f9f9;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.05);&#10;        }&#10;        .debug-info {&#10;            font-size: 12px;&#10;            color: #777;&#10;            margin-top: 30px;&#10;            text-align: left;&#10;            display: none;&#10;            max-height: 300px;&#10;            overflow-y: auto;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            padding: 15px;&#10;            width: 100%;&#10;        }&#10;        .results-container {&#10;            display: none;&#10;            margin-top: 30px;&#10;            padding: 20px;&#10;            background-color: #f0f8ff;&#10;            border-radius: 8px;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.1);&#10;            width: 100%;&#10;        }&#10;        .result-heading {&#10;            text-align: center;&#10;            margin-bottom: 20px;&#10;            color: #2c3e50;&#10;        }&#10;        .result-table {&#10;            width: 100%;&#10;            border-collapse: collapse;&#10;            margin-bottom: 20px;&#10;        }&#10;        .result-table th, .result-table td {&#10;            padding: 12px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .result-table th {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .result-table tr:nth-child(even) {&#10;            background-color: #f2f2f2;&#10;        }&#10;        .result-interpretation {&#10;            background-color: #e8f4f8;&#10;            padding: 15px;&#10;            border-radius: 5px;&#10;            margin-bottom: 20px;&#10;        }&#10;        .back-button {&#10;            display: block;&#10;            margin: 0 auto;&#10;            padding: 14px 28px;&#10;            background-color: #3498db;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .back-button:hover {&#10;            background-color: #2980b9;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .back-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        .chart-container {&#10;            height: 300px;&#10;            margin: 20px 0;&#10;            background-color: white;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;            padding: 10px;&#10;        }&#10;        .auxiliary-buttons {&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            margin-top: 30px;&#10;            gap: 20px;&#10;            flex-wrap: wrap;&#10;        }&#10;        .auxiliary-buttons button {&#10;            padding: 10px 15px;&#10;            border-radius: 5px;&#10;            border: 1px solid #ddd;&#10;            background-color: #f0f0f0;&#10;            cursor: pointer;&#10;            transition: all 0.2s ease;&#10;        }&#10;        .auxiliary-buttons button:hover {&#10;            background-color: #e0e0e0;&#10;        }&#10;        .diagnostic-overlay {&#10;            position: fixed;&#10;            top: 0;&#10;            left: 0;&#10;            width: 100%;&#10;            height: 100%;&#10;            background-color: rgba(0, 0, 0, 0.8);&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            z-index: 1000;&#10;            display: none;&#10;        }&#10;        .diagnostic-content {&#10;            width: 80%;&#10;            max-width: 700px;&#10;            max-height: 80%;&#10;            overflow-y: auto;&#10;            background-color: white;&#10;            padding: 20px;&#10;            border-radius: 8px;&#10;            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);&#10;        }&#10;        .diagnostic-heading {&#10;            text-align: center;&#10;            color: #e74c3c;&#10;            margin-bottom: 20px;&#10;            font-size: 24px;&#10;        }&#10;        .diagnostic-close {&#10;            float: right;&#10;            font-size: 20px;&#10;            cursor: pointer;&#10;            color: #777;&#10;        }&#10;        .diagnostic-close:hover {&#10;            color: #333;&#10;        }&#10;        .diagnostic-section {&#10;            margin-bottom: 15px;&#10;            padding: 10px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;        }&#10;        .diagnostic-actions {&#10;            text-align: center;&#10;            margin-top: 20px;&#10;        }&#10;        .diagnostic-action-button {&#10;            padding: 10px 20px;&#10;            margin: 0 10px;&#10;            border: none;&#10;            border-radius: 5px;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;        }&#10;        .retry-button {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .retry-button:hover {&#10;            background-color: #2980b9;&#10;        }&#10;        .continue-button {&#10;            background-color: #2ecc71;&#10;            color: white;&#10;        }&#10;        .continue-button:hover {&#10;            background-color: #27ae60;&#10;        }&#10;        .diagnostic-file-check {&#10;            margin: 20px 0;&#10;        }&#10;        .diagnostic-file-status {&#10;            display: flex;&#10;            flex-wrap: wrap;&#10;            gap: 10px;&#10;        }&#10;        .file-status-item {&#10;            font-size: 12px;&#10;            padding: 5px 10px;&#10;            border-radius: 3px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .file-found {&#10;            color: #27ae60;&#10;            border-left: 3px solid #27ae60;&#10;        }&#10;        .file-missing {&#10;            color: #e74c3c;&#10;            border-left: 3px solid #e74c3c;&#10;        }&#10;        .statistics-table {&#10;            width: 100%;&#10;            margin: 10px 0;&#10;            border-collapse: collapse;&#10;        }&#10;        .statistics-table th, .statistics-table td {&#10;            padding: 8px;&#10;            text-align:center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .statistics-table th {&#10;            background-color: #f0f0f0;&#10;        }&#10;        .direction-stats-good {&#10;            color: #27ae60;&#10;        }&#10;        .direction-stats-warning {&#10;            color: #f39c12;&#10;        }&#10;        .direction-stats-bad {&#10;            color: #e74c3c;&#10;        }&#10;        @media (max-width: 600px) {&#10;            .response-button {&#10;                width: 130px;&#10;                height: 130px;&#10;                font-size: 22px;&#10;                margin: 0 20px;&#10;            }&#10;            .control-button {&#10;                padding: 12px 20px;&#10;            }&#10;        }&#10;        .print-button {&#10;            padding: 14px 28px;&#10;            margin: 20px auto;&#10;            background-color: #9b59b6;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;            display: block;&#10;        }&#10;        .print-button:hover {&#10;            background-color: #8e44ad;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .print-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        @media print {&#10;            body {&#10;                background-color: white;&#10;                margin: 0;&#10;                padding: 0;&#10;            }&#10;            .container {&#10;                max-width: 100%;&#10;                box-shadow: none;&#10;                padding: 10px;&#10;            }&#10;            .back-button, .print-button, .auxiliary-buttons {&#10;                display: none;&#10;            }&#10;            .results-container {&#10;                display: block !important;&#10;                box-shadow: none;&#10;                background-color: white;&#10;                padding: 0;&#10;            }&#10;            .chart-container {&#10;                border: 1px solid #ddd;&#10;                background-color: white;&#10;            }&#10;            .result-table th {&#10;                background-color: #f0f0f0 !important;&#10;                color: black !important;&#10;            }&#10;            .result-interpretation {&#10;                background-color: white;&#10;                border: 1px solid #ddd;&#10;            }&#10;            * {&#10;                -webkit-print-color-adjust: exact !important;&#10;                print-color-adjust: exact !important;&#10;            }&#10;        }&#10;        .progress-bar-container {&#10;            width: 100%;&#10;            height: 20px;&#10;            background-color: #e0e0e0;&#10;            border-radius: 10px;&#10;            margin: 10px 0;&#10;            overflow: hidden;&#10;        }&#10;        .progress-bar {&#10;            height: 100%;&#10;            background-color: #4CAF50;&#10;            border-radius: 10px;&#10;            transition: width 0.3s ease;&#10;        }&#10;        .progress-label {&#10;            text-align: center;&#10;            font-size: 14px;&#10;            color: #555;&#10;            margin-top: 5px;&#10;        }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;div class=&quot;container&quot;&gt;&#10;        &lt;div class=&quot;header&quot;&gt;&#10;            &lt;img src=&quot;Media/animation.gif&quot; alt=&quot;Experiment animation&quot;&gt;&#10;            &lt;div class=&quot;training-info&quot;&gt;Low Register Discrimination (ABX)&lt;/div&gt;&#10;            &lt;div class=&quot;instruction-text&quot;&gt;請判斷第三個音聽起來更像第一個還是第二個音&lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div id=&quot;experimentContainer&quot;&gt;&#10;            &lt;div class=&quot;control-button-container&quot;&gt;&#10;                &lt;input id=&quot;start&quot; type=&quot;button&quot; value=&quot;開始實驗&quot; onclick=&quot;start_onclick()&quot; class=&quot;control-button&quot;&gt;&#10;                &lt;input id=&quot;viewResult&quot; type=&quot;button&quot; value=&quot;查看結果&quot; onclick=&quot;view_onclick()&quot; class=&quot;control-button&quot; disabled&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;prompt-text&quot; id=&quot;promptText&quot;&gt;&#10;                第三個音更像...&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;firstBtn&quot; type=&quot;button&quot; value=&quot;第一個音&quot; onclick=&quot;processAnswer(1)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;                &lt;input id=&quot;secondBtn&quot; type=&quot;button&quot; value=&quot;第二個音&quot; onclick=&quot;processAnswer(2)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;feedback&quot;&gt;&#10;                &lt;img id=&quot;smile&quot; src=&quot;Media/null.gif&quot; width=&quot;100&quot; height=&quot;84&quot; alt=&quot;Feedback&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;text1&quot; class=&quot;status&quot; readonly&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;progress-bar-container&quot;&gt;&#10;                &lt;div class=&quot;progress-bar&quot; id=&quot;progressBar&quot; style=&quot;width: 0%&quot;&gt;&lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;progress-label&quot; id=&quot;progressLabel&quot;&gt;Progress: 0%&lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;debug-info&quot; id=&quot;debugInfo&quot;&gt;&#10;                Debug information will be displayed here&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot;&gt;&#10;                &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;showDebug&quot; onclick=&quot;toggleDebug()&quot;&gt; Show Debug Info&lt;/label&gt;&#10;                &lt;button onclick=&quot;testAudio()&quot;&gt;Test All Audio&lt;/button&gt;&#10;                &lt;button onclick=&quot;showDiagnostics()&quot;&gt;Diagnostics&lt;/button&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot; id=&quot;exportBtn&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div id=&quot;resultsContainer&quot; class=&quot;results-container&quot;&gt;&#10;            &lt;h2 class=&quot;result-heading&quot;&gt;Pitch Discrimination Test Results (ABX)&lt;/h2&gt;&#10;            &#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Test Direction&lt;/th&gt;&#10;                        &lt;th&gt;Threshold (semitones)&lt;/th&gt;&#10;                        &lt;th&gt;Std. Deviation&lt;/th&gt;&#10;                        &lt;th&gt;Assessment&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;resultTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;div class=&quot;result-interpretation&quot; id=&quot;resultInterpretation&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Reaction Time Statistics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot; id=&quot;rtStatsTable&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Direction&lt;/th&gt;&#10;                        &lt;th&gt;Mean RT (ms)&lt;/th&gt;&#10;                        &lt;th&gt;Median RT (ms)&lt;/th&gt;&#10;                        &lt;th&gt;RT Std. Deviation&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;rtStatsTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;h3&gt;Accuracy Statistics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot; id=&quot;accuracyStatsTable&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Direction&lt;/th&gt;&#10;                        &lt;th&gt;Correct Responses&lt;/th&gt;&#10;                        &lt;th&gt;Total Responses&lt;/th&gt;&#10;                        &lt;th&gt;Accuracy&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;accuracyStatsTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;div class=&quot;chart-container&quot; id=&quot;resultChart&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;button class=&quot;print-button&quot; onclick=&quot;printResults()&quot;&gt;Print Results&lt;/button&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot; style=&quot;margin-top: 20px;&quot;&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;button class=&quot;back-button&quot; onclick=&quot;backToExperiment()&quot;&gt;Back to Experiment&lt;/button&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div class=&quot;diagnostic-overlay&quot; id=&quot;diagnosticOverlay&quot;&gt;&#10;            &lt;div class=&quot;diagnostic-content&quot;&gt;&#10;                &lt;span class=&quot;diagnostic-close&quot; onclick=&quot;closeDiagnostics()&quot;&gt;&amp;times;&lt;/span&gt;&#10;                &lt;h2 class=&quot;diagnostic-heading&quot;&gt;Experiment Diagnostics&lt;/h2&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Test Status&lt;/h3&gt;&#10;                    &lt;table class=&quot;statistics-table&quot;&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;th&gt;Direction&lt;/th&gt;&#10;                            &lt;th&gt;Trials&lt;/th&gt;&#10;                            &lt;th&gt;Reversals&lt;/th&gt;&#10;                            &lt;th&gt;Status&lt;/th&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td&gt;Higher Direction&lt;/td&gt;&#10;                            &lt;td id=&quot;higherTrials&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;higherReversals&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;higherStatus&quot;&gt;Not started&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td&gt;Lower Direction&lt;/td&gt;&#10;                            &lt;td id=&quot;lowerTrials&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;lowerReversals&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;lowerStatus&quot;&gt;Not started&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                    &lt;/table&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Audio Files Check&lt;/h3&gt;&#10;                    &lt;p&gt;Verifying necessary audio files:&lt;/p&gt;&#10;                    &lt;div id=&quot;audioFileStatus&quot; class=&quot;diagnostic-file-status&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Reversal History&lt;/h3&gt;&#10;                    &lt;div id=&quot;reversalHistory&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Recommendations&lt;/h3&gt;&#10;                    &lt;div id=&quot;diagnosticRecommendations&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-actions&quot;&gt;&#10;                    &lt;button class=&quot;diagnostic-action-button retry-button&quot; onclick=&quot;retryIncompleteDirection()&quot;&gt;Retry Incomplete Direction&lt;/button&gt;&#10;                    &lt;button class=&quot;diagnostic-action-button continue-button&quot; onclick=&quot;closeDiagnostics()&quot;&gt;Close&lt;/button&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;audio id=&quot;low_level_standard&quot; src=&quot;Media/low_level_standard.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;    &lt;audio id=&quot;low_level_1_h&quot; src=&quot;Media/low_level_1_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_2_h&quot; src=&quot;Media/low_level_2_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_3_h&quot; src=&quot;Media/low_level_3_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_4_h&quot; src=&quot;Media/low_level_4_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_5_h&quot; src=&quot;Media/low_level_5_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_6_h&quot; src=&quot;Media/low_level_6_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_7_h&quot; src=&quot;Media/low_level_7_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_8_h&quot; src=&quot;Media/low_level_8_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_9_h&quot; src=&quot;Media/low_level_9_h.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;    &lt;audio id=&quot;low_level_1_l&quot; src=&quot;Media/low_level_1_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_2_l&quot; src=&quot;Media/low_level_2_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_3_l&quot; src=&quot;Media/low_level_3_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_4_l&quot; src=&quot;Media/low_level_4_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_5_l&quot; src=&quot;Media/low_level_5_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_6_l&quot; src=&quot;Media/low_level_6_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_7_l&quot; src=&quot;Media/low_level_7_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_8_l&quot; src=&quot;Media/low_level_8_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_level_9_l&quot; src=&quot;Media/low_level_9_l.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;&lt;script&gt;&#10;function getLocalTimestamp() {&#10;    const now = new Date();&#10;    const year = now.getFullYear();&#10;    const month = String(now.getMonth() + 1).padStart(2, '0');&#10;    const day = String(now.getDate()).padStart(2, '0');&#10;    const hours = String(now.getHours()).padStart(2, '0');&#10;    const minutes = String(now.getMinutes()).padStart(2, '0');&#10;    const seconds = String(now.getSeconds()).padStart(2, '0');&#10;    const milliseconds = String(now.getMilliseconds()).padStart(3, '0');&#10;    &#10;    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;&#10;}&#10;&#10;// Adaptive threshold experiment constants&#10;const MAXREVERSALS = 10;&#10;const MAXITERATIONS = 50;&#10;const LOWERLIMIT = 1;&#10;const DECREASING = -1;&#10;const INCREASING = 1;&#10;const MINIMUMREVERSALS = 6;&#10;const THRESHOLD_REVERSAL_COUNT = 6;&#10;const FORCEBALANCETHRESHOLD = 5;&#10;&#10;// Experiment state variables&#10;var CorrectAnswer;&#10;var CorrectResponses = [0, 0];&#10;var Direction = [DECREASING, DECREASING];&#10;var Reversals = [[], []];&#10;var NumberOfReversals = [0, 0];&#10;var currentLevel = [5, 5];&#10;var numberOfIterations = 0;&#10;var sentAverage = [0.0, 0.0];&#10;var sentStdev = [0.0, 0.0];&#10;var currentStimDirection;&#10;var isTestComplete = [false, false];&#10;var audioUnlocked = false;&#10;var trialsPerDirection = [0, 0];&#10;var forceDirection = null;&#10;var directionHistory = [];&#10;var allFilesPresent = true;&#10;var trialRecords = [];&#10;var stimulusEndTime = 0;&#10;&#10;// ABX新增变量&#10;var standardIsFirst;&#10;var comparisonSound;&#10;var standardSound;&#10;var xSound;&#10;&#10;// 新增：重播标志&#10;var isReplayTrial = false;&#10;&#10;function printResults() {&#10;    window.print();&#10;}&#10;&#10;function logDebug(message) {&#10;    console.log(message);&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var now = new Date();&#10;    var timeStr = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + '.' + now.getMilliseconds();&#10;    debugArea.innerHTML += '&lt;p&gt;[' + timeStr + '] ' + message + '&lt;/p&gt;';&#10;    debugArea.scrollTop = debugArea.scrollHeight;&#10;}&#10;&#10;function toggleDebug() {&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var checkbox = document.getElementById('showDebug');&#10;    debugArea.style.display = checkbox.checked ? 'block' : 'none';&#10;}&#10;&#10;function showDiagnostics() {&#10;    updateDiagnostics();&#10;    document.getElementById('diagnosticOverlay').style.display = 'flex';&#10;}&#10;&#10;function closeDiagnostics() {&#10;    document.getElementById('diagnosticOverlay').style.display = 'none';&#10;}&#10;&#10;function updateDiagnostics() {&#10;    document.getElementById('higherTrials').innerText = trialsPerDirection[0];&#10;    document.getElementById('lowerTrials').innerText = trialsPerDirection[1];&#10;    document.getElementById('higherReversals').innerText = NumberOfReversals[0];&#10;    document.getElementById('lowerReversals').innerText = NumberOfReversals[1];&#10;    &#10;    let higherStatus = getDirectionStatus(0);&#10;    let lowerStatus = getDirectionStatus(1);&#10;    &#10;    document.getElementById('higherStatus').innerText = higherStatus.text;&#10;    document.getElementById('higherStatus').className = `direction-stats-${higherStatus.class}`;&#10;    document.getElementById('lowerStatus').innerText = lowerStatus.text;&#10;    document.getElementById('lowerStatus').className = `direction-stats-${lowerStatus.class}`;&#10;    &#10;    checkAudioFiles();&#10;    &#10;    let reversalHistoryHtml = '&lt;h4&gt;Higher Direction&lt;/h4&gt;';&#10;    if (Reversals[0].length === 0) {&#10;        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';&#10;    } else {&#10;        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals[0].join(', ') + '&lt;/p&gt;';&#10;    }&#10;    &#10;    reversalHistoryHtml += '&lt;h4&gt;Lower Direction&lt;/h4&gt;';&#10;    if (Reversals[1].length === 0) {&#10;        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';&#10;    } else {&#10;        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals[1].join(', ') + '&lt;/p&gt;';&#10;    }&#10;    &#10;    document.getElementById('reversalHistory').innerHTML = reversalHistoryHtml;&#10;    &#10;    generateDiagnosticRecommendations();&#10;}&#10;&#10;function getDirectionStatus(dirIndex) {&#10;    if (isTestComplete[dirIndex]) {&#10;        return { text: &quot;Complete&quot;, class: &quot;good&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals[dirIndex] &lt; 1) {&#10;        return { text: &quot;Not enough data&quot;, class: &quot;bad&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals[dirIndex] &lt; MINIMUMREVERSALS) {&#10;        return { text: &quot;Incomplete (&quot; + NumberOfReversals[dirIndex] + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals)&quot;, class: &quot;warning&quot; };&#10;    }&#10;    &#10;    return { text: &quot;In progress&quot;, class: &quot;good&quot; };&#10;}&#10;&#10;function checkAudioFiles() {&#10;    const requiredFiles = [&#10;        &quot;low_level_standard&quot;,&#10;        &quot;low_level_1_h&quot;, &quot;low_level_2_h&quot;, &quot;low_level_3_h&quot;, &quot;low_level_4_h&quot;, &quot;low_level_5_h&quot;, &#10;        &quot;low_level_6_h&quot;, &quot;low_level_7_h&quot;, &quot;low_level_8_h&quot;, &quot;low_level_9_h&quot;,&#10;        &quot;low_level_1_l&quot;, &quot;low_level_2_l&quot;, &quot;low_level_3_l&quot;, &quot;low_level_4_l&quot;, &quot;low_level_5_l&quot;, &#10;        &quot;low_level_6_l&quot;, &quot;low_level_7_l&quot;, &quot;low_level_8_l&quot;, &quot;low_level_9_l&quot;&#10;    ];&#10;    &#10;    let statusHtml = '';&#10;    allFilesPresent = true;&#10;    &#10;    requiredFiles.forEach(function(fileId) {&#10;        const audioElement = document.getElementById(fileId);&#10;        const fileFound = audioElement !== null;&#10;        &#10;        if (!fileFound) {&#10;            allFilesPresent = false;&#10;        }&#10;        &#10;        statusHtml += `&lt;div class=&quot;file-status-item ${fileFound ? 'file-found' : 'file-missing'}&quot;&gt;${fileId}: ${fileFound ? 'Found' : 'Missing'}&lt;/div&gt;`;&#10;    });&#10;    &#10;    document.getElementById('audioFileStatus').innerHTML = statusHtml;&#10;}&#10;&#10;function generateDiagnosticRecommendations() {&#10;    let recommendations = '';&#10;    let hasIssues = false;&#10;    &#10;    if (!allFilesPresent) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Critical Issue:&lt;/strong&gt; Some required audio files are missing. Please ensure all files are properly loaded.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    const directionDifference = Math.abs(trialsPerDirection[0] - trialsPerDirection[1]);&#10;    if (directionDifference &gt; 10 &amp;&amp; !isTestComplete[0] &amp;&amp; !isTestComplete[1]) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Warning:&lt;/strong&gt; Trial count is imbalanced between higher and lower directions. Consider restarting experiment.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    for (let i = 0; i &lt; 2; i++) {&#10;        if (trialsPerDirection[i] &gt;= MAXITERATIONS/2 &amp;&amp; NumberOfReversals[i] &lt; MINIMUMREVERSALS) {&#10;            recommendations += '&lt;p&gt;&lt;strong&gt;Issue:&lt;/strong&gt; ' + (i === 0 ? 'Higher' : 'Lower') + &#10;                ' direction reached maximum trials but has insufficient reversals. This might indicate audio file issues or participant response patterns.&lt;/p&gt;';&#10;            hasIssues = true;&#10;        }&#10;    }&#10;    &#10;    if (numberOfIterations &gt; 10 &amp;&amp; (trialsPerDirection[0] === 0 || trialsPerDirection[1] === 0)) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Warning:&lt;/strong&gt; One direction has not been tested at all. Algorithm may be malfunctioning.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (!hasIssues) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Good:&lt;/strong&gt; No major issues detected with the experiment setup.&lt;/p&gt;';&#10;        &#10;        if (isTestComplete[0] &amp;&amp; isTestComplete[1]) {&#10;            recommendations += '&lt;p&gt;Both test directions are complete.&lt;/p&gt;';&#10;        } else if (isTestComplete[0]) {&#10;            recommendations += '&lt;p&gt;Higher direction test is complete. Lower direction test still needs more data.&lt;/p&gt;';&#10;        } else if (isTestComplete[1]) {&#10;            recommendations += '&lt;p&gt;Lower direction test is complete. Higher direction test still needs more data.&lt;/p&gt;';&#10;        } else {&#10;            recommendations += '&lt;p&gt;Both test directions are still in progress.&lt;/p&gt;';&#10;        }&#10;    }&#10;    &#10;    document.getElementById('diagnosticRecommendations').innerHTML = recommendations;&#10;}&#10;&#10;function retryIncompleteDirection() {&#10;    let retryDirection = null;&#10;    &#10;    if (isTestComplete[0] &amp;&amp; !isTestComplete[1]) {&#10;        retryDirection = 1;&#10;    } else if (!isTestComplete[0] &amp;&amp; isTestComplete[1]) {&#10;        retryDirection = 0;&#10;    } else if (!isTestComplete[0] &amp;&amp; !isTestComplete[1]) {&#10;        retryDirection = (NumberOfReversals[0] &lt; NumberOfReversals[1]) ? 0 : 1;&#10;    } else {&#10;        alert(&quot;Both directions are already complete.&quot;);&#10;        return;&#10;    }&#10;    &#10;    resetDirection(retryDirection);&#10;    forceDirection = retryDirection;&#10;    closeDiagnostics();&#10;    &#10;    if (document.getElementById('start').disabled) {&#10;        document.getElementById('text1').value = &quot;Retrying &quot; + (retryDirection === 0 ? &quot;higher&quot; : &quot;lower&quot;) + &quot; direction...&quot;;&#10;        beginIteration();&#10;    } else {&#10;        start_onclick();&#10;    }&#10;}&#10;&#10;function resetDirection(dirIndex) {&#10;    NumberOfReversals[dirIndex] = 0;&#10;    CorrectResponses[dirIndex] = 0;&#10;    Direction[dirIndex] = DECREASING;&#10;    currentLevel[dirIndex] = 5;&#10;    isTestComplete[dirIndex] = false;&#10;    Reversals[dirIndex] = [];&#10;    trialsPerDirection[dirIndex] = 0;&#10;    &#10;    trialRecords = trialRecords.filter(record =&gt; &#10;        record.direction !== (dirIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;)&#10;    );&#10;    &#10;    logDebug((dirIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction reset&quot;);&#10;    updateProgressBar();&#10;}&#10;&#10;function testAudio() {&#10;    logDebug(&quot;Starting to test all audio files...&quot;);&#10;    var audios = document.querySelectorAll('audio');&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    var index = 0;&#10;    function playNext() {&#10;        if (index &gt;= audios.length) {&#10;            logDebug(&quot;All audio testing complete!&quot;);&#10;            return;&#10;        }&#10;        &#10;        var audio = audios[index];&#10;        logDebug(&quot;Testing audio #&quot; + (index + 1) + &quot;: &quot; + audio.id);&#10;        &#10;        audio.currentTime = 0;&#10;        &#10;        var playPromise = audio.play();&#10;        if (playPromise !== undefined) {&#10;            playPromise.then(function() {&#10;                logDebug(audio.id + &quot; played successfully&quot;);&#10;                &#10;                audio.onended = function() {&#10;                    logDebug(audio.id + &quot; playback ended&quot;);&#10;                    index++;&#10;                    setTimeout(playNext, 500);&#10;                };&#10;            }).catch(function(error) {&#10;                logDebug(&quot;Failed to play &quot; + audio.id + &quot;: &quot; + error);&#10;                index++;&#10;                setTimeout(playNext, 500);&#10;            });&#10;        }&#10;    }&#10;    &#10;    playNext();&#10;}&#10;&#10;function unlockAudioContext() {&#10;    logDebug(&quot;Attempting to unlock audio context...&quot;);&#10;    &#10;    var silentAudio = new Audio();&#10;    silentAudio.src = &quot;data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA&quot;;&#10;    &#10;    var promise = silentAudio.play();&#10;    if (promise !== undefined) {&#10;        promise.then(function() {&#10;            logDebug(&quot;Audio context unlocked successfully&quot;);&#10;            silentAudio.remove();&#10;            audioUnlocked = true;&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to unlock audio context: &quot; + error);&#10;        });&#10;    }&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    for (var i = 0; i &lt; allAudios.length; i++) {&#10;        var audio = allAudios[i];&#10;        audio.load();&#10;    }&#10;    &#10;    logDebug(&quot;Preloaded &quot; + allAudios.length + &quot; audio files&quot;);&#10;}&#10;&#10;function resetPage() {&#10;    numberOfIterations++;&#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('firstBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('secondBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    if (isTestComplete[0] &amp;&amp; isTestComplete[1]) {&#10;        document.getElementById('start').disabled = false;&#10;        document.getElementById('viewResult').disabled = false;&#10;        document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;        updateProgressBar(100);&#10;        return;&#10;    }&#10;    &#10;    if ((trialsPerDirection[currentStimDirection] &gt;= MAXITERATIONS/2) || &#10;        (NumberOfReversals[currentStimDirection] &gt;= MAXREVERSALS)) {&#10;        &#10;        if (NumberOfReversals[currentStimDirection] &gt;= MINIMUMREVERSALS) {&#10;            calculateResults(currentStimDirection);&#10;            isTestComplete[currentStimDirection] = true;&#10;        } else {&#10;            logDebug(&#10;                (currentStimDirection === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &#10;                &quot; direction reached max iterations but has only &quot; + &#10;                NumberOfReversals[currentStimDirection] + &quot;/&quot; + MINIMUMREVERSALS + &#10;                &quot; reversals. Showing diagnostics.&quot;&#10;            );&#10;            &#10;            document.getElementById('text1').value = &#10;                (currentStimDirection === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &#10;                &quot; direction has insufficient data. Check diagnostics.&quot;;&#10;            &#10;            setTimeout(function() {&#10;                showDiagnostics();&#10;            }, 500);&#10;            return;&#10;        }&#10;        &#10;        updateProgressBar();&#10;        &#10;        if (!isTestComplete[0] || !isTestComplete[1]) {&#10;            document.getElementById('text1').value = &quot;實驗繼續中...&quot;;&#10;            setTimeout(function() {&#10;                beginIteration();&#10;            }, 2000);&#10;        } else {&#10;            document.getElementById('start').disabled = false;&#10;            document.getElementById('viewResult').disabled = false;&#10;            document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;            updateProgressBar(100);&#10;        }&#10;    } else {&#10;        updateProgressBar();&#10;        beginIteration();&#10;    }&#10;}&#10;&#10;function updateProgressBar(forcePercent) {&#10;    if (typeof forcePercent === 'number') {&#10;        document.getElementById('progressBar').style.width = forcePercent + '%';&#10;        document.getElementById('progressLabel').textContent = 'Progress: ' + forcePercent + '%';&#10;        return;&#10;    }&#10;    &#10;    const higherDirMax = Math.max(MAXREVERSALS, MAXITERATIONS/2);&#10;    const higherDirValue = isTestComplete[0] ? higherDirMax : Math.max(NumberOfReversals[0], trialsPerDirection[0]);&#10;    const higherDirPercent = Math.min(50 * (higherDirValue / higherDirMax), 50);&#10;    &#10;    const lowerDirMax = Math.max(MAXREVERSALS, MAXITERATIONS/2);&#10;    const lowerDirValue = isTestComplete[1] ? lowerDirMax : Math.max(NumberOfReversals[1], trialsPerDirection[1]);&#10;    const lowerDirPercent = Math.min(50 * (lowerDirValue / lowerDirMax), 50);&#10;    &#10;    const totalPercent = higherDirPercent + lowerDirPercent;&#10;    &#10;    document.getElementById('progressBar').style.width = totalPercent + '%';&#10;    document.getElementById('progressLabel').textContent = 'Progress: ' + Math.round(totalPercent) + '%';&#10;}&#10;&#10;function calculateResults(directionIndex) {&#10;    let sum = 0.0, stddevsum = 0.0, average = 0.0, stdev = 0.0, counter = 0;&#10;    &#10;    const semitoneMap = {&#10;        1: 2.0,&#10;        2: 1.0,&#10;        3: 1/2,&#10;        4: 1/6,&#10;        5: 1/8,&#10;        6: 1/12,&#10;        7: 1/15,&#10;        8: 1/20,&#10;        9: 1/50&#10;    };&#10;    &#10;    for (let i = 0; i &lt; Reversals[directionIndex].length; i++) {&#10;        if (Reversals[directionIndex][i] &gt; 0) counter++;&#10;    }&#10;    &#10;    if (counter &lt; MINIMUMREVERSALS) {&#10;        logDebug((directionIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction test has insufficient data&quot;);&#10;        alert((directionIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction test has insufficient data. Please complete the test again.&quot;);&#10;        return;&#10;    }&#10;    &#10;    const startIndex = Math.max(0, NumberOfReversals[directionIndex] - THRESHOLD_REVERSAL_COUNT);&#10;    counter = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals[directionIndex].length; i++) {&#10;        const level = Reversals[directionIndex][i];&#10;        if (level &gt; 0) {&#10;            const semitones = semitoneMap[level];&#10;            if (semitones !== undefined) {&#10;                sum += semitones;&#10;                counter++;&#10;            }&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 0) {&#10;        average = sum / counter;&#10;        average = parseFloat(average.toFixed(4));&#10;    }&#10;    &#10;    for (let i = startIndex; i &lt; Reversals[directionIndex].length; i++) {&#10;        const level = Reversals[directionIndex][i];&#10;        if (level &gt; 0) {&#10;            const semitones = semitoneMap[level];&#10;            if (semitones !== undefined) {&#10;                stddevsum += Math.pow(semitones - average, 2);&#10;            }&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 1) {&#10;        stdev = Math.sqrt(stddevsum / (counter - 1));&#10;        stdev = parseFloat(stdev.toFixed(4));&#10;    }&#10;    &#10;    sentAverage[directionIndex] = average;&#10;    sentStdev[directionIndex] = stdev;&#10;    &#10;    logDebug((directionIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction test complete! Threshold: &quot; + average.toFixed(4) + &quot; semitones&quot;);&#10;    document.getElementById('text1').value = &#10;        (directionIndex === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &quot; direction test complete! Threshold: &quot; + average.toFixed(4) + &quot; semitones&quot;;&#10;}&#10;&#10;function beginIteration() {&#10;    isReplayTrial = false;&#10;    &#10;    if (forceDirection !== null) {&#10;        currentStimDirection = forceDirection;&#10;        &#10;        if (trialsPerDirection[forceDirection] % 5 === 0) {&#10;            logDebug(&quot;Releasing forced direction after 5 trials&quot;);&#10;            forceDirection = null;&#10;        }&#10;    } &#10;    else if (isTestComplete[0]) {&#10;        currentStimDirection = 1;&#10;    } &#10;    else if (isTestComplete[1]) {&#10;        currentStimDirection = 0;&#10;    }&#10;    else if (Math.abs(trialsPerDirection[0] - trialsPerDirection[1]) &gt; FORCEBALANCETHRESHOLD) {&#10;        currentStimDirection = (trialsPerDirection[0] &gt; trialsPerDirection[1]) ? 1 : 0;&#10;        logDebug(&quot;Forcing balance: selecting &quot; + (currentStimDirection === 0 ? &quot;higher&quot; : &quot;lower&quot;) + &quot; direction&quot;);&#10;    }&#10;    else {&#10;        currentStimDirection = Math.random() &lt; 0.5 ? 0 : 1;&#10;    }&#10;    &#10;    directionHistory.push(currentStimDirection);&#10;    &#10;    standardIsFirst = Math.random() &lt; 0.5;&#10;    var xIsStandard = Math.random() &lt; 0.5;&#10;    &#10;    if (xIsStandard) {&#10;        CorrectAnswer = standardIsFirst ? 1 : 2;&#10;    } else {&#10;        CorrectAnswer = standardIsFirst ? 2 : 1;&#10;    }&#10;    &#10;    trialsPerDirection[currentStimDirection]++;&#10;    &#10;    logDebug(&quot;Starting new iteration #&quot; + numberOfIterations + &#10;             &quot;, Direction: &quot; + (currentStimDirection === 0 ? &quot;Higher&quot; : &quot;Lower&quot;) + &#10;             &quot;, Standard is &quot; + (standardIsFirst ? &quot;first&quot; : &quot;second&quot;) +&#10;             &quot;, X is &quot; + (xIsStandard ? &quot;standard&quot; : &quot;comparison&quot;) +&#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Difficulty level: &quot; + currentLevel[currentStimDirection]);&#10;    &#10;    setTimeout(function() {&#10;        playABXSequence(xIsStandard);&#10;    }, 1000);&#10;}&#10;&#10;function clearButtonAnimations() {&#10;    document.getElementById('firstBtn').classList.remove('button-playing');&#10;    document.getElementById('secondBtn').classList.remove('button-playing');&#10;}&#10;&#10;function playABXSequence(xIsStandard) {&#10;    logDebug(&quot;Playing ABX sequence&quot;);&#10;    &#10;    clearButtonAnimations();&#10;&#10;    standardSound = document.getElementById('low_level_standard');&#10;&#10;    const level = currentLevel[currentStimDirection];&#10;    if (currentStimDirection === 0) {&#10;        comparisonSound = document.getElementById(&quot;low_level_&quot; + level + &quot;_h&quot;);&#10;    } else {&#10;        comparisonSound = document.getElementById(&quot;low_level_&quot; + level + &quot;_l&quot;);&#10;    }&#10;    &#10;    xSound = xIsStandard ? standardSound : comparisonSound;&#10;    &#10;    if (!standardSound || !comparisonSound) {&#10;        logDebug(&quot;Error: Cannot find audio elements!&quot;);&#10;        document.getElementById('text1').value = &quot;出錯：找不到音頻文件&quot;;&#10;        setTimeout(function() {&#10;            showDiagnostics();&#10;        }, 1000);&#10;        return;&#10;    }&#10;    &#10;    var firstSound = standardIsFirst ? standardSound : comparisonSound;&#10;    document.getElementById('text1').value = &quot;播放第一個音&quot;;&#10;    &#10;    document.getElementById('firstBtn').classList.add('button-playing');&#10;    &#10;    firstSound.currentTime = 0;&#10;    var playPromise1 = firstSound.play();&#10;    &#10;    if (playPromise1 !== undefined) {&#10;        playPromise1.then(function() {&#10;            logDebug(&quot;First sound (A) played successfully&quot;);&#10;            &#10;            firstSound.onended = function() {&#10;                logDebug(&quot;First sound ended&quot;);&#10;                &#10;                document.getElementById('firstBtn').classList.remove('button-playing');&#10;                &#10;                setTimeout(function() {&#10;                    var secondSound = standardIsFirst ? comparisonSound : standardSound;&#10;                    document.getElementById('text1').value = &quot;播放第二個音&quot;;&#10;                    &#10;                    document.getElementById('secondBtn').classList.add('button-playing');&#10;                    &#10;                    secondSound.currentTime = 0;&#10;                    var playPromise2 = secondSound.play();&#10;                    &#10;                    if (playPromise2 !== undefined) {&#10;                        playPromise2.then(function() {&#10;                            logDebug(&quot;Second sound (B) played successfully&quot;);&#10;                            &#10;                            secondSound.onended = function() {&#10;                                logDebug(&quot;Second sound ended&quot;);&#10;                                &#10;                                document.getElementById('secondBtn').classList.remove('button-playing');&#10;                                &#10;                                setTimeout(function() {&#10;                                    document.getElementById('text1').value = &quot;播放第三個音&quot;;&#10;                                    &#10;                                    xSound.currentTime = 0;&#10;                                    var playPromise3 = xSound.play();&#10;                                    &#10;                                    if (playPromise3 !== undefined) {&#10;                                        playPromise3.then(function() {&#10;                                            logDebug(&quot;Third sound (X) played successfully&quot;);&#10;                                            &#10;                                            xSound.onended = function() {&#10;                                                logDebug(&quot;Third sound ended, enabling response buttons&quot;);&#10;                                                &#10;                                                stimulusEndTime = performance.now();&#10;                                                &#10;                                                document.getElementById('text1').value = &quot;請作出選擇&quot;;&#10;                                                document.getElementById('promptText').style.visibility = 'visible';&#10;                                                &#10;                                                document.getElementById('firstBtn').disabled = false;&#10;                                                document.getElementById('secondBtn').disabled = false;&#10;                                                document.getElementById('firstBtn').style.background = &quot;#66CCFF&quot;;&#10;                                                document.getElementById('secondBtn').style.background = &quot;#66CCFF&quot;;&#10;                                            };&#10;                                        }).catch(function(error) {&#10;                                            logDebug(&quot;Failed to play third sound: &quot; + error);&#10;                                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                                            clearButtonAnimations();&#10;                                            setTimeout(showDiagnostics, 1000);&#10;                                        });&#10;                                    }&#10;                                }, 1000);&#10;                            };&#10;                        }).catch(function(error) {&#10;                            logDebug(&quot;Failed to play second sound: &quot; + error);&#10;                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                            clearButtonAnimations();&#10;                            setTimeout(showDiagnostics, 1000);&#10;                        });&#10;                    }&#10;                }, 1000);&#10;            };&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to play first sound: &quot; + error);&#10;            document.getElementById('text1').value = &quot;音頻播放錯誤，請刷新頁面&quot;;&#10;            clearButtonAnimations();&#10;            setTimeout(showDiagnostics, 1000);&#10;        });&#10;    }&#10;}&#10;&#10;function start_onclick() {&#10;    logDebug(&quot;Starting experiment&quot;);&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    checkAudioFiles();&#10;    if (!allFilesPresent) {&#10;        logDebug(&quot;Cannot start experiment: Some audio files are missing&quot;);&#10;        document.getElementById('text1').value = &quot;音頻缺失&quot;;&#10;        showDiagnostics();&#10;        return;&#10;    }&#10;    &#10;    window_onload();&#10;    document.getElementById('text1').value = &quot;開始實驗...&quot;;&#10;    updateProgressBar(0);&#10;    &#10;    setTimeout(function() {&#10;        beginIteration();&#10;        document.getElementById('start').disabled = true;&#10;        document.getElementById('viewResult').disabled = true;&#10;        document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;        document.getElementById('promptText').style.visibility = 'hidden';&#10;    }, 1000);&#10;}&#10;&#10;function gotReversal(dirIndex) {&#10;    NumberOfReversals[dirIndex]++;&#10;    Reversals[dirIndex][NumberOfReversals[dirIndex] - 1] = currentLevel[dirIndex];&#10;    Direction[dirIndex] = -Direction[dirIndex];&#10;    logDebug(&quot;Recorded reversal #&quot; + NumberOfReversals[dirIndex] + &quot; at difficulty &quot; + currentLevel[dirIndex]);&#10;}&#10;&#10;function mapLevelToSemitone(level) {&#10;    const semitoneMap = {&#10;        1: 2.0,&#10;        2: 1.0,&#10;        3: 1/2,&#10;        4: 1/6,&#10;        5: 1/8,&#10;        6: 1/12,&#10;        7: 1/15,&#10;        8: 1/20,&#10;        9: 1/50&#10;    };&#10;    return semitoneMap[level] || 0;&#10;}&#10;&#10;function processAnswer(Response) {&#10;    const reactionEndTime = performance.now();&#10;    const reactionTime = reactionEndTime - stimulusEndTime;&#10;    &#10;    logDebug(&quot;User answered: &quot; + (Response === 1 ? &quot;First&quot; : &quot;Second&quot;) + &#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Is replay: &quot; + isReplayTrial);&#10;    &#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    const isCorrect = (Response === CorrectAnswer);&#10;    &#10;    if (!isReplayTrial) {&#10;        const trialInfo = {&#10;            trialNumber: numberOfIterations,&#10;            timestamp: getLocalTimestamp(),&#10;            direction: currentStimDirection === 0 ? &quot;Higher&quot; : &quot;Lower&quot;,&#10;            difficultyLevel: currentLevel[currentStimDirection],&#10;            semitoneValue: mapLevelToSemitone(currentLevel[currentStimDirection]),&#10;            userResponse: Response === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            correctResponse: CorrectAnswer === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            isCorrect: isCorrect,&#10;            reactionTime: reactionTime.toFixed(0),&#10;            isReversal: false,&#10;            stepDirection: Direction[currentStimDirection] === DECREASING ? &quot;Increasing Difficulty&quot; : &quot;Decreasing Difficulty&quot;,&#10;            standardPosition: standardIsFirst ? &quot;First&quot; : &quot;Second&quot;&#10;        };&#10;        &#10;        trialRecords.push(trialInfo);&#10;    }&#10;    &#10;    if (isCorrect) {&#10;        logDebug(&quot;Correct answer&quot;);&#10;        document.getElementById('smile').src = &quot;Media/smiley.png&quot;;&#10;        document.getElementById('text1').value = &quot;正確！&quot;;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses[currentStimDirection]++;&#10;            &#10;            if (CorrectResponses[currentStimDirection] == 2) {&#10;                logDebug(&quot;Two correct answers in a row&quot;);&#10;                CorrectResponses[currentStimDirection] = 0;&#10;                &#10;                if (Direction[currentStimDirection] == INCREASING) {&#10;                    gotReversal(currentStimDirection);&#10;                    if (trialRecords.length &gt; 0) {&#10;                        trialRecords[trialRecords.length-1].isReversal = true;&#10;                    }&#10;                }&#10;                &#10;                changeLevel(DECREASING, currentStimDirection);&#10;            }&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            resetPage();&#10;        }, 1500);&#10;    } else {&#10;        logDebug(&quot;Incorrect answer - will replay stimulus&quot;);&#10;        document.getElementById('smile').src = &quot;Media/nosmiley.png&quot;;&#10;        &#10;        var correctAnswerText = CorrectAnswer === 1 ? &quot;第一個音&quot; : &quot;第二個音&quot;;&#10;        document.getElementById('text1').value = &quot;錯誤！正確答案是：&quot; + correctAnswerText;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses[currentStimDirection] = 0;&#10;            &#10;            if (Direction[currentStimDirection] == DECREASING) {&#10;                gotReversal(currentStimDirection);&#10;                if (trialRecords.length &gt; 0) {&#10;                    trialRecords[trialRecords.length-1].isReversal = true;&#10;                }&#10;            }&#10;            &#10;            changeLevel(INCREASING, currentStimDirection);&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            document.getElementById('text1').value = &quot;重播刺激音...&quot;;&#10;            &#10;            setTimeout(function() {&#10;                isReplayTrial = true;&#10;                &#10;                var xIsStandard = (standardIsFirst &amp;&amp; CorrectAnswer === 1) || &#10;                                  (!standardIsFirst &amp;&amp; CorrectAnswer === 2);&#10;                playABXSequence(xIsStandard);&#10;            }, 1000);&#10;        }, 2000);&#10;    }&#10;}&#10;&#10;function changeLevel(whichWay, dirIndex) {&#10;    var oldLevel = currentLevel[dirIndex];&#10;    var stepSize = NumberOfReversals[dirIndex] &lt; 4 ? 2 : 1;&#10;    &#10;    if (whichWay == DECREASING) {&#10;        currentLevel[dirIndex] = Math.min(9, currentLevel[dirIndex] + stepSize);&#10;    } else {&#10;        currentLevel[dirIndex] = Math.max(LOWERLIMIT, currentLevel[dirIndex] - stepSize);&#10;    }&#10;    &#10;    logDebug(&quot;Difficulty changed from &quot; + oldLevel + &quot; to &quot; + currentLevel[dirIndex] + &#10;             (whichWay == DECREASING ? &quot; (increasing difficulty)&quot; : &quot; (decreasing difficulty)&quot;));&#10;}&#10;&#10;function getThresholdAssessment(value) {&#10;    if (value &lt;= 0.05) return &quot;Exceptional&quot;;&#10;    if (value &lt;= 0.1) return &quot;Excellent&quot;;&#10;    if (value &lt;= 0.25) return &quot;Good&quot;;&#10;    if (value &lt;= 0.5) return &quot;Average&quot;;&#10;    if (value &lt;= 1.0) return &quot;Below Average&quot;;&#10;    return &quot;Needs Improvement&quot;;&#10;}&#10;&#10;function calculateReactionTimeStats() {&#10;    let higherRTs = trialRecords.filter(t =&gt; t.direction === &quot;Higher&quot;).map(t =&gt; parseFloat(t.reactionTime));&#10;    let lowerRTs = trialRecords.filter(t =&gt; t.direction === &quot;Lower&quot;).map(t =&gt; parseFloat(t.reactionTime));&#10;    let allRTs = higherRTs.concat(lowerRTs);&#10;    &#10;    return {&#10;        higher: {&#10;            mean: higherRTs.length ? (higherRTs.reduce((a, b) =&gt; a + b, 0) / higherRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;            median: higherRTs.length ? calculateMedian(higherRTs).toFixed(0) : &quot;N/A&quot;,&#10;            sd: higherRTs.length &gt; 1 ? calculateSD(higherRTs).toFixed(0) : &quot;N/A&quot;&#10;        },&#10;        lower: {&#10;            mean: lowerRTs.length ? (lowerRTs.reduce((a, b) =&gt; a + b, 0) / lowerRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;            median: lowerRTs.length ? calculateMedian(lowerRTs).toFixed(0) : &quot;N/A&quot;,&#10;            sd: lowerRTs.length &gt; 1 ? calculateSD(lowerRTs).toFixed(0) : &quot;N/A&quot;&#10;        },&#10;        overall: {&#10;            mean: allRTs.length ? (allRTs.reduce((a, b) =&gt; a + b, 0) / allRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;            median: allRTs.length ? calculateMedian(allRTs).toFixed(0) : &quot;N/A&quot;,&#10;            sd: allRTs.length &gt; 1 ? calculateSD(allRTs).toFixed(0) : &quot;N/A&quot;&#10;        }&#10;    };&#10;}&#10;&#10;function calculateAccuracyStats() {&#10;    let higherTrials = trialRecords.filter(t =&gt; t.direction === &quot;Higher&quot;);&#10;    let lowerTrials = trialRecords.filter(t =&gt; t.direction === &quot;Lower&quot;);&#10;    let allTrials = trialRecords;&#10;    &#10;    return {&#10;        higher: {&#10;            correct: higherTrials.filter(t =&gt; t.isCorrect).length,&#10;            total: higherTrials.length,&#10;            percentage: higherTrials.length ? &#10;                (higherTrials.filter(t =&gt; t.isCorrect).length / higherTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;        },&#10;        lower: {&#10;            correct: lowerTrials.filter(t =&gt; t.isCorrect).length,&#10;            total: lowerTrials.length,&#10;            percentage: lowerTrials.length ? &#10;                (lowerTrials.filter(t =&gt; t.isCorrect).length / lowerTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;        },&#10;        overall: {&#10;            correct: allTrials.filter(t =&gt; t.isCorrect).length,&#10;            total: allTrials.length,&#10;            percentage: allTrials.length ? &#10;                (allTrials.filter(t =&gt; t.isCorrect).length / allTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;        }&#10;    };&#10;}&#10;&#10;function calculateMedian(values) {&#10;    if (!values.length) return 0;&#10;    &#10;    const sortedValues = values.slice().sort((a, b) =&gt; a - b);&#10;    const mid = Math.floor(sortedValues.length / 2);&#10;    &#10;    return sortedValues.length % 2 === 0 ? &#10;        (sortedValues[mid - 1] + sortedValues[mid]) / 2 : &#10;        sortedValues[mid];&#10;}&#10;&#10;function calculateSD(values) {&#10;    if (values.length &lt;= 1) return 0;&#10;    &#10;    const mean = values.reduce((a, b) =&gt; a + b, 0) / values.length;&#10;    const variance = values.map(x =&gt; Math.pow(x - mean, 2)).reduce((a, b) =&gt; a + b, 0) / (values.length - 1);&#10;    &#10;    return Math.sqrt(variance);&#10;}&#10;&#10;function displayResults() {&#10;    logDebug(&quot;Displaying results&quot;);&#10;    &#10;    let hasHigherData = NumberOfReversals[0] &gt;= MINIMUMREVERSALS;&#10;    let hasLowerData = NumberOfReversals[1] &gt;= MINIMUMREVERSALS;&#10;    &#10;    if (!hasHigherData || !hasLowerData) {&#10;        let message = &quot;Warning: &quot;;&#10;        if (!hasHigherData) message += &quot;Higher direction has insufficient data. &quot;;&#10;        if (!hasLowerData) message += &quot;Lower direction has insufficient data. &quot;;&#10;        message += &quot;Results may not be reliable.&quot;;&#10;        &#10;        if (confirm(message + &quot;\n\nWould you like to retry the experiment?&quot;)) {&#10;            window_onload();&#10;            return;&#10;        }&#10;    }&#10;    &#10;    document.getElementById('experimentContainer').style.display = 'none';&#10;    document.getElementById('resultsContainer').style.display = 'block';&#10;    &#10;    var tableBody = document.getElementById('resultTableBody');&#10;    tableBody.innerHTML = '';&#10;    &#10;    var higherRow = document.createElement('tr');&#10;    higherRow.innerHTML = &#10;        '&lt;td&gt;Higher Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasHigherData ? sentAverage[0].toFixed(4) : 'Insufficient data') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasHigherData ? sentStdev[0].toFixed(4) : '-') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasHigherData ? getThresholdAssessment(sentAverage[0]) : '-') + '&lt;/td&gt;';&#10;    tableBody.appendChild(higherRow);&#10;    &#10;    var lowerRow = document.createElement('tr');&#10;    lowerRow.innerHTML = &#10;        '&lt;td&gt;Lower Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasLowerData ? sentAverage[1].toFixed(4) : 'Insufficient data') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasLowerData ? sentStdev[1].toFixed(4) : '-') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasLowerData ? getThresholdAssessment(sentAverage[1]) : '-') + '&lt;/td&gt;';&#10;    tableBody.appendChild(lowerRow);&#10;    &#10;    if (hasHigherData &amp;&amp; hasLowerData) {&#10;        var avgThreshold = (sentAverage[0] + sentAverage[1]) / 2;&#10;        var combinedVariance = (Math.pow(sentStdev[0], 2) + Math.pow(sentStdev[1], 2)) / 2;&#10;        var combinedSD = Math.sqrt(combinedVariance).toFixed(4);&#10;        &#10;        var avgRow = document.createElement('tr');&#10;        avgRow.style.fontWeight = 'bold';&#10;        avgRow.innerHTML = &#10;            '&lt;td&gt;Average&lt;/td&gt;' +&#10;            '&lt;td&gt;' + avgThreshold.toFixed(4) + '&lt;/td&gt;' +&#10;            '&lt;td&gt;' + combinedSD + '&lt;/td&gt;' +&#10;            '&lt;td&gt;' + getThresholdAssessment(avgThreshold) + '&lt;/td&gt;';&#10;        tableBody.appendChild(avgRow);&#10;    }&#10;    &#10;    var interpretation = document.getElementById('resultInterpretation');&#10;    let interpretationHtml = '&lt;p&gt;&lt;strong&gt;Threshold Interpretation (ABX Task):&lt;/strong&gt;&lt;/p&gt;';&#10;    &#10;    if (hasHigherData &amp;&amp; hasLowerData) {&#10;        const avgThreshold = (sentAverage[0] + sentAverage[1]) / 2;&#10;        interpretationHtml += '&lt;p&gt;Your average pitch discrimination threshold is ' + avgThreshold.toFixed(4) + ' semitones, indicating ' + &#10;            getThresholdAssessment(avgThreshold) + ' pitch discrimination ability.&lt;/p&gt;';&#10;    } else {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Complete results not available due to insufficient data.&lt;/p&gt;';&#10;        &#10;        if (hasHigherData) {&#10;            interpretationHtml += '&lt;p&gt;Your higher direction threshold is ' + sentAverage[0].toFixed(4) + &#10;                ' semitones, indicating ' + getThresholdAssessment(sentAverage[0]) + ' discrimination ability for higher pitches.&lt;/p&gt;';&#10;        }&#10;        &#10;        if (hasLowerData) {&#10;            interpretationHtml += '&lt;p&gt;Your lower direction threshold is ' + sentAverage[1].toFixed(4) + &#10;                ' semitones, indicating ' + getThresholdAssessment(sentAverage[1]) + ' discrimination ability for lower pitches.&lt;/p&gt;';&#10;        }&#10;    }&#10;    &#10;    interpretationHtml += '&lt;p&gt;&lt;strong&gt;Performance Metrics:&lt;/strong&gt;&lt;/p&gt;';&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    const accuracyStats = calculateAccuracyStats();&#10;    &#10;    interpretationHtml += '&lt;p&gt;Your average reaction time was ' + rtStats.overall.mean + &#10;        ' ms, with ' + accuracyStats.overall.percentage + '% overall accuracy.&lt;/p&gt;';&#10;    &#10;    interpretation.innerHTML = interpretationHtml;&#10;    &#10;    var rtTableBody = document.getElementById('rtStatsTableBody');&#10;    rtTableBody.innerHTML = '';&#10;    &#10;    var higherRtRow = document.createElement('tr');&#10;    higherRtRow.innerHTML = &#10;        '&lt;td&gt;Higher Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.higher.mean + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.higher.median + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.higher.sd + '&lt;/td&gt;';&#10;    rtTableBody.appendChild(higherRtRow);&#10;    &#10;    var lowerRtRow = document.createElement('tr');&#10;    lowerRtRow.innerHTML = &#10;        '&lt;td&gt;Lower Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.lower.mean + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.lower.median + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.lower.sd + '&lt;/td&gt;';&#10;    rtTableBody.appendChild(lowerRtRow);&#10;    &#10;    var overallRtRow = document.createElement('tr');&#10;    overallRtRow.style.fontWeight = 'bold';&#10;    overallRtRow.innerHTML = &#10;        '&lt;td&gt;Overall&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.overall.mean + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.overall.median + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rtStats.overall.sd + '&lt;/td&gt;';&#10;    rtTableBody.appendChild(overallRtRow);&#10;    &#10;    var accuracyTableBody = document.getElementById('accuracyStatsTableBody');&#10;    accuracyTableBody.innerHTML = '';&#10;    &#10;    var higherAccRow = document.createElement('tr');&#10;    higherAccRow.innerHTML = &#10;        '&lt;td&gt;Higher Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.higher.correct + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.higher.total + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.higher.percentage + '%&lt;/td&gt;';&#10;    accuracyTableBody.appendChild(higherAccRow);&#10;    &#10;    var lowerAccRow = document.createElement('tr');&#10;    lowerAccRow.innerHTML = &#10;        '&lt;td&gt;Lower Direction&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.lower.correct + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.lower.total + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.lower.percentage + '%&lt;/td&gt;';&#10;    accuracyTableBody.appendChild(lowerAccRow);&#10;    &#10;    var overallAccRow = document.createElement('tr');&#10;    overallAccRow.style.fontWeight = 'bold';&#10;    overallAccRow.innerHTML = &#10;        '&lt;td&gt;Overall&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.overall.correct + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.overall.total + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + accuracyStats.overall.percentage + '%&lt;/td&gt;';&#10;    accuracyTableBody.appendChild(overallAccRow);&#10;    &#10;    drawResultChart(hasHigherData, hasLowerData);&#10;}&#10;&#10;function drawResultChart(hasHigherData, hasLowerData) {&#10;    var chartContainer = document.getElementById('resultChart');&#10;    &#10;    var chartHTML = '&lt;div style=&quot;display: flex; flex-direction: column; height: 100%;&quot;&gt;';&#10;    chartHTML += '&lt;div style=&quot;text-align: center; margin-bottom: 10px;&quot;&gt;&lt;strong&gt;Threshold Comparison&lt;/strong&gt;&lt;/div&gt;';&#10;    &#10;    chartHTML += '&lt;div style=&quot;display: flex; justify-content: center; margin-bottom: 10px;&quot;&gt;';&#10;    chartHTML += '&lt;span style=&quot;margin-right: 20px;&quot;&gt;&lt;span style=&quot;display: inline-block; width: 15px; height: 15px; background-color: #3498db; margin-right: 5px;&quot;&gt;&lt;/span&gt;Higher Direction&lt;/span&gt;';&#10;    chartHTML += '&lt;span&gt;&lt;span style=&quot;display: inline-block; width: 15px; height: 15px; background-color: #e74c3c; margin-right: 5px;&quot;&gt;&lt;/span&gt;Lower Direction&lt;/span&gt;';&#10;    chartHTML += '&lt;/div&gt;';&#10;    &#10;    chartHTML += '&lt;div style=&quot;flex: 1; display: flex; align-items: flex-end; border-left: 1px solid #333; border-bottom: 1px solid #333; position: relative;&quot;&gt;';&#10;    &#10;    let maxValue = 0.5;&#10;    if (hasHigherData) maxValue = Math.max(maxValue, sentAverage[0]);&#10;    if (hasLowerData) maxValue = Math.max(maxValue, sentAverage[1]);&#10;    &#10;    if (hasHigherData) {&#10;        var higherHeight = (sentAverage[0] / maxValue) * 80;&#10;        chartHTML += '&lt;div style=&quot;width: 40px; height: ' + higherHeight + '%; background-color: #3498db; margin: 0 20px; position: relative;&quot;&gt;';&#10;        chartHTML += '&lt;div style=&quot;position: absolute; top: -20px; width: 100%; text-align: center;&quot;&gt;' + sentAverage[0].toFixed(4) + '&lt;/div&gt;';&#10;        chartHTML += '&lt;/div&gt;';&#10;    } else {&#10;        chartHTML += '&lt;div style=&quot;width: 40px; height: 5%; background-color: #ccc; margin: 0 20px; position: relative;&quot;&gt;';&#10;        chartHTML += '&lt;div style=&quot;position: absolute; top: -20px; width: 100%; text-align: center;&quot;&gt;N/A&lt;/div&gt;';&#10;        chartHTML += '&lt;/div&gt;';&#10;    }&#10;    &#10;    if (hasLowerData) {&#10;        var lowerHeight = (sentAverage[1] / maxValue) * 80;&#10;        chartHTML += '&lt;div style=&quot;width: 40px; height: ' + lowerHeight + '%; background-color: #e74c3c; margin: 0 20px; position: relative;&quot;&gt;';&#10;        chartHTML += '&lt;div style=&quot;position: absolute; top: -20px; width: 100%; text-align: center;&quot;&gt;' + sentAverage[1].toFixed(4) + '&lt;/div&gt;';&#10;        chartHTML += '&lt;/div&gt;';&#10;    } else {&#10;        chartHTML += '&lt;div style=&quot;width: 40px; height: 5%; background-color: #ccc; margin: 0 20px; position: relative;&quot;&gt;';&#10;        chartHTML += '&lt;div style=&quot;position: absolute; top: -20px; width: 100%; text-align: center;&quot;&gt;N/A&lt;/div&gt;';&#10;        chartHTML += '&lt;/div&gt;';&#10;    }&#10;    &#10;    chartHTML += '&lt;div style=&quot;position: absolute; bottom: -25px; left: 20px; width: 40px; text-align: center;&quot;&gt;Higher&lt;/div&gt;';&#10;    chartHTML += '&lt;div style=&quot;position: absolute; bottom: -25px; left: 80px; width: 40px; text-align: center;&quot;&gt;Lower&lt;/div&gt;';&#10;    chartHTML += '&lt;div style=&quot;position: absolute; left: -35px; top: 20%; transform: rotate(-90deg);&quot;&gt;Threshold (semitones)&lt;/div&gt;';&#10;    &#10;    chartHTML += '&lt;/div&gt;';&#10;    chartHTML += '&lt;/div&gt;';&#10;    &#10;    chartContainer.innerHTML = chartHTML;&#10;}&#10;&#10;function backToExperiment() {&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;}&#10;&#10;function view_onclick() {&#10;    logDebug(&quot;View results button clicked&quot;);&#10;    &#10;    for (let i = 0; i &lt; 2; i++) {&#10;        if (!isTestComplete[i] &amp;&amp; NumberOfReversals[i] &gt;= MINIMUMREVERSALS) {&#10;            calculateResults(i);&#10;            isTestComplete[i] = true;&#10;        }&#10;    }&#10;    &#10;    displayResults();&#10;}&#10;&#10;function exportToCSV() {&#10;    const headers = [&#10;        &quot;Trial Number&quot;, &#10;        &quot;Timestamp&quot;, &#10;        &quot;Direction&quot;, &#10;        &quot;Difficulty Level&quot;, &#10;        &quot;Semitone Value&quot;, &#10;        &quot;Standard Position&quot;,&#10;        &quot;User Response&quot;, &#10;        &quot;Correct Response&quot;, &#10;        &quot;Is Correct&quot;, &#10;        &quot;Reaction Time (ms)&quot;, &#10;        &quot;Is Reversal&quot;,&#10;        &quot;Step Direction&quot;&#10;    ];&#10;    &#10;    const csvRows = [];&#10;    csvRows.push(headers.join(&quot;,&quot;));&#10;    &#10;    trialRecords.forEach(function(trial) {&#10;        const row = [&#10;            trial.trialNumber,&#10;            trial.timestamp,&#10;            trial.direction,&#10;            trial.difficultyLevel,&#10;            trial.semitoneValue,&#10;            trial.standardPosition,&#10;            trial.userResponse,&#10;            trial.correctResponse,&#10;            trial.isCorrect ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.reactionTime,&#10;            trial.isReversal ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.stepDirection&#10;        ];&#10;        csvRows.push(row.join(&quot;,&quot;));&#10;    });&#10;    &#10;    csvRows.push(&quot;\nRESULTS SUMMARY&quot;);&#10;    csvRows.push(&quot;\nThreshold Results (semitones)&quot;);&#10;    csvRows.push(&quot;Direction,Threshold,Standard Deviation,Assessment&quot;);&#10;    &#10;    const hasHigherData = NumberOfReversals[0] &gt;= MINIMUMREVERSALS;&#10;    const hasLowerData = NumberOfReversals[1] &gt;= MINIMUMREVERSALS;&#10;    &#10;    csvRows.push(&quot;Higher,&quot; + &#10;        (hasHigherData ? sentAverage[0].toFixed(4) : &quot;Insufficient data&quot;) + &quot;,&quot; + &#10;        (hasHigherData ? sentStdev[0].toFixed(4) : &quot;N/A&quot;) + &quot;,&quot; + &#10;        (hasHigherData ? getThresholdAssessment(sentAverage[0]) : &quot;N/A&quot;));&#10;    &#10;    csvRows.push(&quot;Lower,&quot; + &#10;        (hasLowerData ? sentAverage[1].toFixed(4) : &quot;Insufficient data&quot;) + &quot;,&quot; + &#10;        (hasLowerData ? sentStdev[1].toFixed(4) : &quot;N/A&quot;) + &quot;,&quot; + &#10;        (hasLowerData ? getThresholdAssessment(sentAverage[1]) : &quot;N/A&quot;));&#10;    &#10;    if (hasHigherData &amp;&amp; hasLowerData) {&#10;        const avgThreshold = (sentAverage[0] + sentAverage[1]) / 2;&#10;        const combinedVariance = (Math.pow(sentStdev[0], 2) + Math.pow(sentStdev[1], 2)) / 2;&#10;        const combinedSD = Math.sqrt(combinedVariance).toFixed(4);&#10;        &#10;        csvRows.push(&quot;Average,&quot; + avgThreshold.toFixed(4) + &quot;,&quot; + combinedSD + &quot;,&quot; + getThresholdAssessment(avgThreshold));&#10;    }&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    csvRows.push(&quot;\nReaction Time Statistics (ms)&quot;);&#10;    csvRows.push(&quot;Direction,Mean,Median,Standard Deviation&quot;);&#10;    csvRows.push(&quot;Higher,&quot; + rtStats.higher.mean + &quot;,&quot; + rtStats.higher.median + &quot;,&quot; + rtStats.higher.sd);&#10;    csvRows.push(&quot;Lower,&quot; + rtStats.lower.mean + &quot;,&quot; + rtStats.lower.median + &quot;,&quot; + rtStats.lower.sd);&#10;    csvRows.push(&quot;Overall,&quot; + rtStats.overall.mean + &quot;,&quot; + rtStats.overall.median + &quot;,&quot; + rtStats.overall.sd);&#10;    &#10;    const accuracyStats = calculateAccuracyStats();&#10;    csvRows.push(&quot;\nAccuracy Statistics&quot;);&#10;    csvRows.push(&quot;Direction,Correct Responses,Total Responses,Percentage&quot;);&#10;    csvRows.push(&quot;Higher,&quot; + accuracyStats.higher.correct + &quot;,&quot; + accuracyStats.higher.total + &quot;,&quot; + accuracyStats.higher.percentage + &quot;%&quot;);&#10;    csvRows.push(&quot;Lower,&quot; + accuracyStats.lower.correct + &quot;,&quot; + accuracyStats.lower.total + &quot;,&quot; + accuracyStats.lower.percentage + &quot;%&quot;);&#10;    csvRows.push(&quot;Overall,&quot; + accuracyStats.overall.correct + &quot;,&quot; + accuracyStats.overall.total + &quot;,&quot; + accuracyStats.overall.percentage + &quot;%&quot;);&#10;    &#10;    csvRows.push(&quot;\nExperiment Parameters&quot;);&#10;    csvRows.push(&quot;Paradigm,ABX&quot;);&#10;    csvRows.push(&quot;Max Reversals,&quot; + MAXREVERSALS);&#10;    csvRows.push(&quot;Min Reversals for Calculation,&quot; + MINIMUMREVERSALS);&#10;    csvRows.push(&quot;Max Iterations,&quot; + MAXITERATIONS);&#10;    &#10;    const csvContent = &quot;data:text/csv;charset=utf-8,&quot; + csvRows.join(&quot;\n&quot;);&#10;    const encodedUri = encodeURI(csvContent);&#10;    const link = document.createElement(&quot;a&quot;);&#10;    const timestamp = new Date().toISOString().replace(/[:.]/g, &quot;-&quot;);&#10;    link.setAttribute(&quot;href&quot;, encodedUri);&#10;    link.setAttribute(&quot;download&quot;, &quot;pitch_discrimination_ABX_data_&quot; + timestamp + &quot;.csv&quot;);&#10;    document.body.appendChild(link);&#10;    link.click();&#10;    document.body.removeChild(link);&#10;}&#10;&#10;function window_onload() {&#10;    window.name = &quot;EXP&quot;;&#10;    NumberOfReversals = [0, 0];&#10;    numberOfIterations = 0;&#10;    CorrectResponses = [0, 0];&#10;    Direction = [DECREASING, DECREASING];&#10;    currentLevel = [5, 5];&#10;    isTestComplete = [false, false];&#10;    Reversals = [[], []];&#10;    trialsPerDirection = [0, 0];&#10;    forceDirection = null;&#10;    directionHistory = [];&#10;    trialRecords = [];&#10;    isReplayTrial = false;&#10;&#10;    document.getElementById('text1').value = &quot;準備完畢後請點擊\&quot;開始實驗\&quot;&quot;;&#10;    document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;    document.getElementById('start').disabled = false;&#10;    document.getElementById('viewResult').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;    &#10;    updateProgressBar(0);&#10;    &#10;    logDebug(&quot;Page reset complete&quot;);&#10;}&#10;&#10;window.onload = function() {&#10;    window_onload();&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    logDebug(&quot;Preloading &quot; + allAudios.length + &quot; audio files&quot;);&#10;    &#10;    allAudios.forEach(function(audio) {&#10;        audio.load();&#10;    });&#10;    &#10;    document.getElementById('text1').value = &quot;請點擊\&quot;開始實驗\&quot;&quot;;&#10;    &#10;    window.onerror = function(message, source, lineno, colno, error) {&#10;        logDebug(&quot;Global error: &quot; + message + &quot; at &quot; + source + &quot;:&quot; + lineno);&#10;        return false;&#10;    };&#10;    &#10;    document.getElementById('showDebug').checked = true;&#10;    toggleDebug();&#10;};&#10;&lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
                    <entry key="file:///E:/Projects/Pitch_Training/ABX_rising_high.html" value="&lt;!DOCTYPE html&gt;&#10;&lt;html&gt;&#10;&lt;head&gt;&#10;    &lt;title&gt;PLOYU-Peng's Lab: Pitch Sensitivity Training&lt;/title&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;style&gt;&#10;        body {&#10;            font-family: Arial, sans-serif;&#10;            margin: 20px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .container {&#10;            max-width: 800px;&#10;            margin: 0 auto;&#10;            padding: 20px;&#10;            background-color: white;&#10;            border-radius: 10px;&#10;            box-shadow: 0 0 10px rgba(0,0,0,0.1);&#10;            display: flex;&#10;            flex-direction: column;&#10;            align-items: center;&#10;        }&#10;        .header {&#10;            text-align: center;&#10;            margin-bottom: 40px;&#10;            width: 100%;&#10;        }&#10;        .training-info {&#10;            font-size: 16px;&#10;            color: #555;&#10;            margin-top: 10px;&#10;            margin-bottom: 5px;&#10;            text-align: center;&#10;        }&#10;        .instruction-text {&#10;            font-size: 14px;&#10;            color: #777;&#10;            margin-bottom: 15px;&#10;            text-align: center;&#10;            font-style: italic;&#10;        }&#10;        .button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .prompt-text {&#10;            text-align: center;&#10;            font-size: 20px;&#10;            margin-bottom: 25px;&#10;            margin-top: 30px;&#10;            font-weight: bold;&#10;        }&#10;        .response-button {&#10;            width: 160px;&#10;            height: 160px;&#10;            font-size: 26px;&#10;            margin: 0 40px;&#10;            border-radius: 15px;&#10;            border: none;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.1);&#10;            transition: all 0.3s ease;&#10;        }&#10;        .response-button:hover:enabled {&#10;            transform: translateY(-3px);&#10;            box-shadow: 0 6px 12px rgba(0,0,0,0.15);&#10;        }&#10;        .response-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .button-playing {&#10;            animation: pulse 1s ease-in-out infinite;&#10;            box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            transform: scale(1.05);&#10;        }&#10;        @keyframes pulse {&#10;            0%, 100% {&#10;                box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            }&#10;            50% {&#10;                box-shadow: 0 0 30px rgba(102, 204, 255, 1);&#10;            }&#10;        }&#10;        .control-button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            gap: 30px;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .control-button {&#10;            padding: 14px 28px;&#10;            font-size: 18px;&#10;            border-radius: 8px;&#10;            border: none;&#10;            background-color: #4CAF50;&#10;            color: white;&#10;            cursor: pointer;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .control-button:hover:enabled {&#10;            background-color: #3e8e41;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .control-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .control-button:disabled {&#10;            background-color: #cccccc;&#10;            cursor: not-allowed;&#10;            box-shadow: none;&#10;        }&#10;        .feedback {&#10;            text-align: center;&#10;            height: 100px;&#10;            margin: 30px 0;&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;        }&#10;        .status {&#10;            width: 350px;&#10;            height: 68px;&#10;            text-align: center;&#10;            font-size: 18px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            margin: 0 auto;&#10;            padding: 10px;&#10;            background-color: #f9f9f9;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.05);&#10;        }&#10;        .debug-info {&#10;            font-size: 12px;&#10;            color: #777;&#10;            margin-top: 30px;&#10;            text-align: left;&#10;            display: none;&#10;            max-height: 300px;&#10;            overflow-y: auto;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            padding: 15px;&#10;            width: 100%;&#10;        }&#10;        .results-container {&#10;            display: none;&#10;            margin-top: 30px;&#10;            padding: 20px;&#10;            background-color: #f0f8ff;&#10;            border-radius: 8px;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.1);&#10;            width: 100%;&#10;        }&#10;        .result-heading {&#10;            text-align: center;&#10;            margin-bottom: 20px;&#10;            color: #2c3e50;&#10;        }&#10;        .result-table {&#10;            width: 100%;&#10;            border-collapse: collapse;&#10;            margin-bottom: 20px;&#10;        }&#10;        .result-table th, .result-table td {&#10;            padding: 12px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .result-table th {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .result-table tr:nth-child(even) {&#10;            background-color: #f2f2f2;&#10;        }&#10;        .result-interpretation {&#10;            background-color: #e8f4f8;&#10;            padding: 15px;&#10;            border-radius: 5px;&#10;            margin-bottom: 20px;&#10;        }&#10;        .back-button {&#10;            display: block;&#10;            margin: 0 auto;&#10;            padding: 14px 28px;&#10;            background-color: #3498db;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .back-button:hover {&#10;            background-color: #2980b9;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .back-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        .chart-container {&#10;            height: 300px;&#10;            margin: 20px 0;&#10;            background-color: white;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;            padding: 10px;&#10;        }&#10;        .auxiliary-buttons {&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            margin-top: 30px;&#10;            gap: 20px;&#10;            flex-wrap: wrap;&#10;        }&#10;        .auxiliary-buttons button {&#10;            padding: 10px 15px;&#10;            border-radius: 5px;&#10;            border: 1px solid #ddd;&#10;            background-color: #f0f0f0;&#10;            cursor: pointer;&#10;            transition: all 0.2s ease;&#10;        }&#10;        .auxiliary-buttons button:hover {&#10;            background-color: #e0e0e0;&#10;        }&#10;        .diagnostic-overlay {&#10;            position: fixed;&#10;            top: 0;&#10;            left: 0;&#10;            width: 100%;&#10;            height: 100%;&#10;            background-color: rgba(0, 0, 0, 0.8);&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            z-index: 1000;&#10;            display: none;&#10;        }&#10;        .diagnostic-content {&#10;            width: 80%;&#10;            max-width: 700px;&#10;            max-height: 80%;&#10;            overflow-y: auto;&#10;            background-color: white;&#10;            padding: 20px;&#10;            border-radius: 8px;&#10;            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);&#10;        }&#10;        .diagnostic-heading {&#10;            text-align: center;&#10;            color: #e74c3c;&#10;            margin-bottom: 20px;&#10;            font-size: 24px;&#10;        }&#10;        .diagnostic-close {&#10;            float: right;&#10;            font-size: 20px;&#10;            cursor: pointer;&#10;            color: #777;&#10;        }&#10;        .diagnostic-close:hover {&#10;            color: #333;&#10;        }&#10;        .diagnostic-section {&#10;            margin-bottom: 15px;&#10;            padding: 10px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;        }&#10;        .diagnostic-actions {&#10;            text-align: center;&#10;            margin-top: 20px;&#10;        }&#10;        .diagnostic-action-button {&#10;            padding: 10px 20px;&#10;            margin: 0 10px;&#10;            border: none;&#10;            border-radius: 5px;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;        }&#10;        .retry-button {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .retry-button:hover {&#10;            background-color: #2980b9;&#10;        }&#10;        .continue-button {&#10;            background-color: #2ecc71;&#10;            color: white;&#10;        }&#10;        .continue-button:hover {&#10;            background-color: #27ae60;&#10;        }&#10;        .diagnostic-file-status {&#10;            display: flex;&#10;            flex-wrap: wrap;&#10;            gap: 10px;&#10;        }&#10;        .file-status-item {&#10;            font-size: 12px;&#10;            padding: 5px 10px;&#10;            border-radius: 3px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .file-found {&#10;            color: #27ae60;&#10;            border-left: 3px solid #27ae60;&#10;        }&#10;        .file-missing {&#10;            color: #e74c3c;&#10;            border-left: 3px solid #e74c3c;&#10;        }&#10;        .statistics-table {&#10;            width: 100%;&#10;            margin: 10px 0;&#10;            border-collapse: collapse;&#10;        }&#10;        .statistics-table th, .statistics-table td {&#10;            padding: 8px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .statistics-table th {&#10;            background-color: #f0f0f0;&#10;        }&#10;        .direction-stats-good {&#10;            color: #27ae60;&#10;        }&#10;        .direction-stats-warning {&#10;            color: #f39c12;&#10;        }&#10;        .direction-stats-bad {&#10;            color: #e74c3c;&#10;        }&#10;        @media (max-width: 600px) {&#10;            .response-button {&#10;                width: 130px;&#10;                height: 130px;&#10;                font-size: 22px;&#10;                margin: 0 20px;&#10;            }&#10;            .control-button {&#10;                padding: 12px 20px;&#10;            }&#10;        }&#10;        .print-button {&#10;            padding: 14px 28px;&#10;            margin: 20px auto;&#10;            background-color: #9b59b6;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;            display: block;&#10;        }&#10;        .print-button:hover {&#10;            background-color: #8e44ad;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .print-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        @media print {&#10;            body {&#10;                background-color: white;&#10;                margin: 0;&#10;                padding: 0;&#10;            }&#10;            .container {&#10;                max-width: 100%;&#10;                box-shadow: none;&#10;                padding: 10px;&#10;            }&#10;            .back-button, .print-button, .auxiliary-buttons {&#10;                display: none;&#10;            }&#10;            .results-container {&#10;                display: block !important;&#10;                box-shadow: none;&#10;                background-color: white;&#10;                padding: 0;&#10;            }&#10;            .chart-container {&#10;                border: 1px solid #ddd;&#10;                background-color: white;&#10;            }&#10;            .result-table th {&#10;                background-color: #f0f0f0 !important;&#10;                color: black !important;&#10;            }&#10;            .result-interpretation {&#10;                background-color: white;&#10;                border: 1px solid #ddd;&#10;            }&#10;            * {&#10;                -webkit-print-color-adjust: exact !important;&#10;                print-color-adjust: exact !important;&#10;            }&#10;        }&#10;        .progress-bar-container {&#10;            width: 100%;&#10;            height: 20px;&#10;            background-color: #e0e0e0;&#10;            border-radius: 10px;&#10;            margin: 10px 0;&#10;            overflow: hidden;&#10;        }&#10;        .progress-bar {&#10;            height: 100%;&#10;            background-color: #4CAF50;&#10;            border-radius: 10px;&#10;            transition: width 0.3s ease;&#10;        }&#10;        .progress-label {&#10;            text-align: center;&#10;            font-size: 14px;&#10;            color: #555;&#10;            margin-top: 5px;&#10;        }&#10;        .highlight-box {&#10;            background-color: #fffacd;&#10;            border: 2px solid #ffd700;&#10;            padding: 15px;&#10;            border-radius: 8px;&#10;            margin: 20px 0;&#10;            text-align: center;&#10;        }&#10;        .highlight-value {&#10;            font-size: 28px;&#10;            font-weight: bold;&#10;            color: #e74c3c;&#10;            margin: 10px 0;&#10;        }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;div class=&quot;container&quot;&gt;&#10;        &lt;div class=&quot;header&quot;&gt;&#10;            &lt;img src=&quot;Media/animation.gif&quot; alt=&quot;Experiment animation&quot;&gt;&#10;            &lt;div class=&quot;training-info&quot;&gt;High Rising Tone Discrimination (ABX)&lt;/div&gt;&#10;            &lt;div class=&quot;instruction-text&quot;&gt;請判斷第三個音聽起來更像第一個還是第二個音&lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div id=&quot;experimentContainer&quot;&gt;&#10;            &lt;div class=&quot;control-button-container&quot;&gt;&#10;                &lt;input id=&quot;start&quot; type=&quot;button&quot; value=&quot;開始實驗&quot; onclick=&quot;start_onclick()&quot; class=&quot;control-button&quot;&gt;&#10;                &lt;input id=&quot;viewResult&quot; type=&quot;button&quot; value=&quot;查看結果&quot; onclick=&quot;view_onclick()&quot; class=&quot;control-button&quot; disabled&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;prompt-text&quot; id=&quot;promptText&quot;&gt;&#10;                第三個音更像...&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;firstBtn&quot; type=&quot;button&quot; value=&quot;第一個音&quot; onclick=&quot;processAnswer(1)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;                &lt;input id=&quot;secondBtn&quot; type=&quot;button&quot; value=&quot;第二個音&quot; onclick=&quot;processAnswer(2)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;feedback&quot;&gt;&#10;                &lt;img id=&quot;smile&quot; src=&quot;Media/null.gif&quot; width=&quot;100&quot; height=&quot;84&quot; alt=&quot;Feedback&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;text1&quot; class=&quot;status&quot; readonly&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;progress-bar-container&quot;&gt;&#10;                &lt;div class=&quot;progress-bar&quot; id=&quot;progressBar&quot; style=&quot;width: 0%&quot;&gt;&lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;progress-label&quot; id=&quot;progressLabel&quot;&gt;Progress: 0%&lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;debug-info&quot; id=&quot;debugInfo&quot;&gt;&#10;                Debug information will be displayed here&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot;&gt;&#10;                &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;showDebug&quot; onclick=&quot;toggleDebug()&quot;&gt; Show Debug Info&lt;/label&gt;&#10;                &lt;button onclick=&quot;testAudio()&quot;&gt;Test All Audio&lt;/button&gt;&#10;                &lt;button onclick=&quot;showDiagnostics()&quot;&gt;Diagnostics&lt;/button&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot; id=&quot;exportBtn&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div id=&quot;resultsContainer&quot; class=&quot;results-container&quot;&gt;&#10;            &lt;h2 class=&quot;result-heading&quot;&gt;Dynamic Pitch Discrimination Test Results (ABX)&lt;/h2&gt;&#10;            &#10;            &lt;div class=&quot;highlight-box&quot;&gt;&#10;                &lt;h3 style=&quot;margin-top: 0;&quot;&gt;Just Noticeable Difference (JND)&lt;/h3&gt;&#10;                &lt;div class=&quot;highlight-value&quot; id=&quot;jndValue&quot;&gt;--&lt;/div&gt;&#10;                &lt;p style=&quot;margin-bottom: 0; font-size: 14px; color: #666;&quot;&gt;&#10;                    This represents the minimum detectable difference in modulation window duration&lt;br&gt;&#10;                    &lt;strong&gt;Smaller JND = Better discrimination ability&lt;/strong&gt;&#10;                &lt;/p&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Perceptual Discrimination Thresholds&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Parameter&lt;/th&gt;&#10;                        &lt;th&gt;Standard (Reference)&lt;/th&gt;&#10;                        &lt;th&gt;Threshold (Your JND)&lt;/th&gt;&#10;                        &lt;th&gt;Difference Ratio&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;resultTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;div class=&quot;result-interpretation&quot; id=&quot;resultInterpretation&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Detailed Threshold Metrics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Metric&lt;/th&gt;&#10;                        &lt;th&gt;Value&lt;/th&gt;&#10;                        &lt;th&gt;Interpretation&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;detailedMetricsBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;h3&gt;Performance Statistics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Metric&lt;/th&gt;&#10;                        &lt;th&gt;Value&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;performanceStatsBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;button class=&quot;print-button&quot; onclick=&quot;printResults()&quot;&gt;Print Results&lt;/button&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot; style=&quot;margin-top: 20px;&quot;&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;button class=&quot;back-button&quot; onclick=&quot;backToExperiment()&quot;&gt;Back to Experiment&lt;/button&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div class=&quot;diagnostic-overlay&quot; id=&quot;diagnosticOverlay&quot;&gt;&#10;            &lt;div class=&quot;diagnostic-content&quot;&gt;&#10;                &lt;span class=&quot;diagnostic-close&quot; onclick=&quot;closeDiagnostics()&quot;&gt;&amp;times;&lt;/span&gt;&#10;                &lt;h2 class=&quot;diagnostic-heading&quot;&gt;Experiment Diagnostics&lt;/h2&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Test Status&lt;/h3&gt;&#10;                    &lt;table class=&quot;statistics-table&quot;&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;th&gt;Trials&lt;/th&gt;&#10;                            &lt;th&gt;Reversals&lt;/th&gt;&#10;                            &lt;th&gt;Status&lt;/th&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td id=&quot;totalTrials&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;totalReversals&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;testStatus&quot;&gt;Not started&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                    &lt;/table&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Audio Files Check&lt;/h3&gt;&#10;                    &lt;p&gt;Verifying necessary audio files:&lt;/p&gt;&#10;                    &lt;div id=&quot;audioFileStatus&quot; class=&quot;diagnostic-file-status&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Reversal History&lt;/h3&gt;&#10;                    &lt;div id=&quot;reversalHistory&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Recommendations&lt;/h3&gt;&#10;                    &lt;div id=&quot;diagnosticRecommendations&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-actions&quot;&gt;&#10;                    &lt;button class=&quot;diagnostic-action-button continue-button&quot; onclick=&quot;closeDiagnostics()&quot;&gt;Close&lt;/button&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;audio id=&quot;high_rising_standard&quot; src=&quot;Media/high_rising_standard.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;    &lt;audio id=&quot;high_rising_1&quot; src=&quot;Media/high_rising_1.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_rising_2&quot; src=&quot;Media/high_rising_2.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_rising_3&quot; src=&quot;Media/high_rising_3.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_rising_4&quot; src=&quot;Media/high_rising_4.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_rising_5&quot; src=&quot;Media/high_rising_5.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_rising_6&quot; src=&quot;Media/high_rising_6.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_rising_7&quot; src=&quot;Media/high_rising_7.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_rising_8&quot; src=&quot;Media/high_rising_8.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;high_rising_9&quot; src=&quot;Media/high_rising_9.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;&lt;script&gt;&#10;function getLocalTimestamp() {&#10;    const now = new Date();&#10;    const year = now.getFullYear();&#10;    const month = String(now.getMonth() + 1).padStart(2, '0');&#10;    const day = String(now.getDate()).padStart(2, '0');&#10;    const hours = String(now.getHours()).padStart(2, '0');&#10;    const minutes = String(now.getMinutes()).padStart(2, '0');&#10;    const seconds = String(now.getSeconds()).padStart(2, '0');&#10;    const milliseconds = String(now.getMilliseconds()).padStart(3, '0');&#10;    &#10;    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;&#10;}&#10;&#10;// Stimulus parameters for dynamic pitch modulation&#10;const STIMULUS_DURATION = 450; // ms, total duration&#10;const STANDARD_WINDOW = 400; // ms, modulation window for standard (100%)&#10;const STANDARD_WINDOW_PERCENT = 100; // percentage&#10;&#10;// Modulation window percentages for each difficulty level&#10;const MODULATION_WINDOWS = {&#10;    1: 20,   // easiest - 20% of standard window (80 ms)&#10;    2: 40,   // 160 ms&#10;    3: 50,   // 200 ms&#10;    4: 60,   // 240 ms&#10;    5: 70,   // 280 ms&#10;    6: 80,   // 320 ms&#10;    7: 90,   // 360 ms&#10;    8: 95,   // 380 ms&#10;    9: 98    // hardest - 98% of standard window (392 ms)&#10;};&#10;&#10;function getModulationWindowDuration(level) {&#10;    return (MODULATION_WINDOWS[level] / 100) * STANDARD_WINDOW;&#10;}&#10;&#10;const PITCH_RISE_SEMITONES = 1.0;&#10;&#10;function getModulationRate(level) {&#10;    const windowDuration = getModulationWindowDuration(level);&#10;    const windowDurationSec = windowDuration / 1000;&#10;    return PITCH_RISE_SEMITONES / windowDurationSec;&#10;}&#10;&#10;function getModulationSlope(level) {&#10;    const windowDuration = getModulationWindowDuration(level);&#10;    return PITCH_RISE_SEMITONES / windowDuration;&#10;}&#10;&#10;// Adaptive threshold experiment constants&#10;const MAXREVERSALS = 10;&#10;const MAXITERATIONS = 50;&#10;const LOWERLIMIT = 1;&#10;const DECREASING = -1;&#10;const INCREASING = 1;&#10;const MINIMUMREVERSALS = 6;&#10;const THRESHOLD_REVERSAL_COUNT = 6;&#10;&#10;// Experiment state variables&#10;var CorrectAnswer;&#10;var CorrectResponses = 0;&#10;var Direction = DECREASING;&#10;var Reversals = [];&#10;var NumberOfReversals = 0;&#10;var currentLevel = 5;&#10;var numberOfIterations = 0;&#10;var sentAverage = 0.0;&#10;var sentStdev = 0.0;&#10;var isTestComplete = false;&#10;var audioUnlocked = false;&#10;var allFilesPresent = true;&#10;var trialRecords = [];&#10;var stimulusEndTime = 0;&#10;&#10;// ABX variables&#10;var standardIsFirst;&#10;var comparisonSound;&#10;var standardSound;&#10;var xSound;&#10;&#10;var isReplayTrial = false;&#10;&#10;// Results variables - JND-based&#10;var jndAbsoluteDifference = 0;&#10;var jndRatio = 0;&#10;var jndPercentDifference = 0;&#10;var thresholdWindowDuration = 0;&#10;var thresholdWindowPercent = 0;&#10;var thresholdModulationRate = 0;&#10;var thresholdSlope = 0;&#10;var webersRatio = 0;&#10;&#10;function printResults() {&#10;    window.print();&#10;}&#10;&#10;function logDebug(message) {&#10;    console.log(message);&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var now = new Date();&#10;    var timeStr = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + '.' + now.getMilliseconds();&#10;    debugArea.innerHTML += '&lt;p&gt;[' + timeStr + '] ' + message + '&lt;/p&gt;';&#10;    debugArea.scrollTop = debugArea.scrollHeight;&#10;}&#10;&#10;function toggleDebug() {&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var checkbox = document.getElementById('showDebug');&#10;    debugArea.style.display = checkbox.checked ? 'block' : 'none';&#10;}&#10;&#10;function showDiagnostics() {&#10;    updateDiagnostics();&#10;    document.getElementById('diagnosticOverlay').style.display = 'flex';&#10;}&#10;&#10;function closeDiagnostics() {&#10;    document.getElementById('diagnosticOverlay').style.display = 'none';&#10;}&#10;&#10;function updateDiagnostics() {&#10;    document.getElementById('totalTrials').innerText = numberOfIterations;&#10;    document.getElementById('totalReversals').innerText = NumberOfReversals;&#10;    &#10;    let testStatus = getTestStatus();&#10;    document.getElementById('testStatus').innerText = testStatus.text;&#10;    document.getElementById('testStatus').className = `direction-stats-${testStatus.class}`;&#10;    &#10;    checkAudioFiles();&#10;    &#10;    let reversalHistoryHtml = '';&#10;    if (Reversals.length === 0) {&#10;        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';&#10;    } else {&#10;        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals.join(', ') + '&lt;/p&gt;';&#10;        reversalHistoryHtml += '&lt;p&gt;Corresponding modulation windows: ';&#10;        reversalHistoryHtml += Reversals.map(level =&gt; MODULATION_WINDOWS[level] + '% (' + getModulationWindowDuration(level) + ' ms)').join(', ') + '&lt;/p&gt;';&#10;    }&#10;    &#10;    document.getElementById('reversalHistory').innerHTML = reversalHistoryHtml;&#10;    &#10;    generateDiagnosticRecommendations();&#10;}&#10;&#10;function getTestStatus() {&#10;    if (isTestComplete) {&#10;        return { text: &quot;Complete&quot;, class: &quot;good&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals &lt; 1) {&#10;        return { text: &quot;Not enough data&quot;, class: &quot;bad&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals &lt; MINIMUMREVERSALS) {&#10;        return { text: &quot;Incomplete (&quot; + NumberOfReversals + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals)&quot;, class: &quot;warning&quot; };&#10;    }&#10;    &#10;    return { text: &quot;In progress&quot;, class: &quot;good&quot; };&#10;}&#10;&#10;function checkAudioFiles() {&#10;    const requiredFiles = [&#10;        &quot;high_rising_standard&quot;,&#10;        &quot;high_rising_1&quot;, &quot;high_rising_2&quot;, &quot;high_rising_3&quot;, &quot;high_rising_4&quot;, &quot;high_rising_5&quot;, &#10;        &quot;high_rising_6&quot;, &quot;high_rising_7&quot;, &quot;high_rising_8&quot;, &quot;high_rising_9&quot;&#10;    ];&#10;    &#10;    let statusHtml = '';&#10;    allFilesPresent = true;&#10;    &#10;    requiredFiles.forEach(function(fileId) {&#10;        const audioElement = document.getElementById(fileId);&#10;        const fileFound = audioElement !== null;&#10;        &#10;        if (!fileFound) {&#10;            allFilesPresent = false;&#10;        }&#10;        &#10;        statusHtml += `&lt;div class=&quot;file-status-item ${fileFound ? 'file-found' : 'file-missing'}&quot;&gt;${fileId}: ${fileFound ? 'Found' : 'Missing'}&lt;/div&gt;`;&#10;    });&#10;    &#10;    document.getElementById('audioFileStatus').innerHTML = statusHtml;&#10;}&#10;&#10;function generateDiagnosticRecommendations() {&#10;    let recommendations = '';&#10;    let hasIssues = false;&#10;    &#10;    if (!allFilesPresent) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Critical Issue:&lt;/strong&gt; Some required audio files are missing. Please ensure all files are properly loaded.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (numberOfIterations &gt;= MAXITERATIONS &amp;&amp; NumberOfReversals &lt; MINIMUMREVERSALS) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Issue:&lt;/strong&gt; Reached maximum trials but has insufficient reversals. This might indicate audio file issues or participant response patterns.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (!hasIssues) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Good:&lt;/strong&gt; No major issues detected with the experiment setup.&lt;/p&gt;';&#10;        &#10;        if (isTestComplete) {&#10;            recommendations += '&lt;p&gt;Test is complete.&lt;/p&gt;';&#10;        } else {&#10;            recommendations += '&lt;p&gt;Test is still in progress.&lt;/p&gt;';&#10;        }&#10;    }&#10;    &#10;    document.getElementById('diagnosticRecommendations').innerHTML = recommendations;&#10;}&#10;&#10;function testAudio() {&#10;    logDebug(&quot;Starting to test all audio files...&quot;);&#10;    var audios = document.querySelectorAll('audio');&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    var index = 0;&#10;    function playNext() {&#10;        if (index &gt;= audios.length) {&#10;            logDebug(&quot;All audio testing complete!&quot;);&#10;            return;&#10;        }&#10;        &#10;        var audio = audios[index];&#10;        logDebug(&quot;Testing audio #&quot; + (index + 1) + &quot;: &quot; + audio.id);&#10;        &#10;        audio.currentTime = 0;&#10;        &#10;        var playPromise = audio.play();&#10;        if (playPromise !== undefined) {&#10;            playPromise.then(function() {&#10;                logDebug(audio.id + &quot; played successfully&quot;);&#10;                &#10;                audio.onended = function() {&#10;                    logDebug(audio.id + &quot; playback ended&quot;);&#10;                    index++;&#10;                    setTimeout(playNext, 500);&#10;                };&#10;            }).catch(function(error) {&#10;                logDebug(&quot;Failed to play &quot; + audio.id + &quot;: &quot; + error);&#10;                index++;&#10;                setTimeout(playNext, 500);&#10;            });&#10;        }&#10;    }&#10;    &#10;    playNext();&#10;}&#10;&#10;function unlockAudioContext() {&#10;    logDebug(&quot;Attempting to unlock audio context...&quot;);&#10;    &#10;    var silentAudio = new Audio();&#10;    silentAudio.src = &quot;data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA&quot;;&#10;    &#10;    var promise = silentAudio.play();&#10;    if (promise !== undefined) {&#10;        promise.then(function() {&#10;            logDebug(&quot;Audio context unlocked successfully&quot;);&#10;            silentAudio.remove();&#10;            audioUnlocked = true;&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to unlock audio context: &quot; + error);&#10;        });&#10;    }&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    for (var i = 0; i &lt; allAudios.length; i++) {&#10;        var audio = allAudios[i];&#10;        audio.load();&#10;    }&#10;    &#10;    logDebug(&quot;Preloaded &quot; + allAudios.length + &quot; audio files&quot;);&#10;}&#10;&#10;function resetPage() {&#10;    numberOfIterations++;&#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('firstBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('secondBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    if (isTestComplete) {&#10;        document.getElementById('start').disabled = false;&#10;        document.getElementById('viewResult').disabled = false;&#10;        document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;        updateProgressBar(100);&#10;        return;&#10;    }&#10;    &#10;    if ((numberOfIterations &gt;= MAXITERATIONS) || (NumberOfReversals &gt;= MAXREVERSALS)) {&#10;        if (NumberOfReversals &gt;= MINIMUMREVERSALS) {&#10;            calculateResults();&#10;            isTestComplete = true;&#10;            document.getElementById('start').disabled = false;&#10;            document.getElementById('viewResult').disabled = false;&#10;            document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;            updateProgressBar(100);&#10;        } else {&#10;            logDebug(&quot;Reached max iterations but has only &quot; + NumberOfReversals + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals. Showing diagnostics.&quot;);&#10;            document.getElementById('text1').value = &quot;Insufficient data. Check diagnostics.&quot;;&#10;            setTimeout(function() {&#10;                showDiagnostics();&#10;            }, 500);&#10;            return;&#10;        }&#10;    } else {&#10;        updateProgressBar();&#10;        beginIteration();&#10;    }&#10;}&#10;&#10;function updateProgressBar(forcePercent) {&#10;    if (typeof forcePercent === 'number') {&#10;        document.getElementById('progressBar').style.width = forcePercent + '%';&#10;        document.getElementById('progressLabel').textContent = 'Progress: ' + forcePercent + '%';&#10;        return;&#10;    }&#10;    &#10;    const maxValue = Math.max(MAXREVERSALS, MAXITERATIONS);&#10;    const currentValue = isTestComplete ? maxValue : Math.max(NumberOfReversals, numberOfIterations);&#10;    const totalPercent = Math.min(100 * (currentValue / maxValue), 100);&#10;    &#10;    document.getElementById('progressBar').style.width = totalPercent + '%';&#10;    document.getElementById('progressLabel').textContent = 'Progress: ' + Math.round(totalPercent) + '%';&#10;}&#10;&#10;function calculateResults() {&#10;    let sum = 0.0, stddevsum = 0.0, average = 0.0, stdev = 0.0, counter = 0;&#10;    &#10;    for (let i = 0; i &lt; Reversals.length; i++) {&#10;        if (Reversals[i] &gt; 0) counter++;&#10;    }&#10;    &#10;    if (counter &lt; MINIMUMREVERSALS) {&#10;        logDebug(&quot;Test has insufficient data&quot;);&#10;        alert(&quot;Test has insufficient data. Please complete the test again.&quot;);&#10;        return;&#10;    }&#10;    &#10;    const startIndex = Math.max(0, NumberOfReversals - THRESHOLD_REVERSAL_COUNT);&#10;    counter = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0) {&#10;            sum += level;&#10;            counter++;&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 0) {&#10;        average = sum / counter;&#10;        average = parseFloat(average.toFixed(2));&#10;    }&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0) {&#10;            stddevsum += Math.pow(level - average, 2);&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 1) {&#10;        stdev = Math.sqrt(stddevsum / (counter - 1));&#10;        stdev = parseFloat(stdev.toFixed(2));&#10;    }&#10;    &#10;    sentAverage = average;&#10;    sentStdev = stdev;&#10;    &#10;    thresholdWindowPercent = calculateAverageWindowPercent(startIndex);&#10;    thresholdWindowDuration = (thresholdWindowPercent / 100) * STANDARD_WINDOW;&#10;    thresholdModulationRate = PITCH_RISE_SEMITONES / (thresholdWindowDuration / 1000);&#10;    thresholdSlope = PITCH_RISE_SEMITONES / thresholdWindowDuration;&#10;    &#10;    jndAbsoluteDifference = STANDARD_WINDOW - thresholdWindowDuration;&#10;    jndRatio = thresholdWindowDuration / STANDARD_WINDOW;&#10;    jndPercentDifference = 100 - thresholdWindowPercent;&#10;    webersRatio = jndAbsoluteDifference / STANDARD_WINDOW;&#10;    &#10;    logDebug(&quot;Test complete! Average difficulty level: &quot; + average.toFixed(2));&#10;    logDebug(&quot;Threshold window: &quot; + thresholdWindowPercent.toFixed(2) + &quot;% (&quot; + thresholdWindowDuration.toFixed(2) + &quot; ms)&quot;);&#10;    logDebug(&quot;JND Absolute Difference: &quot; + jndAbsoluteDifference.toFixed(2) + &quot; ms&quot;);&#10;    logDebug(&quot;JND Ratio: &quot; + jndRatio.toFixed(4));&#10;    logDebug(&quot;JND Percent Difference: &quot; + jndPercentDifference.toFixed(2) + &quot;%&quot;);&#10;    logDebug(&quot;Weber's Ratio: &quot; + webersRatio.toFixed(4));&#10;    &#10;    document.getElementById('text1').value = &quot;Test complete! JND: &quot; + jndAbsoluteDifference.toFixed(1) + &quot; ms&quot;;&#10;}&#10;&#10;function calculateAverageWindowPercent(startIndex) {&#10;    let sum = 0;&#10;    let count = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0 &amp;&amp; MODULATION_WINDOWS[level] !== undefined) {&#10;            sum += MODULATION_WINDOWS[level];&#10;            count++;&#10;        }&#10;    }&#10;    &#10;    return count &gt; 0 ? sum / count : 0;&#10;}&#10;&#10;function calculateReactionTimeStats() {&#10;    let allRTs = trialRecords.map(t =&gt; parseFloat(t.reactionTime));&#10;    &#10;    return {&#10;        mean: allRTs.length ? (allRTs.reduce((a, b) =&gt; a + b, 0) / allRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;        median: allRTs.length ? calculateMedian(allRTs).toFixed(0) : &quot;N/A&quot;,&#10;        sd: allRTs.length &gt; 1 ? calculateSD(allRTs).toFixed(0) : &quot;N/A&quot;&#10;    };&#10;}&#10;&#10;function calculateAccuracyStats() {&#10;    let allTrials = trialRecords;&#10;    &#10;    return {&#10;        correct: allTrials.filter(t =&gt; t.isCorrect).length,&#10;        total: allTrials.length,&#10;        percentage: allTrials.length ? &#10;            (allTrials.filter(t =&gt; t.isCorrect).length / allTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;    };&#10;}&#10;&#10;function calculateMedian(values) {&#10;    if (!values.length) return 0;&#10;    &#10;    const sortedValues = values.slice().sort((a, b) =&gt; a - b);&#10;    const mid = Math.floor(sortedValues.length / 2);&#10;    &#10;    return sortedValues.length % 2 === 0 ? &#10;        (sortedValues[mid - 1] + sortedValues[mid]) / 2 : &#10;        sortedValues[mid];&#10;}&#10;&#10;function calculateSD(values) {&#10;    if (values.length &lt;= 1) return 0;&#10;    &#10;    const mean = values.reduce((a, b) =&gt; a + b, 0) / values.length;&#10;    const variance = values.map(x =&gt; Math.pow(x - mean, 2)).reduce((a, b) =&gt; a + b, 0) / (values.length - 1);&#10;    &#10;    return Math.sqrt(variance);&#10;}&#10;&#10;function displayResults() {&#10;    logDebug(&quot;Displaying results&quot;);&#10;    &#10;    let hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;&#10;    &#10;    if (!hasData) {&#10;        let message = &quot;Warning: Insufficient data. Results may not be reliable.&quot;;&#10;        &#10;        if (confirm(message + &quot;\n\nWould you like to retry the experiment?&quot;)) {&#10;            window_onload();&#10;            return;&#10;        }&#10;    }&#10;    &#10;    document.getElementById('experimentContainer').style.display = 'none';&#10;    document.getElementById('resultsContainer').style.display = 'block';&#10;    &#10;    if (hasData) {&#10;        document.getElementById('jndValue').innerHTML = &#10;            jndAbsoluteDifference.toFixed(2) + ' ms&lt;br&gt;' +&#10;            '&lt;span style=&quot;font-size: 18px;&quot;&gt;(' + jndPercentDifference.toFixed(2) + '% difference from standard)&lt;/span&gt;';&#10;    } else {&#10;        document.getElementById('jndValue').textContent = 'Insufficient Data';&#10;    }&#10;    &#10;    var tableBody = document.getElementById('resultTableBody');&#10;    tableBody.innerHTML = '';&#10;    &#10;    var windowRow = document.createElement('tr');&#10;    windowRow.innerHTML = &#10;        '&lt;td&gt;Modulation Window Duration&lt;/td&gt;' +&#10;        '&lt;td&gt;' + STANDARD_WINDOW + ' ms (100%)&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? thresholdWindowDuration.toFixed(2) + ' ms (' + thresholdWindowPercent.toFixed(2) + '%)' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? jndRatio.toFixed(4) + ' : 1&lt;br&gt;(Threshold/Standard)' : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(windowRow);&#10;    &#10;    var diffRow = document.createElement('tr');&#10;    diffRow.innerHTML = &#10;        '&lt;td&gt;Absolute Difference (JND)&lt;/td&gt;' +&#10;        '&lt;td&gt;0 ms (reference)&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? jndAbsoluteDifference.toFixed(2) + ' ms' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? 'Weber Ratio: ' + webersRatio.toFixed(4) : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(diffRow);&#10;    &#10;    var rateStandard = PITCH_RISE_SEMITONES / (STANDARD_WINDOW / 1000);&#10;    var rateRow = document.createElement('tr');&#10;    rateRow.innerHTML = &#10;        '&lt;td&gt;Modulation Rate&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rateStandard.toFixed(4) + ' semitones/s&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? thresholdModulationRate.toFixed(4) + ' semitones/s' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? (thresholdModulationRate / rateStandard).toFixed(4) + ' : 1' : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(rateRow);&#10;    &#10;    var interpretation = document.getElementById('resultInterpretation');&#10;    let interpretationHtml = '&lt;h3 style=&quot;margin-top: 0;&quot;&gt;Performance Interpretation&lt;/h3&gt;';&#10;    &#10;    if (hasData) {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Your Just Noticeable Difference (JND):&lt;/strong&gt;&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;You can reliably detect a difference when the modulation window changes by &lt;strong&gt;' + &#10;            jndAbsoluteDifference.toFixed(2) + ' ms&lt;/strong&gt; (or &lt;strong&gt;' + jndPercentDifference.toFixed(2) + &#10;            '%&lt;/strong&gt; of the standard 400 ms window).&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;In other words, you can discriminate between:&lt;/p&gt;';&#10;        interpretationHtml += '&lt;ul&gt;';&#10;        interpretationHtml += '&lt;li&gt;Standard stimulus: 400 ms modulation window&lt;/li&gt;';&#10;        interpretationHtml += '&lt;li&gt;Your threshold: ' + thresholdWindowDuration.toFixed(2) + ' ms modulation window&lt;/li&gt;';&#10;        interpretationHtml += '&lt;li&gt;Difference: ' + jndAbsoluteDifference.toFixed(2) + ' ms&lt;/li&gt;';&#10;        interpretationHtml += '&lt;/ul&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Weber\'s Ratio:&lt;/strong&gt; ' + webersRatio.toFixed(4) + &#10;            ' (smaller Weber\'s ratio = better discrimination sensitivity)&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;&lt;em&gt;Note: A &lt;strong&gt;smaller JND&lt;/strong&gt; indicates &lt;strong&gt;better sensitivity&lt;/strong&gt; to dynamic pitch changes, ' +&#10;            'as it means you can detect smaller differences between stimuli.&lt;/em&gt;&lt;/p&gt;';&#10;    } else {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Complete results not available due to insufficient data.&lt;/p&gt;';&#10;    }&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    const accuracyStats = calculateAccuracyStats();&#10;    &#10;    interpretationHtml += '&lt;p&gt;&lt;strong&gt;Overall Performance:&lt;/strong&gt; ' + accuracyStats.percentage + &#10;        '% accuracy with average reaction time of ' + rtStats.mean + ' ms across ' + &#10;        accuracyStats.total + ' trials.&lt;/p&gt;';&#10;    &#10;    interpretation.innerHTML = interpretationHtml;&#10;    &#10;    var detailedBody = document.getElementById('detailedMetricsBody');&#10;    detailedBody.innerHTML = '';&#10;    &#10;    var metrics = [&#10;        { name: 'Average Difficulty Level', value: hasData ? sentAverage.toFixed(2) : 'N/A', interp: hasData ? 'SD: ' + sentStdev.toFixed(2) : 'N/A' },&#10;        { name: 'Threshold Slope', value: hasData ? thresholdSlope.toFixed(6) + ' semitones/ms' : 'N/A', interp: hasData ? 'Rate of pitch change' : 'N/A' },&#10;        { name: 'Number of Reversals', value: NumberOfReversals, interp: 'Minimum required: ' + MINIMUMREVERSALS },&#10;        { name: 'Total Trials', value: numberOfIterations, interp: 'Maximum allowed: ' + MAXITERATIONS }&#10;    ];&#10;    &#10;    metrics.forEach(function(metric) {&#10;        var row = document.createElement('tr');&#10;        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;&lt;td&gt;' + metric.interp + '&lt;/td&gt;';&#10;        detailedBody.appendChild(row);&#10;    });&#10;    &#10;    var perfBody = document.getElementById('performanceStatsBody');&#10;    perfBody.innerHTML = '';&#10;    &#10;    var perfMetrics = [&#10;        { name: 'Total Trials', value: accuracyStats.total },&#10;        { name: 'Correct Responses', value: accuracyStats.correct },&#10;        { name: 'Overall Accuracy', value: accuracyStats.percentage + '%' },&#10;        { name: 'Mean Reaction Time', value: rtStats.mean + ' ms' },&#10;        { name: 'Median Reaction Time', value: rtStats.median + ' ms' },&#10;        { name: 'RT Standard Deviation', value: rtStats.sd + ' ms' }&#10;    ];&#10;    &#10;    perfMetrics.forEach(function(metric) {&#10;        var row = document.createElement('tr');&#10;        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;';&#10;        perfBody.appendChild(row);&#10;    });&#10;}&#10;&#10;function backToExperiment() {&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;}&#10;&#10;function view_onclick() {&#10;    logDebug(&quot;View results button clicked&quot;);&#10;    &#10;    if (!isTestComplete &amp;&amp; NumberOfReversals &gt;= MINIMUMREVERSALS) {&#10;        calculateResults();&#10;        isTestComplete = true;&#10;    }&#10;    &#10;    displayResults();&#10;}&#10;&#10;function beginIteration() {&#10;    isReplayTrial = false;&#10;    &#10;    standardIsFirst = Math.random() &lt; 0.5;&#10;    var xIsStandard = Math.random() &lt; 0.5;&#10;    &#10;    if (xIsStandard) {&#10;        CorrectAnswer = standardIsFirst ? 1 : 2;&#10;    } else {&#10;        CorrectAnswer = standardIsFirst ? 2 : 1;&#10;    }&#10;    &#10;    logDebug(&quot;Starting new iteration #&quot; + numberOfIterations + &#10;             &quot;, Standard is &quot; + (standardIsFirst ? &quot;first&quot; : &quot;second&quot;) +&#10;             &quot;, X is &quot; + (xIsStandard ? &quot;standard&quot; : &quot;comparison&quot;) +&#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Difficulty level: &quot; + currentLevel +&#10;             &quot;, Modulation window: &quot; + MODULATION_WINDOWS[currentLevel] + &quot;% (&quot; + &#10;             getModulationWindowDuration(currentLevel) + &quot; ms)&quot;);&#10;    &#10;    setTimeout(function() {&#10;        playABXSequence(xIsStandard);&#10;    }, 1000);&#10;}&#10;&#10;function clearButtonAnimations() {&#10;    document.getElementById('firstBtn').classList.remove('button-playing');&#10;    document.getElementById('secondBtn').classList.remove('button-playing');&#10;}&#10;&#10;function playABXSequence(xIsStandard) {&#10;    logDebug(&quot;Playing ABX sequence&quot;);&#10;    &#10;    clearButtonAnimations();&#10;    &#10;    standardSound = document.getElementById('high_rising_standard');&#10;    comparisonSound = document.getElementById(&quot;high_rising_&quot; + currentLevel);&#10;    &#10;    xSound = xIsStandard ? standardSound : comparisonSound;&#10;    &#10;    if (!standardSound || !comparisonSound) {&#10;        logDebug(&quot;Error: Cannot find audio elements!&quot;);&#10;        document.getElementById('text1').value = &quot;出錯：找不到音頻文件&quot;;&#10;        setTimeout(function() {&#10;            showDiagnostics();&#10;        }, 1000);&#10;        return;&#10;    }&#10;    &#10;    var firstSound = standardIsFirst ? standardSound : comparisonSound;&#10;    document.getElementById('text1').value = &quot;播放第一個音&quot;;&#10;    &#10;    document.getElementById('firstBtn').classList.add('button-playing');&#10;    &#10;    firstSound.currentTime = 0;&#10;    var playPromise1 = firstSound.play();&#10;    &#10;    if (playPromise1 !== undefined) {&#10;        playPromise1.then(function() {&#10;            logDebug(&quot;First sound (A) played successfully&quot;);&#10;            &#10;            firstSound.onended = function() {&#10;                logDebug(&quot;First sound ended&quot;);&#10;                &#10;                document.getElementById('firstBtn').classList.remove('button-playing');&#10;                &#10;                setTimeout(function() {&#10;                    var secondSound = standardIsFirst ? comparisonSound : standardSound;&#10;                    document.getElementById('text1').value = &quot;播放第二個音&quot;;&#10;                    &#10;                    document.getElementById('secondBtn').classList.add('button-playing');&#10;                    &#10;                    secondSound.currentTime = 0;&#10;                    var playPromise2 = secondSound.play();&#10;                    &#10;                    if (playPromise2 !== undefined) {&#10;                        playPromise2.then(function() {&#10;                            logDebug(&quot;Second sound (B) played successfully&quot;);&#10;                            &#10;                            secondSound.onended = function() {&#10;                                logDebug(&quot;Second sound ended&quot;);&#10;                                &#10;                                document.getElementById('secondBtn').classList.remove('button-playing');&#10;                                &#10;                                setTimeout(function() {&#10;                                    document.getElementById('text1').value = &quot;播放第三個音&quot;;&#10;                                    &#10;                                    xSound.currentTime = 0;&#10;                                    var playPromise3 = xSound.play();&#10;                                    &#10;                                    if (playPromise3 !== undefined) {&#10;                                        playPromise3.then(function() {&#10;                                            logDebug(&quot;Third sound (X) played successfully&quot;);&#10;                                            &#10;                                            xSound.onended = function() {&#10;                                                logDebug(&quot;Third sound ended, enabling response buttons&quot;);&#10;                                                &#10;                                                stimulusEndTime = performance.now();&#10;                                                &#10;                                                document.getElementById('text1').value = &quot;請作出選擇&quot;;&#10;                                                document.getElementById('promptText').style.visibility = 'visible';&#10;                                                &#10;                                                document.getElementById('firstBtn').disabled = false;&#10;                                                document.getElementById('secondBtn').disabled = false;&#10;                                                document.getElementById('firstBtn').style.background = &quot;#66CCFF&quot;;&#10;                                                document.getElementById('secondBtn').style.background = &quot;#66CCFF&quot;;&#10;                                            };&#10;                                        }).catch(function(error) {&#10;                                            logDebug(&quot;Failed to play third sound: &quot; + error);&#10;                                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                                            clearButtonAnimations();&#10;                                            setTimeout(showDiagnostics, 1000);&#10;                                        });&#10;                                    }&#10;                                }, 1000);&#10;                            };&#10;                        }).catch(function(error) {&#10;                            logDebug(&quot;Failed to play second sound: &quot; + error);&#10;                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                            clearButtonAnimations();&#10;                            setTimeout(showDiagnostics, 1000);&#10;                        });&#10;                    }&#10;                }, 1000);&#10;            };&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to play first sound: &quot; + error);&#10;            document.getElementById('text1').value = &quot;音頻播放錯誤，請刷新頁面&quot;;&#10;            clearButtonAnimations();&#10;            setTimeout(showDiagnostics, 1000);&#10;        });&#10;    }&#10;}&#10;&#10;function start_onclick() {&#10;    logDebug(&quot;Starting experiment&quot;);&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    checkAudioFiles();&#10;    if (!allFilesPresent) {&#10;        logDebug(&quot;Cannot start experiment: Some audio files are missing&quot;);&#10;        document.getElementById('text1').value = &quot;音頻缺失&quot;;&#10;        showDiagnostics();&#10;        return;&#10;    }&#10;    &#10;    window_onload();&#10;    document.getElementById('text1').value = &quot;開始實驗...&quot;;&#10;    updateProgressBar(0);&#10;    &#10;    setTimeout(function() {&#10;        beginIteration();&#10;        document.getElementById('start').disabled = true;&#10;        document.getElementById('viewResult').disabled = true;&#10;        document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;        document.getElementById('promptText').style.visibility = 'hidden';&#10;    }, 1000);&#10;}&#10;&#10;function gotReversal() {&#10;    NumberOfReversals++;&#10;    Reversals[NumberOfReversals - 1] = currentLevel;&#10;    Direction = -Direction;&#10;    logDebug(&quot;Recorded reversal #&quot; + NumberOfReversals + &quot; at difficulty &quot; + currentLevel + &#10;             &quot; (window: &quot; + MODULATION_WINDOWS[currentLevel] + &quot;%, &quot; + &#10;             getModulationWindowDuration(currentLevel) + &quot; ms)&quot;);&#10;}&#10;&#10;function processAnswer(Response) {&#10;    const reactionEndTime = performance.now();&#10;    const reactionTime = reactionEndTime - stimulusEndTime;&#10;    &#10;    logDebug(&quot;User answered: &quot; + (Response === 1 ? &quot;First&quot; : &quot;Second&quot;) + &#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Is replay: &quot; + isReplayTrial);&#10;    &#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    const isCorrect = (Response === CorrectAnswer);&#10;    &#10;    if (!isReplayTrial) {&#10;        const windowPercent = MODULATION_WINDOWS[currentLevel];&#10;        const windowDuration = getModulationWindowDuration(currentLevel);&#10;        const modulationRate = getModulationRate(currentLevel);&#10;        const slope = getModulationSlope(currentLevel);&#10;        &#10;        const trialInfo = {&#10;            trialNumber: numberOfIterations,&#10;            timestamp: getLocalTimestamp(),&#10;            difficultyLevel: currentLevel,&#10;            modulationWindowPercent: windowPercent,&#10;            modulationWindowDuration: windowDuration.toFixed(2),&#10;            modulationRate: modulationRate.toFixed(4),&#10;            slope: slope.toFixed(6),&#10;            userResponse: Response === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            correctResponse: CorrectAnswer === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            isCorrect: isCorrect,&#10;            reactionTime: reactionTime.toFixed(0),&#10;            isReversal: false,&#10;            stepDirection: Direction === DECREASING ? &quot;Increasing Difficulty&quot; : &quot;Decreasing Difficulty&quot;,&#10;            standardPosition: standardIsFirst ? &quot;First&quot; : &quot;Second&quot;&#10;        };&#10;        &#10;        trialRecords.push(trialInfo);&#10;    }&#10;    &#10;    if (isCorrect) {&#10;        logDebug(&quot;Correct answer&quot;);&#10;        document.getElementById('smile').src = &quot;Media/smiley.png&quot;;&#10;        document.getElementById('text1').value = &quot;正確！&quot;;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses++;&#10;            &#10;            if (CorrectResponses == 2) {&#10;                logDebug(&quot;Two correct answers in a row&quot;);&#10;                CorrectResponses = 0;&#10;                &#10;                if (Direction == INCREASING) {&#10;                    gotReversal();&#10;                    if (trialRecords.length &gt; 0) {&#10;                        trialRecords[trialRecords.length-1].isReversal = true;&#10;                    }&#10;                }&#10;                &#10;                changeLevel(DECREASING);&#10;            }&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            resetPage();&#10;        }, 1500);&#10;    } else {&#10;        logDebug(&quot;Incorrect answer - will replay stimulus&quot;);&#10;        document.getElementById('smile').src = &quot;Media/nosmiley.png&quot;;&#10;        &#10;        var correctAnswerText = CorrectAnswer === 1 ? &quot;第一個音&quot; : &quot;第二個音&quot;;&#10;        document.getElementById('text1').value = &quot;錯誤！正確答案是：&quot; + correctAnswerText;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses = 0;&#10;            &#10;            if (Direction == DECREASING) {&#10;                gotReversal();&#10;                if (trialRecords.length &gt; 0) {&#10;                    trialRecords[trialRecords.length-1].isReversal = true;&#10;                }&#10;            }&#10;            &#10;            changeLevel(INCREASING);&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            document.getElementById('text1').value = &quot;重播刺激音...&quot;;&#10;            &#10;            setTimeout(function() {&#10;                isReplayTrial = true;&#10;                &#10;                var xIsStandard = (standardIsFirst &amp;&amp; CorrectAnswer === 1) || &#10;                                  (!standardIsFirst &amp;&amp; CorrectAnswer === 2);&#10;                playABXSequence(xIsStandard);&#10;            }, 1000);&#10;        }, 2000);&#10;    }&#10;}&#10;&#10;function changeLevel(whichWay) {&#10;    var oldLevel = currentLevel;&#10;    var stepSize = NumberOfReversals &lt; 4 ? 2 : 1;&#10;    &#10;    if (whichWay == DECREASING) {&#10;        currentLevel = Math.min(9, currentLevel + stepSize);&#10;    } else {&#10;        currentLevel = Math.max(LOWERLIMIT, currentLevel - stepSize);&#10;    }&#10;    &#10;    logDebug(&quot;Difficulty changed from level &quot; + oldLevel + &quot; (&quot; + MODULATION_WINDOWS[oldLevel] + &quot;%, &quot; +&#10;             getModulationWindowDuration(oldLevel) + &quot; ms) to level &quot; + &#10;             currentLevel + &quot; (&quot; + MODULATION_WINDOWS[currentLevel] + &quot;%, &quot; +&#10;             getModulationWindowDuration(currentLevel) + &quot; ms) &quot; +&#10;             (whichWay == DECREASING ? &quot;(increasing difficulty)&quot; : &quot;(decreasing difficulty)&quot;));&#10;}&#10;&#10;function exportToCSV() {&#10;    const headers = [&#10;        &quot;Trial Number&quot;, &#10;        &quot;Timestamp&quot;, &#10;        &quot;Difficulty Level&quot;, &#10;        &quot;Modulation Window (%)&quot;,&#10;        &quot;Modulation Window (ms)&quot;,&#10;        &quot;Modulation Rate (semitones/s)&quot;,&#10;        &quot;Slope (semitones/ms)&quot;,&#10;        &quot;Standard Position&quot;,&#10;        &quot;User Response&quot;, &#10;        &quot;Correct Response&quot;, &#10;        &quot;Is Correct&quot;, &#10;        &quot;Reaction Time (ms)&quot;, &#10;        &quot;Is Reversal&quot;,&#10;        &quot;Step Direction&quot;&#10;    ];&#10;    &#10;    const csvRows = [];&#10;    csvRows.push(headers.join(&quot;,&quot;));&#10;    &#10;    trialRecords.forEach(function(trial) {&#10;        const row = [&#10;            trial.trialNumber,&#10;            trial.timestamp,&#10;            trial.difficultyLevel,&#10;            trial.modulationWindowPercent,&#10;            trial.modulationWindowDuration,&#10;            trial.modulationRate,&#10;            trial.slope,&#10;            trial.standardPosition,&#10;            trial.userResponse,&#10;            trial.correctResponse,&#10;            trial.isCorrect ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.reactionTime,&#10;            trial.isReversal ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.stepDirection&#10;        ];&#10;        csvRows.push(row.join(&quot;,&quot;));&#10;    });&#10;    &#10;    csvRows.push(&quot;\nRESULTS SUMMARY - JUST NOTICEABLE DIFFERENCE (JND)&quot;);&#10;    csvRows.push(&quot;\nJND Metrics&quot;);&#10;    csvRows.push(&quot;Parameter,Value,Unit,Description&quot;);&#10;    &#10;    const hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;&#10;    &#10;    csvRows.push(&quot;JND Absolute Difference,&quot; + &#10;        (hasData ? jndAbsoluteDifference.toFixed(2) : &quot;N/A&quot;) + &quot;,ms,Detectable difference from standard (smaller = better)&quot;);&#10;    &#10;    csvRows.push(&quot;JND Percentage Difference,&quot; + &#10;        (hasData ? jndPercentDifference.toFixed(2) : &quot;N/A&quot;) + &quot;,%,Percentage difference from standard (smaller = better)&quot;);&#10;    &#10;    csvRows.push(&quot;JND Ratio (Threshold/Standard),&quot; + &#10;        (hasData ? jndRatio.toFixed(4) : &quot;N/A&quot;) + &quot;,ratio,Threshold modulation window / Standard window&quot;);&#10;    &#10;    csvRows.push(&quot;Weber's Ratio,&quot; + &#10;        (hasData ? webersRatio.toFixed(4) : &quot;N/A&quot;) + &quot;,ratio,ΔI / I (smaller = better sensitivity)&quot;);&#10;    &#10;    csvRows.push(&quot;\nThreshold Parameters&quot;);&#10;    csvRows.push(&quot;Parameter,Value,Unit&quot;);&#10;    &#10;    csvRows.push(&quot;Standard Modulation Window,&quot; + STANDARD_WINDOW + &quot;,ms&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Modulation Window,&quot; + &#10;        (hasData ? thresholdWindowDuration.toFixed(2) : &quot;N/A&quot;) + &quot;,ms&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Window Percentage,&quot; + &#10;        (hasData ? thresholdWindowPercent.toFixed(2) : &quot;N/A&quot;) + &quot;,%&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Modulation Rate,&quot; + &#10;        (hasData ? thresholdModulationRate.toFixed(4) : &quot;N/A&quot;) + &quot;,semitones/s&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Slope,&quot; + &#10;        (hasData ? thresholdSlope.toFixed(6) : &quot;N/A&quot;) + &quot;,semitones/ms&quot;);&#10;    &#10;    csvRows.push(&quot;Average Difficulty Level,&quot; + &#10;        (hasData ? sentAverage.toFixed(2) : &quot;N/A&quot;) + &quot;,level (1-9)&quot;);&#10;    &#10;    csvRows.push(&quot;Difficulty Level SD,&quot; + &#10;        (hasData ? sentStdev.toFixed(2) : &quot;N/A&quot;) + &quot;,level&quot;);&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    csvRows.push(&quot;\nReaction Time Statistics&quot;);&#10;    csvRows.push(&quot;Mean,Median,Standard Deviation&quot;);&#10;    csvRows.push(rtStats.mean + &quot;,&quot; + rtStats.median + &quot;,&quot; + rtStats.sd);&#10;    &#10;    const accuracyStats = calculateAccuracyStats();&#10;    csvRows.push(&quot;\nAccuracy Statistics&quot;);&#10;    csvRows.push(&quot;Correct Responses,Total Responses,Percentage&quot;);&#10;    csvRows.push(accuracyStats.correct + &quot;,&quot; + accuracyStats.total + &quot;,&quot; + accuracyStats.percentage + &quot;%&quot;);&#10;    &#10;    csvRows.push(&quot;\nExperiment Parameters&quot;);&#10;    csvRows.push(&quot;Parameter,Value&quot;);&#10;    csvRows.push(&quot;Paradigm,ABX&quot;);&#10;    csvRows.push(&quot;Stimulus Type,Dynamic Pitch (Rising Tone)&quot;);&#10;    csvRows.push(&quot;Total Stimulus Duration,&quot; + STIMULUS_DURATION + &quot; ms&quot;);&#10;    csvRows.push(&quot;Standard Modulation Window,&quot; + STANDARD_WINDOW + &quot; ms&quot;);&#10;    csvRows.push(&quot;Pitch Rise Amount,&quot; + PITCH_RISE_SEMITONES + &quot; semitone(s)&quot;);&#10;    csvRows.push(&quot;Max Reversals,&quot; + MAXREVERSALS);&#10;    csvRows.push(&quot;Min Reversals for Calculation,&quot; + MINIMUMREVERSALS);&#10;    csvRows.push(&quot;Max Iterations,&quot; + MAXITERATIONS);&#10;    &#10;    csvRows.push(&quot;\nDifficulty Level Mapping&quot;);&#10;    csvRows.push(&quot;Level,Modulation Window (%),Modulation Window (ms),Difference from Standard (ms),Modulation Rate (semitones/s),Slope (semitones/ms)&quot;);&#10;    for (let level = 1; level &lt;= 9; level++) {&#10;        const windowPercent = MODULATION_WINDOWS[level];&#10;        const windowDuration = getModulationWindowDuration(level);&#10;        const diffFromStandard = STANDARD_WINDOW - windowDuration;&#10;        const rate = getModulationRate(level);&#10;        const slope = getModulationSlope(level);&#10;        csvRows.push(level + &quot;,&quot; + windowPercent + &quot;,&quot; + windowDuration.toFixed(2) + &quot;,&quot; + &#10;                     diffFromStandard.toFixed(2) + &quot;,&quot; + rate.toFixed(4) + &quot;,&quot; + slope.toFixed(6));&#10;    }&#10;    &#10;    const csvContent = &quot;data:text/csv;charset=utf-8,&quot; + csvRows.join(&quot;\n&quot;);&#10;    const encodedUri = encodeURI(csvContent);&#10;    const link = document.createElement(&quot;a&quot;);&#10;    const timestamp = new Date().toISOString().replace(/[:.]/g, &quot;-&quot;);&#10;    link.setAttribute(&quot;href&quot;, encodedUri);&#10;    link.setAttribute(&quot;download&quot;, &quot;dynamic_pitch_JND_ABX_data_&quot; + timestamp + &quot;.csv&quot;);&#10;    document.body.appendChild(link);&#10;    link.click();&#10;    document.body.removeChild(link);&#10;}&#10;&#10;function window_onload() {&#10;    window.name = &quot;EXP&quot;;&#10;    NumberOfReversals = 0;&#10;    numberOfIterations = 0;&#10;    CorrectResponses = 0;&#10;    Direction = DECREASING;&#10;    currentLevel = 5;&#10;    isTestComplete = false;&#10;    Reversals = [];&#10;    trialRecords = [];&#10;    isReplayTrial = false;&#10;    &#10;    jndAbsoluteDifference = 0;&#10;    jndRatio = 0;&#10;    jndPercentDifference = 0;&#10;    thresholdWindowDuration = 0;&#10;    thresholdWindowPercent = 0;&#10;    thresholdModulationRate = 0;&#10;    thresholdSlope = 0;&#10;    webersRatio = 0;&#10;&#10;    document.getElementById('text1').value = &quot;準備完畢後請點擊\&quot;開始實驗\&quot;&quot;;&#10;    document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;    document.getElementById('start').disabled = false;&#10;    document.getElementById('viewResult').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;    &#10;    updateProgressBar(0);&#10;    &#10;    logDebug(&quot;Page reset complete&quot;);&#10;}&#10;&#10;window.onload = function() {&#10;    window_onload();&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    logDebug(&quot;Preloading &quot; + allAudios.length + &quot; audio files&quot;);&#10;    &#10;    allAudios.forEach(function(audio) {&#10;        audio.load();&#10;    });&#10;    &#10;    document.getElementById('text1').value = &quot;請點擊\&quot;開始實驗\&quot;&quot;;&#10;    &#10;    window.onerror = function(message, source, lineno, colno, error) {&#10;        logDebug(&quot;Global error: &quot; + message + &quot; at &quot; + source + &quot;:&quot; + lineno);&#10;        return false;&#10;    };&#10;    &#10;    document.getElementById('showDebug').checked = true;&#10;    toggleDebug();&#10;};&#10;&lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
                    <entry key="file:///E:/Projects/Pitch_Training/ABX_rising_low.html" value="&lt;!DOCTYPE html&gt;&#10;&lt;html&gt;&#10;&lt;head&gt;&#10;    &lt;title&gt;PLOYU-Peng's Lab: Pitch Sensitivity Training&lt;/title&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;style&gt;&#10;        body {&#10;            font-family: Arial, sans-serif;&#10;            margin: 20px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .container {&#10;            max-width: 800px;&#10;            margin: 0 auto;&#10;            padding: 20px;&#10;            background-color: white;&#10;            border-radius: 10px;&#10;            box-shadow: 0 0 10px rgba(0,0,0,0.1);&#10;            display: flex;&#10;            flex-direction: column;&#10;            align-items: center;&#10;        }&#10;        .header {&#10;            text-align: center;&#10;            margin-bottom: 40px;&#10;            width: 100%;&#10;        }&#10;        .training-info {&#10;            font-size: 16px;&#10;            color: #555;&#10;            margin-top: 10px;&#10;            margin-bottom: 5px;&#10;            text-align: center;&#10;        }&#10;        .instruction-text {&#10;            font-size: 14px;&#10;            color: #777;&#10;            margin-bottom: 15px;&#10;            text-align: center;&#10;            font-style: italic;&#10;        }&#10;        .button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .prompt-text {&#10;            text-align: center;&#10;            font-size: 20px;&#10;            margin-bottom: 25px;&#10;            margin-top: 30px;&#10;            font-weight: bold;&#10;        }&#10;        .response-button {&#10;            width: 160px;&#10;            height: 160px;&#10;            font-size: 26px;&#10;            margin: 0 40px;&#10;            border-radius: 15px;&#10;            border: none;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.1);&#10;            transition: all 0.3s ease;&#10;        }&#10;        .response-button:hover:enabled {&#10;            transform: translateY(-3px);&#10;            box-shadow: 0 6px 12px rgba(0,0,0,0.15);&#10;        }&#10;        .response-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .button-playing {&#10;            animation: pulse 1s ease-in-out infinite;&#10;            box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            transform: scale(1.05);&#10;        }&#10;        @keyframes pulse {&#10;            0%, 100% {&#10;                box-shadow: 0 0 20px rgba(102, 204, 255, 0.8);&#10;            }&#10;            50% {&#10;                box-shadow: 0 0 30px rgba(102, 204, 255, 1);&#10;            }&#10;        }&#10;        .control-button-container {&#10;            display: flex;&#10;            justify-content: center;&#10;            gap: 30px;&#10;            margin: 30px 0;&#10;            width: 100%;&#10;        }&#10;        .control-button {&#10;            padding: 14px 28px;&#10;            font-size: 18px;&#10;            border-radius: 8px;&#10;            border: none;&#10;            background-color: #4CAF50;&#10;            color: white;&#10;            cursor: pointer;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .control-button:hover:enabled {&#10;            background-color: #3e8e41;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .control-button:active:enabled {&#10;            transform: translateY(1px);&#10;        }&#10;        .control-button:disabled {&#10;            background-color: #cccccc;&#10;            cursor: not-allowed;&#10;            box-shadow: none;&#10;        }&#10;        .feedback {&#10;            text-align: center;&#10;            height: 100px;&#10;            margin: 30px 0;&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;        }&#10;        .status {&#10;            width: 350px;&#10;            height: 68px;&#10;            text-align: center;&#10;            font-size: 18px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            margin: 0 auto;&#10;            padding: 10px;&#10;            background-color: #f9f9f9;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.05);&#10;        }&#10;        .debug-info {&#10;            font-size: 12px;&#10;            color: #777;&#10;            margin-top: 30px;&#10;            text-align: left;&#10;            display: none;&#10;            max-height: 300px;&#10;            overflow-y: auto;&#10;            border: 1px solid #ddd;&#10;            border-radius: 8px;&#10;            padding: 15px;&#10;            width: 100%;&#10;        }&#10;        .results-container {&#10;            display: none;&#10;            margin-top: 30px;&#10;            padding: 20px;&#10;            background-color: #f0f8ff;&#10;            border-radius: 8px;&#10;            box-shadow: 0 2px 4px rgba(0,0,0,0.1);&#10;            width: 100%;&#10;        }&#10;        .result-heading {&#10;            text-align: center;&#10;            margin-bottom: 20px;&#10;            color: #2c3e50;&#10;        }&#10;        .result-table {&#10;            width: 100%;&#10;            border-collapse: collapse;&#10;            margin-bottom: 20px;&#10;        }&#10;        .result-table th, .result-table td {&#10;            padding: 12px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .result-table th {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .result-table tr:nth-child(even) {&#10;            background-color: #f2f2f2;&#10;        }&#10;        .result-interpretation {&#10;            background-color: #e8f4f8;&#10;            padding: 15px;&#10;            border-radius: 5px;&#10;            margin-bottom: 20px;&#10;        }&#10;        .back-button {&#10;            display: block;&#10;            margin: 0 auto;&#10;            padding: 14px 28px;&#10;            background-color: #3498db;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;        }&#10;        .back-button:hover {&#10;            background-color: #2980b9;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .back-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        .chart-container {&#10;            height: 300px;&#10;            margin: 20px 0;&#10;            background-color: white;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;            padding: 10px;&#10;        }&#10;        .auxiliary-buttons {&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            margin-top: 30px;&#10;            gap: 20px;&#10;            flex-wrap: wrap;&#10;        }&#10;        .auxiliary-buttons button {&#10;            padding: 10px 15px;&#10;            border-radius: 5px;&#10;            border: 1px solid #ddd;&#10;            background-color: #f0f0f0;&#10;            cursor: pointer;&#10;            transition: all 0.2s ease;&#10;        }&#10;        .auxiliary-buttons button:hover {&#10;            background-color: #e0e0e0;&#10;        }&#10;        .diagnostic-overlay {&#10;            position: fixed;&#10;            top: 0;&#10;            left: 0;&#10;            width: 100%;&#10;            height: 100%;&#10;            background-color: rgba(0, 0, 0, 0.8);&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            z-index: 1000;&#10;            display: none;&#10;        }&#10;        .diagnostic-content {&#10;            width: 80%;&#10;            max-width: 700px;&#10;            max-height: 80%;&#10;            overflow-y: auto;&#10;            background-color: white;&#10;            padding: 20px;&#10;            border-radius: 8px;&#10;            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);&#10;        }&#10;        .diagnostic-heading {&#10;            text-align: center;&#10;            color: #e74c3c;&#10;            margin-bottom: 20px;&#10;            font-size: 24px;&#10;        }&#10;        .diagnostic-close {&#10;            float: right;&#10;            font-size: 20px;&#10;            cursor: pointer;&#10;            color: #777;&#10;        }&#10;        .diagnostic-close:hover {&#10;            color: #333;&#10;        }&#10;        .diagnostic-section {&#10;            margin-bottom: 15px;&#10;            padding: 10px;&#10;            border: 1px solid #ddd;&#10;            border-radius: 5px;&#10;        }&#10;        .diagnostic-actions {&#10;            text-align: center;&#10;            margin-top: 20px;&#10;        }&#10;        .diagnostic-action-button {&#10;            padding: 10px 20px;&#10;            margin: 0 10px;&#10;            border: none;&#10;            border-radius: 5px;&#10;            cursor: pointer;&#10;            font-weight: bold;&#10;        }&#10;        .retry-button {&#10;            background-color: #3498db;&#10;            color: white;&#10;        }&#10;        .retry-button:hover {&#10;            background-color: #2980b9;&#10;        }&#10;        .continue-button {&#10;            background-color: #2ecc71;&#10;            color: white;&#10;        }&#10;        .continue-button:hover {&#10;            background-color: #27ae60;&#10;        }&#10;        .diagnostic-file-status {&#10;            display: flex;&#10;            flex-wrap: wrap;&#10;            gap: 10px;&#10;        }&#10;        .file-status-item {&#10;            font-size: 12px;&#10;            padding: 5px 10px;&#10;            border-radius: 3px;&#10;            background-color: #f8f8f8;&#10;        }&#10;        .file-found {&#10;            color: #27ae60;&#10;            border-left: 3px solid #27ae60;&#10;        }&#10;        .file-missing {&#10;            color: #e74c3c;&#10;            border-left: 3px solid #e74c3c;&#10;        }&#10;        .statistics-table {&#10;            width: 100%;&#10;            margin: 10px 0;&#10;            border-collapse: collapse;&#10;        }&#10;        .statistics-table th, .statistics-table td {&#10;            padding: 8px;&#10;            text-align: center;&#10;            border: 1px solid #ddd;&#10;        }&#10;        .statistics-table th {&#10;            background-color: #f0f0f0;&#10;        }&#10;        .direction-stats-good {&#10;            color: #27ae60;&#10;        }&#10;        .direction-stats-warning {&#10;            color: #f39c12;&#10;        }&#10;        .direction-stats-bad {&#10;            color: #e74c3c;&#10;        }&#10;        @media (max-width: 600px) {&#10;            .response-button {&#10;                width: 130px;&#10;                height: 130px;&#10;                font-size: 22px;&#10;                margin: 0 20px;&#10;            }&#10;            .control-button {&#10;                padding: 12px 20px;&#10;            }&#10;        }&#10;        .print-button {&#10;            padding: 14px 28px;&#10;            margin: 20px auto;&#10;            background-color: #9b59b6;&#10;            color: white;&#10;            border: none;&#10;            border-radius: 8px;&#10;            cursor: pointer;&#10;            font-size: 18px;&#10;            box-shadow: 0 3px 5px rgba(0,0,0,0.1);&#10;            transition: all 0.2s ease;&#10;            display: block;&#10;        }&#10;        .print-button:hover {&#10;            background-color: #8e44ad;&#10;            transform: translateY(-2px);&#10;            box-shadow: 0 4px 8px rgba(0,0,0,0.15);&#10;        }&#10;        .print-button:active {&#10;            transform: translateY(1px);&#10;        }&#10;        @media print {&#10;            body {&#10;                background-color: white;&#10;                margin: 0;&#10;                padding: 0;&#10;            }&#10;            .container {&#10;                max-width: 100%;&#10;                box-shadow: none;&#10;                padding: 10px;&#10;            }&#10;            .back-button, .print-button, .auxiliary-buttons {&#10;                display: none;&#10;            }&#10;            .results-container {&#10;                display: block !important;&#10;                box-shadow: none;&#10;                background-color: white;&#10;                padding: 0;&#10;            }&#10;            .chart-container {&#10;                border: 1px solid #ddd;&#10;                background-color: white;&#10;            }&#10;            .result-table th {&#10;                background-color: #f0f0f0 !important;&#10;                color: black !important;&#10;            }&#10;            .result-interpretation {&#10;                background-color: white;&#10;                border: 1px solid #ddd;&#10;            }&#10;            * {&#10;                -webkit-print-color-adjust: exact !important;&#10;                print-color-adjust: exact !important;&#10;            }&#10;        }&#10;        .progress-bar-container {&#10;            width: 100%;&#10;            height: 20px;&#10;            background-color: #e0e0e0;&#10;            border-radius: 10px;&#10;            margin: 10px 0;&#10;            overflow: hidden;&#10;        }&#10;        .progress-bar {&#10;            height: 100%;&#10;            background-color: #4CAF50;&#10;            border-radius: 10px;&#10;            transition: width 0.3s ease;&#10;        }&#10;        .progress-label {&#10;            text-align: center;&#10;            font-size: 14px;&#10;            color: #555;&#10;            margin-top: 5px;&#10;        }&#10;        .highlight-box {&#10;            background-color: #fffacd;&#10;            border: 2px solid #ffd700;&#10;            padding: 15px;&#10;            border-radius: 8px;&#10;            margin: 20px 0;&#10;            text-align: center;&#10;        }&#10;        .highlight-value {&#10;            font-size: 28px;&#10;            font-weight: bold;&#10;            color: #e74c3c;&#10;            margin: 10px 0;&#10;        }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;    &lt;div class=&quot;container&quot;&gt;&#10;        &lt;div class=&quot;header&quot;&gt;&#10;            &lt;img src=&quot;Media/animation.gif&quot; alt=&quot;Experiment animation&quot;&gt;&#10;            &lt;div class=&quot;training-info&quot;&gt;Low Rising Tone Discrimination (ABX)&lt;/div&gt;&#10;            &lt;div class=&quot;instruction-text&quot;&gt;請判斷第三個音聽起來更像第一個還是第二個音&lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div id=&quot;experimentContainer&quot;&gt;&#10;            &lt;div class=&quot;control-button-container&quot;&gt;&#10;                &lt;input id=&quot;start&quot; type=&quot;button&quot; value=&quot;開始實驗&quot; onclick=&quot;start_onclick()&quot; class=&quot;control-button&quot;&gt;&#10;                &lt;input id=&quot;viewResult&quot; type=&quot;button&quot; value=&quot;查看結果&quot; onclick=&quot;view_onclick()&quot; class=&quot;control-button&quot; disabled&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;prompt-text&quot; id=&quot;promptText&quot;&gt;&#10;                第三個音更像...&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;firstBtn&quot; type=&quot;button&quot; value=&quot;第一個音&quot; onclick=&quot;processAnswer(1)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;                &lt;input id=&quot;secondBtn&quot; type=&quot;button&quot; value=&quot;第二個音&quot; onclick=&quot;processAnswer(2)&quot; disabled &#10;                    class=&quot;response-button&quot; style=&quot;background:#FF6666;&quot;&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;feedback&quot;&gt;&#10;                &lt;img id=&quot;smile&quot; src=&quot;Media/null.gif&quot; width=&quot;100&quot; height=&quot;84&quot; alt=&quot;Feedback&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;button-container&quot;&gt;&#10;                &lt;input id=&quot;text1&quot; class=&quot;status&quot; readonly&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;progress-bar-container&quot;&gt;&#10;                &lt;div class=&quot;progress-bar&quot; id=&quot;progressBar&quot; style=&quot;width: 0%&quot;&gt;&lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div class=&quot;progress-label&quot; id=&quot;progressLabel&quot;&gt;Progress: 0%&lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;debug-info&quot; id=&quot;debugInfo&quot;&gt;&#10;                Debug information will be displayed here&#10;            &lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot;&gt;&#10;                &lt;label&gt;&lt;input type=&quot;checkbox&quot; id=&quot;showDebug&quot; onclick=&quot;toggleDebug()&quot;&gt; Show Debug Info&lt;/label&gt;&#10;                &lt;button onclick=&quot;testAudio()&quot;&gt;Test All Audio&lt;/button&gt;&#10;                &lt;button onclick=&quot;showDiagnostics()&quot;&gt;Diagnostics&lt;/button&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot; id=&quot;exportBtn&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div id=&quot;resultsContainer&quot; class=&quot;results-container&quot;&gt;&#10;            &lt;h2 class=&quot;result-heading&quot;&gt;Dynamic Pitch Discrimination Test Results (ABX)&lt;/h2&gt;&#10;            &#10;            &lt;div class=&quot;highlight-box&quot;&gt;&#10;                &lt;h3 style=&quot;margin-top: 0;&quot;&gt;Just Noticeable Difference (JND)&lt;/h3&gt;&#10;                &lt;div class=&quot;highlight-value&quot; id=&quot;jndValue&quot;&gt;--&lt;/div&gt;&#10;                &lt;p style=&quot;margin-bottom: 0; font-size: 14px; color: #666;&quot;&gt;&#10;                    This represents the minimum detectable difference in modulation window duration&lt;br&gt;&#10;                    &lt;strong&gt;Smaller JND = Better discrimination ability&lt;/strong&gt;&#10;                &lt;/p&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Perceptual Discrimination Thresholds&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Parameter&lt;/th&gt;&#10;                        &lt;th&gt;Standard (Reference)&lt;/th&gt;&#10;                        &lt;th&gt;Threshold (Your JND)&lt;/th&gt;&#10;                        &lt;th&gt;Difference Ratio&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;resultTableBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;div class=&quot;result-interpretation&quot; id=&quot;resultInterpretation&quot;&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;h3&gt;Detailed Threshold Metrics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Metric&lt;/th&gt;&#10;                        &lt;th&gt;Value&lt;/th&gt;&#10;                        &lt;th&gt;Interpretation&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;detailedMetricsBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;h3&gt;Performance Statistics&lt;/h3&gt;&#10;            &lt;table class=&quot;result-table&quot;&gt;&#10;                &lt;thead&gt;&#10;                    &lt;tr&gt;&#10;                        &lt;th&gt;Metric&lt;/th&gt;&#10;                        &lt;th&gt;Value&lt;/th&gt;&#10;                    &lt;/tr&gt;&#10;                &lt;/thead&gt;&#10;                &lt;tbody id=&quot;performanceStatsBody&quot;&gt;&#10;                &lt;/tbody&gt;&#10;            &lt;/table&gt;&#10;            &#10;            &lt;button class=&quot;print-button&quot; onclick=&quot;printResults()&quot;&gt;Print Results&lt;/button&gt;&#10;            &#10;            &lt;div class=&quot;auxiliary-buttons&quot; style=&quot;margin-top: 20px;&quot;&gt;&#10;                &lt;button onclick=&quot;exportToCSV()&quot;&gt;Export Data (CSV)&lt;/button&gt;&#10;            &lt;/div&gt;&#10;            &#10;            &lt;button class=&quot;back-button&quot; onclick=&quot;backToExperiment()&quot;&gt;Back to Experiment&lt;/button&gt;&#10;        &lt;/div&gt;&#10;        &#10;        &lt;div class=&quot;diagnostic-overlay&quot; id=&quot;diagnosticOverlay&quot;&gt;&#10;            &lt;div class=&quot;diagnostic-content&quot;&gt;&#10;                &lt;span class=&quot;diagnostic-close&quot; onclick=&quot;closeDiagnostics()&quot;&gt;&amp;times;&lt;/span&gt;&#10;                &lt;h2 class=&quot;diagnostic-heading&quot;&gt;Experiment Diagnostics&lt;/h2&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Test Status&lt;/h3&gt;&#10;                    &lt;table class=&quot;statistics-table&quot;&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;th&gt;Trials&lt;/th&gt;&#10;                            &lt;th&gt;Reversals&lt;/th&gt;&#10;                            &lt;th&gt;Status&lt;/th&gt;&#10;                        &lt;/tr&gt;&#10;                        &lt;tr&gt;&#10;                            &lt;td id=&quot;totalTrials&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;totalReversals&quot;&gt;0&lt;/td&gt;&#10;                            &lt;td id=&quot;testStatus&quot;&gt;Not started&lt;/td&gt;&#10;                        &lt;/tr&gt;&#10;                    &lt;/table&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Audio Files Check&lt;/h3&gt;&#10;                    &lt;p&gt;Verifying necessary audio files:&lt;/p&gt;&#10;                    &lt;div id=&quot;audioFileStatus&quot; class=&quot;diagnostic-file-status&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Reversal History&lt;/h3&gt;&#10;                    &lt;div id=&quot;reversalHistory&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-section&quot;&gt;&#10;                    &lt;h3&gt;Recommendations&lt;/h3&gt;&#10;                    &lt;div id=&quot;diagnosticRecommendations&quot;&gt;&#10;                    &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &#10;                &lt;div class=&quot;diagnostic-actions&quot;&gt;&#10;                    &lt;button class=&quot;diagnostic-action-button continue-button&quot; onclick=&quot;closeDiagnostics()&quot;&gt;Close&lt;/button&gt;&#10;                &lt;/div&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;audio id=&quot;low_rising_standard&quot; src=&quot;Media/low_rising_standard.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;    &lt;audio id=&quot;low_rising_1&quot; src=&quot;Media/low_rising_1.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_rising_2&quot; src=&quot;Media/low_rising_2.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_rising_3&quot; src=&quot;Media/low_rising_3.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_rising_4&quot; src=&quot;Media/low_rising_4.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_rising_5&quot; src=&quot;Media/low_rising_5.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_rising_6&quot; src=&quot;Media/low_rising_6.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_rising_7&quot; src=&quot;Media/low_rising_7.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_rising_8&quot; src=&quot;Media/low_rising_8.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;    &lt;audio id=&quot;low_rising_9&quot; src=&quot;Media/low_rising_9.wav&quot; preload=&quot;auto&quot;&gt;&lt;/audio&gt;&#10;&#10;&lt;script&gt;&#10;function getLocalTimestamp() {&#10;    const now = new Date();&#10;    const year = now.getFullYear();&#10;    const month = String(now.getMonth() + 1).padStart(2, '0');&#10;    const day = String(now.getDate()).padStart(2, '0');&#10;    const hours = String(now.getHours()).padStart(2, '0');&#10;    const minutes = String(now.getMinutes()).padStart(2, '0');&#10;    const seconds = String(now.getSeconds()).padStart(2, '0');&#10;    const milliseconds = String(now.getMilliseconds()).padStart(3, '0');&#10;    &#10;    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}.${milliseconds}`;&#10;}&#10;&#10;// Stimulus parameters for dynamic pitch modulation&#10;const STIMULUS_DURATION = 450; // ms, total duration&#10;const STANDARD_WINDOW = 400; // ms, modulation window for standard (100%)&#10;const STANDARD_WINDOW_PERCENT = 100; // percentage&#10;&#10;// Modulation window percentages for each difficulty level&#10;const MODULATION_WINDOWS = {&#10;    1: 20,   // easiest - 20% of standard window (80 ms)&#10;    2: 40,   // 160 ms&#10;    3: 50,   // 200 ms&#10;    4: 60,   // 240 ms&#10;    5: 70,   // 280 ms&#10;    6: 80,   // 320 ms&#10;    7: 90,   // 360 ms&#10;    8: 95,   // 380 ms&#10;    9: 98    // hardest - 98% of standard window (392 ms)&#10;};&#10;&#10;function getModulationWindowDuration(level) {&#10;    return (MODULATION_WINDOWS[level] / 100) * STANDARD_WINDOW;&#10;}&#10;&#10;const PITCH_RISE_SEMITONES = 1.0;&#10;&#10;function getModulationRate(level) {&#10;    const windowDuration = getModulationWindowDuration(level);&#10;    const windowDurationSec = windowDuration / 1000;&#10;    return PITCH_RISE_SEMITONES / windowDurationSec;&#10;}&#10;&#10;function getModulationSlope(level) {&#10;    const windowDuration = getModulationWindowDuration(level);&#10;    return PITCH_RISE_SEMITONES / windowDuration;&#10;}&#10;&#10;// Adaptive threshold experiment constants&#10;const MAXREVERSALS = 10;&#10;const MAXITERATIONS = 50;&#10;const LOWERLIMIT = 1;&#10;const DECREASING = -1;&#10;const INCREASING = 1;&#10;const MINIMUMREVERSALS = 6;&#10;const THRESHOLD_REVERSAL_COUNT = 6;&#10;&#10;// Experiment state variables&#10;var CorrectAnswer;&#10;var CorrectResponses = 0;&#10;var Direction = DECREASING;&#10;var Reversals = [];&#10;var NumberOfReversals = 0;&#10;var currentLevel = 5;&#10;var numberOfIterations = 0;&#10;var sentAverage = 0.0;&#10;var sentStdev = 0.0;&#10;var isTestComplete = false;&#10;var audioUnlocked = false;&#10;var allFilesPresent = true;&#10;var trialRecords = [];&#10;var stimulusEndTime = 0;&#10;&#10;// ABX variables&#10;var standardIsFirst;&#10;var comparisonSound;&#10;var standardSound;&#10;var xSound;&#10;&#10;var isReplayTrial = false;&#10;&#10;// Results variables - JND-based&#10;var jndAbsoluteDifference = 0;&#10;var jndRatio = 0;&#10;var jndPercentDifference = 0;&#10;var thresholdWindowDuration = 0;&#10;var thresholdWindowPercent = 0;&#10;var thresholdModulationRate = 0;&#10;var thresholdSlope = 0;&#10;var webersRatio = 0;&#10;&#10;function printResults() {&#10;    window.print();&#10;}&#10;&#10;function logDebug(message) {&#10;    console.log(message);&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var now = new Date();&#10;    var timeStr = now.getHours() + ':' + now.getMinutes() + ':' + now.getSeconds() + '.' + now.getMilliseconds();&#10;    debugArea.innerHTML += '&lt;p&gt;[' + timeStr + '] ' + message + '&lt;/p&gt;';&#10;    debugArea.scrollTop = debugArea.scrollHeight;&#10;}&#10;&#10;function toggleDebug() {&#10;    var debugArea = document.getElementById('debugInfo');&#10;    var checkbox = document.getElementById('showDebug');&#10;    debugArea.style.display = checkbox.checked ? 'block' : 'none';&#10;}&#10;&#10;function showDiagnostics() {&#10;    updateDiagnostics();&#10;    document.getElementById('diagnosticOverlay').style.display = 'flex';&#10;}&#10;&#10;function closeDiagnostics() {&#10;    document.getElementById('diagnosticOverlay').style.display = 'none';&#10;}&#10;&#10;function updateDiagnostics() {&#10;    document.getElementById('totalTrials').innerText = numberOfIterations;&#10;    document.getElementById('totalReversals').innerText = NumberOfReversals;&#10;    &#10;    let testStatus = getTestStatus();&#10;    document.getElementById('testStatus').innerText = testStatus.text;&#10;    document.getElementById('testStatus').className = `direction-stats-${testStatus.class}`;&#10;    &#10;    checkAudioFiles();&#10;    &#10;    let reversalHistoryHtml = '';&#10;    if (Reversals.length === 0) {&#10;        reversalHistoryHtml += '&lt;p&gt;No reversals recorded yet&lt;/p&gt;';&#10;    } else {&#10;        reversalHistoryHtml += '&lt;p&gt;Reversals at difficulty levels: ' + Reversals.join(', ') + '&lt;/p&gt;';&#10;        reversalHistoryHtml += '&lt;p&gt;Corresponding modulation windows: ';&#10;        reversalHistoryHtml += Reversals.map(level =&gt; MODULATION_WINDOWS[level] + '% (' + getModulationWindowDuration(level) + ' ms)').join(', ') + '&lt;/p&gt;';&#10;    }&#10;    &#10;    document.getElementById('reversalHistory').innerHTML = reversalHistoryHtml;&#10;    &#10;    generateDiagnosticRecommendations();&#10;}&#10;&#10;function getTestStatus() {&#10;    if (isTestComplete) {&#10;        return { text: &quot;Complete&quot;, class: &quot;good&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals &lt; 1) {&#10;        return { text: &quot;Not enough data&quot;, class: &quot;bad&quot; };&#10;    }&#10;    &#10;    if (NumberOfReversals &lt; MINIMUMREVERSALS) {&#10;        return { text: &quot;Incomplete (&quot; + NumberOfReversals + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals)&quot;, class: &quot;warning&quot; };&#10;    }&#10;    &#10;    return { text: &quot;In progress&quot;, class: &quot;good&quot; };&#10;}&#10;&#10;function checkAudioFiles() {&#10;    const requiredFiles = [&#10;        &quot;low_rising_standard&quot;,&#10;        &quot;low_rising_1&quot;, &quot;low_rising_2&quot;, &quot;low_rising_3&quot;, &quot;low_rising_4&quot;, &quot;low_rising_5&quot;, &#10;        &quot;low_rising_6&quot;, &quot;low_rising_7&quot;, &quot;low_rising_8&quot;, &quot;low_rising_9&quot;&#10;    ];&#10;    &#10;    let statusHtml = '';&#10;    allFilesPresent = true;&#10;    &#10;    requiredFiles.forEach(function(fileId) {&#10;        const audioElement = document.getElementById(fileId);&#10;        const fileFound = audioElement !== null;&#10;        &#10;        if (!fileFound) {&#10;            allFilesPresent = false;&#10;        }&#10;        &#10;        statusHtml += `&lt;div class=&quot;file-status-item ${fileFound ? 'file-found' : 'file-missing'}&quot;&gt;${fileId}: ${fileFound ? 'Found' : 'Missing'}&lt;/div&gt;`;&#10;    });&#10;    &#10;    document.getElementById('audioFileStatus').innerHTML = statusHtml;&#10;}&#10;&#10;function generateDiagnosticRecommendations() {&#10;    let recommendations = '';&#10;    let hasIssues = false;&#10;    &#10;    if (!allFilesPresent) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Critical Issue:&lt;/strong&gt; Some required audio files are missing. Please ensure all files are properly loaded.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (numberOfIterations &gt;= MAXITERATIONS &amp;&amp; NumberOfReversals &lt; MINIMUMREVERSALS) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Issue:&lt;/strong&gt; Reached maximum trials but has insufficient reversals. This might indicate audio file issues or participant response patterns.&lt;/p&gt;';&#10;        hasIssues = true;&#10;    }&#10;    &#10;    if (!hasIssues) {&#10;        recommendations += '&lt;p&gt;&lt;strong&gt;Good:&lt;/strong&gt; No major issues detected with the experiment setup.&lt;/p&gt;';&#10;        &#10;        if (isTestComplete) {&#10;            recommendations += '&lt;p&gt;Test is complete.&lt;/p&gt;';&#10;        } else {&#10;            recommendations += '&lt;p&gt;Test is still in progress.&lt;/p&gt;';&#10;        }&#10;    }&#10;    &#10;    document.getElementById('diagnosticRecommendations').innerHTML = recommendations;&#10;}&#10;&#10;function testAudio() {&#10;    logDebug(&quot;Starting to test all audio files...&quot;);&#10;    var audios = document.querySelectorAll('audio');&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    var index = 0;&#10;    function playNext() {&#10;        if (index &gt;= audios.length) {&#10;            logDebug(&quot;All audio testing complete!&quot;);&#10;            return;&#10;        }&#10;        &#10;        var audio = audios[index];&#10;        logDebug(&quot;Testing audio #&quot; + (index + 1) + &quot;: &quot; + audio.id);&#10;        &#10;        audio.currentTime = 0;&#10;        &#10;        var playPromise = audio.play();&#10;        if (playPromise !== undefined) {&#10;            playPromise.then(function() {&#10;                logDebug(audio.id + &quot; played successfully&quot;);&#10;                &#10;                audio.onended = function() {&#10;                    logDebug(audio.id + &quot; playback ended&quot;);&#10;                    index++;&#10;                    setTimeout(playNext, 500);&#10;                };&#10;            }).catch(function(error) {&#10;                logDebug(&quot;Failed to play &quot; + audio.id + &quot;: &quot; + error);&#10;                index++;&#10;                setTimeout(playNext, 500);&#10;            });&#10;        }&#10;    }&#10;    &#10;    playNext();&#10;}&#10;&#10;function unlockAudioContext() {&#10;    logDebug(&quot;Attempting to unlock audio context...&quot;);&#10;    &#10;    var silentAudio = new Audio();&#10;    silentAudio.src = &quot;data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA&quot;;&#10;    &#10;    var promise = silentAudio.play();&#10;    if (promise !== undefined) {&#10;        promise.then(function() {&#10;            logDebug(&quot;Audio context unlocked successfully&quot;);&#10;            silentAudio.remove();&#10;            audioUnlocked = true;&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to unlock audio context: &quot; + error);&#10;        });&#10;    }&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    for (var i = 0; i &lt; allAudios.length; i++) {&#10;        var audio = allAudios[i];&#10;        audio.load();&#10;    }&#10;    &#10;    logDebug(&quot;Preloaded &quot; + allAudios.length + &quot; audio files&quot;);&#10;}&#10;&#10;function resetPage() {&#10;    numberOfIterations++;&#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('firstBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('secondBtn').style.background = &quot;#FF6666&quot;;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    if (isTestComplete) {&#10;        document.getElementById('start').disabled = false;&#10;        document.getElementById('viewResult').disabled = false;&#10;        document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;        updateProgressBar(100);&#10;        return;&#10;    }&#10;    &#10;    if ((numberOfIterations &gt;= MAXITERATIONS) || (NumberOfReversals &gt;= MAXREVERSALS)) {&#10;        if (NumberOfReversals &gt;= MINIMUMREVERSALS) {&#10;            calculateResults();&#10;            isTestComplete = true;&#10;            document.getElementById('start').disabled = false;&#10;            document.getElementById('viewResult').disabled = false;&#10;            document.getElementById('text1').value = &quot;實驗結束！&quot;;&#10;            updateProgressBar(100);&#10;        } else {&#10;            logDebug(&quot;Reached max iterations but has only &quot; + NumberOfReversals + &quot;/&quot; + MINIMUMREVERSALS + &quot; reversals. Showing diagnostics.&quot;);&#10;            document.getElementById('text1').value = &quot;Insufficient data. Check diagnostics.&quot;;&#10;            setTimeout(function() {&#10;                showDiagnostics();&#10;            }, 500);&#10;            return;&#10;        }&#10;    } else {&#10;        updateProgressBar();&#10;        beginIteration();&#10;    }&#10;}&#10;&#10;function updateProgressBar(forcePercent) {&#10;    if (typeof forcePercent === 'number') {&#10;        document.getElementById('progressBar').style.width = forcePercent + '%';&#10;        document.getElementById('progressLabel').textContent = 'Progress: ' + forcePercent + '%';&#10;        return;&#10;    }&#10;    &#10;    const maxValue = Math.max(MAXREVERSALS, MAXITERATIONS);&#10;    const currentValue = isTestComplete ? maxValue : Math.max(NumberOfReversals, numberOfIterations);&#10;    const totalPercent = Math.min(100 * (currentValue / maxValue), 100);&#10;    &#10;    document.getElementById('progressBar').style.width = totalPercent + '%';&#10;    document.getElementById('progressLabel').textContent = 'Progress: ' + Math.round(totalPercent) + '%';&#10;}&#10;&#10;function calculateResults() {&#10;    let sum = 0.0, stddevsum = 0.0, average = 0.0, stdev = 0.0, counter = 0;&#10;    &#10;    for (let i = 0; i &lt; Reversals.length; i++) {&#10;        if (Reversals[i] &gt; 0) counter++;&#10;    }&#10;    &#10;    if (counter &lt; MINIMUMREVERSALS) {&#10;        logDebug(&quot;Test has insufficient data&quot;);&#10;        alert(&quot;Test has insufficient data. Please complete the test again.&quot;);&#10;        return;&#10;    }&#10;    &#10;    const startIndex = Math.max(0, NumberOfReversals - THRESHOLD_REVERSAL_COUNT);&#10;    counter = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0) {&#10;            sum += level;&#10;            counter++;&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 0) {&#10;        average = sum / counter;&#10;        average = parseFloat(average.toFixed(2));&#10;    }&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0) {&#10;            stddevsum += Math.pow(level - average, 2);&#10;        }&#10;    }&#10;    &#10;    if (counter &gt; 1) {&#10;        stdev = Math.sqrt(stddevsum / (counter - 1));&#10;        stdev = parseFloat(stdev.toFixed(2));&#10;    }&#10;    &#10;    sentAverage = average;&#10;    sentStdev = stdev;&#10;    &#10;    thresholdWindowPercent = calculateAverageWindowPercent(startIndex);&#10;    thresholdWindowDuration = (thresholdWindowPercent / 100) * STANDARD_WINDOW;&#10;    thresholdModulationRate = PITCH_RISE_SEMITONES / (thresholdWindowDuration / 1000);&#10;    thresholdSlope = PITCH_RISE_SEMITONES / thresholdWindowDuration;&#10;    &#10;    jndAbsoluteDifference = STANDARD_WINDOW - thresholdWindowDuration;&#10;    jndRatio = thresholdWindowDuration / STANDARD_WINDOW;&#10;    jndPercentDifference = 100 - thresholdWindowPercent;&#10;    webersRatio = jndAbsoluteDifference / STANDARD_WINDOW;&#10;    &#10;    logDebug(&quot;Test complete! Average difficulty level: &quot; + average.toFixed(2));&#10;    logDebug(&quot;Threshold window: &quot; + thresholdWindowPercent.toFixed(2) + &quot;% (&quot; + thresholdWindowDuration.toFixed(2) + &quot; ms)&quot;);&#10;    logDebug(&quot;JND Absolute Difference: &quot; + jndAbsoluteDifference.toFixed(2) + &quot; ms&quot;);&#10;    logDebug(&quot;JND Ratio: &quot; + jndRatio.toFixed(4));&#10;    logDebug(&quot;JND Percent Difference: &quot; + jndPercentDifference.toFixed(2) + &quot;%&quot;);&#10;    logDebug(&quot;Weber's Ratio: &quot; + webersRatio.toFixed(4));&#10;    &#10;    document.getElementById('text1').value = &quot;Test complete! JND: &quot; + jndAbsoluteDifference.toFixed(1) + &quot; ms&quot;;&#10;}&#10;&#10;function calculateAverageWindowPercent(startIndex) {&#10;    let sum = 0;&#10;    let count = 0;&#10;    &#10;    for (let i = startIndex; i &lt; Reversals.length; i++) {&#10;        const level = Reversals[i];&#10;        if (level &gt; 0 &amp;&amp; MODULATION_WINDOWS[level] !== undefined) {&#10;            sum += MODULATION_WINDOWS[level];&#10;            count++;&#10;        }&#10;    }&#10;    &#10;    return count &gt; 0 ? sum / count : 0;&#10;}&#10;&#10;function calculateReactionTimeStats() {&#10;    let allRTs = trialRecords.map(t =&gt; parseFloat(t.reactionTime));&#10;    &#10;    return {&#10;        mean: allRTs.length ? (allRTs.reduce((a, b) =&gt; a + b, 0) / allRTs.length).toFixed(0) : &quot;N/A&quot;,&#10;        median: allRTs.length ? calculateMedian(allRTs).toFixed(0) : &quot;N/A&quot;,&#10;        sd: allRTs.length &gt; 1 ? calculateSD(allRTs).toFixed(0) : &quot;N/A&quot;&#10;    };&#10;}&#10;&#10;function calculateAccuracyStats() {&#10;    let allTrials = trialRecords;&#10;    &#10;    return {&#10;        correct: allTrials.filter(t =&gt; t.isCorrect).length,&#10;        total: allTrials.length,&#10;        percentage: allTrials.length ? &#10;            (allTrials.filter(t =&gt; t.isCorrect).length / allTrials.length * 100).toFixed(1) : &quot;N/A&quot;&#10;    };&#10;}&#10;&#10;function calculateMedian(values) {&#10;    if (!values.length) return 0;&#10;    &#10;    const sortedValues = values.slice().sort((a, b) =&gt; a - b);&#10;    const mid = Math.floor(sortedValues.length / 2);&#10;    &#10;    return sortedValues.length % 2 === 0 ? &#10;        (sortedValues[mid - 1] + sortedValues[mid]) / 2 : &#10;        sortedValues[mid];&#10;}&#10;&#10;function calculateSD(values) {&#10;    if (values.length &lt;= 1) return 0;&#10;    &#10;    const mean = values.reduce((a, b) =&gt; a + b, 0) / values.length;&#10;    const variance = values.map(x =&gt; Math.pow(x - mean, 2)).reduce((a, b) =&gt; a + b, 0) / (values.length - 1);&#10;    &#10;    return Math.sqrt(variance);&#10;}&#10;&#10;function displayResults() {&#10;    logDebug(&quot;Displaying results&quot;);&#10;    &#10;    let hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;&#10;    &#10;    if (!hasData) {&#10;        let message = &quot;Warning: Insufficient data. Results may not be reliable.&quot;;&#10;        &#10;        if (confirm(message + &quot;\n\nWould you like to retry the experiment?&quot;)) {&#10;            window_onload();&#10;            return;&#10;        }&#10;    }&#10;    &#10;    document.getElementById('experimentContainer').style.display = 'none';&#10;    document.getElementById('resultsContainer').style.display = 'block';&#10;    &#10;    if (hasData) {&#10;        document.getElementById('jndValue').innerHTML = &#10;            jndAbsoluteDifference.toFixed(2) + ' ms&lt;br&gt;' +&#10;            '&lt;span style=&quot;font-size: 18px;&quot;&gt;(' + jndPercentDifference.toFixed(2) + '% difference from standard)&lt;/span&gt;';&#10;    } else {&#10;        document.getElementById('jndValue').textContent = 'Insufficient Data';&#10;    }&#10;    &#10;    var tableBody = document.getElementById('resultTableBody');&#10;    tableBody.innerHTML = '';&#10;    &#10;    var windowRow = document.createElement('tr');&#10;    windowRow.innerHTML = &#10;        '&lt;td&gt;Modulation Window Duration&lt;/td&gt;' +&#10;        '&lt;td&gt;' + STANDARD_WINDOW + ' ms (100%)&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? thresholdWindowDuration.toFixed(2) + ' ms (' + thresholdWindowPercent.toFixed(2) + '%)' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? jndRatio.toFixed(4) + ' : 1&lt;br&gt;(Threshold/Standard)' : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(windowRow);&#10;    &#10;    var diffRow = document.createElement('tr');&#10;    diffRow.innerHTML = &#10;        '&lt;td&gt;Absolute Difference (JND)&lt;/td&gt;' +&#10;        '&lt;td&gt;0 ms (reference)&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? jndAbsoluteDifference.toFixed(2) + ' ms' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? 'Weber Ratio: ' + webersRatio.toFixed(4) : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(diffRow);&#10;    &#10;    var rateStandard = PITCH_RISE_SEMITONES / (STANDARD_WINDOW / 1000);&#10;    var rateRow = document.createElement('tr');&#10;    rateRow.innerHTML = &#10;        '&lt;td&gt;Modulation Rate&lt;/td&gt;' +&#10;        '&lt;td&gt;' + rateStandard.toFixed(4) + ' semitones/s&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? thresholdModulationRate.toFixed(4) + ' semitones/s' : 'N/A') + '&lt;/td&gt;' +&#10;        '&lt;td&gt;' + (hasData ? (thresholdModulationRate / rateStandard).toFixed(4) + ' : 1' : 'N/A') + '&lt;/td&gt;';&#10;    tableBody.appendChild(rateRow);&#10;    &#10;    var interpretation = document.getElementById('resultInterpretation');&#10;    let interpretationHtml = '&lt;h3 style=&quot;margin-top: 0;&quot;&gt;Performance Interpretation&lt;/h3&gt;';&#10;    &#10;    if (hasData) {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Your Just Noticeable Difference (JND):&lt;/strong&gt;&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;You can reliably detect a difference when the modulation window changes by &lt;strong&gt;' + &#10;            jndAbsoluteDifference.toFixed(2) + ' ms&lt;/strong&gt; (or &lt;strong&gt;' + jndPercentDifference.toFixed(2) + &#10;            '%&lt;/strong&gt; of the standard 400 ms window).&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;In other words, you can discriminate between:&lt;/p&gt;';&#10;        interpretationHtml += '&lt;ul&gt;';&#10;        interpretationHtml += '&lt;li&gt;Standard stimulus: 400 ms modulation window&lt;/li&gt;';&#10;        interpretationHtml += '&lt;li&gt;Your threshold: ' + thresholdWindowDuration.toFixed(2) + ' ms modulation window&lt;/li&gt;';&#10;        interpretationHtml += '&lt;li&gt;Difference: ' + jndAbsoluteDifference.toFixed(2) + ' ms&lt;/li&gt;';&#10;        interpretationHtml += '&lt;/ul&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Weber\'s Ratio:&lt;/strong&gt; ' + webersRatio.toFixed(4) + &#10;            ' (smaller Weber\'s ratio = better discrimination sensitivity)&lt;/p&gt;';&#10;        &#10;        interpretationHtml += '&lt;p&gt;&lt;em&gt;Note: A &lt;strong&gt;smaller JND&lt;/strong&gt; indicates &lt;strong&gt;better sensitivity&lt;/strong&gt; to dynamic pitch changes, ' +&#10;            'as it means you can detect smaller differences between stimuli.&lt;/em&gt;&lt;/p&gt;';&#10;    } else {&#10;        interpretationHtml += '&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Complete results not available due to insufficient data.&lt;/p&gt;';&#10;    }&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    const accuracyStats = calculateAccuracyStats();&#10;    &#10;    interpretationHtml += '&lt;p&gt;&lt;strong&gt;Overall Performance:&lt;/strong&gt; ' + accuracyStats.percentage + &#10;        '% accuracy with average reaction time of ' + rtStats.mean + ' ms across ' + &#10;        accuracyStats.total + ' trials.&lt;/p&gt;';&#10;    &#10;    interpretation.innerHTML = interpretationHtml;&#10;    &#10;    var detailedBody = document.getElementById('detailedMetricsBody');&#10;    detailedBody.innerHTML = '';&#10;    &#10;    var metrics = [&#10;        { name: 'Average Difficulty Level', value: hasData ? sentAverage.toFixed(2) : 'N/A', interp: hasData ? 'SD: ' + sentStdev.toFixed(2) : 'N/A' },&#10;        { name: 'Threshold Slope', value: hasData ? thresholdSlope.toFixed(6) + ' semitones/ms' : 'N/A', interp: hasData ? 'Rate of pitch change' : 'N/A' },&#10;        { name: 'Number of Reversals', value: NumberOfReversals, interp: 'Minimum required: ' + MINIMUMREVERSALS },&#10;        { name: 'Total Trials', value: numberOfIterations, interp: 'Maximum allowed: ' + MAXITERATIONS }&#10;    ];&#10;    &#10;    metrics.forEach(function(metric) {&#10;        var row = document.createElement('tr');&#10;        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;&lt;td&gt;' + metric.interp + '&lt;/td&gt;';&#10;        detailedBody.appendChild(row);&#10;    });&#10;    &#10;    var perfBody = document.getElementById('performanceStatsBody');&#10;    perfBody.innerHTML = '';&#10;    &#10;    var perfMetrics = [&#10;        { name: 'Total Trials', value: accuracyStats.total },&#10;        { name: 'Correct Responses', value: accuracyStats.correct },&#10;        { name: 'Overall Accuracy', value: accuracyStats.percentage + '%' },&#10;        { name: 'Mean Reaction Time', value: rtStats.mean + ' ms' },&#10;        { name: 'Median Reaction Time', value: rtStats.median + ' ms' },&#10;        { name: 'RT Standard Deviation', value: rtStats.sd + ' ms' }&#10;    ];&#10;    &#10;    perfMetrics.forEach(function(metric) {&#10;        var row = document.createElement('tr');&#10;        row.innerHTML = '&lt;td&gt;' + metric.name + '&lt;/td&gt;&lt;td&gt;' + metric.value + '&lt;/td&gt;';&#10;        perfBody.appendChild(row);&#10;    });&#10;}&#10;&#10;function backToExperiment() {&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;}&#10;&#10;function view_onclick() {&#10;    logDebug(&quot;View results button clicked&quot;);&#10;    &#10;    if (!isTestComplete &amp;&amp; NumberOfReversals &gt;= MINIMUMREVERSALS) {&#10;        calculateResults();&#10;        isTestComplete = true;&#10;    }&#10;    &#10;    displayResults();&#10;}&#10;&#10;function beginIteration() {&#10;    isReplayTrial = false;&#10;    &#10;    standardIsFirst = Math.random() &lt; 0.5;&#10;    var xIsStandard = Math.random() &lt; 0.5;&#10;    &#10;    if (xIsStandard) {&#10;        CorrectAnswer = standardIsFirst ? 1 : 2;&#10;    } else {&#10;        CorrectAnswer = standardIsFirst ? 2 : 1;&#10;    }&#10;    &#10;    logDebug(&quot;Starting new iteration #&quot; + numberOfIterations + &#10;             &quot;, Standard is &quot; + (standardIsFirst ? &quot;first&quot; : &quot;second&quot;) +&#10;             &quot;, X is &quot; + (xIsStandard ? &quot;standard&quot; : &quot;comparison&quot;) +&#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Difficulty level: &quot; + currentLevel +&#10;             &quot;, Modulation window: &quot; + MODULATION_WINDOWS[currentLevel] + &quot;% (&quot; + &#10;             getModulationWindowDuration(currentLevel) + &quot; ms)&quot;);&#10;    &#10;    setTimeout(function() {&#10;        playABXSequence(xIsStandard);&#10;    }, 1000);&#10;}&#10;&#10;function clearButtonAnimations() {&#10;    document.getElementById('firstBtn').classList.remove('button-playing');&#10;    document.getElementById('secondBtn').classList.remove('button-playing');&#10;}&#10;&#10;function playABXSequence(xIsStandard) {&#10;    logDebug(&quot;Playing ABX sequence&quot;);&#10;    &#10;    clearButtonAnimations();&#10;&#10;    standardSound = document.getElementById('low_rising_standard');&#10;    comparisonSound = document.getElementById(&quot;low_rising_&quot; + currentLevel);&#10;&#10;    xSound = xIsStandard ? standardSound : comparisonSound;&#10;    &#10;    if (!standardSound || !comparisonSound) {&#10;        logDebug(&quot;Error: Cannot find audio elements!&quot;);&#10;        document.getElementById('text1').value = &quot;出錯：找不到音頻文件&quot;;&#10;        setTimeout(function() {&#10;            showDiagnostics();&#10;        }, 1000);&#10;        return;&#10;    }&#10;    &#10;    var firstSound = standardIsFirst ? standardSound : comparisonSound;&#10;    document.getElementById('text1').value = &quot;播放第一個音&quot;;&#10;    &#10;    document.getElementById('firstBtn').classList.add('button-playing');&#10;    &#10;    firstSound.currentTime = 0;&#10;    var playPromise1 = firstSound.play();&#10;    &#10;    if (playPromise1 !== undefined) {&#10;        playPromise1.then(function() {&#10;            logDebug(&quot;First sound (A) played successfully&quot;);&#10;            &#10;            firstSound.onended = function() {&#10;                logDebug(&quot;First sound ended&quot;);&#10;                &#10;                document.getElementById('firstBtn').classList.remove('button-playing');&#10;                &#10;                setTimeout(function() {&#10;                    var secondSound = standardIsFirst ? comparisonSound : standardSound;&#10;                    document.getElementById('text1').value = &quot;播放第二個音&quot;;&#10;                    &#10;                    document.getElementById('secondBtn').classList.add('button-playing');&#10;                    &#10;                    secondSound.currentTime = 0;&#10;                    var playPromise2 = secondSound.play();&#10;                    &#10;                    if (playPromise2 !== undefined) {&#10;                        playPromise2.then(function() {&#10;                            logDebug(&quot;Second sound (B) played successfully&quot;);&#10;                            &#10;                            secondSound.onended = function() {&#10;                                logDebug(&quot;Second sound ended&quot;);&#10;                                &#10;                                document.getElementById('secondBtn').classList.remove('button-playing');&#10;                                &#10;                                setTimeout(function() {&#10;                                    document.getElementById('text1').value = &quot;播放第三個音&quot;;&#10;                                    &#10;                                    xSound.currentTime = 0;&#10;                                    var playPromise3 = xSound.play();&#10;                                    &#10;                                    if (playPromise3 !== undefined) {&#10;                                        playPromise3.then(function() {&#10;                                            logDebug(&quot;Third sound (X) played successfully&quot;);&#10;                                            &#10;                                            xSound.onended = function() {&#10;                                                logDebug(&quot;Third sound ended, enabling response buttons&quot;);&#10;                                                &#10;                                                stimulusEndTime = performance.now();&#10;                                                &#10;                                                document.getElementById('text1').value = &quot;請作出選擇&quot;;&#10;                                                document.getElementById('promptText').style.visibility = 'visible';&#10;                                                &#10;                                                document.getElementById('firstBtn').disabled = false;&#10;                                                document.getElementById('secondBtn').disabled = false;&#10;                                                document.getElementById('firstBtn').style.background = &quot;#66CCFF&quot;;&#10;                                                document.getElementById('secondBtn').style.background = &quot;#66CCFF&quot;;&#10;                                            };&#10;                                        }).catch(function(error) {&#10;                                            logDebug(&quot;Failed to play third sound: &quot; + error);&#10;                                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                                            clearButtonAnimations();&#10;                                            setTimeout(showDiagnostics, 1000);&#10;                                        });&#10;                                    }&#10;                                }, 1000);&#10;                            };&#10;                        }).catch(function(error) {&#10;                            logDebug(&quot;Failed to play second sound: &quot; + error);&#10;                            document.getElementById('text1').value = &quot;音頻播放錯誤&quot;;&#10;                            clearButtonAnimations();&#10;                            setTimeout(showDiagnostics, 1000);&#10;                        });&#10;                    }&#10;                }, 1000);&#10;            };&#10;        }).catch(function(error) {&#10;            logDebug(&quot;Failed to play first sound: &quot; + error);&#10;            document.getElementById('text1').value = &quot;音頻播放錯誤，請刷新頁面&quot;;&#10;            clearButtonAnimations();&#10;            setTimeout(showDiagnostics, 1000);&#10;        });&#10;    }&#10;}&#10;&#10;function start_onclick() {&#10;    logDebug(&quot;Starting experiment&quot;);&#10;    &#10;    if (!audioUnlocked) {&#10;        unlockAudioContext();&#10;    }&#10;    &#10;    checkAudioFiles();&#10;    if (!allFilesPresent) {&#10;        logDebug(&quot;Cannot start experiment: Some audio files are missing&quot;);&#10;        document.getElementById('text1').value = &quot;音頻缺失&quot;;&#10;        showDiagnostics();&#10;        return;&#10;    }&#10;    &#10;    window_onload();&#10;    document.getElementById('text1').value = &quot;開始實驗...&quot;;&#10;    updateProgressBar(0);&#10;    &#10;    setTimeout(function() {&#10;        beginIteration();&#10;        document.getElementById('start').disabled = true;&#10;        document.getElementById('viewResult').disabled = true;&#10;        document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;        document.getElementById('promptText').style.visibility = 'hidden';&#10;    }, 1000);&#10;}&#10;&#10;function gotReversal() {&#10;    NumberOfReversals++;&#10;    Reversals[NumberOfReversals - 1] = currentLevel;&#10;    Direction = -Direction;&#10;    logDebug(&quot;Recorded reversal #&quot; + NumberOfReversals + &quot; at difficulty &quot; + currentLevel + &#10;             &quot; (window: &quot; + MODULATION_WINDOWS[currentLevel] + &quot;%, &quot; + &#10;             getModulationWindowDuration(currentLevel) + &quot; ms)&quot;);&#10;}&#10;&#10;function processAnswer(Response) {&#10;    const reactionEndTime = performance.now();&#10;    const reactionTime = reactionEndTime - stimulusEndTime;&#10;    &#10;    logDebug(&quot;User answered: &quot; + (Response === 1 ? &quot;First&quot; : &quot;Second&quot;) + &#10;             &quot;, Correct answer: &quot; + (CorrectAnswer === 1 ? &quot;First&quot; : &quot;Second&quot;) +&#10;             &quot;, Is replay: &quot; + isReplayTrial);&#10;    &#10;    document.getElementById('firstBtn').disabled = true;&#10;    document.getElementById('secondBtn').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    &#10;    const isCorrect = (Response === CorrectAnswer);&#10;    &#10;    if (!isReplayTrial) {&#10;        const windowPercent = MODULATION_WINDOWS[currentLevel];&#10;        const windowDuration = getModulationWindowDuration(currentLevel);&#10;        const modulationRate = getModulationRate(currentLevel);&#10;        const slope = getModulationSlope(currentLevel);&#10;        &#10;        const trialInfo = {&#10;            trialNumber: numberOfIterations,&#10;            timestamp: getLocalTimestamp(),&#10;            difficultyLevel: currentLevel,&#10;            modulationWindowPercent: windowPercent,&#10;            modulationWindowDuration: windowDuration.toFixed(2),&#10;            modulationRate: modulationRate.toFixed(4),&#10;            slope: slope.toFixed(6),&#10;            userResponse: Response === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            correctResponse: CorrectAnswer === 1 ? &quot;First Tone&quot; : &quot;Second Tone&quot;,&#10;            isCorrect: isCorrect,&#10;            reactionTime: reactionTime.toFixed(0),&#10;            isReversal: false,&#10;            stepDirection: Direction === DECREASING ? &quot;Increasing Difficulty&quot; : &quot;Decreasing Difficulty&quot;,&#10;            standardPosition: standardIsFirst ? &quot;First&quot; : &quot;Second&quot;&#10;        };&#10;        &#10;        trialRecords.push(trialInfo);&#10;    }&#10;    &#10;    if (isCorrect) {&#10;        logDebug(&quot;Correct answer&quot;);&#10;        document.getElementById('smile').src = &quot;Media/smiley.png&quot;;&#10;        document.getElementById('text1').value = &quot;正確！&quot;;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses++;&#10;            &#10;            if (CorrectResponses == 2) {&#10;                logDebug(&quot;Two correct answers in a row&quot;);&#10;                CorrectResponses = 0;&#10;                &#10;                if (Direction == INCREASING) {&#10;                    gotReversal();&#10;                    if (trialRecords.length &gt; 0) {&#10;                        trialRecords[trialRecords.length-1].isReversal = true;&#10;                    }&#10;                }&#10;                &#10;                changeLevel(DECREASING);&#10;            }&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            resetPage();&#10;        }, 1500);&#10;    } else {&#10;        logDebug(&quot;Incorrect answer - will replay stimulus&quot;);&#10;        document.getElementById('smile').src = &quot;Media/nosmiley.png&quot;;&#10;        &#10;        var correctAnswerText = CorrectAnswer === 1 ? &quot;第一個音&quot; : &quot;第二個音&quot;;&#10;        document.getElementById('text1').value = &quot;錯誤！正確答案是：&quot; + correctAnswerText;&#10;        &#10;        if (!isReplayTrial) {&#10;            CorrectResponses = 0;&#10;            &#10;            if (Direction == DECREASING) {&#10;                gotReversal();&#10;                if (trialRecords.length &gt; 0) {&#10;                    trialRecords[trialRecords.length-1].isReversal = true;&#10;                }&#10;            }&#10;            &#10;            changeLevel(INCREASING);&#10;        }&#10;        &#10;        setTimeout(function() {&#10;            document.getElementById(&quot;smile&quot;).src = 'Media/null.gif';&#10;            document.getElementById('text1').value = &quot;重播刺激音...&quot;;&#10;            &#10;            setTimeout(function() {&#10;                isReplayTrial = true;&#10;                &#10;                var xIsStandard = (standardIsFirst &amp;&amp; CorrectAnswer === 1) || &#10;                                  (!standardIsFirst &amp;&amp; CorrectAnswer === 2);&#10;                playABXSequence(xIsStandard);&#10;            }, 1000);&#10;        }, 2000);&#10;    }&#10;}&#10;&#10;function changeLevel(whichWay) {&#10;    var oldLevel = currentLevel;&#10;    var stepSize = NumberOfReversals &lt; 4 ? 2 : 1;&#10;    &#10;    if (whichWay == DECREASING) {&#10;        currentLevel = Math.min(9, currentLevel + stepSize);&#10;    } else {&#10;        currentLevel = Math.max(LOWERLIMIT, currentLevel - stepSize);&#10;    }&#10;    &#10;    logDebug(&quot;Difficulty changed from level &quot; + oldLevel + &quot; (&quot; + MODULATION_WINDOWS[oldLevel] + &quot;%, &quot; +&#10;             getModulationWindowDuration(oldLevel) + &quot; ms) to level &quot; + &#10;             currentLevel + &quot; (&quot; + MODULATION_WINDOWS[currentLevel] + &quot;%, &quot; +&#10;             getModulationWindowDuration(currentLevel) + &quot; ms) &quot; +&#10;             (whichWay == DECREASING ? &quot;(increasing difficulty)&quot; : &quot;(decreasing difficulty)&quot;));&#10;}&#10;&#10;function exportToCSV() {&#10;    const headers = [&#10;        &quot;Trial Number&quot;, &#10;        &quot;Timestamp&quot;, &#10;        &quot;Difficulty Level&quot;, &#10;        &quot;Modulation Window (%)&quot;,&#10;        &quot;Modulation Window (ms)&quot;,&#10;        &quot;Modulation Rate (semitones/s)&quot;,&#10;        &quot;Slope (semitones/ms)&quot;,&#10;        &quot;Standard Position&quot;,&#10;        &quot;User Response&quot;, &#10;        &quot;Correct Response&quot;, &#10;        &quot;Is Correct&quot;, &#10;        &quot;Reaction Time (ms)&quot;, &#10;        &quot;Is Reversal&quot;,&#10;        &quot;Step Direction&quot;&#10;    ];&#10;    &#10;    const csvRows = [];&#10;    csvRows.push(headers.join(&quot;,&quot;));&#10;    &#10;    trialRecords.forEach(function(trial) {&#10;        const row = [&#10;            trial.trialNumber,&#10;            trial.timestamp,&#10;            trial.difficultyLevel,&#10;            trial.modulationWindowPercent,&#10;            trial.modulationWindowDuration,&#10;            trial.modulationRate,&#10;            trial.slope,&#10;            trial.standardPosition,&#10;            trial.userResponse,&#10;            trial.correctResponse,&#10;            trial.isCorrect ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.reactionTime,&#10;            trial.isReversal ? &quot;1&quot; : &quot;0&quot;,&#10;            trial.stepDirection&#10;        ];&#10;        csvRows.push(row.join(&quot;,&quot;));&#10;    });&#10;    &#10;    csvRows.push(&quot;\nRESULTS SUMMARY - JUST NOTICEABLE DIFFERENCE (JND)&quot;);&#10;    csvRows.push(&quot;\nJND Metrics&quot;);&#10;    csvRows.push(&quot;Parameter,Value,Unit,Description&quot;);&#10;    &#10;    const hasData = NumberOfReversals &gt;= MINIMUMREVERSALS;&#10;    &#10;    csvRows.push(&quot;JND Absolute Difference,&quot; + &#10;        (hasData ? jndAbsoluteDifference.toFixed(2) : &quot;N/A&quot;) + &quot;,ms,Detectable difference from standard (smaller = better)&quot;);&#10;    &#10;    csvRows.push(&quot;JND Percentage Difference,&quot; + &#10;        (hasData ? jndPercentDifference.toFixed(2) : &quot;N/A&quot;) + &quot;,%,Percentage difference from standard (smaller = better)&quot;);&#10;    &#10;    csvRows.push(&quot;JND Ratio (Threshold/Standard),&quot; + &#10;        (hasData ? jndRatio.toFixed(4) : &quot;N/A&quot;) + &quot;,ratio,Threshold modulation window / Standard window&quot;);&#10;    &#10;    csvRows.push(&quot;Weber's Ratio,&quot; + &#10;        (hasData ? webersRatio.toFixed(4) : &quot;N/A&quot;) + &quot;,ratio,ΔI / I (smaller = better sensitivity)&quot;);&#10;    &#10;    csvRows.push(&quot;\nThreshold Parameters&quot;);&#10;    csvRows.push(&quot;Parameter,Value,Unit&quot;);&#10;    &#10;    csvRows.push(&quot;Standard Modulation Window,&quot; + STANDARD_WINDOW + &quot;,ms&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Modulation Window,&quot; + &#10;        (hasData ? thresholdWindowDuration.toFixed(2) : &quot;N/A&quot;) + &quot;,ms&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Window Percentage,&quot; + &#10;        (hasData ? thresholdWindowPercent.toFixed(2) : &quot;N/A&quot;) + &quot;,%&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Modulation Rate,&quot; + &#10;        (hasData ? thresholdModulationRate.toFixed(4) : &quot;N/A&quot;) + &quot;,semitones/s&quot;);&#10;    &#10;    csvRows.push(&quot;Threshold Slope,&quot; + &#10;        (hasData ? thresholdSlope.toFixed(6) : &quot;N/A&quot;) + &quot;,semitones/ms&quot;);&#10;    &#10;    csvRows.push(&quot;Average Difficulty Level,&quot; + &#10;        (hasData ? sentAverage.toFixed(2) : &quot;N/A&quot;) + &quot;,level (1-9)&quot;);&#10;    &#10;    csvRows.push(&quot;Difficulty Level SD,&quot; + &#10;        (hasData ? sentStdev.toFixed(2) : &quot;N/A&quot;) + &quot;,level&quot;);&#10;    &#10;    const rtStats = calculateReactionTimeStats();&#10;    csvRows.push(&quot;\nReaction Time Statistics&quot;);&#10;    csvRows.push(&quot;Mean,Median,Standard Deviation&quot;);&#10;    csvRows.push(rtStats.mean + &quot;,&quot; + rtStats.median + &quot;,&quot; + rtStats.sd);&#10;    &#10;    const accuracyStats = calculateAccuracyStats();&#10;    csvRows.push(&quot;\nAccuracy Statistics&quot;);&#10;    csvRows.push(&quot;Correct Responses,Total Responses,Percentage&quot;);&#10;    csvRows.push(accuracyStats.correct + &quot;,&quot; + accuracyStats.total + &quot;,&quot; + accuracyStats.percentage + &quot;%&quot;);&#10;    &#10;    csvRows.push(&quot;\nExperiment Parameters&quot;);&#10;    csvRows.push(&quot;Parameter,Value&quot;);&#10;    csvRows.push(&quot;Paradigm,ABX&quot;);&#10;    csvRows.push(&quot;Stimulus Type,Dynamic Pitch (Rising Tone)&quot;);&#10;    csvRows.push(&quot;Total Stimulus Duration,&quot; + STIMULUS_DURATION + &quot; ms&quot;);&#10;    csvRows.push(&quot;Standard Modulation Window,&quot; + STANDARD_WINDOW + &quot; ms&quot;);&#10;    csvRows.push(&quot;Pitch Rise Amount,&quot; + PITCH_RISE_SEMITONES + &quot; semitone(s)&quot;);&#10;    csvRows.push(&quot;Max Reversals,&quot; + MAXREVERSALS);&#10;    csvRows.push(&quot;Min Reversals for Calculation,&quot; + MINIMUMREVERSALS);&#10;    csvRows.push(&quot;Max Iterations,&quot; + MAXITERATIONS);&#10;    &#10;    csvRows.push(&quot;\nDifficulty Level Mapping&quot;);&#10;    csvRows.push(&quot;Level,Modulation Window (%),Modulation Window (ms),Difference from Standard (ms),Modulation Rate (semitones/s),Slope (semitones/ms)&quot;);&#10;    for (let level = 1; level &lt;= 9; level++) {&#10;        const windowPercent = MODULATION_WINDOWS[level];&#10;        const windowDuration = getModulationWindowDuration(level);&#10;        const diffFromStandard = STANDARD_WINDOW - windowDuration;&#10;        const rate = getModulationRate(level);&#10;        const slope = getModulationSlope(level);&#10;        csvRows.push(level + &quot;,&quot; + windowPercent + &quot;,&quot; + windowDuration.toFixed(2) + &quot;,&quot; + &#10;                     diffFromStandard.toFixed(2) + &quot;,&quot; + rate.toFixed(4) + &quot;,&quot; + slope.toFixed(6));&#10;    }&#10;    &#10;    const csvContent = &quot;data:text/csv;charset=utf-8,&quot; + csvRows.join(&quot;\n&quot;);&#10;    const encodedUri = encodeURI(csvContent);&#10;    const link = document.createElement(&quot;a&quot;);&#10;    const timestamp = new Date().toISOString().replace(/[:.]/g, &quot;-&quot;);&#10;    link.setAttribute(&quot;href&quot;, encodedUri);&#10;    link.setAttribute(&quot;download&quot;, &quot;dynamic_pitch_JND_ABX_data_&quot; + timestamp + &quot;.csv&quot;);&#10;    document.body.appendChild(link);&#10;    link.click();&#10;    document.body.removeChild(link);&#10;}&#10;&#10;function window_onload() {&#10;    window.name = &quot;EXP&quot;;&#10;    NumberOfReversals = 0;&#10;    numberOfIterations = 0;&#10;    CorrectResponses = 0;&#10;    Direction = DECREASING;&#10;    currentLevel = 5;&#10;    isTestComplete = false;&#10;    Reversals = [];&#10;    trialRecords = [];&#10;    isReplayTrial = false;&#10;    &#10;    jndAbsoluteDifference = 0;&#10;    jndRatio = 0;&#10;    jndPercentDifference = 0;&#10;    thresholdWindowDuration = 0;&#10;    thresholdWindowPercent = 0;&#10;    thresholdModulationRate = 0;&#10;    thresholdSlope = 0;&#10;    webersRatio = 0;&#10;&#10;    document.getElementById('text1').value = &quot;準備完畢後請點擊\&quot;開始實驗\&quot;&quot;;&#10;    document.getElementById('smile').src = &quot;Media/null.gif&quot;;&#10;    document.getElementById('start').disabled = false;&#10;    document.getElementById('viewResult').disabled = true;&#10;    document.getElementById('promptText').style.visibility = 'hidden';&#10;    document.getElementById('experimentContainer').style.display = 'block';&#10;    document.getElementById('resultsContainer').style.display = 'none';&#10;    &#10;    updateProgressBar(0);&#10;    &#10;    logDebug(&quot;Page reset complete&quot;);&#10;}&#10;&#10;window.onload = function() {&#10;    window_onload();&#10;    &#10;    var allAudios = document.querySelectorAll('audio');&#10;    logDebug(&quot;Preloading &quot; + allAudios.length + &quot; audio files&quot;);&#10;    &#10;    allAudios.forEach(function(audio) {&#10;        audio.load();&#10;    });&#10;    &#10;    document.getElementById('text1').value = &quot;請點擊\&quot;開始實驗\&quot;&quot;;&#10;    &#10;    window.onerror = function(message, source, lineno, colno, error) {&#10;        logDebug(&quot;Global error: &quot; + message + &quot; at &quot; + source + &quot;:&quot; + lineno);&#10;        return false;&#10;    };&#10;    &#10;    document.getElementById('showDebug').checked = true;&#10;    toggleDebug();&#10;};&#10;&lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
                    <entry key="file:///E:/Projects/Pitch_Training/index.html" value="&lt;!DOCTYPE html&gt;&#10;&lt;html lang=&quot;zh-CN&quot;&gt;&#10;&lt;head&gt;&#10;    &lt;meta charset=&quot;UTF-8&quot;&gt;&#10;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;&#10;    &lt;title&gt;PLOYU-Peng's Lab: 音高敏感度训练系统&lt;/title&gt;&#10;    &lt;style&gt;&#10;        * {&#10;            margin: 0;&#10;            padding: 0;&#10;            box-sizing: border-box;&#10;        }&#10;&#10;        body {&#10;            font-family: 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif;&#10;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&#10;            min-height: 100vh;&#10;            display: flex;&#10;            justify-content: center;&#10;            align-items: center;&#10;            padding: 20px;&#10;        }&#10;&#10;        .container {&#10;            max-width: 1200px;&#10;            width: 100%;&#10;            background: white;&#10;            border-radius: 20px;&#10;            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);&#10;            overflow: hidden;&#10;        }&#10;&#10;        .header {&#10;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&#10;            color: white;&#10;            padding: 40px;&#10;            text-align: center;&#10;        }&#10;&#10;        .header h1 {&#10;            font-size: 36px;&#10;            margin-bottom: 10px;&#10;            font-weight: 600;&#10;        }&#10;&#10;        .header p {&#10;            font-size: 18px;&#10;            opacity: 0.9;&#10;        }&#10;&#10;        .content {&#10;            padding: 40px;&#10;        }&#10;&#10;        .intro {&#10;            text-align: center;&#10;            margin-bottom: 40px;&#10;            color: #555;&#10;        }&#10;&#10;        .intro h2 {&#10;            color: #333;&#10;            margin-bottom: 15px;&#10;            font-size: 28px;&#10;        }&#10;&#10;        .intro p {&#10;            font-size: 16px;&#10;            line-height: 1.6;&#10;            max-width: 800px;&#10;            margin: 0 auto;&#10;        }&#10;&#10;        .experiments-grid {&#10;            display: grid;&#10;            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));&#10;            gap: 25px;&#10;            margin-top: 30px;&#10;        }&#10;&#10;        .experiment-card {&#10;            background: #f8f9fa;&#10;            border-radius: 15px;&#10;            padding: 30px;&#10;            text-align: center;&#10;            transition: all 0.3s ease;&#10;            border: 2px solid transparent;&#10;            cursor: pointer;&#10;            position: relative;&#10;            overflow: hidden;&#10;        }&#10;&#10;        .experiment-card::before {&#10;            content: '';&#10;            position: absolute;&#10;            top: 0;&#10;            left: 0;&#10;            width: 100%;&#10;            height: 5px;&#10;            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);&#10;            transform: scaleX(0);&#10;            transition: transform 0.3s ease;&#10;        }&#10;&#10;        .experiment-card:hover {&#10;            transform: translateY(-5px);&#10;            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);&#10;            border-color: #667eea;&#10;        }&#10;&#10;        .experiment-card:hover::before {&#10;            transform: scaleX(1);&#10;        }&#10;&#10;        .experiment-icon {&#10;            font-size: 48px;&#10;            margin-bottom: 15px;&#10;        }&#10;&#10;        .experiment-card h3 {&#10;            color: #333;&#10;            font-size: 22px;&#10;            margin-bottom: 10px;&#10;        }&#10;&#10;        .experiment-card p {&#10;            color: #666;&#10;            font-size: 14px;&#10;            margin-bottom: 20px;&#10;            line-height: 1.5;&#10;        }&#10;&#10;        .experiment-card .btn {&#10;            display: inline-block;&#10;            padding: 12px 30px;&#10;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);&#10;            color: white;&#10;            text-decoration: none;&#10;            border-radius: 25px;&#10;            font-weight: 600;&#10;            transition: all 0.3s ease;&#10;            border: none;&#10;            cursor: pointer;&#10;            font-size: 16px;&#10;        }&#10;&#10;        .experiment-card .btn:hover {&#10;            transform: scale(1.05);&#10;            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);&#10;        }&#10;&#10;        .info-section {&#10;            background: #e8f4f8;&#10;            border-radius: 15px;&#10;            padding: 30px;&#10;            margin-top: 40px;&#10;        }&#10;&#10;        .info-section h3 {&#10;            color: #2c3e50;&#10;            margin-bottom: 15px;&#10;            font-size: 24px;&#10;        }&#10;&#10;        .info-section ul {&#10;            list-style: none;&#10;            padding-left: 0;&#10;        }&#10;&#10;        .info-section li {&#10;            padding: 10px 0;&#10;            color: #555;&#10;            font-size: 15px;&#10;            line-height: 1.6;&#10;        }&#10;&#10;        .info-section li::before {&#10;            content: &quot;✓&quot;;&#10;            color: #667eea;&#10;            font-weight: bold;&#10;            margin-right: 10px;&#10;        }&#10;&#10;        .footer {&#10;            text-align: center;&#10;            padding: 20px;&#10;            color: #999;&#10;            font-size: 14px;&#10;            border-top: 1px solid #eee;&#10;        }&#10;&#10;        @media (max-width: 768px) {&#10;            .header h1 {&#10;                font-size: 28px;&#10;            }&#10;&#10;            .header p {&#10;                font-size: 16px;&#10;            }&#10;&#10;            .experiments-grid {&#10;                grid-template-columns: 1fr;&#10;            }&#10;&#10;            .content {&#10;                padding: 20px;&#10;            }&#10;        }&#10;&#10;        .badge {&#10;            display: inline-block;&#10;            padding: 5px 12px;&#10;            background: #667eea;&#10;            color: white;&#10;            border-radius: 12px;&#10;            font-size: 12px;&#10;            font-weight: 600;&#10;            margin-top: 10px;&#10;        }&#10;&#10;        .rising { background: #3498db; }&#10;        .falling { background: #e74c3c; }&#10;    &lt;/style&gt;&#10;&lt;/head&gt;&#10;&lt;body&gt;&#10;&lt;div class=&quot;container&quot;&gt;&#10;    &lt;div class=&quot;header&quot;&gt;&#10;        &lt;h1&gt; PLOYU-Peng's Lab&lt;/h1&gt;&#10;        &lt;p&gt;音高敏感度训练系统 - Pitch Sensitivity Training System&lt;/p&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;content&quot;&gt;&#10;        &lt;div class=&quot;intro&quot;&gt;&#10;            &lt;h2&gt;欢迎来到音高辨别实验平台&lt;/h2&gt;&#10;            &lt;p&gt;&#10;                本系统采用ABX范式进行动态音高敏感度训练与测试。通过自适应阈值实验，&#10;                精确测量您对不同音高变化模式的辨别能力（Just Noticeable Difference, JND）。&#10;                请选择以下任一实验开始您的音高感知训练。&#10;            &lt;/p&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div class=&quot;experiments-grid&quot;&gt;&#10;            &lt;div class=&quot;experiment-card&quot; onclick=&quot;window.location.href='ABX_rising_low.html'&quot;&gt;&#10;                &lt;div class=&quot;experiment-icon&quot;&gt;&lt;/div&gt;&#10;                &lt;h3&gt;动态音高辨别-低升调&lt;/h3&gt;&#10;                &lt;span class=&quot;badge rising&quot;&gt;Rising Tone&lt;/span&gt;&#10;                &lt;p&gt;测试对低音区升调变化的敏感度。通过调节调制窗口时长，评估您对缓慢音高上升的辨别能力。&lt;/p&gt;&#10;                &lt;a href=&quot;ABX_rising_low.html&quot; class=&quot;btn&quot; onclick=&quot;event.stopPropagation()&quot;&gt;开始实验&lt;/a&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;experiment-card&quot; onclick=&quot;window.location.href='ABX_rising_high.html'&quot;&gt;&#10;                &lt;div class=&quot;experiment-icon&quot;&gt;&lt;/div&gt;&#10;                &lt;h3&gt;动态音高辨别-高升调&lt;/h3&gt;&#10;                &lt;span class=&quot;badge rising&quot;&gt;Rising Tone&lt;/span&gt;&#10;                &lt;p&gt;测试对高音区升调变化的敏感度。评估您在高频范围内对音高上升的感知精度。&lt;/p&gt;&#10;                &lt;a href=&quot;ABX_rising_high.html&quot; class=&quot;btn&quot; onclick=&quot;event.stopPropagation()&quot;&gt;开始实验&lt;/a&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;experiment-card&quot; onclick=&quot;window.location.href='ABX_falling_low.html'&quot;&gt;&#10;                &lt;div class=&quot;experiment-icon&quot;&gt;&lt;/div&gt;&#10;                &lt;h3&gt;动态音高辨别-低降调&lt;/h3&gt;&#10;                &lt;span class=&quot;badge falling&quot;&gt;Falling Tone&lt;/span&gt;&#10;                &lt;p&gt;测试对低音区降调变化的敏感度。通过调节调制窗口时长，评估您对音高下降的辨别能力。&lt;/p&gt;&#10;                &lt;a href=&quot;ABX_falling_low.html&quot; class=&quot;btn&quot; onclick=&quot;event.stopPropagation()&quot;&gt;开始实验&lt;/a&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;experiment-card&quot; onclick=&quot;window.location.href='ABX_falling_high.html'&quot;&gt;&#10;                &lt;div class=&quot;experiment-icon&quot;&gt;&lt;/div&gt;&#10;                &lt;h3&gt;动态音高辨别-高降调&lt;/h3&gt;&#10;                &lt;span class=&quot;badge falling&quot;&gt;Falling Tone&lt;/span&gt;&#10;                &lt;p&gt;测试对低音区平调变化的敏感度。评估您在高频范围内对音高下降的感知精度。&lt;/p&gt;&#10;                &lt;a href=&quot;ABX_falling_high.html&quot; class=&quot;btn&quot; onclick=&quot;event.stopPropagation()&quot;&gt;开始实验&lt;/a&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;experiment-card&quot; onclick=&quot;window.location.href='ABX_level_high.html'&quot;&gt;&#10;                &lt;div class=&quot;experiment-icon&quot;&gt;&lt;/div&gt;&#10;                &lt;h3&gt;静态音高辨别-高调域&lt;/h3&gt;&#10;                &lt;span class=&quot;badge rising&quot;&gt;Rising Tone&lt;/span&gt;&#10;                &lt;p&gt;测试对高音区平调变化的敏感度。评估您在高频范围内对音高的辨别能力。&lt;/p&gt;&#10;                &lt;a href=&quot;ABX_level_high.html&quot; class=&quot;btn&quot; onclick=&quot;event.stopPropagation()&quot;&gt;开始实验&lt;/a&gt;&#10;            &lt;/div&gt;&#10;&#10;            &lt;div class=&quot;experiment-card&quot; onclick=&quot;window.location.href='ABX_level_low.html'&quot;&gt;&#10;                &lt;div class=&quot;experiment-icon&quot;&gt;&lt;/div&gt;&#10;                &lt;h3&gt;静态音高辨别-低调域&lt;/h3&gt;&#10;                &lt;span class=&quot;badge falling&quot;&gt;Falling Tone&lt;/span&gt;&#10;                &lt;p&gt;测试对低音区平调变化的敏感度。评估您在低频范围内对音高的辨别能力。&lt;/p&gt;&#10;                &lt;a href=&quot;ABX_level_low.html&quot; class=&quot;btn&quot; onclick=&quot;event.stopPropagation()&quot;&gt;开始实验&lt;/a&gt;&#10;            &lt;/div&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div class=&quot;info-section&quot;&gt;&#10;            &lt;h3&gt; 实验说明&lt;/h3&gt;&#10;            &lt;ul&gt;&#10;                &lt;li&gt;&lt;strong&gt;实验范式：&lt;/strong&gt;ABX三音辨别任务 - 您将听到三个音，判断第三个音更像第一个还是第二个&lt;/li&gt;&#10;                &lt;li&gt;&lt;strong&gt;自适应算法：&lt;/strong&gt;系统会根据您的表现自动调整难度，精确定位您的辨别阈值&lt;/li&gt;&#10;                &lt;li&gt;&lt;strong&gt;测量指标：&lt;/strong&gt;Just Noticeable Difference (JND) - 可察觉的最小差异&lt;/li&gt;&#10;                &lt;li&gt;&lt;strong&gt;实验时长：&lt;/strong&gt;每个实验约需10-15分钟完成&lt;/li&gt;&#10;                &lt;li&gt;&lt;strong&gt;结果分析：&lt;/strong&gt;实验结束后可查看详细的阈值分析报告和性能统计&lt;/li&gt;&#10;                &lt;li&gt;&lt;strong&gt;数据导出：&lt;/strong&gt;支持导出CSV格式的详细实验数据&lt;/li&gt;&#10;                &lt;li&gt;&lt;strong&gt;建议环境：&lt;/strong&gt;请在安静环境下使用耳机完成实验，以获得最佳测试效果&lt;/li&gt;&#10;            &lt;/ul&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div class=&quot;info-section&quot; style=&quot;background: #fff3cd; margin-top: 20px;&quot;&gt;&#10;            &lt;h3&gt;⚠️ 注意事项&lt;/h3&gt;&#10;            &lt;ul&gt;&#10;                &lt;li&gt;首次使用时，浏览器可能会请求音频播放权限，请点击允许&lt;/li&gt;&#10;                &lt;li&gt;建议使用Chrome、Firefox或Edge等现代浏览器&lt;/li&gt;&#10;                &lt;li&gt;实验过程中请保持专注，避免中途退出&lt;/li&gt;&#10;                &lt;li&gt;如遇到音频播放问题，可点击实验页面中的&quot;Diagnostics&quot;按钮进行诊断&lt;/li&gt;&#10;            &lt;/ul&gt;&#10;        &lt;/div&gt;&#10;    &lt;/div&gt;&#10;&#10;    &lt;div class=&quot;footer&quot;&gt;&#10;        &lt;p&gt;&amp;copy; 2024 PLOYU-Peng's Lab | Pitch Sensitivity Training System&lt;/p&gt;&#10;        &lt;p style=&quot;margin-top: 5px; font-size: 12px;&quot;&gt;Powered by Adaptive Threshold Experiment Technology&lt;/p&gt;&#10;    &lt;/div&gt;&#10;&lt;/div&gt;&#10;&#10;&lt;script&gt;&#10;    // 页面加载动画&#10;    document.addEventListener('DOMContentLoaded', function() {&#10;        const cards = document.querySelectorAll('.experiment-card');&#10;        cards.forEach((card, index) =&gt; {&#10;            card.style.opacity = '0';&#10;            card.style.transform = 'translateY(20px)';&#10;            setTimeout(() =&gt; {&#10;                card.style.transition = 'all 0.5s ease';&#10;                card.style.opacity = '1';&#10;                card.style.transform = 'translateY(0)';&#10;            }, index * 100);&#10;        });&#10;    });&#10;&#10;    // 检查实验文件是否存在&#10;    window.addEventListener('load', function() {&#10;        const experimentFiles = [&#10;            'ABX_rising_low.html',&#10;            'ABX_rising_high.html',&#10;            'ABX_falling_low.html',&#10;            'ABX_falling_high.html',&#10;            'ABX_rising_mid.html',&#10;            'ABX_falling_mid.html'&#10;        ];&#10;&#10;        // 可以在这里添加文件存在性检查逻辑&#10;        console.log('实验系统已加载');&#10;        console.log('可用实验:', experimentFiles);&#10;    });&#10;&lt;/script&gt;&#10;&lt;/body&gt;&#10;&lt;/html&gt;" />
                  </map>
                </option>
                <option name="inputToken" value="2351913" />
                <option name="messageId" value="019a6732969a7fb6ab788be3ee9cfce5" />
                <option name="model" value="claude-4.5-sonnet" />
                <option name="outputToken" value="23758" />
                <option name="protocol" value="ag-ui" />
                <option name="question" value="我想要使用VnzroQH实现，你仔细阅读代码，在完成实验后会生成一个xhe文件，请将该文件作为附件发送，收件人邮箱是固定的，不需要用户确认。&#13;&#10;请将发送邮箱功能封装在qh文件中" />
                <option name="rating" value="UNRATED" />
                <option name="referenceBeans">
                  <list />
                </option>
                <option name="status" value="SUCCESS" />
                <option name="totalToken" value="2375671" />
                <option name="variables">
                  <list />
                </option>
              </Turn>
            </list>
          </option>
          <option name="updateTime" value="1762668442079" />
        </Conversation>
      </list>
    </option>
  </component>
</project>